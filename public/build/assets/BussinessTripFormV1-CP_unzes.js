import{r as d,u as ze,j as e,b as We}from"./app-DmdjFYN3.js";import{d as He,F as b,a as y,b as S,c as D,e as Ke}from"./form-CqaPDspB.js";import{z as r,t as Ze}from"./index-BQDDbtGT.js";import{d as Z}from"./index-CfLX6Nrw.js";import{B as Qe}from"./button-ByWU15lG.js";import{T as Ue}from"./textarea-DcskZrXp.js";import{u as et,b as re,c as tt}from"./index.esm-CKoOinFG.js";import{S as at}from"./scroll-area-DxTtq742.js";import{S as Q}from"./separator-fZ3zoYV1.js";/* empty css              */import{a as k}from"./axiosInstance-Bgc-5Uba.js";import{W as st}from"./WorkflowComponent-B3S7LAR3.js";import{F as rt}from"./formSwitchCustom-DxKkg0Fc.js";import{I as ne}from"./input-DBXbMqR8.js";import{S as U,a as ee,b as te,c as ae,d as A}from"./select-BfvEDJjB.js";import{C as nt,E as ot,a as it}from"./api-BQWbUuI8.js";import{G as se,a as lt}from"./api-BEQetkWJ.js";import{h as q}from"./moment-C5S46NFB.js";import{BusinessTripType as j}from"./models-DxedGf0Y.js";import{u as w}from"./getDropdown-HLpn0cwd.js";import{F as $}from"./formDropdown-BBndZPCe.js";import{f as ct}from"./rupiahCurrencyFormat-CP-6egij.js";import{BussinesTripDestination as dt}from"./BussinesTripDestination-CVRlepxK.js";import{B as pt}from"./Button-BXNR_zZl.js";import"./app-DQK4SJPx.js";import"./index-ChSjQNUV.js";import"./utils-DkKlTS5W.js";import"./index-DuB2W0Qy.js";import"./index-Bb4qSo10.js";import"./index-CwK3G1m4.js";import"./index-Bvuzssq6.js";import"./createSvgIcon-BjVbGZeT.js";import"./DefaultPropsProvider-CwyvXzBo.js";import"./extends-CF3RwP-h.js";import"./createLucideIcon-ufL-sbNF.js";import"./Switch-B8jH8aHn.js";import"./createSimplePaletteValueFilter-BPz92A5r.js";import"./SwitchBase-DWNSWEKM.js";import"./FormHelperText-CDzZYCvV.js";import"./useControlled-DyI6iNHe.js";import"./index-7sizUBCg.js";import"./index-U_nQZURT.js";import"./Combination-dV56z6h6.js";import"./index-9m1hz7GY.js";import"./index-spAMJ4bx.js";import"./index-D14G0JmU.js";import"./CustomStatus-Cp7HloCf.js";import"./TextField-Ae-BOfAt.js";import"./useSlot-DkcPt954.js";import"./tabs-xiyoa8Aq.js";import"./index-DYcOYdjm.js";import"./BussinessDestinationForm-_2ZwtStj.js";import"./CustomDatePicker-BhrZUTiD.js";import"./popover-BbJTFm7J.js";import"./DetailAttedances-f6u_jsQe.js";import"./DetailAllowance-Bz3tqqB_.js";import"./chevrons-up-down-CDV25hLh.js";import"./ResultTotalItem-B56xi8Vf.js";r.object({remark:r.string().min(1).max(50),reimburse_cost:r.number()});const mt=1*1024*1024,ut=["image/jpeg","image/jpg","image/png","image/heic","application/pdf"],ba=({users:I,listPurposeType:oe,pajak:R,costcenter:V,purchasingGroup:Y,type:u,id:f,isAdmin:_,idUser:h})=>{const ie=r.object({purpose_type_id:r.string().min(1,"Purpose type required"),request_for:r.string().min(1,"Request is required"),cost_center_id:r.string().min(1,"Cost Center is required"),remark:r.string().min(1,"Remark is required"),attachment:r.array(r.instanceof(File).refine(t=>ut.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(t=>t.size<=mt,{message:"File size must be less than 1MB"})),total_destination:r.number().min(1,"Total Destinantion Required"),cash_advance:r.boolean().nullable().optional(),total_percent:r.string().nullable().optional(),total_cash_advance:r.string().nullable().optional(),destinations:r.array(r.object({destination:r.string().min(1,"Destinantion is Required"),pajak_id:r.string().min(1,"Pajak is required"),purchasing_group_id:r.string().min(1,"Purchasing Group is required"),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.date().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),default_price:r.number().optional(),type:r.string().optional(),subtotal:r.number().optional(),currency:r.string().optional(),detail:r.array(r.object({date:r.date().nullish(),request_price:r.any().optional()}))}))}))}),[B,le]=d.useState("1"),n=et({resolver:Ze(ie),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[T,M]=d.useState([]),[ce,de]=d.useState(null),[G,L]=d.useState([]);async function pe(){const t=it(f);n.setValue("destinations",[]);try{const s=(await We.get(t)).data.data,o=se(s.purpose_type_id,s.request_for.id),i=await k.get(o);L(i.data.data),O("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:s.purpose_type.type}}),de(s.request_no),M(s.attachments),n.setValue("purpose_type_id",s.purpose_type_id.toString()),n.setValue("request_for",s.request_for.id.toString()),n.setValue("cost_center_id",s.cost_center_id.toString()),n.setValue("remark",s.remarks),n.setValue("total_destination",s.total_destination),n.setValue("cash_advance",s.cash_advance==1),n.setValue("total_percent",s.total_percent),n.setValue("total_cash_advance",s.total_cash_advance),n.setValue("destinations",s.destinations.map(l=>({destination:l.destination,pajak_id:l.pajak_id,purchasing_group_id:l.purchasing_group_id,business_trip_start_date:new Date(l.business_trip_start_date),business_trip_end_date:new Date(l.business_trip_end_date),detail_attedances:l.detail_attedances.map(c=>({...c,date:new Date(c.date)})),allowances:l.allowances.map(c=>({...c,default_price:parseInt(c.default_price),subtotal:parseInt(c.subtotal),detail:c.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?new Date(p.date):null}))}))})))}catch{}}const[me,ue]=d.useState(""),{dataDropdown:_e,getDropdown:O}=w(),[he,fe]=d.useState(_==="0"?h==null?void 0:h.toString():"");async function xe(t){n.setValue("purpose_type_id",t||"");const a=_=="0"?h||"":he||"",s=se(t,a),o=lt(t);try{const i=await k.get(s),l=await k.get(o);ue(me),L(i.data.data),O("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:l.data.data.purpose.type}})}catch(i){console.log(i)}}const ge=t=>{n.setValue("total_destination",parseInt(t,10)),le(t),X()},{showToast:F}=ze(),je=async t=>{console.log(T," valuesss");try{const a=new FormData,s=J();if(a.append("user_id",t.request_for??""),a.append("value",s.toString()),a.append("purpose_type_id",t.purpose_type_id??""),a.append("request_for",t.request_for??""),a.append("cost_center_id",t.cost_center_id??""),a.append("remark",t.remark??""),a.append("cash_advance",`${t.cash_advance}`),a.append("total_percent",`${t.total_percent}`),a.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((o,i)=>{o&&a.append(`attachment[${i}]`,o)}),a.append("total_destination",`${t.total_destination}`),t.destinations.forEach((o,i)=>{const l={...o,business_trip_start_date:q(o.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:q(o.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:o.detail_attedances.map(c=>({...c,date:q(c.date).format("YYYY-MM-DD")})),allowances:o.allowances.map(c=>({...c,detail:c.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?q(p.date).format("YYYY-MM-DD"):null}))}))};a.append(`destinations[${i}]`,JSON.stringify(l))}),u==j.create)await Z.Inertia.post(nt,a,{headers:{"Content-Type":"multipart/form-data"}}),F("succesfully created data","success");else{const o=new FormData;o.append("remark",t.remark??""),t.attachment.forEach((i,l)=>{i&&o.append(`attachment[${l}]`,i)}),T.forEach((i,l)=>{i&&o.append(`file_existing[${l}]`,JSON.stringify(i))}),await Z.Inertia.post(`${ot}/${f}`,o,{headers:{"Content-Type":"multipart/form-data"}}),F("succesfully updated data","success")}}catch(a){console.log(a)}};function X(){const t=[],a=parseInt(B);for(let s=0;s<a;s++)t.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});n.setValue("destinations",t)}const{fields:we,append:_t,remove:ht,update:be}=re({control:n.control,name:"destinations"}),[ye,Se]=d.useState(!1);d.useEffect(()=>{f&&u==j.clone&&(pe(),Se(!0))},[u]),d.useEffect(()=>{u==j.create&&X()},[B,G,_,h]);const[ve,De]=d.useState(!1),[v,Te]=d.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Fe=(t,a)=>{var s;return t.type==="total"?parseFloat(((s=a==null?void 0:a[0])==null?void 0:s.request_price)||0):a==null?void 0:a.reduce((o,i)=>o+parseFloat(i.request_price||0),0)},J=()=>n.getValues("destinations").reduce((s,o,i)=>{const c=(o.allowances||[]).reduce((p,N,C)=>{const P=n.getValues(`destinations.${i}.allowances.${C}.detail`),E=Fe(N,P);return p+E},0);return s+c},0),Ne=async()=>{var t,a,s,o,i,l,c,p,N,C,P,E;try{const x=J();if(x===0){F("Please fill the balance","error");return}const g=await k.get("/check-approval",{params:{value:x,user_id:n.getValues("request_for"),type:"TRIP"}});if(g.data.status_code===200){const Oe=(a=(t=g.data)==null?void 0:t.data)==null?void 0:a.approval.map(m=>(m==null?void 0:m.division_name)||null),Xe=(o=(s=g.data)==null?void 0:s.data)==null?void 0:o.approval.map(m=>(m==null?void 0:m.name)||null),K=[];(l=(i=g.data)==null?void 0:i.data)!=null&&l.hr&&K.push((N=(p=(c=g.data)==null?void 0:c.data)==null?void 0:p.hr)==null?void 0:N.name);const Je=(((C=g.data.data)==null?void 0:C.approval)??[]).map(m=>({status:"",name:m.name,dateApproved:""}));Te({approvalRequest:Oe,approvalFrom:Xe,acknowledgeFrom:K,approvalFromStatusRoute:Je}),De(!0)}}catch(x){F((E=(P=x==null?void 0:x.response)==null?void 0:P.data)==null?void 0:E.message,"error")}};d.useEffect(()=>{},[n.watch("destinations")]);const Ce=t=>{M(a=>a.filter(s=>s.id!==t))},[Pe,z]=d.useState(!1),Ee=t=>{z(t)},W=tt({control:n.control,name:"total_percent"}),[ke,Ae]=d.useState(0),H=ke;d.useEffect(()=>{u==j.clone&&z(n.getValues("cash_advance")??!1);const a=parseFloat((W||"0").toString())/100*H;n.setValue("total_cash_advance",ct(a.toFixed(0),!1))},[W,H]);const{dataDropdown:qe,getDropdown:Ie}=w(),{dataDropdown:Re,getDropdown:Ve}=w(),{dataDropdown:Ye,getDropdown:$e}=w(),{dataDropdown:Be,getDropdown:Me}=w(),{dataDropdown:Ge,getDropdown:Le}=w();return d.useEffect(()=>{Ie("",{name:"name",id:"id",tabel:"users",idType:"string"}),Ve("",{name:"name",id:"id",tabel:"purpose_types",idType:"string"}),$e("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),Me("",{name:"mwszkz",id:"id",tabel:"pajaks",idType:"string"}),Le("",{name:"purchasing_group",id:"id",tabel:"purchasing_groups",idType:"string"})},[]),d.useEffect(()=>{u!=j.clone&&_=="0"&&n.setValue("request_for",(h==null?void 0:h.toString())??"")},[]),e.jsx(at,{className:"h-[600px] w-full ",children:e.jsx(He,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(je),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),ye&&e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"From Request No."}),e.jsx("td",{className:"text-sm",children:ce})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Request For ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx($,{fieldLabel:"",options:qe,fieldName:"request_for",isRequired:!0,disabled:_=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{fe(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussiness Trip Purpose Type",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx($,{fieldLabel:"",options:Re,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,a)=>{await xe(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx($,{fieldLabel:"",options:Ye,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Remark",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(b,{control:n.control,name:"remark",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(Ue,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(D,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(b,{control:n.control,name:"attachment",render:({field:t})=>e.jsxs(y,{children:[e.jsx(Ke,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(S,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:a=>{const s=a.target.files;if(s){const o=Array.from(s);t.onChange(o)}else t.onChange([])}})}),n.formState.errors.attachment&&Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((a,s)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:a.message},s)):null]})})})]}),T.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:T.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:t.file_name},a),e.jsx("button",{type:"button",onClick:()=>Ce(t.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]},a))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Total Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[" ",e.jsx(b,{control:n.control,name:"total_destination",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(U,{value:t.value.toString(),onValueChange:ge,disabled:!1,children:[e.jsx(ee,{className:"w-[200px] py-2",children:e.jsx(te,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(ae,{children:Array.from({length:5},(a,s)=>e.jsxs(A,{value:(s+1).toString(),children:[" ",s+1," "]},s))})]})}),e.jsx(D,{})]})})]})]})]}),e.jsx(Q,{className:"my-4"}),e.jsx(dt,{updateDestination:be,destinationField:we,form:n,listAllowances:G,totalDestination:n.getValues("total_destination").toString(),pajak:R,purchasingGroup:Y,setTotalAllowance:Ae,dataTax:Be,dataPurchasingGroup:Ge,dataDestination:_e,type:u,btClone:j.clone}),e.jsx(Q,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(rt,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Ee(t.target.checked)})})]}),Pe&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(b,{control:n.control,name:"total_percent",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(U,{value:t.value||void 0,onValueChange:a=>t.onChange(a),children:[e.jsx(ee,{className:"w-[50%] mb-2",children:e.jsx(te,{placeholder:"-- Select Total Percent --"})}),e.jsxs(ae,{children:[e.jsx(A,{value:"10",children:"10%"}),e.jsx(A,{value:"25",children:"25%"}),e.jsx(A,{value:"50",children:"50%"})]})]})}),e.jsx(D,{})]})}),e.jsx(b,{control:n.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(ne,{value:t.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(D,{})]})})]})]})})]}),e.jsx(pt,{onClick:async()=>await Ne(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ve&&e.jsx(st,{workflowApproval:{approvalRequest:v.approvalRequest,approvalFrom:v.approvalFrom,acknowledgeFrom:v.acknowledgeFrom},workflowApprovalStep:v.approvalFromStatusRoute,workflowApprovalDiagram:v.approvalFrom})}),e.jsx(Qe,{type:"submit",children:"submit"})]})})})};function ya({form:I,type:oe,allowanceIndex:R,destinationIndex:V}){const{fields:Y}=re({control:I.control,name:`destinations.${V}.allowances.${R}.detail`});return e.jsx(e.Fragment,{children:Y.map((u,f)=>e.jsx(b,{control:I.control,name:`destinations.${V}.allowances.${f}.detail.${f}.request_price`,render:({field:_})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(ne,{value:_.value,onChange:_.onChange})}),e.jsx(D,{})]})}))})}export{ya as AllowanceInputForm,ba as BussinessTripFormV1};
