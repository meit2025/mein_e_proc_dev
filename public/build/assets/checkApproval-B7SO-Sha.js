import{b as O,r as d,u as W,j as a}from"./app-Dd2dlN2u.js";import{a as B}from"./axiosInstance-C9H9WqCQ.js";import{L as H}from"./Loading-BY_5lJHL.js";import{W as M}from"./WorkflowComponent-DPDXPz9M.js";import{F as v}from"./formDropdown-DUeNwkpq.js";import{u as C}from"./getDropdown-Bjw7Diaj.js";import{a as U}from"./index.esm-BFAzSaQL.js";import{B as Z}from"./Button-DquElond.js";import"./app-DQK4SJPx.js";import"./index-DAB5glv1.js";import"./createSvgIcon-CA6hYm9j.js";import"./DefaultPropsProvider-veLoW-9k.js";import"./createLucideIcon-Bbfnrd4H.js";import"./TextField-BAkpb4w0.js";import"./useSlot-CW1kY3I5.js";import"./createSimplePaletteValueFilter-CIy_9DDw.js";import"./useControlled-D4uQCTco.js";import"./FormHelperText-BkWYcPXr.js";const{Axios:ue,AxiosError:J,CanceledError:_e,isCancel:ve,CancelToken:fe,VERSION:ge,all:he,Cancel:ke,isAxiosError:we,spread:be,toFormData:Ae,AxiosHeaders:xe,HttpStatusCode:ye,formToJSON:Ce,getAdapter:Fe,mergeConfig:je}=O,Se=({isDisabled:z})=>{const{getValues:f,watch:i,setValue:F}=U(),[j,r]=d.useState(!1),[S,g]=d.useState(!1),[s,N]=d.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),{dataDropdown:R,getDropdown:D}=C(),{dataDropdown:E,getDropdown:T}=C(),{showToast:o}=W(),P=i("document_type"),L=i("metode_approval"),q=async()=>{var t,h,k,w,b,A,x;try{const e=f(),m=f("vendors").filter(l=>(l.winner||!1)===!0),p=m.length>0?m[0]:null;if(p==null){r(!1),o("Please Select Vendor Winner","error");return}const u=((p==null?void 0:p.units)||[]).reduce((l,_)=>l+_.total_amount,0);if(F("total_all_amount",u),e.document_type===null||e.document_type===void 0){r(!1),o("Please input Document Type","error");return}if(e.purchasing_groups===null||e.purchasing_groups===void 0){r(!1),o("Please input purchasing group","error");return}if(i("total_all_amount")===null||i("total_all_amount")===void 0||u===0){r(!1),o("Please input Item","error");return}if(e.user_id===null||e.user_id===void 0){r(!1),o("Please input Item","error");return}if(e.document_type==="ZENT"){if(e.metode_approval===null||e.metode_approval===void 0){r(!1),o("Please select metode approval","error");return}if(e.metode_approval==="chooses_approval"&&(e.chooses_approval_id===null||e.chooses_approval_id===void 0)){r(!1),o("Please select chooses approval","error");return}}const c=await B.get("/check-approval",{params:{document_type_id:e.document_type,purchasing_group_id:e.purchasing_groups,value:u,user_id:e.user_id,type:"PR",metode_approval:e.metode_approval,chooses_approval_id:e.chooses_approval_id,tracking_approval_id:e.tracking_approval_id}});if(c.data.status_code===200){const l=(h=(t=c.data)==null?void 0:t.data)==null?void 0:h.approval_route.map(n=>{var y;return((y=n.user.divisions)==null?void 0:y.name)||null}),_=(w=(k=c.data)==null?void 0:k.data)==null?void 0:w.approval_route.map(n=>n.user.name),V=(((A=(b=c.data)==null?void 0:b.data)==null?void 0:A.approval_route)??[]).map(n=>({status:"",name:n.user.name,dateApproved:""}));N({approvalRequest:l,approvalFrom:_,acknowledgeFrom:[],approvalFromStatusRoute:V}),g(!0)}r(!1)}catch(e){if(r(!1),g(!1),e instanceof J&&e.response){const m=((x=e.response.data)==null?void 0:x.message)||"An unexpected error occurred";o(m,"error")}else e instanceof Error?o(e.message,"error"):o("An unexpected error occurred","error")}},I=t=>{T("",{name:"master_tracking_numbers.name",id:"master_tracking_numbers.id",tabel:"approval_tracking_number_choose_routes",join:"master_tracking_numbers,master_tracking_numbers.id,=,approval_tracking_number_choose_routes.master_tracking_number_id",where:{key:"approval_tracking_number_choose_id",parameter:t}})};return d.useEffect(()=>{D("",{name:"name",id:"id",tabel:"approval_tracking_number_chooses"})},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[a.jsx(H,{isLoading:j}),a.jsxs("div",{className:"card-body",children:[a.jsx("div",{className:"flex justify-start mt-4 mb-2",children:a.jsx(Z,{onClick:async()=>await q(),variant:"contained",color:"primary",type:"button",children:"Check Approval"})}),P==="ZENT"&&a.jsxs(a.Fragment,{children:[a.jsx(v,{options:[{label:"Approval",value:"approval"},{label:"Chooses Approval Tracking Number",value:"chooses_approval"},{label:"Automatic Approval Tracking Number",value:"automatic_approval_by_purchasing_group"}],fieldLabel:"Metode Approval",fieldName:"metode_approval",disabled:!1,style:{width:"58.5rem"},placeholder:"Metode Approval",classNames:"mt-2"}),L==="chooses_approval"&&a.jsxs(a.Fragment,{children:[a.jsx(v,{options:R,fieldLabel:"Chooses approval",fieldName:"chooses_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2",onChangeOutside:t=>{I(t)}}),a.jsx(v,{options:E,fieldLabel:"Tracking Approval",fieldName:"tracking_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2"})]})]}),S&&a.jsx(M,{workflowApproval:{approvalRequest:s.approvalRequest,approvalFrom:s.approvalFrom,acknowledgeFrom:s.acknowledgeFrom},workflowApprovalStep:s.approvalFromStatusRoute,workflowApprovalDiagram:s.approvalFrom})]})]})})};export{Se as default};
