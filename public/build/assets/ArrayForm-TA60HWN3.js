import{u as ye,r as I,j as t,a as xe,x as k}from"./app-B6mX289p.js";import{a as we,c as j}from"./index.esm-DFF6wkEY.js";import{F as c}from"./formDropdown-Mr4BOcnD.js";import{F as M}from"./formInput-CnxAf11v.js";import{F as ve}from"./formSwitch-CFJ1O-pQ.js";import{F as Ne}from"./formTextArea-D7IyV72J.js";import{a as Z}from"./axiosInstance-DD8iEQY9.js";import{columnsItem as je}from"./listModel-CuM4yovq.js";import{f as O}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{u as _}from"./getDropdown-DqqIdocs.js";import{B}from"./Button-CmkD72nO.js";import{B as W}from"./Box-Bzmb58UI.js";import{T as Q}from"./Typography-LS0vXV-X.js";import{D as Ee}from"./DataGrid-BFpLwrzW.js";import"./app-ffJwujpg.js";import"./TextField-PUQBNOwG.js";import"./createSvgIcon-DmYpHUQR.js";import"./DefaultPropsProvider-het2hsiR.js";import"./useSlot-D-LoQ1ir.js";import"./createSimplePaletteValueFilter-CxkDmgqu.js";import"./CircularProgress-DB2mA4FB.js";import"./FormHelperText-DqYHdCa9.js";import"./mergeSlotProps-Edkec8ME.js";import"./Switch-C0Ijva5d.js";import"./SwitchBase-BS36dm95.js";import"./index-B4jUsV-j.js";import"./CustomStatus-BTF_ZN8f.js";import"./utils-Bqp0N6xH.js";import"./createLucideIcon-BSSYJmNL.js";import"./page-DZboPOZw.js";import"./moment-C5S46NFB.js";import"./index-Bzm0rjDn.js";import"./ListItemText-DjyckJif.js";import"./FormControlLabel-selIn7dz.js";import"./KeyboardArrowRight-DeDzS5dg.js";const ot=({dataIndex:a,subAsset:z,FetchDataValue:Y,disable:i})=>{const{getValues:m,setValue:r,watch:f}=we(),{dataDropdown:y,getDropdown:E}=_(),{dataDropdown:H,getDropdown:J}=_(),{dataDropdown:K,getDropdown:ee}=_(),{dataDropdown:te,getDropdown:re}=_(),{dataDropdown:F,getDropdown:se}=_(),{dataDropdown:ne,getDropdown:ae}=_(),{dataDropdown:ie,getDropdown:oe}=_(),{dataDropdown:T,getDropdown:D}=_(),{dataDropdown:V,getDropdown:L}=_(),{showToast:S}=ye(),P=f(`vendors[${a}].units`),g=j({name:"item_account_assignment_categories"}),G=j({name:"document_type"}),me=j({name:"item_material_group"}),$=j({name:"currency_from"});I.useEffect(()=>{J("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",hiddenZero:!0,isMapping:!0}),E("",{name:"name_one || ' - ' || REGEXP_REPLACE(partner_number, '^(0+)(\\d)', '\\2') ",id:"id",tabel:"master_business_partners",hiddenZero:!0,isMapping:!1,raw:!0,hasValue:{key:m(`vendors[${a}].vendor`)?"id":"",value:m(`vendors[${a}].vendor`)??""}}),re("",{name:"material_group_desc",id:"material_group",tabel:"material_groups",hiddenZero:!0,isMapping:!0}),ae("",{name:"description",id:"mwszkz",tabel:"pajaks",hiddenZero:!0,isMapping:!0}),oe("",{name:"unit_of_measurement_text",id:"commercial",tabel:"uoms",hiddenZero:!0,isMapping:!0}),D("",{name:"master_orders.desc || ' - ' || REGEXP_REPLACE(order_number, '^(0+)(\\d)', '\\2') ",id:"order_number",tabel:"master_orders",hiddenZero:!1,isMapping:!1,raw:!0}),L("",{name:"master_assets.desc || ' - ' || REGEXP_REPLACE(asset, '^(0+)(\\d)', '\\2') ",id:"asset",tabel:"master_assets",where:{groupBy:"asset,master_assets.desc"},raw:!0}),x(me)},[]),I.useEffect(()=>{ee("",{name:"description",id:"account",tabel:"account_assignment_categories",attribut:G,hiddenZero:!0,isMapping:!0})},[G]);const x=async e=>{se("",{name:"material_description",id:"material_number",tabel:"master_materials",attribut:e,isMapping:!0,hiddenZero:!0,where:{key:"material_group",parameter:e}})},le=async()=>{var e,n;try{const s=m(),l=Object.entries({item_qty:"Qty",item_unit_price:"Unit Price",item_account_assignment_categories:"Account Assignment",item_material_group:"Grup Material",item_material_number:"Number Material",item_uom:"UOM",item_tax:"Tax",item_short_text:"Short Text"}).filter(([o])=>!s[o]).map(([o,N])=>N);if(l.length>0){S(`Harap lengkapi data berikut sebelum menambahkan item:
- ${l.join(`
- `)}`,"error");return}const d=s.item_id!==void 0&&s.item_id!==null&&s.item_id!==""?s.item_id:`random-generated-id-${Math.random().toString(36).substr(2,9)}`;let p=0;s.is_conversion_currency&&(p=(await Z.post("/currency-conversion",{from:s.currency_from,to:s.currency_to,amount:parseInt(s.item_qty)*parseInt(s.item_unit_price)},{headers:{"Content-Type":"application/json"}})).data.data);const A=F.filter(o=>o.material_number===s.item_material_number);console.log("dataMaterialDesc",A);const b={id:d,qty:s.item_qty,unit_price:s.item_unit_price,total_amount:s.item_qty*s.item_unit_price,account_assignment_categories:s.item_account_assignment_categories,cost_center:s.item_cost_center,material_group:s.item_material_group,material_number:s.item_material_number,material_number_description:s.item_material_number_description,uom:s.item_uom,tax:s.item_tax,short_text:s.item_short_text,order_number:s.item_order_number,asset_number:s.item_asset_number,sub_asset_number:s.item_sub_asset_number,total_amount_conversion:p},w=m(`vendors[${a}].units`)||[];let v=[];s.action==="edit"?v=w.map((o,N)=>o.id===s.indexEdit?b:o):v=[...w,b],r(`vendors[${a}].units`,v),r("indexEdit",0),r("item_id",null);const C=m("vendors").filter(o=>(o.winner||!1)===!0),h=C.length>0?C[0]:null;if(h!==null){const o=h.units||[],N=o.reduce((R,q)=>R+parseInt(q.total_amount),0);r("total_all_amount",N);const fe=o.reduce((R,q)=>q.unit_price>R?parseInt(q.unit_price):R,0);r("amount_max",fe);const ge=parseInt(f("cash_advance_purchases.dp"))/100*parseInt(N);r("cash_advance_purchases.nominal",ge)}U()}catch(s){xe.isAxiosError(s)&&((n=(e=s.response)==null?void 0:e.data)!=null&&n.message)&&S(s.response.data.message,"error")}},U=()=>{r("indexEdit",""),r("action","create"),r("item_account_assignment_categories",""),r("item_asset_number",""),r("item_cost_center",""),r("item_id",""),r("item_is_cashAdvance",""),r("item_material_group","NTSVC"),r("item_material_number",""),r("item_material_number_description",""),r("item_order_number",""),r("item_qty",""),r("item_short_text",""),r("item_sub_asset_number",""),r("item_tax","V0"),r("item_unit_price",""),r("item_uom","AU"),x("NTSVC")},ce=async(e,n)=>{const s=e.id||`random-generated-id-${Math.random().toString(36).substr(2,9)}`;await x(e.material_group),r("indexEdit",s),r("action","edit"),r("item_account_assignment_categories",e.account_assignment_categories??""),r("item_asset_number",e.asset_number??""),r("item_cost_center",e.cost_center??""),r("item_id",s),r("item_material_group",e.material_group??""),r("item_material_number",e.material_number??""),r("item_material_number_description",e.material_number_description??""),r("item_order_number",e.order_number??""),r("item_qty",e.qty??"0"),r("item_short_text",e.short_text??""),r("item_sub_asset_number",e.sub_asset_number??""),r("item_tax",e.tax??""),r("item_unit_price",e.unit_price??"0"),r("item_uom",e.uom??"")},ue=async(e,n)=>{const s=`random-generated-id-${Math.random().toString(36).substr(2,9)}`;await x(e.material_group),r(": currency_total,",e.uom??"");const u={id:s,qty:e.qty??"0",unit_price:e.unit_price??"0",total_amount:parseInt(e.qty)*parseInt(e.unit_price),account_assignment_categories:e.account_assignment_categories,cost_center:e.cost_center??"",material_group:e.material_group??"",material_number:e.material_number??"",material_number_description:e.material_number_description??"",uom:e.uom??"",tax:e.tax??"",short_text:e.short_text??"",order_number:e.order_number??"",asset_number:e.asset_number??"",sub_asset_number:e.sub_asset_number??"",total_amount_conversion:e.total_amount_conversion??""},d=[...m(`vendors[${a}].units`)||[],u];r(`vendors[${a}].units`,d);const p=m("vendors").filter(b=>(b.winner||!1)===!0),A=p.length>0?p[0]:null;if(A!==null){const b=A.units||[],w=b.reduce((h,o)=>h+parseInt(o.total_amount),0);r("total_all_amount",w);const v=b.reduce((h,o)=>o.unit_price>h?parseInt(o.unit_price):h,0);r("amount_max",v);const C=parseInt(f("cash_advance_purchases.dp"))/100*parseInt(w);r("cash_advance_purchases.nominal",C)}U()},de=(e,n)=>{const u=(m(`vendors[${a}].units`)||[]).filter((l,d)=>l.id!==e.id);r(`vendors[${a}].units`,u)},X=j({name:"total_vendor"}),_e=X>0?X:1,pe=e=>{const n=m(`vendors[${a}].units`)||[];r(`vendors[${e}].units`,n)};I.useEffect(()=>{(async()=>{const n=m(),s=m(`vendors[${a}].units`)||[];if(!n.is_conversion_currency)return;const u=await Promise.all(s.map(async l=>{let d=l.unit_price;($==="IDR"||$==="JPY")&&(d=l.unit_price.toString().split(/[.,]/)[0]);try{const p=await Z.post("/currency-conversion",{from:n.currency_from,to:n.currency_to,amount:parseInt(l.qty)*parseInt(l.unit_price)},{headers:{"Content-Type":"application/json"}});return{...l,total_amount_conversion:p.data.data,unit_price:d,total_amount:parseInt(d)*parseInt(l.qty)}}catch{return{...l,total_amount_conversion:0,unit_price:parseInt(d),total_amount:parseInt(d)*parseInt(l.qty)}}}));r(`vendors[${a}].units`,u)})()},[$]);const be=[{field:"actions",headerName:"Actions",width:150,renderCell:e=>t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[t.jsx(k,{type:"button",onClick:n=>{n.preventDefault(),ue(e.row)},href:"#",children:t.jsx("i",{className:"text-2xl ki-filled ki-copy text-warning"})}),t.jsx(k,{type:"button",onClick:n=>{n.preventDefault(),ce(e.row)},href:"#",children:t.jsx("i",{className:"text-2xl ki-duotone ki-notepad-edit text-success"})}),t.jsx(k,{type:"button",onClick:n=>{n.preventDefault(),de(e.row)},href:"#",children:t.jsx("i",{className:"text-2xl ki-duotone ki-trash-square text-danger"})})]})}],he=()=>{const e=(P??[]).reduce((s,u)=>parseInt(s)+parseInt(u.total_amount),0),n=(P??[]).reduce((s,u)=>parseInt(s)+parseInt(u.total_amount_conversion),0);return t.jsxs(W,{sx:{display:"flex",justifyContent:"flex-end",padding:"10px",background:"#f5f5f5"},children:[t.jsxs(Q,{sx:{marginRight:"20px",fontWeight:"bold"},children:["Total Amount: ",O(e,!1)]}),t.jsxs(Q,{sx:{fontWeight:"bold"},children:["Total Amount Conversion: ",O(n,!1)]})]})};return t.jsxs("div",{children:[t.jsx(c,{options:[{label:"Existing",value:"existing"},{label:"New",value:"new"}],fieldLabel:"Select Type Vendor",fieldName:`vendors[${a}].type_vendor`,isRequired:!0,style:{width:"56.5rem"},placeholder:"Select Vendor",classNames:"mt-2",disabled:i}),f(`vendors[${a}].type_vendor`)==="existing"&&t.jsxs(t.Fragment,{children:[t.jsx(c,{options:y,fieldLabel:"Select Vendor",fieldName:`vendors[${a}].vendor`,isRequired:!0,style:{width:"56.5rem"},placeholder:"Select Vendor",classNames:"mt-2",disabled:i,onSearch:async e=>{const n=y==null?void 0:y.some(s=>s.label===e);return e.length>0&&!n?await E("",{name:"name_one || ' - ' || REGEXP_REPLACE(partner_number, '^(0+)(\\d)', '\\2')",id:"id",tabel:"master_business_partners",hiddenZero:!0,isMapping:!1,search:e,raw:!0}):e.length===0&&!n&&await E("",{name:"name_one || ' - ' || REGEXP_REPLACE(partner_number, '^(0+)(\\d)', '\\2') ",id:"id",tabel:"master_business_partners",hiddenZero:!0,isMapping:!1,raw:!0}),y??[]},onFocus:async()=>{const e=m(`vendors[${a}].vendor`);await E("",{name:"name_one || ' - '  || REGEXP_REPLACE(partner_number, '^(0+)(\\d)', '\\2') ",id:"id",tabel:"master_business_partners",hiddenZero:!0,isMapping:!1,raw:!0,hasValue:{key:e?"id":"",value:e??""}})}}),t.jsx(ve,{fieldLabel:"Propose Vendor",fieldName:`vendors[${a}].winner`,isRequired:!1,disabled:i})]}),f(`vendors[${a}].winner`)&&t.jsx(M,{fieldLabel:"Number Quotation",fieldName:`vendors[${a}].quotation`,isRequired:!1,type:"text",placeholder:"Number Quotation",disabled:i}),f(`vendors[${a}].type_vendor`)==="new"&&t.jsx(t.Fragment,{children:t.jsx(M,{fieldLabel:"Vendor Name",fieldName:`vendors[${a}].vendor_name_text`,isRequired:!1,type:"text",placeholder:"Enter your vendor",disabled:i})}),!i&&t.jsxs("div",{className:"mt-2 card",children:[t.jsx("div",{className:"card-header",children:t.jsx("p",{children:"item"})}),t.jsxs("div",{className:"card-body",style:{padding:"1rem"},children:[t.jsx(M,{fieldLabel:"Qty",fieldName:"item_qty",isRequired:!1,type:"number",placeholder:"Enter your qty",disabled:i}),t.jsx(M,{removeDecimal:!0,nameDecimal:"currency_from",fieldLabel:"Unit Price",fieldName:"item_unit_price",isRequired:!1,disabled:i,type:"number",placeholder:"Unit Price"}),t.jsx(c,{options:K,fieldLabel:"Account Assignment",fieldName:"item_account_assignment_categories",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Account Assignment",classNames:"mt-2"}),(g==="K"||g==="V"||g==="W"||g==="Y")&&t.jsx(c,{options:H,fieldLabel:"Cost Center",fieldName:"item_cost_center",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Cost Center",classNames:"mt-2"}),t.jsx(c,{options:te,fieldLabel:"Material Group",fieldName:"item_material_group",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Material Group",classNames:"mt-2",onChangeOutside:async(e,n)=>{await x(e)}}),t.jsx(c,{options:F,fieldLabel:"Material Number",fieldName:"item_material_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Material Number",classNames:"mt-2",onChangeOutside:async(e,n)=>{r("item_material_number_description",n.label.split("-")[0])}}),t.jsx(c,{options:ie,fieldLabel:"Uom",fieldName:"item_uom",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Purchase requisition unit of measure",classNames:"mt-2"}),t.jsx(c,{options:ne,fieldLabel:"Tax On Sales",fieldName:"item_tax",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Tax on sales",classNames:"mt-2"}),t.jsx(Ne,{fieldLabel:"Short Text",fieldName:"item_short_text",isRequired:!1,disabled:i,maxLength:40,classNames:"mt-4",style:{width:"56.5rem"}}),g==="F"&&t.jsx(c,{options:T,fieldLabel:"Order Number",fieldName:"item_order_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Order Number",classNames:"mt-2",onSearch:async e=>(await D("",{name:"master_orders.desc || ' - ' || REGEXP_REPLACE(order_number, '^(0+)(\\d)', '\\2') ",id:"order_number",tabel:"master_orders",search:e,raw:!0}),T??[]),onFocus:async()=>{const e=m("item_order_number");await D("",{name:"master_orders.desc || ' - ' || REGEXP_REPLACE(order_number, '^(0+)(\\d)', '\\2') ",id:"order_number",tabel:"master_orders",hasValue:{key:e?"id":"",value:e??""},raw:!0})}}),g==="A"&&t.jsxs(t.Fragment,{children:[t.jsx(c,{options:V,fieldLabel:"Main Asset Number",fieldName:"item_asset_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Main Asset",classNames:"mt-2",onChangeOutside:(e,n)=>{Y(e,a)},onSearch:async e=>(await L("",{name:"master_assets.desc || ' - ' || REGEXP_REPLACE(asset, '^(0+)(\\d)', '\\2') ",id:"asset",tabel:"master_assets",search:e,raw:!0,where:{groupBy:"asset,master_assets.desc"}}),V??[]),onFocus:async()=>{const e=m("item_asset_number");await L("",{name:"master_assets.desc || ' - ' || REGEXP_REPLACE(asset, '^(0+)(\\d)', '\\2') ",id:"asset",tabel:"master_assets",raw:!0,hasValue:{key:e?"id":"",value:e??""},where:{groupBy:"asset,master_assets.desc"}})}}),t.jsx(c,{options:z[a],fieldLabel:"Sub Asset",fieldName:"item_sub_asset_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Sub Asset Number",classNames:"mt-2"})]})]}),t.jsx("div",{className:"card-footer",children:t.jsx(B,{type:"button",variant:"contained",className:"px-6 py-2 text-white transition-all bg-blue-500 rounded hover:bg-blue-600",onClick:async()=>await le(),children:"Add Item"})})]}),t.jsx(W,{sx:{width:"100%",overflowX:"auto",marginTop:"1rem"},children:t.jsx("div",{className:"lg:col-span-2",children:t.jsx("div",{className:"grid",children:t.jsx("div",{className:"h-full min-w-full card card-grid",children:t.jsx("div",{className:"card-body",children:t.jsx("div",{"data-datatable":"true",children:t.jsx("div",{className:"scrollable-x-auto",children:t.jsx(Ee,{columns:[...i?[]:be,...je],rows:P,hideFooterPagination:!0,slots:{footer:he}})})})})})})})}),Array.from({length:_e},(e,n)=>t.jsx(t.Fragment,{children:!i&&n!==a&&t.jsxs(B,{type:"button",variant:"contained",style:{marginTop:"1rem",marginRight:"1rem"},className:"px-6 py-2 text-white transition-all bg-blue-500 rounded hover:bg-blue-600",onClick:async()=>await pe(n),children:["Copy To Vendor ",n+1]},n)}))]})};export{ot as default};
