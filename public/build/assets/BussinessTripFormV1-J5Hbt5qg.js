import{j as e,r as l,u as Ge,d as Oe}from"./app-B1AEVzT5.js";import{d as Xe,F as j,a as w,b,c as D,e as ze}from"./form-aZS_lP4z.js";import{z as s,t as We}from"./index-BE6io-Qz.js";import{a as B,d as ae}from"./axiosInstance-BvtOE-BZ.js";import{B as Je}from"./button-D307KTBQ.js";import{T as He}from"./textarea-KkVD86ro.js";import{a as Ke,C as Ze,u as Qe,b as le,c as Ue}from"./index.esm-BH2AsJwf.js";import{S as et}from"./scroll-area-B4UsZDU7.js";import{S as se}from"./separator-BwWq-Dpn.js";/* empty css              */import{W as tt}from"./WorkflowComponent-IYpfeqpP.js";import{S as at}from"./Switch-B0Z_K4ZC.js";import{F as st}from"./FormHelperText-NiKjcd5a.js";import{I as X}from"./input-Dk0wpb63.js";import{S as re,a as ne,b as oe,c as ie,d as M}from"./select-XsufbaGO.js";import{C as rt,E as nt,b as ot}from"./api-D52m_Wz0.js";import{G as it,a as lt}from"./api-BEQetkWJ.js";import{h as L}from"./moment-C5S46NFB.js";import{BusinessTripType as A}from"./models-BYB4YKpr.js";import{b as ct}from"./api-Cpn27s-b.js";import{u as v}from"./getDropdown-ChW2e3_l.js";import{F as O}from"./formDropdown-CMRXdDA-.js";import{BussinesTripDestination as dt}from"./BussinesTripDestination-CSDZ8yyI.js";import{B as pt}from"./Button-IxlbKDxk.js";import"./app-HlhieNAw.js";import"./index-Ba4If0pH.js";import"./utils-DNtRlc7o.js";import"./index-Bb4qSo10.js";import"./index-C9TLrTnG.js";import"./index-DPFwwSoh.js";import"./createSimplePaletteValueFilter-Dl2aI-kV.js";import"./DefaultPropsProvider-BnWYfosm.js";import"./createLucideIcon-BQ1Dm3Q6.js";import"./SwitchBase-C0qn7K6b.js";import"./useSlot-DFDxNTwK.js";import"./index-8lU3ZcA2.js";import"./index-SZE-yZcV.js";import"./Combination-D4vcfTob.js";import"./index-BQRrVA_2.js";import"./index-BIDPva6F.js";import"./index-DvLNK93s.js";import"./CustomStatus-tphcljYb.js";import"./TextField-Ct7iXDKX.js";import"./tabs-B4HORxWO.js";import"./index-Cwr-K4pD.js";import"./BussinessDestinationForm-BE-j28rM.js";import"./CustomDatePicker-BpDrN-SO.js";import"./popover-BdP7V8TQ.js";import"./DetailAttedances-DH8VzmE4.js";import"./DetailAllowance-S0TUq3sK.js";import"./rupiahCurrencyFormat-CnMdu_8N.js";import"./chevrons-up-down-B8n2YkTO.js";import"./ResultTotalItem-DyTjkHlR.js";const mt=({fieldLabel:x,fieldName:T,isRequired:y=!1,disabled:C=!1,style:F,requiredMessage:_,classNames:h,defaultChecked:m=!1,note:u,onChanges:k})=>{var r;const{control:I,formState:{errors:q}}=Ke();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[x&&e.jsxs("label",{className:"form-label max-w-32",children:[x," ",e.jsxs("span",{className:"text-red-700",children:[" ",y?"*":""]})]}),e.jsx(Ze,{name:T,control:I,rules:{required:y?_??`${x} is required`:!1},render:({field:S})=>e.jsx("div",{style:F,className:h,children:e.jsx(at,{...S,checked:!!(S.value??m),onChange:N=>{S.onChange(N),k&&k(N)},disabled:C})})}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),q[T]&&e.jsx(st,{error:!0,children:String((r=q[T])==null?void 0:r.message)})]})]})};s.object({remark:s.string().min(1).max(50),reimburse_cost:s.number()});const ut=1*1024*1024,_t=["image/jpeg","image/png","application/pdf"],fa=({users:x,listPurposeType:T,pajak:y,costcenter:C,purchasingGroup:F,type:_,id:h,isAdmin:m,idUser:u})=>{const k=s.object({purpose_type_id:s.string().min(1,"Purpose type required"),request_for:s.string().min(1,"Request is required"),cost_center_id:s.string().min(1,"Cost Center is required"),remark:s.string().min(1,"Remark is required"),attachment:s.array(s.instanceof(File).refine(t=>_t.includes(t.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(t=>t.size<=ut,{message:"File size must be less than 1MB"})),total_destination:s.number().min(1,"Total Destinantion Required"),cash_advance:s.boolean().nullable().optional(),reference_number:s.string().nullable().optional(),total_percent:s.string().nullable().optional(),total_cash_advance:s.string().nullable().optional(),destinations:s.array(s.object({destination:s.string().min(1,"Destinantion is Required"),pajak_id:s.string().min(1,"Pajak is required"),purchasing_group_id:s.string().min(1,"Purchasing Group is required"),business_trip_start_date:s.date().optional(),business_trip_end_date:s.date().optional(),detail_attedances:s.array(s.object({date:s.date().optional(),shift_code:s.string().optional(),shift_start:s.string().optional(),shift_end:s.string().optional(),start_time:s.string().optional(),end_time:s.string().optional()})),allowances:s.array(s.object({name:s.string().optional(),code:s.string().optional(),default_price:s.number().optional(),type:s.string().optional(),subtotal:s.number().optional(),currency:s.string().optional(),detail:s.array(s.object({date:s.date().nullish(),request_price:s.any().optional()}))}))}))}),[I,q]=l.useState("1"),r=Qe({resolver:We(k),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[S,N]=l.useState([]);async function ce(){const t=ot(h);r.setValue("destinations",[]);try{const n=(await Oe.get(t)).data.data,o=ct(n.purpose_type_id),c=await B.get(o);me(c.data.data),N(n.attachments),r.setValue("purpose_type_id",n.purpose_type_id.toString()),r.setValue("request_for",n.request_for.id.toString()),r.setValue("cost_center_id",n.cost_center_id.toString()),r.setValue("remark",n.remarks),r.setValue("total_destination",n.total_destination),r.setValue("cash_advance",n.cash_advance==1),r.setValue("reference_number",n.reference_number),r.setValue("total_percent",n.total_percent),r.setValue("total_cash_advance",n.total_cash_advance),r.setValue("destinations",n.destinations.map(d=>({destination:d.destination,pajak_id:d.pajak_id,purchasing_group_id:d.purchasing_group_id,business_trip_start_date:new Date(d.business_trip_start_date),business_trip_end_date:new Date(d.business_trip_end_date),detail_attedances:d.detail_attedances.map(i=>({...i,date:new Date(i.date)})),allowances:d.allowances.map(i=>({...i,default_price:parseInt(i.default_price),subtotal:parseInt(i.subtotal),detail:i.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?new Date(p.date):null}))}))})))}catch{}}const[z,de]=l.useState([]),[pe,me]=l.useState([]),[ue,_e]=l.useState(""),{dataDropdown:W,getDropdown:he}=v(),[fe,xe]=l.useState(m==="0"?u==null?void 0:u.toString():"");async function ge(t){r.setValue("purpose_type_id",t||"");const a=m=="0"?u||"":fe||"",n=it(t,a),o=lt(t);try{const c=await B.get(n),d=await B.get(o),i=d.data.data.purpose.type;i=="international"&&J("1"),_e(i),de(c.data.data),he("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:d.data.data.purpose.type}})}catch(c){console.log(c)}}const J=t=>{r.setValue("total_destination",parseInt(t,10)),q(t),H()},{showToast:V}=Ge(),je=async t=>{console.log(t," valuesss");try{const a=new FormData,n=G();a.append("user_id",t.request_for??""),a.append("value",n.toString()),a.append("purpose_type_id",t.purpose_type_id??""),a.append("request_for",t.request_for??""),a.append("cost_center_id",t.cost_center_id??""),a.append("remark",t.remark??""),a.append("reference_number",`${t.reference_number}`),a.append("cash_advance",`${t.cash_advance}`),a.append("total_percent",`${t.total_percent}`),a.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((o,c)=>{o&&a.append(`attachment[${c}]`,o)}),a.append("total_destination",`${t.total_destination}`),t.destinations.forEach((o,c)=>{const d={...o,business_trip_start_date:L(o.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:L(o.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:o.detail_attedances.map(i=>({...i,date:L(i.date).format("YYYY-MM-DD")})),allowances:o.allowances.map(i=>({...i,detail:i.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?L(p.date).format("YYYY-MM-DD"):null}))}))};a.append(`destinations[${c}]`,JSON.stringify(d))}),_==A.create?(await ae.Inertia.post(rt,a,{headers:{"Content-Type":"multipart/form-data"}}),V("succesfully created data","success")):(await ae.Inertia.post(`${nt}/${h}`,a,{headers:{"Content-Type":"multipart/form-data"}}),V("succesfully updated data","success"))}catch(a){console.log(a)}};function H(){const t=[],a=parseInt(I);for(let n=0;n<a;n++)t.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});r.setValue("destinations",t)}const{fields:we,append:ht,remove:ft,update:be}=le({control:r.control,name:"destinations"});l.useEffect(()=>{h&&_==A.edit&&ce()},[]),l.useEffect(()=>{_==A.create&&H()},[I,z,h,_,m,u]);const[ye,Se]=l.useState(!1),[P,ve]=l.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),De=(t,a)=>{var n;return t.type==="total"?parseFloat(((n=a==null?void 0:a[0])==null?void 0:n.request_price)||0):a==null?void 0:a.reduce((o,c)=>o+parseFloat(c.request_price||0),0)},G=()=>r.getValues("destinations").reduce((n,o,c)=>{const i=(o.allowances||[]).reduce((p,R,Y)=>{const $=r.getValues(`destinations.${c}.allowances.${Y}.detail`),f=De(R,$);return p+f},0);return n+i},0),K=async()=>{var t,a,n,o,c,d,i,p,R,Y,$;try{const f=G();if(f===0){V("Please fill the balance","error");return}const E=await B.get("/check-approval",{params:{value:f,user_id:r.getValues("request_for"),type:"TRIP"}});if(E.data.status_code===200){const Me=(a=(t=E.data)==null?void 0:t.data)==null?void 0:a.approval.map(g=>(g==null?void 0:g.division_name)||null),Le=(o=(n=E.data)==null?void 0:n.data)==null?void 0:o.approval.map(g=>(g==null?void 0:g.name)||null),ee=[];(d=(c=E.data)==null?void 0:c.data)!=null&&d.hr&&ee.push((R=(p=(i=E.data)==null?void 0:i.data)==null?void 0:p.hr)==null?void 0:R.name);const te={approvalRequest:Me,approvalFrom:Le,acknowledgeFrom:ee};console.log(te),ve(te),Se(!0)}}catch(f){V(($=(Y=f==null?void 0:f.response)==null?void 0:Y.data)==null?void 0:$.message,"error")}};l.useEffect(()=>{G()>0&&K()},[r.watch("destinations")]),l.useState([]);const Te=t=>{N(a=>a.filter(n=>n.id!==t))},[Ce,Z]=l.useState(!1),Fe=t=>{Z(t)},Q=Ue({control:r.control,name:"total_percent"}),[Ne,Pe]=l.useState(0),U=Ne;l.useEffect(()=>{_==A.edit&&Z(r.getValues("cash_advance")??!1);const a=parseFloat((Q||"0").toString())/100*U;r.setValue("total_cash_advance",a.toFixed(0))},[Q,U]);const{dataDropdown:Ee,getDropdown:Ae}=v(),{dataDropdown:ke,getDropdown:Ie}=v(),{dataDropdown:qe,getDropdown:Ve}=v(),{dataDropdown:Re,getDropdown:Ye}=v(),{dataDropdown:$e,getDropdown:Be}=v();return l.useEffect(()=>{Ae("",{name:"name",id:"id",tabel:"users",idType:"string"}),Ie("",{name:"name",id:"id",tabel:"purpose_types",idType:"string"}),Ve("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),Ye("",{name:"mwszkz",id:"id",tabel:"pajaks"}),Be("",{name:"purchasing_group",id:"id",tabel:"purchasing_groups"})},[]),l.useEffect(()=>{_!=A.edit&&m=="0"&&r.setValue("request_for",(u==null?void 0:u.toString())??"")},[]),console.log(W,"data destination"),e.jsx(et,{className:"h-[600px] w-full ",children:e.jsx(Xe,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(je),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(O,{fieldLabel:"",options:Ee,fieldName:"request_for",isRequired:!0,disabled:m=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{xe(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsx("td",{children:e.jsx(O,{fieldLabel:"",options:ke,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,a)=>{await ge(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(O,{fieldLabel:"",options:qe,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(j,{control:r.control,name:"remark",render:({field:t})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(He,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(D,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(j,{control:r.control,name:"attachment",render:({field:t})=>e.jsxs(w,{children:[e.jsx(ze,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(b,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:a=>{const n=a.target.files;if(n){const o=Array.from(n);t.onChange(o)}else t.onChange([])}})}),r.formState.errors.attachment&&Array.isArray(r.formState.errors.attachment)?r.formState.errors.attachment.map((a,n)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:a.message},n)):null]})})})]}),S.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),S.map((t,a)=>e.jsxs("td",{className:"flex flex-col pb-3",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",children:t.file_name},a),e.jsx("button",{type:"button",onClick:()=>Te(t.id),className:"text-red-500 mt-2",children:"Delete"})]}))]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:r.control,name:"total_destination",render:({field:t})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsxs(re,{value:t.value.toString(),onValueChange:J,disabled:ue==="international",children:[e.jsx(ne,{className:"w-[200px] py-2",children:e.jsx(oe,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(ie,{children:Array.from({length:5},(a,n)=>e.jsxs(M,{value:(n+1).toString(),children:[" ",n+1," "]},n))})]})}),e.jsx(D,{})]})})]})]})]}),e.jsx(se,{className:"my-4"}),e.jsx(dt,{updateDestination:be,destinationField:we,listDestination:pe,form:r,listAllowances:z,totalDestination:r.getValues("total_destination").toString(),pajak:y,purchasingGroup:F,setTotalAllowance:Pe,dataTax:Re,dataPurchasingGroup:$e,dataDestination:W}),e.jsx(se,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(mt,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Fe(t.target.checked)})})]}),Ce&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(j,{control:r.control,name:"reference_number",render:({field:t})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(X,{value:t.value||"",onChange:a=>t.onChange(a.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(D,{})]})}),e.jsx(j,{control:r.control,name:"total_percent",render:({field:t})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsxs(re,{value:t.value||void 0,onValueChange:a=>t.onChange(a),children:[e.jsx(ne,{className:"w-[50%] mb-2",children:e.jsx(oe,{placeholder:"-- Select Total Percent --"})}),e.jsxs(ie,{children:[e.jsx(M,{value:"10",children:"10%"}),e.jsx(M,{value:"25",children:"25%"}),e.jsx(M,{value:"50",children:"50%"})]})]})}),e.jsx(D,{})]})}),e.jsx(j,{control:r.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(X,{value:t.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(D,{})]})})]})]})})]}),e.jsx(pt,{onClick:async()=>await K(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ye&&e.jsx(tt,{workflowApproval:{approvalRequest:P.approvalRequest,approvalFrom:P.approvalFrom,acknowledgeFrom:P.acknowledgeFrom},workflowApprovalStep:P.approvalFrom,workflowApprovalDiagram:P.approvalFrom})}),e.jsx(Je,{type:"submit",children:"submit"})]})})})};function xa({form:x,type:T,allowanceIndex:y,destinationIndex:C}){const{fields:F}=le({control:x.control,name:`destinations.${C}.allowances.${y}.detail`});return e.jsx(e.Fragment,{children:F.map((_,h)=>e.jsx(j,{control:x.control,name:`destinations.${C}.allowances.${h}.detail.${h}.request_price`,render:({field:m})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(X,{value:m.value,onChange:m.onChange})}),e.jsx(D,{})]})}))})}export{xa as AllowanceInputForm,fa as BussinessTripFormV1};
