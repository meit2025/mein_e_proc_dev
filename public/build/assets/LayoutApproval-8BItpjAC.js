import{q as j,r as l,j as a}from"./app-D6zZUnhT.js";import{a as E}from"./axiosInstance-ipjuDDWO.js";import{L as M}from"./Loading-CKDxNtru.js";import{F as k}from"./FormMapping-CErydMu0.js";import{F as q}from"./formTextArea-BSSxWl3V.js";import{u as B}from"./index.esm-SvsRdIxO.js";import{D}from"./detailApproval-fDjqAQvL.js";import{h as I}from"./moment-C5S46NFB.js";import{B as u}from"./Button-BEMCM1jW.js";import{M as Y}from"./TextField-C5r2XV-c.js";import{B as N}from"./Box-CpnnZMYt.js";const O={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",pt:2,px:4,pb:3},W=({id:d,children:y,type:p,status_id:t})=>{var g;j();const{auth:r}=j().props,e=B({mode:"onChange",reValidateMode:"onChange"}),[V,m]=l.useState(!1),[b,f]=l.useState(!1),[C,v]=l.useState(!1),x=l.useCallback(async()=>{var i;m(!0);try{const s=(await E.get("/api/approval/route/getApproval?id="+d+"&type="+p)).data;e.reset(s.data.data);const w=(s.data??[]).map(o=>{var h;return((h=o.user.divisions)==null?void 0:h.name)||null}),A=(s.data??[]).map(o=>o.user.name),n=(s.data??[]).find(o=>o.is_status===!1);t!==4&&t!==6&&(n==null?void 0:n.user_id)===((i=r==null?void 0:r.user)==null?void 0:i.id)&&f(!0),console.log("data",s.data);const F=(s.data??[]).map(o=>({status:o.status,name:o.user.name,dateApproved:I(o.updated_at).format("YYYY-MM-DD"),note:o.message}));e.setValue("approvalFromStatusRoute",F),e.setValue("approvalRequest",w),e.setValue("approvalFrom",A),e.setValue("approvalId",n==null?void 0:n.id),e.setValue("function_name",p.toLowerCase()),e.setValue("type",p.toLowerCase()),e.setValue("id",d)}catch{m(!1)}finally{m(!1)}},[d,p,e,t,(g=r==null?void 0:r.user)==null?void 0:g.id]);l.useEffect(()=>{x()},[x,t]),l.useEffect(()=>{(t===4||t===6)&&f(!1)},[t]);const L=()=>{v(!1),e.setValue("note",""),e.setValue("id_approval",""),e.setValue("status",""),e.setValue("type","")},c=i=>{v(!0),e.setValue("status",i)};return a.jsxs(a.Fragment,{children:[a.jsx(M,{isLoading:V}),a.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[b&&a.jsx("div",{className:"card-header",children:a.jsxs("div",{children:[a.jsx(u,{variant:"contained",onClick:()=>c("Approved"),color:"primary",type:"button",children:"APPROVE"}),a.jsx(u,{onClick:()=>c("Revise"),style:{marginLeft:"1rem"},variant:"contained",color:"warning",type:"button",children:"Revise"}),a.jsx(u,{onClick:()=>c("Rejected"),style:{marginLeft:"1rem"},variant:"contained",color:"error",type:"button",children:"REJECT"})]})}),y,a.jsx(D,{methods:e}),a.jsx(Y,{open:C,onClose:L,"aria-labelledby":"parent-modal-title","aria-describedby":"parent-modal-description",children:a.jsx(N,{sx:{...O,width:900},children:a.jsx(k,{isCustom:!0,formCustom:a.jsx(a.Fragment,{children:a.jsx(q,{fieldLabel:"note",fieldName:"note",isRequired:!0,requiredMessage:"",rows:20,style:{width:"100%"}})}),methods:e,url:"api/approval/approval_or_rejceted"})})})]})]})};export{W as L};
