import{j as e,r as c,u as qe,q as Ve}from"./app-DGVQjNt2.js";import{B as $e}from"./button-CCcjRejr.js";import{z as l,t as Ee}from"./index-BSgW4QJO.js";import{F as Ie,a as i,b as m,c as p,d as u,f as ke}from"./form-BrMT-qfA.js";import{u as Ae,b as Pe}from"./index.esm-De_pvXg7.js";import{T as K}from"./textarea-S3umdk6M.js";/* empty css                  */import{S as Be}from"./scroll-area-Cw_XkSqf.js";import{a as b}from"./axiosInstance-C8hqrQ0i.js";import{S as Q}from"./separator-CMeesRI3.js";import{T as Me,a as Ge,b as Le,c as Oe}from"./tabs-_5TZopGg.js";import{S as x,a as g,b as f,c as y,d as _}from"./select-DrYNCRXG.js";import{F as X}from"./formDropdown-DTr37xIo.js";import{C as E}from"./CustomDatePicker-BC4606Vy.js";import{I as Z}from"./input-Gdp4NPm_.js";import{F as ze}from"./utils-B_fSG7st.js";import{u as U}from"./getDropdown-CWNPDN6O.js";import{G as We,a as ee,b as Ye,c as He}from"./api-C-9NntP9.js";import{L as Je}from"./LoadingSpin-Cybhh-pv.js";import{W as Ke}from"./WorkflowComponent-C9zL6aQT.js";import{B as Qe}from"./Button-Kfj3e9G4.js";import"./app-HlhieNAw.js";import"./index-B7ZMekuf.js";import"./index-CXRj3aMS.js";import"./index-D6sdH0h3.js";import"./index-_PTaM1-D.js";import"./index-elOYbwq4.js";import"./index-mOyiHV7R.js";import"./index-6I4UGF0A.js";import"./index-DmhTOqmj.js";import"./Combination-CGkhae2Z.js";import"./index-V-2EGEMD.js";import"./TextField-DQKYZ5he.js";import"./useSlot-_G19XvkC.js";import"./DefaultPropsProvider-BlLl9HAQ.js";import"./extends-CF3RwP-h.js";import"./createSimplePaletteValueFilter-CO2E3lAV.js";import"./useControlled-B0dPpj7V.js";import"./FormHelperText-B3LaBlw2.js";import"./popover-CqTQA25r.js";import"./createLucideIcon-DjRlAJCY.js";function Xe({isLoading:T=!1,children:q}){return e.jsx("div",{className:"",children:T?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(Je,{})})}):q})}const zs=({onSuccess:T,purchasing_groups:q,currencies:se,categories:re,periods:Ze,users:Ue,taxes:te,cost_center:ae,edit_url:ne,update_url:es,store_url:oe,latestPeriod:ss,type:I,currentUser:S})=>{const[le,ce]=c.useState("form1"),{showToast:v}=qe();Ve().props,c.useState(1),c.useState([]),c.useState([[]]),c.useState(),c.useState([]),c.useState([[]]);const{dataDropdown:ie,getDropdown:de}=U(),{dataDropdown:me,getDropdown:k}=U(We),[pe,A]=c.useState([]),[ue,he]=c.useState([]),[je,xe]=c.useState([]);c.useState("");const[P,ge]=c.useState(!1),[fe,D]=c.useState(!1),[d,ye]=c.useState(null),[N,_e]=c.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),be=l.object({formCount:l.string().min(1,"total form must be have value"),remark_group:l.string().optional(),cost_center:l.string().min(1,"cost center required"),requester:l.string().min(1,"requester required"),value:l.number().optional(),user_id:l.string().optional(),forms:l.array(l.object({id:l.string().optional(),for:l.string().optional(),group:l.string().optional(),reimburse_type:l.string().min(1,"reimburse type is required"),short_text:l.string().min(1,"remarks is required"),balance:l.string().min(1,"balance required"),currency:l.string().min(1,"currency required"),tax_on_sales:l.string().min(1,"tax required"),uom:l.string().min(1,"uom required"),purchasing_group:l.string().min(1,"Purchasing Group required"),period:l.string().min(1,"period required"),type:l.any(),item_delivery_data:l.date(),start_date:l.date(),end_date:l.date()}))}),n=Ae({resolver:Ee(be),defaultValues:{formCount:"1",remark_group:"test",cost_center:"",requester:String(S==null?void 0:S.is_admin)==="1"?"":S==null?void 0:S.nip,forms:[{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"IDR",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date}]}}),{fields:R,update:j}=Pe({control:n.control,name:"forms"});async function we(){n.setValue("forms",[]),D(!0);try{const t=await b.get(ne??""),r=t.data.data.group,a=t.data.data.forms,s=a.map(o=>({id:String(o.id),for:String(o.for),group:String(o.group),reimburse_type:o.reimburse_type,short_text:o.short_text,balance:o.balance,currency:o.currency,tax_on_sales:String(o.tax_on_sales),uom:String(o.uom),purchasing_group:String(o.purchasing_group),period:o.period,type:o.type,item_delivery_data:new Date(o.item_delivery_data),start_date:new Date(o.start_date),end_date:new Date(o.end_date)}));n.setValue("formCount",a.length.toString()),n.setValue("remark_group",r.remark_group),n.setValue("cost_center",String(r.cost_center)),n.setValue("requester",r.requester),n.setValue("forms",s),D(!1)}catch(t){console.log(t),D(!1)}}c.useEffect(()=>{I===ze.edit&&(D(!0),we())},[I]);const Se=async t=>{t.length>0&&k("",{name:"name",id:"nip",tabel:"users"})};c.useEffect(()=>{de("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms"}),k("",{name:"name",id:"nip",tabel:"users"})},[]);const B=async t=>{const r=await b.get(ee,{params:{user:n.getValues("requester"),familyRelationship:n.getValues(`forms.${t}.type`)},headers:{"Content-Type":"application/json"}});A(a=>{const s=[...a];return s[t]=r.data.data,s})},ve=async(t,r)=>{if(t.length>0)try{const a=await b.get(ee,{params:{search:t,user:n.getValues("requester"),familyRelationship:n.getValues(`forms.${r}.type`)}});A(s=>{const o=[...s];return o[r]=a.data.data,o})}catch(a){console.error("Error searching reimburse types:",a)}},Ne=async(t,r)=>{const a=await b.get(Ye,{params:{user:n.getValues("requester"),familyRelationship:n.getValues(`forms.${r}.type`),reimburseType:t},headers:{"Content-Type":"application/json"}});he(s=>{const o=[...s];return o[r]=a.data.data,o})},Ce=async(t,r)=>{const a=await b.get(He,{params:{user:n.getValues("requester"),familyRelationship:n.getValues(`forms.${r}.type`),reimburseType:n.getValues(`forms.${r}.reimburse_type`),reimbursePeriod:t},headers:{"Content-Type":"application/json"}});xe(s=>{const o=[...s];return o[r]=a.data.data,o})};c.useEffect(()=>{for(let t=0;t<R.length;t++){let r=n.getValues("requester"),a=n.getValues(`forms.${t}.type`);(r||a)&&B(t)}},[R.length,n.watch("forms")]);const De=()=>{for(let t=0;t<R.length;t++)n.setValue(`forms.${t}.reimburse_type`,""),n.setValue(`forms.${t}.period`,""),n.getValues(`forms.${t}.type`)=="Family"&&n.setValue(`forms.${t}.for`,"")};function Re(t){const r=[...n.getValues("forms")];for(let a=0;a<parseInt(t);a++)if(a+1>r.length){const s={id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date};r.push(s)}n.setValue("forms",r)}const Fe=t=>{ce(t)},Te=async t=>{if(d){if(parseInt(d==null?void 0:d.limit)<t.forms.length){v("Limit has been reached","error");return}const a=t.forms.reduce((s,o)=>s+parseInt(o.balance),0);if(parseInt((d==null?void 0:d.balance)??0)<a){v("Please check your balance input in forms is not must be above "+(d==null?void 0:d.balance),"error");return}}const r=t.forms.reduce((a,s)=>a+parseInt(s.balance)||0,0);t.value=r,t.user_id=(t==null?void 0:t.requester)||"0";try{const a=await b.post(oe??"",t);v("succesfully created data","success"),T()}catch(a){console.log(a)}};async function M(t){var s,o;const r=n.getValues(`forms.${t}`),a={user:n.getValues("requester"),periode:r.period,reimbuse_type_id:r.reimburse_type};try{const h=await b.get("reimburse/data-limit-and-balance",{params:a});ye(h.data.data)}catch(h){console.log(h),v((o=(s=h==null?void 0:h.response)==null?void 0:s.data)==null?void 0:o.message,"error")}}const G=async()=>{var t,r,a,s,o,h,L,O,z,W,Y;try{const H=n.getValues("forms").reduce((V,$)=>V+parseInt($.balance)||0,0);if(H===0){v("Please fill the balance","error");return}const C=await b.get("/check-approval",{params:{value:H,user_id:n.getValues("requester"),type:"REIM"}});if(C.data.status_code===200){const V=(r=(t=C.data)==null?void 0:t.data)==null?void 0:r.approval.map(w=>(w==null?void 0:w.division_name)||null),$=(s=(a=C.data)==null?void 0:a.data)==null?void 0:s.approval.map(w=>(w==null?void 0:w.name)||null),J=[];(h=(o=C.data)==null?void 0:o.data)!=null&&h.hr&&J.push((z=(O=(L=C.data)==null?void 0:L.data)==null?void 0:O.hr)==null?void 0:z.name),_e({approvalRequest:V,approvalFrom:$,acknowledgeFrom:J}),ge(!0)}}catch(F){v((Y=(W=F==null?void 0:F.response)==null?void 0:W.data)==null?void 0:Y.message,"error")}};return c.useEffect(()=>{n.getValues("forms").reduce((a,s)=>a+parseInt(s.balance)||0,0)>0&&P===!0&&G()},[n.watch("forms"),n.watch("requester")]),e.jsx(Be,{className:"h-[600px] w-full",children:e.jsx(Xe,{isLoading:fe,children:e.jsx(Ie,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(Te),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Request No."}),e.jsx("td",{children:(n==null?void 0:n.code)??"-"})]}),e.jsx("tr",{children:e.jsx("td",{className:"w-1/4",children:"Request Status"})}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"remark_group",render:({field:t})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(K,{placeholder:"Insert remark",...t})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Cost Center"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"cost_center",render:({field:t})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:ae.map(r=>e.jsx(_,{value:r.id.toString(),children:r.cost_center},r.id))})]})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Employee"}),e.jsx("td",{children:e.jsx(X,{options:me,fieldName:"requester",isRequired:!0,disabled:!1,placeholder:"Select Employee",onSearch:Se,onChangeOutside:()=>De(),classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"formCount",render:({field:t})=>{var r;return e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{onValueChange:a=>{t.onChange(a),Re(a)},value:(r=t.value)==null?void 0:r.toString(),children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"Select number of forms"})}),e.jsx(y,{children:Array.from({length:20},(a,s)=>s+1).map(a=>e.jsx(_,{value:a.toString(),children:a},a))})]})}),e.jsx(u,{})]})}})})]})]})}),e.jsx(Q,{className:"my-4"}),e.jsxs(Me,{value:le,onValueChange:Fe,className:"w-full",children:[e.jsxs(Ge,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:n.watch("formCount")||1}).map((t,r)=>e.jsxs(Le,{value:`form${r+1}`,children:["Form ",r+1]},r))]}),R.map((t,r)=>e.jsxs(Oe,{value:`form${r+1}`,children:[e.jsx(i,{control:n.control,name:`forms.${r}.id`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(Z,{className:"sr-only",value:a.value,onChange:a.onChange})}),e.jsx(u,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Type of Reimbursement "}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(i,{control:n.control,name:`forms.${r}.type`,render:({field:a})=>e.jsxs(x,{onValueChange:s=>{j(r,{...t,type:String(s),reimburse_type:"",period:"",for:""})},defaultValue:t.type,children:[e.jsx(g,{children:e.jsx(f,{placeholder:"Select Family Relationship"})}),e.jsx(y,{children:re.map(s=>e.jsx(_,{value:s,children:s},s))})]})}),e.jsx(X,{options:pe[r],fieldName:`forms.${r}.reimburse_type`,isRequired:!0,disabled:n.getValues(`forms.${r}.type`)==""||n.getValues("requester")=="",placeholder:"Select Reimburse Type",onChangeOutside:(a,s)=>{const o=n.getValues("requester"),h=n.getValues(`forms.${r}.type`);a!==(s==null?void 0:s.value)&&o!==""&&h!==""&&ve(a,r),s!=null&&s.value&&(j(r,{...t,reimburse_type:s==null?void 0:s.value,period:"",for:""}),Ne(s.value,r))},onFocus:()=>B(r),classNames:"mt-2 w-full"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.purchasing_group`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{onValueChange:s=>{j(r,{...t,purchasing_group:String(s)})},defaultValue:t.purchasing_group,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:q.map(s=>e.jsxs(_,{value:s.id.toString(),children:[s.purchasing_group_desc," -"," ",s.purchasing_group]},s.id))})]})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Period Date"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.period`,render:({field:a})=>{var s;return e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{disabled:n.getValues(`forms.${r}.reimburse_type`)=="",onValueChange:o=>{j(r,{...t,period:o,for:""}),n.getValues(`forms.${r}.type`)=="Employee"&&M(r),Ce(o,r)},defaultValue:t.period,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:(s=ue[r])==null?void 0:s.map(o=>e.jsx(_,{value:o.value,children:o.label},o.value))})]})}),e.jsx(u,{})]})}})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family "}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.for`,render:({field:a})=>{var s;return e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{disabled:n.getValues(`forms.${r}.type`)!=="Family",onValueChange:o=>{j(r,{...t,for:o}),n.getValues(`forms.${r}.type`)=="Family"&&M(r)},defaultValue:t==null?void 0:t.for,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:(s=je[r])==null?void 0:s.map(o=>e.jsx(_,{value:o.value.toString(),children:o.label},o.value))})]})}),e.jsx(u,{})]})}})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.tax_on_sales`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{onValueChange:s=>{j(r,{...t,tax_on_sales:s})},defaultValue:t.tax_on_sales,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:te.map(s=>e.jsx(_,{value:s.id.toString(),children:s.mwszkz},s.id))})]})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.uom`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{onValueChange:s=>{j(r,{...t,uom:String(s)})},defaultValue:t.uom,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:(ie??[]).map((s,o)=>e.jsx(_,{value:s.value.toString(),children:s.label},s.value))})]})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.short_text`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(K,{placeholder:"Insert remark",onChange:s=>{j(r,{...t,short_text:s.target.value})},defaultValue:t.short_text})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Sisa Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:d==null?void 0:d.balance})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Sisa Limit"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:d==null?void 0:d.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.item_delivery_data`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(E,{initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(u,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(i,{control:n.control,name:`forms.${r}.start_date`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(E,{initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(u,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(i,{control:n.control,name:`forms.${r}.end_date`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(E,{initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(u,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(i,{control:n.control,name:`forms.${r}.currency`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsxs(x,{onValueChange:s=>{j(r,{...t,currency:s})},defaultValue:t.currency,children:[e.jsx(g,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(y,{children:se.map(s=>e.jsxs(_,{value:s.code,children:[s.name," (",s.code,")"]},s.code))})]})}),e.jsx(ke,{className:"h-6"}),e.jsx(u,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(i,{control:n.control,name:`forms.${r}.balance`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx(Z,{type:"number",placeholder:"0.0",onChange:s=>{j(r,{...t,balance:s.target.value})},defaultValue:t.balance})}),e.jsx(u,{})]})})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Attachments"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.attachment`,render:({field:a})=>e.jsxs(m,{children:[e.jsx(p,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:s=>{const o=s.target.files;if(o){const h=Array.from(o);a.onChange(h)}}})}),e.jsx(u,{})]})})})]})]})})})]},r))]}),e.jsx(Qe,{onClick:async()=>await G(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:P&&e.jsx(Ke,{workflowApproval:{approvalRequest:N.approvalRequest,approvalFrom:N.approvalFrom,acknowledgeFrom:N.acknowledgeFrom},workflowApprovalStep:N.approvalFrom,workflowApprovalDiagram:N.approvalFrom})}),e.jsx(Q,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx($e,{type:"submit",className:"w-32",children:"Save"})})]})})})})};export{zs as ReimburseForm};
