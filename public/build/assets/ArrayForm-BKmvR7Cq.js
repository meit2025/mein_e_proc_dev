import{u as le,r as L,j as t,b as de,a as D}from"./app-Do965W2P.js";import{F as a}from"./formDropdown-B24WgnXZ.js";import{F as q}from"./formInput-B2ZRDAU5.js";import{u as l}from"./getDropdown-D0MTj46Q.js";import{a as ce,c as M}from"./index.esm-Cyrp_nNR.js";import{F as ue}from"./formSwitch-DpY_GDZN.js";import{F as _e}from"./formTextArea-5JEHRy0W.js";import{columnsItem as pe}from"./listModel-tLLCqp5m.js";import{a as he}from"./axiosInstance-BsDuOK24.js";import{B as V}from"./Button-DLMm9OEl.js";import{B as be}from"./Box-BuBpDwAp.js";import{D as ge}from"./DataGrid-DFjMDCox.js";import"./app-DGQxOE2s.js";import"./TextField-xVNRcMw0.js";import"./createSvgIcon-BSebketx.js";import"./DefaultPropsProvider-DZrIPOKE.js";import"./useSlot-DEbkiHjr.js";import"./createSimplePaletteValueFilter-HClZ1-Ig.js";import"./useControlled-CbrMHbqp.js";import"./FormHelperText-BogwG6lR.js";import"./rupiahCurrencyFormat-C2HfaEL7.js";import"./Switch-Dq12i4bh.js";import"./SwitchBase-Dzl8zVxp.js";import"./Typography-BuS4IuVs.js";import"./CustomStatus-LfdEo2TU.js";import"./utils-Dmyq4JWQ.js";import"./createLucideIcon-C6e2xv_g.js";import"./page-DB73t_G4.js";import"./moment-C5S46NFB.js";import"./index-BV8EyldU.js";import"./index-mxjbKCDZ.js";import"./ListItemText-C4rFMnkb.js";import"./FormControlLabel-DD1FECGP.js";import"./KeyboardArrowRight-DtSUqMmU.js";const He=({dataIndex:n,subAsset:F,FetchDataValue:I,disable:o})=>{const{getValues:d,setValue:r,watch:u}=ce(),{dataDropdown:k,getDropdown:S}=l(),{dataDropdown:T,getDropdown:E}=l(),{dataDropdown:Z,getDropdown:U}=l(),{dataDropdown:G,getDropdown:O}=l(),{dataDropdown:B,getDropdown:P}=l(),{dataDropdown:Q,getDropdown:W}=l(),{dataDropdown:z,getDropdown:K}=l(),{dataDropdown:X,getDropdown:Y}=l(),{dataDropdown:H,getDropdown:J}=l(),{showToast:ee}=le(),te=u(`vendors[${n}].units`),_=M({name:"item_account_assignment_categories"}),C=M({name:"document_type"});L.useEffect(()=>{E("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",hiddenZero:!0,isMapping:!0}),S("",{name:"name_one",id:"id",tabel:"master_business_partners",hiddenZero:!0,isMapping:!0}),O("",{name:"material_group_desc",id:"material_group",tabel:"material_groups",hiddenZero:!0,isMapping:!0}),W("",{name:"description",id:"mwszkz",tabel:"pajaks",hiddenZero:!0,isMapping:!0}),K("",{name:"unit_of_measurement_text",id:"commercial",tabel:"uoms",hiddenZero:!0,isMapping:!0}),Y("",{name:"desc",id:"order_number",tabel:"master_orders",hiddenZero:!0,isMapping:!0}),J("",{name:"desc",id:"asset",tabel:"master_assets",where:{groupBy:"asset,desc"},hiddenZero:!0,isMapping:!0})},[]),L.useEffect(()=>{U("",{name:"description",id:"account",tabel:"account_assignment_categories",attribut:C,hiddenZero:!0,isMapping:!0})},[C]);const A=async e=>{P("",{name:"material_description",id:"material_number",tabel:"master_materials",attribut:e,isMapping:!0,hiddenZero:!0,where:{key:"material_group",parameter:e}})},re=async()=>{var e,i;try{const s=d(),g=s.item_id!==void 0&&s.item_id!==null&&s.item_id!==""?s.item_id:`random-generated-id-${Math.random().toString(36).substr(2,9)}`;let f=0;s.is_conversion_currency&&(f=(await he.post("/currency-conversion",{from:s.currency_from,to:s.currency_to,amount:parseInt(s.item_qty)*parseInt(s.item_unit_price)},{headers:{"Content-Type":"application/json"}})).data.data);const x={id:g,qty:s.item_qty,unit_price:s.item_unit_price,total_amount:s.item_qty*s.item_unit_price,account_assignment_categories:s.item_account_assignment_categories,cost_center:s.item_cost_center,material_group:s.item_material_group,material_number:s.item_material_number,uom:s.item_uom,tax:s.item_tax,short_text:s.item_short_text,order_number:s.item_order_number,asset_number:s.item_asset_number,sub_asset_number:s.item_sub_asset_number,total_amount_conversion:f},y=d(`vendors[${n}].units`)||[];let p=[];s.action==="edit"?p=y.map((m,v)=>m.id===s.indexEdit?x:m):p=[...y,x],r(`vendors[${n}].units`,p),r("indexEdit",0),r("item_id",null);const c=d("vendors").filter(m=>(m.winner||!1)===!0),w=c.length>0?c[0]:null;if(w!==null){const m=w.units||[],v=m.reduce((N,j)=>N+parseInt(j.total_amount),0);r("total_all_amount",v);const h=m.reduce((N,j)=>j.unit_price>N?parseInt(j.unit_price):N,0);r("amount_max",h);const b=parseInt(u("cash_advance_purchases.dp"))/100*parseInt(v);r("cash_advance_purchases.nominal",b)}$()}catch(s){de.isAxiosError(s)&&((i=(e=s.response)==null?void 0:e.data)!=null&&i.message)&&ee(s.response.data.message,"error")}},$=()=>{r("indexEdit",""),r("action","create"),r("item_account_assignment_categories",""),r("item_asset_number",""),r("item_cost_center",""),r("item_id",""),r("item_is_cashAdvance",""),r("item_material_group",""),r("item_material_number",""),r("item_order_number",""),r("item_qty",""),r("item_short_text",""),r("item_sub_asset_number",""),r("item_tax",""),r("item_unit_price",""),r("item_uom","")},se=async(e,i)=>{const s=e.id||`random-generated-id-${Math.random().toString(36).substr(2,9)}`;await A(e.material_group),r("indexEdit",s),r("action","edit"),r("item_account_assignment_categories",e.account_assignment_categories??""),r("item_asset_number",e.asset_number??""),r("item_cost_center",e.cost_center??""),r("item_id",s),r("item_material_group",e.material_group??""),r("item_material_number",e.material_number??""),r("item_order_number",e.order_number??""),r("item_qty",e.qty??"0"),r("item_short_text",e.short_text??""),r("item_sub_asset_number",e.sub_asset_number??""),r("item_tax",e.tax??""),r("item_unit_price",e.unit_price??"0"),r("item_uom",e.uom??"")},ie=async(e,i)=>{const s=`random-generated-id-${Math.random().toString(36).substr(2,9)}`;await A(e.material_group),r(": currency_total,",e.uom??"");const g={id:s,qty:e.qty??"0",unit_price:e.unit_price??"0",total_amount:parseInt(e.qty)*parseInt(e.unit_price),account_assignment_categories:e.account_assignment_categories,cost_center:e.cost_center??"",material_group:e.material_group??"",material_number:e.material_number??"",uom:e.uom??"",tax:e.tax??"",short_text:e.short_text??"",order_number:e.order_number??"",asset_number:e.asset_number??"",sub_asset_number:e.sub_asset_number??"",total_amount_conversion:e.total_amount_conversion??""},x=[...d(`vendors[${n}].units`)||[],g];r(`vendors[${n}].units`,x);const y=d("vendors").filter(c=>(c.winner||!1)===!0),p=y.length>0?y[0]:null;if(p!==null){const c=p.units||[],w=c.reduce((h,b)=>h+parseInt(b.total_amount),0);r("total_all_amount",w);const m=c.reduce((h,b)=>b.unit_price>h?parseInt(b.unit_price):h,0);r("amount_max",m);const v=parseInt(u("cash_advance_purchases.dp"))/100*parseInt(w);r("cash_advance_purchases.nominal",v)}$()},ne=(e,i)=>{const s=d(`vendors[${n}].units`)||[];console.log("currentItems",s);const g=s.filter((f,x)=>f.id!==e.id);r(`vendors[${n}].units`,g)},R=M({name:"total_vendor"}),oe=R>0?R:1,ae=e=>{const i=d(`vendors[${n}].units`)||[];r(`vendors[${e}].units`,i)},me=[{field:"actions",headerName:"Actions",width:150,renderCell:e=>t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[t.jsx(D,{type:"button",onClick:i=>{i.preventDefault(),ie(e.row)},href:"#",children:t.jsx("i",{className:"ki-filled ki-copy text-warning text-2xl"})}),t.jsx(D,{type:"button",onClick:i=>{i.preventDefault(),se(e.row)},href:"#",children:t.jsx("i",{className:" ki-duotone ki-notepad-edit text-success text-2xl"})}),t.jsx(D,{type:"button",onClick:i=>{i.preventDefault(),ne(e.row)},href:"#",children:t.jsx("i",{className:" ki-duotone ki-trash-square text-danger text-2xl"})})]})}];return t.jsxs("div",{children:[t.jsx(a,{options:[{label:"Existing",value:"existing"},{label:"New",value:"new"}],fieldLabel:"Select Type Vendor",fieldName:`vendors[${n}].type_vendor`,isRequired:!0,style:{width:"56.5rem"},placeholder:"Select Vendor",classNames:"mt-2",disabled:o}),u(`vendors[${n}].type_vendor`)==="existing"&&t.jsxs(t.Fragment,{children:[t.jsx(a,{options:k,fieldLabel:"Select Vendor",fieldName:`vendors[${n}].vendor`,isRequired:!0,style:{width:"56.5rem"},placeholder:"Select Vendor",classNames:"mt-2",disabled:o}),t.jsx(ue,{fieldLabel:"Propose Vendor",fieldName:`vendors[${n}].winner`,isRequired:!1,disabled:o})]}),u(`vendors[${n}].winner`)&&t.jsx(q,{fieldLabel:"Number Quotation",fieldName:`vendors[${n}].quotation`,isRequired:!1,type:"text",placeholder:"Number Quotation",disabled:o}),u(`vendors[${n}].type_vendor`)==="new"&&t.jsx(t.Fragment,{children:t.jsx(q,{fieldLabel:"Vendor Name",fieldName:`vendors[${n}].vendor_name_text`,isRequired:!1,type:"text",placeholder:"Enter your vendor",disabled:o})}),!o&&t.jsxs("div",{className:"card mt-2",children:[t.jsx("div",{className:"card-header",children:t.jsx("p",{children:"item"})}),t.jsxs("div",{className:"card-body",style:{padding:"1rem"},children:[t.jsx(q,{fieldLabel:"Qty",fieldName:"item_qty",isRequired:!1,type:"number",placeholder:"Enter your qty",disabled:o}),t.jsx(q,{fieldLabel:"Unit Price",fieldName:"item_unit_price",isRequired:!1,disabled:o,type:"number",placeholder:"Unit Price"}),t.jsx(a,{options:Z,fieldLabel:"Account Assignment",fieldName:"item_account_assignment_categories",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Account Assignment",classNames:"mt-2"}),(_==="K"||_==="V"||_==="W"||_==="Y")&&t.jsx(a,{options:T,fieldLabel:"Cost Center",fieldName:"item_cost_center",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Cost Center",classNames:"mt-2"}),t.jsx(a,{options:G,fieldLabel:"Material Group",fieldName:"item_material_group",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Material Group",classNames:"mt-2",onChangeOutside:async(e,i)=>{await A(e)}}),t.jsx(a,{options:B,fieldLabel:"Material Number",fieldName:"item_material_number",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Material Number",classNames:"mt-2"}),t.jsx(a,{options:z,fieldLabel:"Uom",fieldName:"item_uom",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Purchase requisition unit of measure",classNames:"mt-2"}),t.jsx(a,{options:Q,fieldLabel:"Tax On Sales",fieldName:"item_tax",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Tax on sales",classNames:"mt-2"}),t.jsx(_e,{fieldLabel:"Short Text",fieldName:"item_short_text",isRequired:!1,disabled:o,maxLength:40,classNames:"mt-4",style:{width:"56.5rem"}}),_==="F"&&t.jsx(a,{options:X,fieldLabel:"Order Number",fieldName:"item_order_number",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Order Number",classNames:"mt-2"}),_==="A"&&t.jsxs(t.Fragment,{children:[t.jsx(a,{options:H,fieldLabel:"Main Asset Number",fieldName:"item_asset_number",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Main Asset",classNames:"mt-2",onChangeOutside:(e,i)=>{I(e,n)}}),t.jsx(a,{options:F[n],fieldLabel:"Sub Asset",fieldName:"item_sub_asset_number",isRequired:!1,disabled:o,style:{width:"56.5rem"},placeholder:"Sub Asset Number",classNames:"mt-2"})]})]}),t.jsx("div",{className:"card-footer",children:t.jsx(V,{type:"button",variant:"contained",className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition-all",onClick:async()=>await re(),children:"Add Item"})})]}),t.jsx(be,{sx:{width:"100%",overflowX:"auto",marginTop:"1rem"},children:t.jsx("div",{className:"lg:col-span-2",children:t.jsx("div",{className:"grid",children:t.jsx("div",{className:"card card-grid h-full min-w-full",children:t.jsx("div",{className:"card-body",children:t.jsx("div",{"data-datatable":"true",children:t.jsx("div",{className:"scrollable-x-auto",children:t.jsx(ge,{columns:[...o?[]:me,...pe],rows:te,hideFooterPagination:!0})})})})})})})}),Array.from({length:oe},(e,i)=>t.jsx(t.Fragment,{children:i!==n&&t.jsxs(V,{type:"button",variant:"contained",style:{marginTop:"1rem",marginRight:"1rem"},className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition-all",onClick:async()=>await ae(i),children:["Copy To Vendor ",i+1]},i)}))]})};export{He as default};
