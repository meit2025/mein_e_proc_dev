import{u as G,r as w,j as e}from"./app-V_aYsj-M.js";/* empty css              */import{F as U,a as p,b as u,c as g,d as f,e as W}from"./form-DN64hzNr.js";import{u as H,b as F,a as J,c as q}from"./index.esm-_MomtXCY.js";import{S as I,a as P,b as L,c as X,d as O}from"./select-zW_Ufi8g.js";import{S as K}from"./separator-YWaC-m9H.js";import{T as Q}from"./textarea-ed9U-XYq.js";import{I as v}from"./input-DfoRi2XR.js";import{T as Z,a as ee,b as te,c as se}from"./tabs-gYCtKfJl.js";import{z as r,t as ae}from"./index-DabNArkO.js";import{S as ne}from"./scroll-area-UM4GkKYX.js";import{C as le,G as re}from"./api-BzUwn5yu.js";import{a as ie}from"./axiosInstance-D_UQ5Oeg.js";import{h as $}from"./moment-C5S46NFB.js";import{B as R}from"./button-DgFoKUJa.js";import{d as de}from"./index-BjJohnmY.js";import{C as ce}from"./chevrons-up-down-BROtukoX.js";import"./app-HlhieNAw.js";import"./utils-Dt2ZdthB.js";import"./index-DnYZiXOk.js";import"./index-BsScLVdH.js";import"./index-T6xl80ph.js";import"./Combination-DY1yqLlm.js";import"./index-ujTPzd8h.js";import"./index-fmdl82i2.js";import"./index-C0IC6wh1.js";import"./index-A2phKgim.js";import"./createLucideIcon-BeYui1_Y.js";const Oe=({listBusinessTrip:a})=>{var k,M,B;const t=r.object({request_no:r.string().min(1,"Request for required"),remark:r.string().min(1,"Remark is required"),attachment:r.instanceof(File).nullable().optional(),total_destination:r.number().min(1,"Total Destinantion Required"),destinations:r.array(r.object({destination:r.string().min(1,"Destinantion Required"),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.string().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional(),request_start_time:r.string().optional(),request_end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),type:r.string().optional(),subtotal:r.string().optional(),detail:r.array(r.object({date:r.string().nullish(),request_price:r.any().optional()}))})),other:r.any().optional()}))}),n=H({resolver:ae(t),defaultValues:{request_no:"",remark:"",attachment:null,total_destination:1,destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),{showToast:h}=G(),j=async c=>{console.log(c," data");try{const o=new FormData;o.append("request_no",c.request_no??""),o.append("remark",c.remark??""),o.append("attachment",c.attachment??""),o.append("total_destination",`${c.total_destination}`),c.destinations.forEach((x,y)=>{o.append(`destinations[${y}]`,JSON.stringify(x))}),await de.Inertia.post(le,o,{headers:{"Content-Type":"multipart/form-data"}}),h("succesfully created data","success")}catch(o){console.log(o)}},[l,d]=w.useState([]),[s,_]=w.useState([]),[T,N]=w.useState([]);async function i(c){n.setValue("request_no",c||"");const o=re(c);try{const x=await ie.get(o),y=x.data.data;console.log(y," Response Detailxxxx"),n.setValue("remark",y.remarks||""),n.setValue("total_destination",y.total_destination||1),d(x.data.data),N(y.destinations),b(y.total_destination),Y(y.destinations)}catch(x){console.log(x)}}const[m,b]=w.useState(""),D=c=>{b(c)};console.log(l,"businessTripDetail");function Y(c){const o=c.map(x=>({destination:x.destination||"",business_trip_start_date:new Date(x.business_trip_start_date),business_trip_end_date:new Date(x.business_trip_end_date),allowances:x.allowances||[],detail_attedances:x.detail_attedances||[],total_allowance:x.total_allowance||0}));n.setValue("destinations",o)}const{fields:A,append:S,remove:C,update:V}=F({control:n.control,name:"destinations"});w.useEffect(()=>{},[l,m]);const[E,z]=w.useState(0);return e.jsx(ne,{className:"h-[600px] w-full ",children:e.jsx(U,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(j),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(p,{control:n.control,name:"request_no",render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:o=>i(o),value:c.value,children:[e.jsx(P,{className:"w-[200px] py-2",children:e.jsx(L,{placeholder:"-- Select One --"})}),e.jsx(X,{children:a.map(o=>e.jsx(O,{value:o.id.toString(),children:o.request_no}))})]})}),e.jsx(f,{})]})})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:l.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:l.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:(k=l==null?void 0:l.pajak)==null?void 0:k.mwszkz})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(M=l==null?void 0:l.cost_center)==null?void 0:M.company_code})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:(B=l==null?void 0:l.purchasing_group)==null?void 0:B.purchasing_group})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(p,{control:n.control,name:"remark",render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(Q,{placeholder:"Insert remark",...c,rows:4,className:"w-[300px]"})}),e.jsx(f,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(p,{control:n.control,name:"attachment",render:({field:c})=>e.jsxs(u,{children:[e.jsx(W,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(g,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:o=>{var y;const x=(y=o.target.files)==null?void 0:y[0];x?c.onChange(x):c.onChange(null)}})}),e.jsx(f,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"Not Availabe"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(p,{control:n.control,name:"total_destination",render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(I,{value:m,onValueChange:D,disabled:!0,children:[e.jsx(P,{className:"w-[200px] py-2",children:e.jsx(L,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(X,{children:Array.from({length:5},(o,x)=>e.jsxs(O,{value:(x+1).toString(),children:[" ",x+1," "]}))})]})}),e.jsx(f,{})]})})]})]})]}),e.jsx(K,{className:"my-4"}),e.jsx(oe,{updateDestination:V,destinationField:A,form:n,listAllowances:s,totalDestination:n.getValues("total_destination").toString(),setTotalAllowance:z,businessTripDetail:l}),e.jsx(R,{type:"submit",children:"submit"})]})})})};function oe({totalDestination:a,listAllowances:t,form:n,destinationField:h,updateDestination:j,setTotalAllowance:l,businessTripDetail:d}){return e.jsxs(Z,{defaultValue:"destination1",className:"w-full",children:[e.jsx(ee,{className:"flex items-center justify-start space-x-4",children:h.map((s,_)=>e.jsxs(te,{value:`destination${_+1}`,children:["Destination ",_+1]}))}),h.map((s,_)=>e.jsx(xe,{listAllowances:t,updateDestination:j,destination:s,form:n,index:_,setTotalAllowance:l,businessTripDetail:d}))]})}function xe({form:a,index:t,destination:n,updateDestination:h,listAllowances:j,setTotalAllowance:l,businessTripDetail:d}){const{fields:s,update:_,append:T,remove:N}=F({control:a.control,name:`destinations[${t}].detail_attedances`}),{fields:i,update:m,append:b,remove:D,replace:Y}=F({control:a.control,name:`destinations[${t}].allowances`});w.useState(!1);const{setValue:A}=J(),S=q({control:a.control,name:"total_percent"}),C=d.total_cash_advance;return w.useEffect(()=>{const E=parseFloat(S||0)/100*C;A("total_cash_advance",E.toFixed(2))},[S,C,A]),e.jsxs(se,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:n.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:$(n.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:$(n.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(me,{detailAttedanceFields:s,form:a,updateAttedanceFields:_,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(je,{allowanceField:i,destinationIndex:t,form:a})]},t),e.jsx(he,{allowanceField:i,destinationIndex:t,form:a,setTotalAllowance:l}),e.jsx("table",{className:"w-full text-sm mt-10",children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[20%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[80%] flex",children:C})]})})]})}function he({allowanceField:a,destinationIndex:t,form:n,setTotalAllowance:h}){const j=n.watch(`destinations[${t}].allowances`),l=n.watch(`destinations[${t}].total_allowance`);return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:j.map((d,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:d.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:d.subtotal})]})]},d.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:l})]})]})})]})})}function me({form:a,destinationIndex:t,detailAttedanceFields:n,updateAttedanceFields:h}){const j=a.watch(`destinations[${t}].detail_attedances`);return w.useEffect(()=>{},[j]),w.useEffect(()=>{},[n]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:j.map((l,d)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[$(l.date).format("DD/MM/YYYY"),e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.date`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(s.value).format("YYYY-MM-DD"),onChange:s.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[l.shift_code,e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.shift_code`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(s.value).format("YYYY-MM-DD"),onChange:s.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[l.shift_start,e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.shift_start`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(s.value).format("YYYY-MM-DD"),onChange:s.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[l.shift_end,e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.shift_end`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(s.value).format("YYYY-MM-DD"),onChange:s.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsx("td",{children:e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.start_time`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:s.value,onChange:s.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.end_time`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:s.value,onChange:s.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.request_start_time`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:s.value,onChange:s.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(p,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.request_end_time`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:s.value,onChange:s.onChange})}),e.jsx(f,{})]})})})]},l.index))})]})})})]})}function je({form:a,destinationIndex:t,allowanceField:n}){const h=a.watch(`destinations[${t}].allowances`);w.useEffect(()=>{},[h]);const{fields:j,append:l,remove:d}=F({control:a.control,name:`destinations.${t}.other`}),s=q({control:a.control,name:`destinations.${t}.other`}),_=()=>(s||[]).reduce((N,i)=>{const m=Number((i==null?void 0:i.value)||0);return N+m},0),T=()=>{l({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[h.map((N,i)=>e.jsx(pe,{form:a,allowance:N,destinationIndex:t,allowanceIndex:i})),j.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(R,{type:"button",className:"text-xl",onClick:T,children:"+"})})}),j.map((N,i)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{control:a.control,name:`destinations.${t}.other[${i}].value`,render:({field:m})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:m.value,onChange:b=>{m.onChange(b)}})}),e.jsx(f,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",_()]})})}),e.jsx("td",{children:e.jsx(R,{type:"button",className:"text-xs",onClick:()=>d(i),children:"X"})})]},i))]})}function pe({form:a,allowance:t,destinationIndex:n,allowanceIndex:h}){const[j,l]=w.useState(!1);w.useState(0);const d=i=>{l(m=>!m)},s=q({control:a.control,name:`destinations[${n}].allowances[${h}].detail[0].request_price`}),_=q({control:a.control,name:`destinations[${n}].allowances[${h}].detail`}),T=()=>{if(t.type==="total")return parseFloat(s||0)*1;{let i=0;return _==null||_.forEach(m=>{const b=parseFloat(m.request_price||0);i+=b}),i}},N=(i,m)=>{const b=parseFloat(m),D=isNaN(b)?0:b,Y=t.request_value;let A=!0;switch(Y){case"unlimited":A=!0;break;case"fixed value":const S=t.subtotal;D!==S&&(alert(`Please enter the fixed value of IDR ${S}`),A=!1);break;case"up to max value":const C=t.subtotal;D>C&&(alert(`The value should not exceed IDR ${C}`),A=!1);break;default:A=!1}A&&a.setValue(`destinations[${n}].allowances[${h}].detail[${i}].request_price`,D)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{control:a.control,name:`destinations[${n}].allowances[${h}].detail[0].request_price`,render:({field:i})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:i.value,onChange:m=>N(0,m.target.value)})}),e.jsx(f,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",T()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(R,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),j&&e.jsx(e.Fragment,{children:t.detail.map((i,m)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:$(i.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(p,{control:a.control,name:`destinations[${n}].allowances[${h}].detail[${m}].request_price`,render:({field:b})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:b.value,onChange:D=>N(m,D.target.value)})}),e.jsx(f,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},i.id))})]})}function ze({form:a,type:t,allowanceIndex:n,destinationIndex:h}){const{fields:j}=F({control:a.control,name:`destinations.${h}.allowances.${n}.detail`});return e.jsx(e.Fragment,{children:j.map((l,d)=>e.jsx(p,{control:a.control,name:`destinations.${h}.allowances.${d}.detail.${d}.request_price`,render:({field:s})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:s.value,onChange:s.onChange})}),e.jsx(f,{})]})}))})}export{ze as AllowanceInputForm,pe as AllowanceRowInput,oe as BussinesTripDestination,xe as BussinessDestinationForm,Oe as BussinessTripFormV1,je as DetailAllowance,me as DetailAttedances,he as ResultTotalItem};
