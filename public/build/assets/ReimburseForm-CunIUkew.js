import{j as e,r as q,u as nt,q as lt}from"./app-CTh3kvOX.js";import{B as ot}from"./button-DWH0Xgy5.js";import{h as z}from"./moment-C5S46NFB.js";import{z as p,t as it}from"./index-AMrxDqeW.js";import{f as K}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ct,F as T,a as A,b as E,c as k,I as Re,f as mt,e as ut}from"./form-D__EzdxD.js";import{u as dt,b as pt}from"./index.esm-DS68CA5F.js";import{T as Te}from"./textarea-CJ7Eme7Y.js";import{S as ht}from"./scroll-area-B49g2M64.js";import{a as Y}from"./axiosInstance-DzGPJiez.js";import{S as Ae}from"./separator-BZLCio5p.js";import{T as ft,a as gt,b as bt,c as _t}from"./tabs-CBiNJF-i.js";import{S as X,a as Q,b as U,c as ee,d as te}from"./select-CiJOnR_9.js";import{F as pe}from"./formDropdown-B3JkNxjE.js";import{C as Ee}from"./CustomDatePicker-CugQGRV-.js";import{ReimburseFormType as x}from"./listModel-BpIRwQpu.js";import{u as se}from"./getDropdown-BTYOkewo.js";import{G as jt,a as ke,b as xt}from"./api-BeRu2Z8X.js";import{L as yt}from"./LoadingSpin-CyLcZl_3.js";import{W as wt}from"./WorkflowComponent-CTt_t9NZ.js";import{C as vt}from"./CustomStatus-BuD4uP2b.js";import{F as Le}from"./FormHelperText-EIpBRZtY.js";import{B as Nt}from"./Button-CMXUOtnV.js";import"./app-CfpADx9m.js";import"./index-Cq8hzMGu.js";import"./index-Bb4qSo10.js";import"./utils-Dh97R192.js";import"./createLucideIcon-CPVK6x5j.js";import"./index-CEXoxLN6.js";import"./index-CZmIq-64.js";import"./index-Dji0ht4z.js";import"./index-DtGKePfb.js";import"./index-Csq47a0z.js";import"./index-BdQq_4o_.js";import"./index-DkhbIixU.js";import"./index-B3UEZXde.js";import"./index-DaiRYLfv.js";import"./index-BGb9SAxe.js";import"./index-KRiSHzA7.js";import"./Combination-C99O56-Y.js";import"./index-BN7VOD__.js";import"./TextField-FxrA5W9M.js";import"./createSvgIcon-BkohkIM7.js";import"./DefaultPropsProvider-DYV0MD-a.js";import"./useSlot-CebwZN1g.js";import"./createSimplePaletteValueFilter-ZNaaQ3s1.js";import"./useControlled-CjsMLuco.js";function Dt({isLoading:H=!1,children:he}){return e.jsx("div",{className:"",children:H?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(yt,{})})}):he})}const xs=({onSuccess:H,currencies:he,taxDefaultValue:ye,uomDefaultValue:we,edit_url:Me,update_url:Ve,store_url:Ie,type:_,currentUser:V})=>{const[ve,Ne]=q.useState("form1"),{showToast:L}=nt();lt().props;const{dataDropdown:ae,getDropdown:re}=se(jt);se();const{dataDropdown:$e,getDropdown:Be}=se(),{dataDropdown:ne,getDropdown:le}=se("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:oe,getDropdown:ie}=se("api/master/cost-center/dropdown-list"),[B,fe]=q.useState([]),[Ye,ge]=q.useState([]),[ce,Pe]=q.useState(null),[De,Ge]=q.useState(!1),[Oe,me]=q.useState(!1),[N,P]=q.useState([]),[St,G]=q.useState([]);q.useState([]);const be=q.useRef([]),W=q.useRef([]),[Z,ze]=q.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),He=1*1024*1024,We=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],Ze=p.object({formCount:p.string().min(1,"total form must be have value"),remark_group:p.string().min(1,"header remark is required"),cost_center:p.string().min(1,"cost center required"),requester:p.string().min(1,"requester required"),value:p.number().optional(),user_id:p.string().optional(),forms:p.array(p.object({reimburseId:p.string().optional(),for:p.string().optional(),group:p.string().optional(),reimburse_type:p.string().min(1,"reimburse type is required"),short_text:p.string().min(1,"remarks is required"),balance:p.string(),remaining_balance_when_request:p.number(),currency:p.string().min(1,"currency required"),tax_on_sales:p.string().min(1,"tax required"),purchase_requisition_unit_of_measure:p.string().min(1,"uom required"),purchasing_group:p.string().min(1,"Purchasing Group required"),type:p.any(),item_delivery_data:p.date(),claim_date:p.date(),attachment:p.array(p.instanceof(File).refine(t=>We.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=He,{message:"File size must be less than 1MB"})),savedAttachment:p.array(p.any()).optional().nullable()}).refine(t=>{const s=_===x.clone,n=_===x.create,m=Array.isArray(t.savedAttachment)&&t.savedAttachment.length>0,i=Array.isArray(t.attachment)&&t.attachment.length>0;return!(n&&!i||s&&!m&&!i)},{message:"Attachment is required",path:["attachment"]}))});q.useEffect(()=>{(async()=>{var n,m;(_===x.edit||_===x.clone)&&(me(!0),await Je()),Be("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=Number(ve.split("form")[1])-1;le("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(n=r.getValues("forms")[s])!=null&&n.purchasing_group?"id":"",value:((m=r.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),re("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&_===x.create&&J(0)})()},[_]);async function Je(){var t,s;r.setValue("forms",[]),me(!0);try{const m=(await Y.get(Me??"")).data.data,i=m.forms??[],d=m.group;Pe(d.reimbursementStatus),G(i.map(c=>String(c.id)));const b=i.map((c,g)=>{const{id:j,for:h,group:R,reimburse_type:w,short_text:S,balance:I,currency:$,tax_on_sales:F,purchase_requisition_unit_of_measure:v,remaining_balance_when_request:C,purchasing_group:l,type:a,item_delivery_data:o,claim_date:u,reimburse_attachment:f}=c,D=i.slice(g).filter(M=>M.for===h&&M.reimburse_type.code===w.code);be.current.push({id:String(j),reimburse_type:w.code,balance:D.reduce((M,ue)=>M+Number(ue.balance||0),0),limit:D.reduce(M=>M+1||0,0),for:String(h)});const O=W.current.findIndex(M=>M.reimburse_type===w.code&&M.for===String(h));return O!==-1?W.current[O].totalBalance=Number(W.current[O].totalBalance)+Number(I||0):W.current.push({reimburse_type:w.code,totalBalance:Number(I||0),for:String(h)}),{reimburseId:String(j),for:String(h),group:String(R),reimburse_type:w.code,short_text:S,balance:I,currency:$,tax_on_sales:String(F),purchase_requisition_unit_of_measure:String(v),remaining_balance_when_request:Number(C)||0,purchasing_group:String(l),type:a,item_delivery_data:new Date(o),claim_date:new Date(u),attachment:[],savedAttachment:f}});r.setValue("formCount",i.length.toString()),r.setValue("remark_group",d.remark),r.setValue("cost_center",String(d.cost_center.id)),r.setValue("requester",d.requester),r.setValue("forms",b);for(let c=0;c<i.length;c++){const g=i[c];await J(c,{reimburse_type:g.reimburse_type.code}),await Se(c,{type:g.type,reimburse_type:g.reimburse_type.code}),await je(c,{reimburse_type:g.reimburse_type.code,for:g.reimburse_type.is_employee===1?null:g.for},!0)}me(!1)}catch(n){const m=n;me(!1),L((s=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:s.message,"error")}}const Ke={formCount:"1",remark_group:"",cost_center:"",requester:String(V==null?void 0:V.is_admin)==="1"?"":V==null?void 0:V.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ye,purchase_requisition_unit_of_measure:we,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=dt({resolver:it(Ze),defaultValues:Ke}),{fields:_e,update:y}=pt({control:r.control,name:"forms"}),J=async(t,s=null)=>{const n=r.getValues("requester");if(n===null||n===""){fe(i=>{const d=[...i];return d[t]=[],d});return}const m=await Y.get(ke,{params:{user:n,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});fe(i=>{const d=[...i];return d[t]=m.data.data,d})},Xe=async(t,s)=>{if(t&&t.length>0)try{const n=await Y.get(ke,{params:{search:t,user:r.getValues("requester")}});fe(m=>{const i=[...m];return i[s]=n.data.data,i})}catch(n){console.error("Error searching reimburse types:",n)}},Se=async(t,s)=>{const n=await Y.get(xt,{params:{user:r.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});ge(m=>{const i=[...m];return i[t]=n.data.data,i})},Qe=t=>{for(let s=0;s<_e.length;s++)J(s);if(t==null)for(let s=0;s<_e.length;s++)r.setValue(`forms.${s}.reimburse_type`,""),r.setValue(`forms.${s}.for`,"");P([]),ge([])},Fe=(t,s)=>{const n=r.getValues("forms");n.forEach((m,i)=>{var d,b;if(i>t&&n[i].reimburse_type===s.reimburse_type){const c=((d=N[i])==null?void 0:d.balance)||0,g=((b=N[i])==null?void 0:b.limit)||0;P(j=>{var R;const h=[...j];return h[i]={...h[i],balance:c+Number(s.balance||"0")},((R=N[i])==null?void 0:R.type_limit)!=="Unlimited"&&(h[i]={...h[i],limit:g+1}),h}),r.setValue(`forms.${i}.balance`,"")}})};function Ue(t){const s=[...r.getValues("forms")];for(let n=0;n<Number(t);n++)if(n+1>s.length){J(n);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ye,purchase_requisition_unit_of_measure:we,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}r.setValue("forms",s)}const et=t=>{Ne(t)},tt=async t=>{var n,m,i,d,b;if(N)for(let c=0;c<N.length;c++){if(t.forms.length==0||t.forms.length-1,((n=N[c])==null?void 0:n.type_limit)!=="Unlimited"&&Number((m=N[c])==null?void 0:m.limit)==0){L("Claim Limit for form "+(c+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[c].balance==""||Number(t.forms[c].balance)==0){L("Claim Balance for form "+(c+1)+" cannot be 0","error");return}if(Number(((i=N[c])==null?void 0:i.balance)??0)<Number(t.forms[c].balance??0)){L("Please check your balance input for forms "+(c+1)+"  is not must be above "+((d=N[c])==null?void 0:d.balance),"error");return}t.forms=t.forms.map((g,j)=>{var h;return{...g,claim_date:z(g.claim_date).toDate(),item_delivery_data:z(g.item_delivery_data).toDate(),remaining_balance_when_request:Number(((h=N[j])==null?void 0:h.balance)??0)}})}const s=t.forms.reduce((c,g)=>c+Number(g.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let c;_===x.edit||_===x.clone?c=await Y.post(Ve??"",t,{headers:{"Content-Type":"multipart/form-data"}}):c=await Y.post(Ie??"",t,{headers:{"Content-Type":"multipart/form-data"}}),L((b=c==null?void 0:c.data)==null?void 0:b.data,"success"),H==null||H()}catch{}};async function je(t,s=null,n=!1){var b,c,g;const m=r.getValues(`forms.${t}`);let i=!m.for||m.for===""?r.getValues("requester")||"":m.for;const d={user:r.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:m.reimburse_type,for:s!=null?s.for:i};try{const j=await Y.get("reimburse/data-limit-and-balance",{params:d}),h=r.getValues("forms");let R=0,w=0,S=j.data.data.balance,I=j.data.data.limit,$=(a=!1)=>h.filter((o,u)=>{let f=!o.for||o.for===""?r.getValues("requester")||"":o.for;return o.reimburse_type===m.reimburse_type&&f===i&&(_===x.clone&&n&&!a?!0:u!==t)}),F=$(!0).length,v=$().reduce((a,o)=>a+Number(o.balance||0),0);if(_===x.clone){let a=((b=W.current.find(o=>o.reimburse_type===m.reimburse_type&&o.for===i))==null?void 0:b.totalBalance)??0;if(S+=a,n){let o=be.current.find(u=>m.reimburseId==u.id);o&&(R=Number(o.balance),w=F+Number(o.limit),G(u=>{const f=[...u];return f[t]=o.id,f}))}else{let o=be.current.find(u=>u.reimburse_type===m.reimburse_type&&u.for===i);o!==void 0&&(w=Number(o.limit),G(u=>{const f=[...u];return f[t]=o.id,f}))}}let C=S-v+R,l=Math.max(0,I-F+w);P(a=>{const o=[...a];return o[t]={...j.data.data,balance:C,limit:j.data.data.type_limit==="Unlimited"?j.data.data.type_limit:l},o})}catch(j){const h=j;L((g=(c=h==null?void 0:h.response)==null?void 0:c.data)==null?void 0:g.message,"error")}}const Ce=async()=>{var t,s,n,m,i,d,b,c,g,j,h,R;try{const w=r.getValues("forms"),S=w.map((v,C)=>({index:C,value:v.balance?Number(v.balance):0}));if(S.some(v=>v.value===0)){const v=S.findIndex(C=>C.value===0);L(`Please fill balance form ${v+1}`,"error");return}const $=w.reduce((v,C)=>v+(Number(C.balance)||0),0),F=await Y.get("/check-approval",{params:{value:$,requester:r.getValues("requester"),type:"REIM"}});if(F.data.status_code===200){const v=(s=(t=F.data)==null?void 0:t.data)==null?void 0:s.approval.map(u=>(u==null?void 0:u.division_name)||null),C=(m=(n=F.data)==null?void 0:n.data)==null?void 0:m.approval.map(u=>(u==null?void 0:u.name)||null),l=[];(d=(i=F.data)==null?void 0:i.data)!=null&&d.hr&&l.push((g=(c=(b=F.data)==null?void 0:b.data)==null?void 0:c.hr)==null?void 0:g.name);const a=(((j=F.data.data)==null?void 0:j.approval)??[]).map(u=>({status:"",name:u.name,dateApproved:""}));ze({approvalRequest:v,approvalFrom:C,acknowledgeFrom:l,approvalFromStatusRoute:a}),Ge(!0)}}catch(w){const S=w;L((R=(h=S==null?void 0:S.response)==null?void 0:h.data)==null?void 0:R.message,"error")}};q.useEffect(()=>{r.getValues("forms").reduce((n,m)=>n+Number(m.balance)||0,0)>0&&De===!0&&Ce()},[r.watch("forms"),r.watch("requester")]);const st=t=>{const s=t;if(Object.keys(s).length>0){let n=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,i])=>{m==="forms"?i.forEach((d,b)=>{n+=`</br><strong>Form ${b+1}:</strong></br>`,Object.values(d).forEach(c=>{n+=`<li>${c.message}</li>`})}):n+=`<li>${i.message}</li>`}),n+="</ul>",L(e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),"error")}};return e.jsx(ht,{className:"h-[600px] w-full",children:e.jsx(Dt,{isLoading:Oe,children:e.jsx(ct,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(tt,t=>{st(t)}),children:[e.jsx("table",{className:"mt-4 w-full text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:ce&&e.jsx(vt,{name:ce.name,className:ce.classname,code:ce.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:"remark_group",render:({field:t})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Te,{placeholder:"Insert remark",...t})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(pe,{fieldLabel:"",options:oe,fieldName:"cost_center",disabled:_===x.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=oe==null?void 0:oe.some(n=>n.label===t);t.length>0&&!s?await ie(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=r.getValues("cost_center");ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(pe,{options:ae,fieldName:"requester",disabled:String(V==null?void 0:V.is_admin)==="0"||_===x.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const n=ae==null?void 0:ae.some(m=>m.label===t);t.length>0&&!n?re(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!n&&re("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>Qe(t),onFocus:()=>{const t=r.getValues("requester");re("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:_===x.edit,onValueChange:n=>{t.onChange(n),Ue(n);const m=r.getValues("forms");let i=Number(n);if(m.length>i){const d=m.slice(0,i);r.setValue("forms",d),P(b=>{let c=[...b];return c=c.slice(0,i),c}),Ne(`form${Math.max(1,i)}`),G(b=>{const c=[...b];return c[i]="",c})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"Select number of forms"})}),e.jsx(ee,{children:Array.from({length:3},(n,m)=>m+1).map(n=>e.jsx(te,{value:n.toString(),children:n},n))})]})}),e.jsx(k,{})]})}})})]})]})}),e.jsx(Ae,{className:"my-4"}),e.jsxs(ft,{value:ve,onValueChange:et,className:"w-full",children:[e.jsxs(gt,{className:"flex justify-start items-center space-x-4",children:[" ",Array.from({length:Number(r.watch("formCount"))||1}).map((t,s)=>e.jsxs(bt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),_e.map((t,s)=>{var n,m,i,d,b,c,g,j,h,R,w,S,I,$,F,v,C;return e.jsxs(_t,{value:`form${s+1}`,children:[e.jsx(T,{control:r.control,name:`forms.${s}.reimburseId`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Re,{className:"sr-only",value:t.reimburseId,onChange:l.onChange})}),e.jsx(k,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(pe,{options:B[s],fieldName:`forms.${s}.reimburse_type`,disabled:B[s]===void 0||B[s].length===0||_===x.edit,placeholder:"Select Reimburse Type",onSearch:async l=>{var o;((o=B[s])==null?void 0:o.some(u=>u.label===l))||await Xe(l,s)},onChangeOutside:async l=>{if(l){const a=B[s].filter(u=>u.value==l)[0];y(s,{...t,reimburse_type:l,type:a.is_employee===1?"Employee":"Family",balance:""}),a.is_employee===1?je(s,{reimburse_type:l,for:null}):(P(u=>{const f=[...u];return f[s]=[],f}),r.setValue(`forms.${s}.balance`,""),r.setValue(`forms.${s}.for`,""),Se(s,{type:"Family",reimburse_type:l}));const o=r.getValues(`forms.${s}.reimburse_type`);l!==o&&(G(u=>{const f=[...u];return f[s]="",f}),Fe(s,t))}else P(a=>{const o=[...a];return o[s]=[],o}),y(s,{...t,reimburse_type:"",type:"",balance:""}),G(a=>{const o=[...a];return o[s]="",o}),r.setValue(`forms.${s}.for`,""),ge(a=>{const o=[...a];return o[s]=[],o}),Fe(s,t)},onFocus:()=>{J(s)},classNames:"mt-2 w-full"}),((i=(m=(n=r.formState.errors)==null?void 0:n.forms)==null?void 0:m[s])==null?void 0:i.reimburse_type)&&e.jsx(Le,{error:!0,children:(g=(c=(b=(d=r.formState.errors)==null?void 0:d.forms)==null?void 0:b[s])==null?void 0:c.reimburse_type)==null?void 0:g.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.for`,render:({field:l})=>{var a,o,u,f;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:((u=(o=(a=B==null?void 0:B[s])==null?void 0:a.filter(D=>(D==null?void 0:D.value)==r.getValues(`forms.${s}.reimburse_type`)))==null?void 0:o[0])==null?void 0:u.is_employee)===1||_===x.edit,onValueChange:D=>{y(s,{...t,for:D}),je(s,{reimburse_type:r.getValues(`forms.${s}.reimburse_type`),for:D})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:(f=Ye[s])==null?void 0:f.map(D=>e.jsx(te,{value:D.value.toString(),children:D.label},D.value))})]})}),e.jsx(k,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(pe,{fieldLabel:"",options:ne,fieldName:`forms.${s}.purchasing_group`,disabled:_===x.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:l=>{const a=ne==null?void 0:ne.some(o=>o.label===l);l.length>0&&!a?le(l,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:l}):l.length==0&&!a&&le("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:l=>{l&&y(s,{...t,purchasing_group:l})},onFocus:()=>{var a;const l=(a=r.getValues("forms")[s])==null?void 0:a.purchasing_group;le("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:l?"id":"",value:l??""}})}}),((R=(h=(j=r.formState.errors)==null?void 0:j.forms)==null?void 0:h[s])==null?void 0:R.purchasing_group)&&e.jsx(Le,{error:!0,children:($=(I=(S=(w=r.formState.errors)==null?void 0:w.forms)==null?void 0:S[s])==null?void 0:I.purchasing_group)==null?void 0:$.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.tax_on_sales`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:!0,onValueChange:a=>{y(s,{...t,tax_on_sales:a})},defaultValue:t.tax_on_sales,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:($e??[]).map((a,o)=>e.jsxs(te,{value:a.value.toString(),children:[a.description," - ",a.label]},a.value))})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:!0,onValueChange:a=>{y(s,{...t,purchase_requisition_unit_of_measure:String(a)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:e.jsx(te,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.short_text`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Te,{placeholder:"Insert remark",onChange:a=>{y(s,{...t,short_text:a.target.value})},defaultValue:t.short_text})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((F=N[s])==null?void 0:F.balance)&&K((v=N[s])==null?void 0:v.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(C=N[s])==null?void 0:C.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.item_delivery_data`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Ee,{disabled:_===x.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:a=>{z(a).format("YYYY-MM-DD")>=z(new Date).format("YYYY-MM-DD")?(l.onChange(a),y(s,{...t,item_delivery_data:a})):(l.onChange(l.value),y(s,{...t,item_delivery_data:l.value}),L("Receipt date cannot be less than today","error"))}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.claim_date`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Ee,{disabled:_===x.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:a=>{z(a).format("YYYY-MM-DD")>=z(new Date).format("YYYY-MM-DD")?(l.onChange(a),y(s,{...t,claim_date:a})):(l.onChange(l.value),y(s,{...t,claim_date:l.value}),L("Claim date cannot be less than today","error"))}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid grid-cols-7 gap-x-4 w-full",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(T,{control:r.control,name:`forms.${s}.currency`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:_===x.edit,onValueChange:a=>{y(s,{...t,currency:a})},defaultValue:t.currency,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:he.map(a=>e.jsxs(te,{value:a.code,children:[a.name," (",a.code,")"]},a.code))})]})}),e.jsx(mt,{className:"h-6"}),e.jsx(k,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(T,{control:r.control,name:`forms.${s}.balance`,render:({field:l})=>{var a;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Re,{type:"text",placeholder:"0",onChange:o=>{var ue;const u=o.target.value.replace(/[^0-9]/g,""),f=K(u,!1),D=Number(u)||0,O=((ue=N[s])==null?void 0:ue.balance)||0;if(D>O){o.target.value=K(u.slice(0,-1),!1);return}y(s,{...t,balance:u}),o.target.value=f,r.getValues("forms").forEach((qe,de)=>{if(de>s&&qe.reimburse_type===t.reimburse_type){const at=O-D;P(rt=>{const xe=[...rt];return xe[de]={...xe[de],balance:at},xe}),y(de,{...qe,balance:""})}})},defaultValue:K(t.balance,!1),value:K(t.balance,!1),disabled:typeof N[s]>"u"||((a=N[s])==null?void 0:a.length)===0||_===x.edit})}),e.jsx(k,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(T,{control:r.control,name:`forms.${s}.attachment`,render:({field:l})=>e.jsxs(A,{children:[e.jsx(ut,{className:"mb-1 text-xs font-extralight text-gray-500",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(E,{children:e.jsx("input",{className:"flex px-3 py-1 w-full h-9 text-xs bg-transparent rounded-md border shadow-sm transition-colors border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:a=>{const o=a.target.files;if(o){const u=[...t.attachment],f=Array.from(o);u.push(...f),y(s,{...t,attachment:u})}}})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((l,a)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:l.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const o=t.attachment.filter((u,f)=>f!==a);y(s,{...t,attachment:o})},children:"Delete"})]},a))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((l,a)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:l.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const o=t.savedAttachment.filter((u,f)=>f!==a);y(s,{...t,savedAttachment:o})},children:"Delete"})]},a))})})]})]})]})]})})})]},s)})]}),e.jsx(Nt,{onClick:async()=>await Ce(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:De&&e.jsx(wt,{workflowApproval:{approvalRequest:Z.approvalRequest,approvalFrom:Z.approvalFrom,acknowledgeFrom:Z.acknowledgeFrom},workflowApprovalStep:Z.approvalFromStatusRoute,workflowApprovalDiagram:Z.approvalFrom})}),e.jsx(Ae,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ot,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{xs as ReimburseForm};
