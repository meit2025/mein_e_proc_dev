import{r as g,u as Ne,j as e,b as De}from"./app-lowdYTlW.js";/* empty css              */import{d as Se,F as _,a as w,b as v,c as y}from"./form-4n9gep9P.js";import{u as Te,b as X,a as Ce,c as z}from"./index.esm-D7_NQzWh.js";import{S as $e,a as Fe,b as Ee,c as Re,d as qe}from"./select-DCts1vg2.js";import{S as ie}from"./separator-Dh7dKDC0.js";import{T as ke}from"./textarea-C0nLmI7h.js";import{I as A}from"./input-cpC_b7UD.js";import{T as Ye,a as Ve,b as Ie,c as Pe}from"./tabs-eci_syqa.js";import{z as i,t as Me}from"./index-B9deDs5S.js";import{S as Be}from"./scroll-area-BiOW_Svx.js";import{C as Oe,E as Le,G as Ge,b as Xe}from"./api-DtjMnnyq.js";import{BusinessTripType as W}from"./models-DrbGR5Cf.js";import{a as oe}from"./axiosInstance-DvqVunYo.js";import{h as R}from"./moment-C5S46NFB.js";import{F as Je}from"./formSwitchCustom-BnM_8WgP.js";import{B as H}from"./button-DyxvNSvM.js";import{d as ce}from"./index-Dd0baHji.js";import{W as Ue}from"./WorkflowComponent-Pw37lcvw.js";import{F as We}from"./formDropdown-CJV74tQW.js";import{u as de}from"./getDropdown-CZvObdtt.js";import{f as O}from"./rupiahCurrencyFormat-CP-6egij.js";import{B as ze}from"./Button-DoeK0FE7.js";import{C as He}from"./chevrons-up-down-DRVqCgdC.js";import"./app-DQK4SJPx.js";import"./index-DrKI-vNW.js";import"./utils-_zAxyYmh.js";import"./index-7bsnvJPK.js";import"./index-FsLhjpnp.js";import"./index-Bb4qSo10.js";import"./index-DFhA67-R.js";import"./index-fwwPj17Z.js";import"./index-BVduEbmV.js";import"./index-__VHxqnw.js";import"./Combination-CeBmB4bA.js";import"./index-Cl71D2Zz.js";import"./index-DKjJJS_Q.js";import"./index-BdMhvhVX.js";import"./CustomStatus-Mvt2zWEX.js";import"./createLucideIcon-D_i0w-64.js";import"./Switch-E5KchUHZ.js";import"./createSimplePaletteValueFilter-26CGbSiI.js";import"./DefaultPropsProvider-BnXDhKJU.js";import"./SwitchBase-TIcblSGw.js";import"./FormHelperText-DRVdSVwH.js";import"./useControlled-D-9dWuvU.js";import"./createSvgIcon-iEWJCLaX.js";import"./TextField-JAsLzfcy.js";import"./useSlot-BqrojJZP.js";const Ze=1*1024*1024,Ke=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],ss=({type:l,id:s})=>{var re;const d=i.object({request_no:i.string().nonempty("Request for required"),remark:i.string().nonempty("Remark is required"),attachment:i.array(i.instanceof(File).refine(n=>Ke.includes(n.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(n=>n.size<=Ze,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:i.number().int("Total Destinantion Required"),cash_advance:i.boolean().nullable().optional(),reference_number:i.string().nullable().optional(),total_cash_advance:i.string().nullable().optional(),destinations:i.array(i.object({destination:i.string().nonempty("Destinantion Required"),business_trip_start_date:i.date().optional(),business_trip_end_date:i.date().optional(),detail_attedances:i.array(i.object({date:i.string().optional(),shift_code:i.string().optional(),shift_start:i.string().optional(),shift_end:i.string().optional(),start_time:i.string().optional(),end_time:i.string().optional(),request_start_time:i.string().optional(),request_end_time:i.string().optional()})),allowances:i.array(i.object({name:i.string().optional(),code:i.string().optional(),default_price:i.string().optional(),type:i.string().optional(),currency:i.string().optional(),subtotal:i.number().optional(),detail:i.array(i.object({date:i.string().nullish(),request_price:i.number().optional()}))})),other:i.array(i.object({value:i.number().optional()}))}))}),a=Te({resolver:Me(d),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),N=(n,c)=>{var t;return n.type==="total"?parseFloat(((t=c==null?void 0:c[0])==null?void 0:t.request_price)||0):c==null?void 0:c.reduce((r,b)=>r+parseFloat(b.request_price||0),0)},x=()=>{const n=a.getValues("destinations");a.getValues("destinations.0.other");const c=n.reduce((r,b,C)=>{const V=(b.allowances||[]).reduce((I,G,P)=>{const q=a.getValues(`destinations.${C}.allowances.${P}.detail`),U=N(G,q);return I+U},0);return r+V},0);let t=0;try{t=n.reduce((r,b,C)=>{const V=(b.other||[]).reduce((I,G,P)=>{const q=a.getValues(`destinations.${C}.other.${P}.value`);return I+(q===void 0?0:q)},0);return r+V},0)}catch(r){console.log(r),t=0}return c+t},[p,o]=g.useState(!1),{showToast:D}=Ne(),$=async n=>{var c;try{if(l===W.create){const t=x(),r=new FormData;r.append("user_id",((c=u.request_for)==null?void 0:c.id.toString())??""),r.append("value",t.toString()),r.append("request_no",n.request_no??""),r.append("remark",n.remark??""),n.attachment.forEach((b,C)=>{b&&r.append(`attachment[${C}]`,b)}),r.append("total_destination",`${n.total_destination}`),n.destinations.forEach((b,C)=>{r.append(`destinations[${C}]`,JSON.stringify(b))}),await ce.Inertia.post(Oe,r,{headers:{"Content-Type":"multipart/form-data"}}),D("succesfully created data","success")}else{const t=new FormData;t.append("remark",n.remark??""),n.attachment.forEach((r,b)=>{r&&t.append(`attachment[${b}]`,r)}),te.forEach((r,b)=>{r&&t.append(`file_existing[${b}]`,JSON.stringify(r))}),await ce.Inertia.post(`${Le}/${s}`,t,{headers:{"Content-Type":"multipart/form-data"}}),D("succesfully updated data","success")}}catch(t){console.log(t)}},[u,j]=g.useState([]),[h,m]=g.useState([]),[f,k]=g.useState([]),[T,F]=g.useState(!1);async function Y(n){a.setValue("request_no",n||"");const c=Ge(n);try{const t=await oe.get(c),r=t.data.data;console.log(r,"businessTripData"),F(r.cash_advance==1),a.setValue("remark",r.remarks||""),a.setValue("total_destination",r.total_destination||1),a.setValue("cash_advance",r.cash_advance==1),a.setValue("reference_number",r.reference_number),a.setValue("total_percent",r.total_percent),a.setValue("total_cash_advance",O(r.total_cash_advance,!1)),j(t.data.data),k(r.destinations),K(r.total_destination),Q(r.destinations)}catch(t){console.log(t)}}const[Z,K]=g.useState(""),se=n=>{K(n)};function Q(n){const c=n.map(t=>({destination:t.destination||"",pajak:t.pajak||"",purchasing_group:t.purchasing_group||"",business_trip_start_date:new Date(t.business_trip_start_date),business_trip_end_date:new Date(t.business_trip_end_date),allowances:t.allowances||[],detail_attedances:t.detail_attedances||[],total_allowance:t.total_allowance||0,other:t.other||[]}));a.setValue("destinations",c)}const{fields:ee,append:S,remove:ae,update:pe}=X({control:a.control,name:"destinations"});g.useEffect(()=>{},[u,Z]);const[nt,me]=g.useState(0),[he,xe]=g.useState(!1),[L,ue]=g.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),je=async()=>{var n,c,t,r,b,C,J,V,I,G,P,q,U;try{const M=x();if(M===0){D("Please fill the balance","error");return}const B=await oe.get("/check-approval",{params:{value:M,user_id:((n=u.request_for)==null?void 0:n.id)??"",type:"TRIP_DECLARATION"}});if(B.data.status_code===200){const be=(t=(c=B.data)==null?void 0:c.data)==null?void 0:t.approval.map(E=>(E==null?void 0:E.division_name)||null),ye=(b=(r=B.data)==null?void 0:r.data)==null?void 0:b.approval.map(E=>(E==null?void 0:E.name)||null),le=[];(J=(C=B.data)==null?void 0:C.data)!=null&&J.hr&&le.push((G=(I=(V=B.data)==null?void 0:V.data)==null?void 0:I.hr)==null?void 0:G.name);const Ae=(((P=B.data.data)==null?void 0:P.approval)??[]).map(E=>({status:"",name:E.name,dateApproved:""}));ue({approvalRequest:be,approvalFrom:ye,acknowledgeFrom:le,approvalFromStatusRoute:Ae}),xe(!0)}}catch(M){D((U=(q=M==null?void 0:M.response)==null?void 0:q.data)==null?void 0:U.message,"error")}},{dataDropdown:fe,getDropdown:ge}=de(),{dataDropdown:rt,getDropdown:_e}=de();g.useEffect(()=>{ge("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[a.watch("destinations")]);const[te,ne]=g.useState([]);async function we(){a.setValue("destinations",[]);const n=Xe(s),t=(await De.get(n)).data.data;await Y(t.parent_id.toString()),ne(t.attachments)}g.useEffect(()=>{s&&l==W.clone&&(we(),_e("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[l]);const ve=n=>{ne(c=>c.filter(t=>t.id!==n))};return e.jsx(Be,{className:"h-[600px] w-full ",children:e.jsx(Se,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit($),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:fe,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:n=>{Y(n)}})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:u.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:u.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(re=u==null?void 0:u.cost_center)==null?void 0:re.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:"remark",render:({field:n})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(ke,{placeholder:"Insert remark",...n,rows:4,className:"w-[300px]"})}),e.jsx(y,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:"attachment",render:({field:n})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:c=>{const t=c.target.files;if(t){const r=Array.from(t);n.onChange(r)}else n.onChange([])}})}),a.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(a.formState.errors.attachment)?a.formState.errors.attachment.map((c,t)=>e.jsx("span",{children:c.message},t)):a.formState.errors.attachment.message})]})})})]}),te.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:te.map((n,c)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:n.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:n.file_name},c),e.jsx("button",{type:"button",onClick:()=>ve(n.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:a.control,name:"total_destination",render:({field:n})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs($e,{value:Z,onValueChange:se,disabled:!0,children:[e.jsx(Fe,{className:"w-[200px] py-2",children:e.jsx(Ee,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Re,{children:Array.from({length:5},(c,t)=>e.jsxs(qe,{value:(t+1).toString(),children:[" ",t+1," "]},t))})]})}),e.jsx(y,{})]})})]})]})]}),e.jsx(ie,{className:"my-4"}),e.jsx(Qe,{updateDestination:pe,destinationField:ee,form:a,listAllowances:h,totalDestination:a.getValues("total_destination").toString(),setTotalAllowance:me,businessTripDetail:u,type:l,btEdit:W.edit,setIsCashAdvance:F,isCashAdvance:T,setOtherAllowance:o,otherAllowance:p}),e.jsx(ie,{className:"my-4"}),e.jsx(ze,{onClick:async()=>await je(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:he&&e.jsx(Ue,{workflowApproval:{approvalRequest:L.approvalRequest,approvalFrom:L.approvalFrom,acknowledgeFrom:L.acknowledgeFrom},workflowApprovalStep:L.approvalFromStatusRoute,workflowApprovalDiagram:L.approvalFrom})}),e.jsx(H,{type:"submit",children:"submit"})]})})})};function Qe({totalDestination:l,listAllowances:s,form:d,destinationField:a,updateDestination:N,setTotalAllowance:x,businessTripDetail:p,type:o,btEdit:D,setIsCashAdvance:$,isCashAdvance:u,setOtherAllowance:j,otherAllowance:h}){return e.jsxs(Ye,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ve,{className:"flex items-center justify-start space-x-4",children:a.map((m,f)=>e.jsxs(Ie,{value:`destination${f+1}`,children:["Destination ",f+1]}))}),a.map((m,f)=>e.jsx(et,{listAllowances:s,updateDestination:N,destination:m,form:d,index:f,setTotalAllowance:x,businessTripDetail:p,type:o,btEdit:W.edit,setIsCashAdvance:$,isCashAdvance:u,setOtherAllowance:j,otherAllowance:h}))]})}function et({form:l,index:s,destination:d,updateDestination:a,listAllowances:N,setTotalAllowance:x,businessTripDetail:p,type:o,btEdit:D,setIsCashAdvance:$,isCashAdvance:u,setOtherAllowance:j,otherAllowance:h}){const{fields:m,update:f,append:k,remove:T}=X({control:l.control,name:`destinations[${s}].detail_attedances`}),{fields:F,update:Y,append:Z,remove:K,replace:se}=X({control:l.control,name:`destinations[${s}].allowances`}),Q=S=>{$(S)};Ce(),z({control:l.control,name:"total_percent"});const ee=p.total_cash_advance;return g.useEffect(()=>{},[ee]),e.jsxs(Pe,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:d.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:d==null?void 0:d.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:d==null?void 0:d.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:R(d.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:R(d.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(tt,{detailAttedanceFields:m,form:l,updateAttedanceFields:f,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(st,{allowanceField:F,destinationIndex:s,form:l,setOtherAllowance:j,otherAllowance:h})]},s),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Je,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:S=>Q(S.target.checked)})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(_,{control:l.control,name:"reference_number",render:({field:S})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{value:S.value||"",onChange:ae=>S.onChange(ae.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(y,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(_,{control:l.control,name:"total_percent",render:({field:S})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{...S,value:S.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(y,{})]})}),e.jsx(_,{control:l.control,name:"total_cash_advance",render:({field:S})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{value:S.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(y,{})]})})]})]})]})]})]})}function as({allowanceField:l,destinationIndex:s,form:d,setTotalAllowance:a}){const N=d.watch(`destinations[${s}].allowances`),x=d.watch(`destinations[${s}].total_allowance`);return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:N.map((p,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:p.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:O(p.subtotal)})]})]},p.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:O(x)})]})]})})]})})}function tt({form:l,destinationIndex:s,detailAttedanceFields:d,updateAttedanceFields:a}){const N=l.watch(`destinations[${s}].detail_attedances`);return g.useEffect(()=>{},[N]),g.useEffect(()=>{},[d]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:N.map((x,p)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[R(x.date).format("DD/MM/YYYY"),e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.date`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.shift_code`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.shift_start`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.shift_end`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.start_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(y,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.end_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(y,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.request_start_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(y,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${s}.detail_attedances.${p}.request_end_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(y,{})]})})})]},x.index))})]})})})]})}function st({form:l,destinationIndex:s,allowanceField:d,setOtherAllowance:a,otherAllowance:N}){const x=l.watch(`destinations[${s}].allowances`);g.useEffect(()=>{},[x]);const{fields:p,append:o,remove:D}=X({control:l.control,name:`destinations.${s}.other`}),$=z({control:l.control,name:`destinations.${s}.other`}),u=()=>($||[]).reduce((h,m)=>{const f=Number((m==null?void 0:m.value)||0);return h+f},0),j=()=>{o({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[x.map((h,m)=>e.jsx(at,{form:l,allowance:h,destinationIndex:s,allowanceIndex:m})),p.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(H,{type:"button",className:"text-xl",onClick:j,children:"+"})})}),p.map((h,m)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:l.control,name:`destinations.${s}.other[${m}].value`,render:({field:f})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{type:"number",min:"0",value:f.value??"",onChange:k=>{const T=k.target.value;if(T===""){f.onChange(void 0);return}const F=Math.max(0,Number(T));f.onChange(F)}})}),e.jsx(y,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",O(u(),!1)]})})}),e.jsx("td",{children:e.jsx(H,{type:"button",className:"text-xs",onClick:()=>D(m),children:"X"})})]},m))]})}function at({form:l,allowance:s,destinationIndex:d,allowanceIndex:a}){const[N,x]=g.useState(!1);g.useState(0);const p=j=>{x(h=>!h)},o=z({control:l.control,name:`destinations[${d}].allowances[${a}].detail[0].request_price`}),D=z({control:l.control,name:`destinations[${d}].allowances[${a}].detail`}),$=()=>{if(s.type==="total")return parseFloat(o||0)*1;{let j=0;return D==null||D.forEach(h=>{const m=parseFloat(h.request_price||0);j+=m}),j}},u=(j,h)=>{const m=parseFloat(h),f=isNaN(m)?0:m,k=s.request_value;let T=!0;switch(k){case"unlimited":T=!0;break;case"fixed value":const F=s.subtotal;f!==F&&(alert(`Please enter the fixed value of IDR ${F}`),T=!1);break;case"up to max value":const Y=s.subtotal;f>Y&&(alert(`The value should not exceed IDR ${Y}`),T=!1);break;default:T=!1}T&&l.setValue(`destinations[${d}].allowances[${a}].detail[${j}].request_price`,f)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:l.control,name:`destinations[${d}].allowances[${a}].detail[0].request_price`,render:({field:j})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{value:j.value,onChange:h=>u(0,h.target.value)})}),e.jsx(y,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",O(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",O($(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>p(),children:e.jsxs(H,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),N&&e.jsx(e.Fragment,{children:s.detail.map((j,h)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:R(j.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(_,{control:l.control,name:`destinations[${d}].allowances[${a}].detail[${h}].request_price`,render:({field:m})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{value:m.value,onChange:f=>u(h,f.target.value)})}),e.jsx(y,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},j.id))})]})}function ns({form:l,type:s,allowanceIndex:d,destinationIndex:a}){const{fields:N}=X({control:l.control,name:`destinations.${a}.allowances.${d}.detail`});return e.jsx(e.Fragment,{children:N.map((x,p)=>e.jsx(_,{control:l.control,name:`destinations.${a}.allowances.${p}.detail.${p}.request_price`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(A,{value:o.value,onChange:o.onChange})}),e.jsx(y,{})]})}))})}export{ns as AllowanceInputForm,at as AllowanceRowInput,Qe as BussinesTripDestination,et as BussinessDestinationForm,ss as BussinessTripFormV1,st as DetailAllowance,tt as DetailAttedances,as as ResultTotalItem};
