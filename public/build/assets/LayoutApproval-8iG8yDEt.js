import{q as h,r as n,j as a}from"./app-CyajJ2jC.js";import{a as M}from"./axiosInstance-BGm7j-k0.js";import{L as E}from"./Loading-DA4NIgSD.js";import{F as k}from"./FormMapping-hXXFy9CO.js";import{F as q}from"./formTextArea-BNkdLSHs.js";import{u as _}from"./index.esm-DcfM53bQ.js";import{D as B}from"./detailApproval-CNYexB5u.js";import{h as D}from"./moment-C5S46NFB.js";import{B as j}from"./Button-O5cMpr-_.js";import{M as I}from"./TextField-Btjz-vo8.js";import{B as Y}from"./Box-B89rFl0H.js";const N={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",pt:2,px:4,pb:3},W=({id:i,children:g,type:l,status_id:d})=>{var v;h();const{auth:o}=h().props,e=_({mode:"onChange",reValidateMode:"onChange"}),[V,m]=n.useState(!1),[b,y]=n.useState(!1),[C,u]=n.useState(!1),c=n.useCallback(async()=>{var p;m(!0);try{const r=(await M.get("/api/approval/route/getApproval?id="+i+"&type="+l)).data;e.reset(r.data.data);const R=(r.data??[]).map(t=>{var x;return((x=t.user.divisions)==null?void 0:x.name)||null}),w=(r.data??[]).map(t=>t.user.name),s=(r.data??[]).find(t=>t.is_status===!1);d!==4&&(s==null?void 0:s.user_id)===((p=o==null?void 0:o.user)==null?void 0:p.id)&&y(!0);const F=(r.data??[]).map(t=>({status:t.status,name:t.user.name,dateApproved:D(t.updated_at).format("YYYY-MM-DD")}));e.setValue("approvalFromStatusRoute",F),e.setValue("approvalRequest",R),e.setValue("approvalFrom",w),e.setValue("approvalId",s==null?void 0:s.id),e.setValue("function_name",l.toLowerCase()),e.setValue("type",l.toLowerCase()),e.setValue("id",i)}catch{m(!1)}finally{m(!1)}},[i,l,e,d,(v=o==null?void 0:o.user)==null?void 0:v.id]);n.useEffect(()=>{c()},[c,d]);const L=()=>{u(!1),e.setValue("note",""),e.setValue("id_approval",""),e.setValue("status",""),e.setValue("type","")},f=p=>{u(!0),e.setValue("status",p)};return a.jsxs(a.Fragment,{children:[a.jsx(E,{isLoading:V}),a.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[b&&a.jsx("div",{className:"card-header",children:a.jsxs("div",{children:[a.jsx(j,{variant:"contained",onClick:()=>f("Approved"),color:"primary",type:"button",children:"APPROVE"}),a.jsx(j,{onClick:()=>f("Rejected"),style:{marginLeft:"1rem"},variant:"contained",color:"error",type:"button",children:"REJECT"})]})}),g,a.jsx(B,{methods:e}),a.jsx(I,{open:C,onClose:L,"aria-labelledby":"parent-modal-title","aria-describedby":"parent-modal-description",children:a.jsx(Y,{sx:{...N,width:900},children:a.jsx(k,{isCustom:!0,formCustom:a.jsx(a.Fragment,{children:a.jsx(q,{fieldLabel:"note",fieldName:"note",isRequired:!0,requiredMessage:"",rows:20,style:{width:"100%"}})}),methods:e,url:"api/approval/approval_or_rejceted"})})})]})]})};export{W as L};
