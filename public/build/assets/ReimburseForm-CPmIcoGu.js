import{j as e,r as j,u as le,q as ie}from"./app-ySnIjE8D.js";import{B as ce}from"./button-E5c0S4Af.js";import{z as o,t as de}from"./index-6Hir6SiA.js";import{F as he,a as i,b as d,c as h,d as m,f as me}from"./form-D4Exn2UR.js";import{u as xe,b as je}from"./index.esm-C8wTv4Ti.js";import{T as E}from"./textarea-2SrhIFSn.js";/* empty css                  */import{S as ue}from"./scroll-area-DgifY02Z.js";import{a as b}from"./axiosInstance-BC0OhrCm.js";import{S as $}from"./separator-De88C_0g.js";import{T as pe,a as ge,b as fe,c as _e}from"./tabs-uvJ4nMO-.js";import{S as g,a as f,b as _,c as y,d as p}from"./select-Bap3EkS0.js";import{C as D}from"./CustomDatePicker-Bk1ujuPs.js";import{I}from"./input-BZYb72DI.js";import{F as ye}from"./utils-DCxhhQGX.js";import{u as be}from"./getDropdown-BeHToccv.js";import{A as k}from"./AsyncDropdownComponent-IUeoonoZ.js";import{G as A,a as Se}from"./api-cOVJSxmC.js";import{L as we}from"./LoadingSpin-n0b666jo.js";import"./app-HlhieNAw.js";import"./index-BZM3ott2.js";import"./index-BcxigRMg.js";import"./index-Ckn8CRxD.js";import"./index-DSU5tDx2.js";import"./index-QbDqtRj5.js";import"./index-BQXhlZbJ.js";import"./index-BRAsP6NI.js";import"./Combination-BanHX9_q.js";import"./index-D2XJ0LqA.js";import"./popover-B75BTy0S.js";import"./createLucideIcon-Cz-QHqyT.js";import"./extends-CF3RwP-h.js";import"./chevrons-up-down-CJXoJ3Gu.js";function Ce({isLoading:C=!1,children:v}){return e.jsx("div",{className:"",children:C?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(we,{})})}):v})}const cs=({onSuccess:C,purchasing_groups:v,currencies:P,categories:B,periods:ve,users:G,taxes:M,cost_center:V,edit_url:L,update_url:De,store_url:z,latestPeriod:Ne,type:N,currentUser:c})=>{const[O,H]=j.useState("form1"),{showToast:S}=le();ie().props,j.useState(1),j.useState([]),j.useState([[]]);const[Fe,W]=j.useState(),[Te,Y]=j.useState([]);j.useState([[]]);const{dataDropdown:J,getDropdown:K}=be(),[Q,F]=j.useState([]);j.useState("");const[X,w]=j.useState(!1),[x,T]=j.useState(null),Z=o.object({formCount:o.string().min(1,"total form must be have value"),remark_group:o.string().optional(),cost_center:o.string().min(1,"cost center required"),requester:o.string().min(1,"requester required"),forms:o.array(o.object({id:o.string().optional(),for:o.string().optional(),group:o.string().optional(),reimburse_type:o.string().min(1,"reimburse type is required"),short_text:o.string().min(1,"remarks is required"),balance:o.string().min(1,"balance required"),currency:o.string().min(1,"currency required"),tax_on_sales:o.string().min(1,"tax required"),uom:o.string().min(1,"uom required"),purchasing_group:o.string().min(1,"Purchasing Group required"),period:o.string().min(1,"period required"),type:o.any(),item_delivery_data:o.date(),start_date:o.date(),end_date:o.date(),url:o.string().optional()}))}),a=xe({resolver:de(Z),defaultValues:{formCount:"1",remark_group:"test",cost_center:"",requester:String(c==null?void 0:c.is_admin)==="1"?"":c==null?void 0:c.nip,forms:[{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"IDR",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date,url:""}]}}),{fields:q,update:u}=je({control:a.control,name:"forms"});async function U(){a.setValue("forms",[]),w(!0);try{const t=await b.get(L??""),s=t.data.data.group,n=t.data.data.forms,r=n.map(l=>({id:String(l.id),for:l.form,group:String(l.group),reimburse_type:l.reimburse_type,short_text:l.short_text,balance:l.balance,currency:l.currency,tax_on_sales:String(l.tax_on_sales),uom:String(l.uom),purchasing_group:String(l.purchasing_group),period:l.period,type:l.type,item_delivery_data:new Date(l.item_delivery_data),start_date:new Date(l.start_date),end_date:new Date(l.end_date),url:A(l.type)}));a.setValue("formCount",n.length),a.setValue("remark_group",s.remark_group),a.setValue("cost_center",String(s.cost_center)),a.setValue("requester",s.requester),a.setValue("forms",r),w(!1)}catch(t){console.log(t),w(!1)}}j.useEffect(()=>{N===ye.edit&&(w(!0),U())},[N]),j.useEffect(()=>{K("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms"})},[]);function ee(t){const s=[...a.getValues("forms")];for(let n=0;n<parseInt(t);n++)if(n+1>s.length){const r={id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date,url:""};s.push(r)}a.setValue("forms",s)}const se=async t=>{try{const n=(await b.get(`/family/show/${t}`)).data;Y(n),W(t),a.setValue("requester",t)}catch(s){const r=s.response.data;S(r.message,"error")}},re=t=>{H(t)};async function te(t,s){u(t,{...q[t],type:s,url:A(s),reimburse_type:"",period:""}),T(null),F([])}async function ne(t,s){try{const n=await b.get(Se,{params:{type:s,user:a.getValues("requester")}});F(n.data.data),R(t),console.log(n)}catch{}}const ae=async t=>{if(x){if(parseInt(x==null?void 0:x.limit)<t.forms.length){S("Limit has been reached","error");return}const s=t.forms.reduce((n,r)=>n+parseInt(r.balance),0);if(parseInt((x==null?void 0:x.balance)??0)<s){S("Please check your balance input in forms is not must be above "+(x==null?void 0:x.balance),"error");return}}try{const s=await b.post(z??"",t);console.log(t),S("succesfully created data","success"),C()}catch(s){console.log(s)}};async function R(t){const s=a.getValues(`forms.${t}`);console.log(s);const n={user:c==null?void 0:c.nip,periode:s.period,reimbuse_type_id:s.reimburse_type};try{const r=await b.get("reimburse/data-limit-and-balance",{params:n});T(r.data.data)}catch(r){console.log(r)}}return e.jsx(ue,{className:"h-[600px] w-full",children:e.jsx(Ce,{isLoading:X,children:e.jsx(he,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(ae),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Request No."}),e.jsx("td",{children:(a==null?void 0:a.code)??"-"})]}),e.jsx("tr",{children:e.jsx("td",{width:200,children:"Request Status"})}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:"remark_group",render:({field:t})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(E,{placeholder:"Insert remark",...t})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:"cost_center",render:({field:t})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:s=>t.onChange(s),value:t.value,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"-"})}),e.jsx(y,{children:V.map(s=>e.jsx(p,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:"requester",render:({field:t})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:s=>se(s),value:t.value,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"Requester"})}),e.jsx(y,{children:(c==null?void 0:c.is_admin)===1?e.jsx(e.Fragment,{children:G.map(s=>e.jsxs(p,{value:s.nip,children:[s.name," [",s.nip,"]"]},s.nip))}):e.jsx(e.Fragment,{children:e.jsxs(p,{value:c.nip,children:[c.name," [",c.nip,"]"]},c.nip)})})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:n=>{t.onChange(n),ee(n)},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"Select number of forms"})}),e.jsx(y,{children:Array.from({length:20},(n,r)=>r+1).map(n=>e.jsx(p,{value:n.toString(),children:n},n))})]})}),e.jsx(m,{})]})}})})]})]})}),e.jsx($,{className:"my-4"}),e.jsxs(pe,{value:O,onValueChange:re,className:"w-full",children:[e.jsxs(ge,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((t,s)=>e.jsxs(fe,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),q.map((t,s)=>e.jsxs(_e,{value:`form${s+1}`,children:[e.jsx(i,{control:a.control,name:`forms.${s}.id`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(I,{className:"sr-only",value:n.value,onChange:n.onChange})}),e.jsx(m,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement "}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(i,{control:a.control,name:`forms.${s}.type`,render:({field:n})=>e.jsxs(g,{onValueChange:r=>te(s,r),defaultValue:t.type,children:[e.jsx(f,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsx(y,{children:B.map(r=>e.jsx(p,{value:r,children:r},r))})]})}),e.jsx(i,{control:a.control,name:`forms.${s}.reimburse_type`,render:({field:n})=>e.jsx(k,{disabled:t.type==="",onSelectChange:r=>{u(s,{...t,reimburse_type:r}),ne(s,r)},value:t.reimburse_type,placeholder:"Select Reimbuse Type",filter:["name"],id:"code",label:"name",defaultLabel:t.reimburse_type,url:t.url})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.purchasing_group`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:r=>{u(s,{...t,purchasing_group:String(r)})},defaultValue:t.purchasing_group,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"-"})}),e.jsx(y,{children:v.map(r=>e.jsxs(p,{value:r.id.toString(),children:[r.purchasing_group_desc," -"," ",r.purchasing_group]},r.id))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.period`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{disabled:t.reimburse_type==="",onValueChange:r=>{u(s,{...t,period:r}),R(s)},defaultValue:t.period,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"-"})}),e.jsx(y,{children:Q.map(r=>e.jsxs(p,{value:r.code,children:[r.start," - ",r.end," (",r.code,")"]},r.code))})]})}),e.jsx(m,{})]})})})]}),t.type==="Family"?e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Family ",t.for]}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.for`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(k,{disabled:t.type==="",onSelectChange:r=>{u(s,{...t,for:String(r)})},value:t.for,placeholder:"Select Family",filter:["name"],id:"id",label:"name",url:"reimburse/get-data-family/"+c.id})}),e.jsx(m,{})]})})})]}):null,e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Tax"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.tax_on_sales`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:r=>{u(s,{...t,tax_on_sales:r})},defaultValue:t.tax_on_sales,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"-"})}),e.jsx(y,{children:M.map(r=>e.jsx(p,{value:r.id.toString(),children:r.mwszkz},r.id))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Uom"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.uom`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:r=>{u(s,{...t,uom:String(r)})},defaultValue:t.uom,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"-"})}),e.jsx(y,{children:(J??[]).map((r,l)=>e.jsx(p,{value:r.value.toString(),children:r.label},r.value))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.short_text`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(E,{placeholder:"Insert remark",onChange:r=>{u(s,{...t,short_text:r.target.value})},defaultValue:t.short_text})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Sisa Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:x==null?void 0:x.balance})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Sisa Limit"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:x==null?void 0:x.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.item_delivery_data`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(D,{initialDate:n.value instanceof Date?n.value:new Date(n.value),onDateChange:r=>n.onChange(r)})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(i,{control:a.control,name:`forms.${s}.start_date`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(D,{initialDate:n.value instanceof Date?n.value:new Date(n.value),onDateChange:r=>n.onChange(r)})}),e.jsx(m,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(i,{control:a.control,name:`forms.${s}.end_date`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(D,{initialDate:n.value instanceof Date?n.value:new Date(n.value),onDateChange:r=>n.onChange(r)})}),e.jsx(m,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(i,{control:a.control,name:`forms.${s}.currency`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs(g,{onValueChange:r=>{u(s,{...t,currency:r})},defaultValue:t.currency,children:[e.jsx(f,{className:"w-[200px]",children:e.jsx(_,{placeholder:"-"})}),e.jsx(y,{children:P.map(r=>e.jsxs(p,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(me,{className:"h-6"}),e.jsx(m,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(i,{control:a.control,name:`forms.${s}.balance`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(I,{type:"number",placeholder:"0.0",onChange:r=>{u(s,{...t,balance:r.target.value})},defaultValue:t.balance})}),e.jsx(m,{})]})})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(i,{control:a.control,name:`forms.${s}.attachment`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(h,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:r=>{const l=r.target.files;if(l){const oe=Array.from(l);n.onChange(oe)}}})}),e.jsx(m,{})]})})})]})]})})})]},s))]}),e.jsx($,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(ce,{type:"submit",className:"w-32",children:"Save"})})]})})})})};export{cs as ReimburseForm};
