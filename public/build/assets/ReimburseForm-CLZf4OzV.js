import{r as m,u as te,q as ne,j as e}from"./app-Q02zLcXX.js";import{B as ae}from"./button-DLEvtIcY.js";import{z as o,t as oe}from"./index-BtE6aq0g.js";import{F as ce,a as c,b as i,c as d,d as h,f as F}from"./form-B6RX0Kdp.js";import{u as le,b as ie}from"./index.esm-Dh9NkTuT.js";import{T as $}from"./textarea-PvWO3XW2.js";/* empty css                  */import{S as de}from"./scroll-area-BNgK7mo4.js";import{a as b}from"./axiosInstance-C_QnZdax.js";import{S as T}from"./separator-CSri2TnF.js";import{T as he,a as me,b as xe,c as je}from"./tabs-4FH6QJo9.js";import{S as j,a as p,b as u,c as g,d as f}from"./select-DKFtb4_l.js";import{C as D}from"./CustomDatePicker-D99UeCsm.js";import{I as R}from"./input-BoJOXb21.js";import{F as pe}from"./utils-VpeaZUGr.js";import{u as ue}from"./getDropdown-D6Mks0iq.js";import{A as ge}from"./AsyncDropdownComponent-szE50I4-.js";import"./app-HlhieNAw.js";import"./index-DrfHZtB2.js";import"./index-D7iVQqXi.js";import"./index-DAzBI7Fs.js";import"./index-B0vn49q-.js";import"./index-BPKZ8EcE.js";import"./index-CKLvZY52.js";import"./index-C8VvNNQC.js";import"./Combination-CkT5sw3X.js";import"./index-t3Oz1Ald.js";import"./popover-BAM928Dd.js";import"./createLucideIcon-CH5jhPQz.js";import"./LoadingSpin-BO3_pbB1.js";import"./chevrons-up-down-BVDJpNM0.js";const es=({onSuccess:fe,purchasing_groups:k,currencies:E,categories:A,periods:_e,users:I,taxes:V,cost_center:B,edit_url:z,update_url:ye,store_url:G,latestPeriod:l,type:M,currentUser:w})=>{const[O,H]=m.useState("form1"),{showToast:C}=te();ne().props,m.useState(1),m.useState([]);const[v,J]=m.useState([[]]),[be,K]=m.useState(),[we,Q]=m.useState([]);m.useState([[]]);const{dataDropdown:W,getDropdown:X}=ue();m.useState("");const[_,Y]=m.useState(null),Z=o.object({formCount:o.string().min(1,"total form must be have value"),remark_group:o.string().optional(),cost_center:o.string().min(1,"cost center required"),requester:o.string().min(1,"requester required"),forms:o.array(o.object({id:o.string().optional(),for:o.string().optional(),group:o.string().optional(),reimburse_type:o.string().min(1,"reimburse type is required"),short_text:o.string().min(1,"remarks is required"),balance:o.string().min(1,"balance required"),currency:o.string().min(1,"currency required"),tax_on_sales:o.string().min(1,"currtax_on_salesency required"),uom:o.string().min(1,"uom required"),purchasing_group:o.string().min(1,"purchasing_group required"),period:o.string().min(1,"period required"),type:o.any(),item_delivery_data:o.date(),start_date:o.date(),end_date:o.date()}))}),a=le({resolver:oe(Z),defaultValues:{formCount:"1",remark_group:"test",cost_center:"test",requester:"",forms:[{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"IDR",tax_on_sales:"",uom:"",purchasing_group:"",period:l,type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date}]}}),{fields:N,update:x}=ie({control:a.control,name:"forms"});async function L(){try{const s=(await b.get(z)).data.data[0];a.setValue("remark_group",s.remark),a.setValue("cost_center",s.cost_center),a.setValue("requester",s.users.nip),a.setValue("formCount",s.reimburses.length.toString()),a.setValue("forms",s.reimburses.map(t=>({id:t.id,for:t.for,group:t.group,reimburse_type:t.reimburse_type,short_text:t.short_text,balance:Number(t.balance),currency:t.currency,tax_on_sales:t.tax_on_sales,purchasing_group:t.purchasing_group,period:t.period,type:t.type,item_delivery_data:new Date(t.item_delivery_data),start_date:new Date(t.start_date),end_date:new Date(t.end_date)}))),s.reimburses.forEach((t,r)=>{q(r,t.reimburse_type)})}catch(n){C(n,"error")}}m.useEffect(()=>{M===pe.edit&&L()}),m.useEffect(()=>{X("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms"})},[]);function U(n){const s=[];for(let t=0;t<parseInt(n);t++){const r={id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"",tax_on_sales:"",uom:"",purchasing_group:"",period:l.code,type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date};s.push(r)}console.log(s),a.setValue("forms",s)}const P=async n=>{try{const t=(await b.get(`/family/show/${n}`)).data;Q(t),K(n),a.setValue("requester",n)}catch(s){const r=s.response.data;C(r.message,"error")}},ee=n=>{H(n)};async function q(n,s){try{const r=(await b.get(`reimburse/type/${s}`??"")).data.data;J(y=>{const S=[...y];return S[n]=r,S}),x(n,{...N[n],type:s})}catch(t){const y=t.response.data;C(y.message,"error")}}const se=async n=>{try{const s=await b.post(G??"",n);console.log(n),C("succesfully created data","success")}catch(s){console.log(s)}};async function re(n){const s=a.getValues(`forms.${n}`);console.log(s);const t={user:w==null?void 0:w.nip,periode:s.period,reimbuse_type_id:s.reimburse_type};try{const r=await b.get("reimburse/data-limit-and-balance",{params:t});Y(r.data.data)}catch(r){console.log(r)}}return e.jsx(de,{className:"h-[600px] w-full",children:e.jsx(ce,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(se),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("td",{width:200,children:"Reimburse Request No."})}),e.jsx("tr",{children:e.jsx("td",{width:200,children:"Request Status"})}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"remark_group",render:({field:n})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx($,{placeholder:"Insert remark",...n})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"cost_center",render:({field:n})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:s=>n.onChange(s),value:n.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(g,{children:B.map(s=>e.jsx(f,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"requester",render:({field:n})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:s=>P(s),value:n.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"Requester"})}),e.jsx(g,{children:I.map(s=>e.jsxs(f,{value:s.nip,children:[s.name," [",s.nip,"]"]},s.nip))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"formCount",render:({field:n})=>{var s;return e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:t=>{n.onChange(t),U(t)},value:(s=n.value)==null?void 0:s.toString(),children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"Select number of forms"})}),e.jsx(g,{children:Array.from({length:20},(t,r)=>r+1).map(t=>e.jsx(f,{value:t.toString(),children:t},t))})]})}),e.jsx(h,{})]})}})})]})]})}),e.jsx(T,{className:"my-4"}),e.jsxs(he,{value:O,onValueChange:ee,className:"w-full",children:[e.jsxs(me,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((n,s)=>e.jsxs(xe,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),N.map((n,s)=>e.jsxs(je,{value:`form${s+1}`,children:[e.jsx(c,{control:a.control,name:`forms.${s}.id`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(R,{className:"sr-only",value:t.value,onChange:t.onChange})}),e.jsx(h,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Type of Reimbursement ",n.reimburse_type]}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:a.control,name:`forms.${s}.type`,render:({field:t})=>e.jsxs(j,{onValueChange:r=>q(s,r),defaultValue:a.type,children:[e.jsx(p,{children:e.jsx(u,{placeholder:"Select type"})}),e.jsx(g,{children:A.map(r=>e.jsx(f,{value:r,children:r},r))})]})}),e.jsx(c,{control:a.control,name:`forms.${s}.reimburse_type`,render:({field:t})=>e.jsxs(j,{disabled:!v[s]||v[s].length===0,onValueChange:r=>{x(s,{...n,reimburse_type:r})},defaultValue:n.reimburse_type,children:[e.jsx(p,{children:e.jsx(u,{placeholder:"Select detail"})}),e.jsx(g,{children:v[s]&&v[s].map(r=>e.jsx(f,{value:r.code,children:r.name},r.code))})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.purchasing_group`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:r=>{x(s,{...n,purchasing_group:r})},defaultValue:a.purchasing_group,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(g,{children:k.map(r=>e.jsxs(f,{value:r.id.toString(),children:[r.purchasing_group_desc," - ",r.purchasing_group]},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.period`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:r=>{x(s,{...n,period:r}),re(s)},defaultValue:t.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(g,{children:e.jsxs(f,{value:l==null?void 0:l.code,children:[l==null?void 0:l.start," - ",l==null?void 0:l.end," (",l==null?void 0:l.code,")"]},l==null?void 0:l.code)})]})}),e.jsx(h,{})]})})})]}),n.type==="Family"?e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Family ",n.for]}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.for`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(ge,{onSelectChange:r=>{x(s,{...n,for:String(r)})},value:n.for,placeholder:"Select Family",filter:["name"],id:"id",label:"name",url:"reimburse/get-data-family/"+w.id})}),e.jsx(h,{})]})})})]}):null,e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Tax"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.tax_on_sales`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:r=>{x(s,{...n,tax_on_sales:r})},defaultValue:n.tax_on_sales,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(g,{children:V.map(r=>e.jsx(f,{value:r.id.toString(),children:r.mwszkz},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Uom"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.uom`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:r=>{x(s,{...n,uom:r})},defaultValue:n.uom,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(g,{children:(W??[]).map((r,y)=>e.jsx(f,{value:r.value.toString(),children:r.label},r.value))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.short_text`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx($,{placeholder:"Insert remark",onChange:r=>{x(s,{...n,short_text:r.target.value})},defaultValue:n.short_text})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Sisa Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:_==null?void 0:_.balance})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Sisa Limit"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:_==null?void 0:_.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.item_delivery_data`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(D,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(c,{control:a.control,name:`forms.${s}.start_date`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(D,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(h,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(c,{control:a.control,name:`forms.${s}.end_date`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(D,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(c,{control:a.control,name:`forms.${s}.currency`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(j,{onValueChange:r=>{x(s,{...n,currency:r})},defaultValue:n.currency,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(g,{children:E.map(r=>e.jsxs(f,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(F,{className:"h-6"}),e.jsx(h,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(c,{control:a.control,name:`forms.${s}.balance`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(R,{type:"number",placeholder:"0.0",onChange:r=>{x(s,{...n,balance:r.target.value})},defaultValue:n.balance})}),e.jsx(F,{className:"h-6",children:parseInt((_==null?void 0:_.balance)??0)<parseInt(n.balance)?e.jsx("span",{className:"text-red-500",children:"Reimbuse cost must be not greather than balance"}):null}),e.jsx(h,{})]})})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${s}.attachment`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:r=>{const y=r.target.files;if(y){const S=Array.from(y);t.onChange(S)}}})}),e.jsx(h,{})]})})})]})]})})})]},s))]}),e.jsx(T,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(ae,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{es as ReimburseForm};
