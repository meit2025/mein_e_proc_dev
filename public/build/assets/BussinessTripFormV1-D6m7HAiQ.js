import{r as g,u as $e,j as e,b as Ee}from"./app-CM3a6AMx.js";/* empty css              */import{d as Re,F as _,a as w,b as v,c as b}from"./form-C7dK1lvL.js";import{u as qe,b as M,a as ke,c as H}from"./index.esm-CyL4HeOh.js";import{S as ue,a as je,b as fe,c as ge,d as W}from"./select-DcXw8vm_.js";import{S as pe}from"./separator-BF_G9AJ_.js";import{T as Ve}from"./textarea-CJxaDyi2.js";import{I as D}from"./input-dkEhNxwo.js";import{T as Ye,a as Ie,b as Pe,c as Me}from"./tabs-BruzVbt6.js";import{z as r,t as Be}from"./index-1rkLDSpP.js";import{S as Oe}from"./scroll-area-D-RY_byD.js";import{C as Le,E as Ge,G as Xe,b as Je}from"./api-DtjMnnyq.js";import{BusinessTripType as z}from"./models-BgPWkH6M.js";import{a as he}from"./axiosInstance-DNBZQMNr.js";import{h as E}from"./moment-C5S46NFB.js";import{F as Ue}from"./formSwitchCustom-EiHHEQNO.js";import{B as Z}from"./button-DSj1dE-z.js";import{d as me}from"./index-BGDdWDtd.js";import{W as We}from"./WorkflowComponent--mwrNL92.js";import{F as ze}from"./formDropdown-BtEKq3m5.js";import{u as xe}from"./getDropdown-JLTaLmuZ.js";import{f as ne}from"./rupiahCurrencyFormat-CP-6egij.js";import{B as He}from"./Button-DEt77LZf.js";import{C as Ze}from"./chevrons-up-down-qXA8v-l4.js";import"./app-DQK4SJPx.js";import"./index-Dwwa6c3M.js";import"./utils-D9cQCQE5.js";import"./index-B4No1jTG.js";import"./index-BhoK6Rbq.js";import"./index-Bb4qSo10.js";import"./index-ByKLJkfo.js";import"./index-g0vlDlbq.js";import"./index-ZoMH47jF.js";import"./index-BvQZoS64.js";import"./Combination-DX63lx9B.js";import"./index-glVq3Kuk.js";import"./index-BLceM0nB.js";import"./index-DWzFH9Bv.js";import"./CustomStatus-B7HjvS-2.js";import"./createLucideIcon-CxqBcp50.js";import"./Switch-B17hzI_e.js";import"./createSimplePaletteValueFilter-DDZkRvI6.js";import"./DefaultPropsProvider-c1JEsdsa.js";import"./SwitchBase-BwKJYDxa.js";import"./FormHelperText-DIvsH4dd.js";import"./useControlled-D2LMQn40.js";import"./createSvgIcon-Basgfq6T.js";import"./TextField-CszGyKbI.js";import"./useSlot-C64eCYFR.js";const Ke=1*1024*1024,Qe=["image/jpeg","image/jpg","image/png","image/heic","image/heif","application/pdf"],ss=({type:n,id:t})=>{var oe;const c=r.object({request_no:r.string().nonempty("Request for required"),remark:r.string().nonempty("Remark is required"),attachment:r.array(r.instanceof(File).refine(a=>Qe.includes(a.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(a=>a.size<=Ke,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:r.number().int("Total Destinantion Required"),cash_advance:r.boolean().nullable().optional(),reference_number:r.string().nullable().optional(),total_percent:r.string().nullable().optional(),total_cash_advance:r.string().nullable().optional(),destinations:r.array(r.object({destination:r.string().nonempty("Destinantion Required"),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.string().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional(),request_start_time:r.string().optional(),request_end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),default_price:r.string().optional(),type:r.string().optional(),currency:r.string().optional(),subtotal:r.number().optional(),detail:r.array(r.object({date:r.string().nullish(),request_price:r.string().optional()}))})),other:r.array(r.object({value:r.number().optional()}))}))}),l=qe({resolver:Be(c),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),y=(a,p)=>{var s;return a.type==="total"?parseFloat(((s=p==null?void 0:p[0])==null?void 0:s.request_price)||0):p==null?void 0:p.reduce((o,A)=>o+parseFloat(A.request_price||0),0)},x=()=>l.getValues("destinations").reduce((s,o,A)=>{const O=(o.allowances||[]).reduce((L,G,X)=>{const J=l.getValues(`destinations.${A}.allowances.${X}.detail`),U=y(G,J);return L+U},0);return s+O},0),[d,i]=g.useState(!1),{showToast:C}=$e(),T=async a=>{var p;try{if(n==z.create){const s=x(),o=new FormData;o.append("user_id",((p=u.request_for)==null?void 0:p.id.toString())??""),o.append("value",s.toString()),o.append("request_no",a.request_no??""),o.append("remark",a.remark??""),a.attachment.forEach((A,R)=>{A&&o.append(`attachment[${R}]`,A)}),o.append("total_destination",`${a.total_destination}`),a.destinations.forEach((A,R)=>{o.append(`destinations[${R}]`,JSON.stringify(A))}),await me.Inertia.post(Le,o,{headers:{"Content-Type":"multipart/form-data"}}),C("succesfully created data","success")}else{const s=new FormData;s.append("remark",a.remark??""),a.attachment.forEach((o,A)=>{o&&s.append(`attachment[${A}]`,o)}),ae.forEach((o,A)=>{o&&s.append(`file_existing[${A}]`,JSON.stringify(o))}),await me.Inertia.post(`${Ge}/${t}`,s,{headers:{"Content-Type":"multipart/form-data"}}),C("succesfully updated data","success")}}catch(s){console.log(s)}},[u,j]=g.useState([]),[m,h]=g.useState([]),[f,q]=g.useState([]),[S,F]=g.useState(!1);console.log(d);async function k(a){l.setValue("request_no",a||"");const p=Xe(a);try{const s=await he.get(p),o=s.data.data;F(o.cash_advance==1),l.setValue("remark",o.remarks||""),l.setValue("total_destination",o.total_destination||1),l.setValue("cash_advance",o.cash_advance==1),l.setValue("reference_number",o.reference_number),l.setValue("total_percent",o.total_percent),l.setValue("total_cash_advance",o.total_cash_advance),j(s.data.data),q(o.destinations),Q(o.total_destination),ee(o.destinations)}catch(s){console.log(s)}}const[K,Q]=g.useState(""),le=a=>{Q(a)};function ee(a){const p=a.map(s=>({destination:s.destination||"",pajak:s.pajak||"",purchasing_group:s.purchasing_group||"",business_trip_start_date:new Date(s.business_trip_start_date),business_trip_end_date:new Date(s.business_trip_end_date),allowances:s.allowances||[],detail_attedances:s.detail_attedances||[],total_allowance:s.total_allowance||0,other:s.other||[]}));l.setValue("destinations",p)}const{fields:B,append:te,remove:se,update:N}=M({control:l.control,name:"destinations"});g.useEffect(()=>{},[u,K]);const[V,_e]=g.useState(0),[we,ve]=g.useState(!1),[P,be]=g.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),re=async()=>{var a,p,s,o,A,R,O,L,G,X,J,U,ce;try{const Y=x();if(Y===0){C("Please fill the balance","error");return}const I=await he.get("/check-approval",{params:{value:Y,user_id:((a=u.request_for)==null?void 0:a.id)??"",type:"TRIP_DECLARATION"}});if(I.data.status_code===200){const Se=(s=(p=I.data)==null?void 0:p.data)==null?void 0:s.approval.map($=>($==null?void 0:$.division_name)||null),Te=(A=(o=I.data)==null?void 0:o.data)==null?void 0:A.approval.map($=>($==null?void 0:$.name)||null),de=[];(O=(R=I.data)==null?void 0:R.data)!=null&&O.hr&&de.push((X=(G=(L=I.data)==null?void 0:L.data)==null?void 0:G.hr)==null?void 0:X.name);const Fe=(((J=I.data.data)==null?void 0:J.approval)??[]).map($=>({status:"",name:$.name,dateApproved:""}));be({approvalRequest:Se,approvalFrom:Te,acknowledgeFrom:de,approvalFromStatusRoute:Fe}),ve(!0)}}catch(Y){C((ce=(U=Y==null?void 0:Y.response)==null?void 0:U.data)==null?void 0:ce.message,"error")}},{dataDropdown:Ae,getDropdown:ye}=xe(),{dataDropdown:lt,getDropdown:Ne}=xe();g.useEffect(()=>{x()>0&&re(),ye("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[l.watch("destinations")]);const[ae,ie]=g.useState([]);async function De(){l.setValue("destinations",[]);const a=Je(t),s=(await Ee.get(a)).data.data;await k(s.parent_id.toString()),ie(s.attachments)}g.useEffect(()=>{t&&n==z.clone&&(De(),Ne("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[n]);const Ce=a=>{ie(p=>p.filter(s=>s.id!==a))};return e.jsx(Oe,{className:"h-[600px] w-full ",children:e.jsx(Re,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(T),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(ze,{fieldLabel:"",options:Ae,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:a=>{k(a)}})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:u.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:u.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(oe=u==null?void 0:u.cost_center)==null?void 0:oe.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:"remark",render:({field:a})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(Ve,{placeholder:"Insert remark",...a,rows:4,className:"w-[300px]"})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:"attachment",render:({field:a})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:p=>{const s=p.target.files;if(s){const o=Array.from(s);a.onChange(o)}else a.onChange([])}})}),l.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(l.formState.errors.attachment)?l.formState.errors.attachment.map((p,s)=>e.jsx("span",{children:p.message},s)):l.formState.errors.attachment.message})]})})})]}),ae.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ae.map((a,p)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:a.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:a.file_name},p),e.jsx("button",{type:"button",onClick:()=>Ce(a.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:l.control,name:"total_destination",render:({field:a})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(ue,{value:K,onValueChange:le,disabled:!0,children:[e.jsx(je,{className:"w-[200px] py-2",children:e.jsx(fe,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(ge,{children:Array.from({length:5},(p,s)=>e.jsxs(W,{value:(s+1).toString(),children:[" ",s+1," "]},s))})]})}),e.jsx(b,{})]})})]})]})]}),e.jsx(pe,{className:"my-4"}),e.jsx(et,{updateDestination:N,destinationField:B,form:l,listAllowances:m,totalDestination:l.getValues("total_destination").toString(),setTotalAllowance:_e,businessTripDetail:u,type:n,btEdit:z.edit,setIsCashAdvance:F,isCashAdvance:S,setOtherAllowance:i,otherAllowance:d}),e.jsx(pe,{className:"my-4"}),e.jsx(He,{onClick:async()=>await re(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:we&&e.jsx(We,{workflowApproval:{approvalRequest:P.approvalRequest,approvalFrom:P.approvalFrom,acknowledgeFrom:P.acknowledgeFrom},workflowApprovalStep:P.approvalFromStatusRoute,workflowApprovalDiagram:P.approvalFrom})}),e.jsx(Z,{type:"submit",children:"submit"})]})})})};function et({totalDestination:n,listAllowances:t,form:c,destinationField:l,updateDestination:y,setTotalAllowance:x,businessTripDetail:d,type:i,btEdit:C,setIsCashAdvance:T,isCashAdvance:u,setOtherAllowance:j,otherAllowance:m}){return e.jsxs(Ye,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ie,{className:"flex items-center justify-start space-x-4",children:l.map((h,f)=>e.jsxs(Pe,{value:`destination${f+1}`,children:["Destination ",f+1]}))}),l.map((h,f)=>e.jsx(tt,{listAllowances:t,updateDestination:y,destination:h,form:c,index:f,setTotalAllowance:x,businessTripDetail:d,type:i,btEdit:z.edit,setIsCashAdvance:T,isCashAdvance:u,setOtherAllowance:j,otherAllowance:m}))]})}function tt({form:n,index:t,destination:c,updateDestination:l,listAllowances:y,setTotalAllowance:x,businessTripDetail:d,type:i,btEdit:C,setIsCashAdvance:T,isCashAdvance:u,setOtherAllowance:j,otherAllowance:m}){const{fields:h,update:f,append:q,remove:S}=M({control:n.control,name:`destinations[${t}].detail_attedances`}),{fields:F,update:k,append:K,remove:Q,replace:le}=M({control:n.control,name:`destinations[${t}].allowances`}),ee=N=>{T(N)},{setValue:B}=ke(),te=H({control:n.control,name:"total_percent"}),se=d.total_cash_advance;return g.useEffect(()=>{const V=parseFloat(te||0)/100*se;B("total_cash_advance",V.toFixed(2))},[te,se,B]),e.jsxs(Me,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:c.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:c==null?void 0:c.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:c==null?void 0:c.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:E(c.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:E(c.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(st,{detailAttedanceFields:h,form:n,updateAttedanceFields:f,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(at,{allowanceField:F,destinationIndex:t,form:n,setOtherAllowance:j,otherAllowance:m})]},t),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Ue,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:N=>ee(N.target.checked)})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(_,{control:n.control,name:"reference_number",render:({field:N})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{value:N.value||"",onChange:V=>N.onChange(V.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(_,{control:n.control,name:"total_percent",render:({field:N})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsxs(ue,{value:N.value||void 0,disabled:!0,onValueChange:V=>N.onChange(V),children:[e.jsx(je,{className:"w-[50%] mb-2",children:e.jsx(fe,{placeholder:"-- Select Total Percent --"})}),e.jsxs(ge,{children:[e.jsx(W,{value:"10",children:"10%"}),e.jsx(W,{value:"25",children:"25%"}),e.jsx(W,{value:"50",children:"50%"})]})]})}),e.jsx(b,{})]})}),e.jsx(_,{control:n.control,name:"total_cash_advance",render:({field:N})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{value:N.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(b,{})]})})]})]})]})]})]})}function as({allowanceField:n,destinationIndex:t,form:c,setTotalAllowance:l}){const y=c.watch(`destinations[${t}].allowances`),x=c.watch(`destinations[${t}].total_allowance`);return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:y.map((d,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:d.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:d.subtotal})]})]},d.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:x})]})]})})]})})}function st({form:n,destinationIndex:t,detailAttedanceFields:c,updateAttedanceFields:l}){const y=n.watch(`destinations[${t}].detail_attedances`);return g.useEffect(()=>{},[y]),g.useEffect(()=>{},[c]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:y.map((x,d)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[E(x.date).format("DD/MM/YYYY"),e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.date`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:E(i.value).format("YYYY-MM-DD"),onChange:i.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.shift_code`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:E(i.value).format("YYYY-MM-DD"),onChange:i.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.shift_start`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:E(i.value).format("YYYY-MM-DD"),onChange:i.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.shift_end`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:E(i.value).format("YYYY-MM-DD"),onChange:i.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.start_time`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:i.value,onChange:i.onChange})}),e.jsx(b,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.end_time`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:i.value,onChange:i.onChange})}),e.jsx(b,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.request_start_time`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:i.value,onChange:i.onChange})}),e.jsx(b,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:`destinations.${t}.detail_attedances.${d}.request_end_time`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{defaultValue:i.value,onChange:i.onChange})}),e.jsx(b,{})]})})})]},x.index))})]})})})]})}function at({form:n,destinationIndex:t,allowanceField:c,setOtherAllowance:l,otherAllowance:y}){const x=n.watch(`destinations[${t}].allowances`);g.useEffect(()=>{},[x]);const{fields:d,append:i,remove:C}=M({control:n.control,name:`destinations.${t}.other`}),T=H({control:n.control,name:`destinations.${t}.other`}),u=()=>(T||[]).reduce((m,h)=>{const f=Number((h==null?void 0:h.value)||0);return m+f},0),j=()=>{i({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[x.map((m,h)=>e.jsx(nt,{form:n,allowance:m,destinationIndex:t,allowanceIndex:h})),d.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(Z,{type:"button",className:"text-xl",onClick:j,children:"+"})})}),d.map((m,h)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:n.control,name:`destinations.${t}.other[${h}].value`,render:({field:f})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{type:"number",min:"0",value:f.value??"",onChange:q=>{let S=q.target.value;if(S===""){f.onChange(void 0);return}const F=Math.max(0,Number(S));f.onChange(F)}})}),e.jsx(b,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",ne(u(),!1)]})})}),e.jsx("td",{children:e.jsx(Z,{type:"button",className:"text-xs",onClick:()=>C(h),children:"X"})})]},h))]})}function nt({form:n,allowance:t,destinationIndex:c,allowanceIndex:l}){const[y,x]=g.useState(!1);g.useState(0);const d=j=>{x(m=>!m)},i=H({control:n.control,name:`destinations[${c}].allowances[${l}].detail[0].request_price`}),C=H({control:n.control,name:`destinations[${c}].allowances[${l}].detail`}),T=()=>{if(t.type==="total")return parseFloat(i||0)*1;{let j=0;return C==null||C.forEach(m=>{const h=parseFloat(m.request_price||0);j+=h}),j}},u=(j,m)=>{const h=parseFloat(m),f=isNaN(h)?0:h,q=t.request_value;let S=!0;switch(q){case"unlimited":S=!0;break;case"fixed value":const F=t.subtotal;f!==F&&(alert(`Please enter the fixed value of IDR ${F}`),S=!1);break;case"up to max value":const k=t.subtotal;f>k&&(alert(`The value should not exceed IDR ${k}`),S=!1);break;default:S=!1}S&&n.setValue(`destinations[${c}].allowances[${l}].detail[${j}].request_price`,f)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:n.control,name:`destinations[${c}].allowances[${l}].detail[0].request_price`,render:({field:j})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{value:j.value,onChange:m=>u(0,m.target.value)})}),e.jsx(b,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",ne(t.subtotal,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",ne(T(),!1)]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(Z,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),y&&e.jsx(e.Fragment,{children:t.detail.map((j,m)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:E(j.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(_,{control:n.control,name:`destinations[${c}].allowances[${l}].detail[${m}].request_price`,render:({field:h})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{value:h.value,onChange:f=>u(m,f.target.value)})}),e.jsx(b,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},j.id))})]})}function ns({form:n,type:t,allowanceIndex:c,destinationIndex:l}){const{fields:y}=M({control:n.control,name:`destinations.${l}.allowances.${c}.detail`});return e.jsx(e.Fragment,{children:y.map((x,d)=>e.jsx(_,{control:n.control,name:`destinations.${l}.allowances.${d}.detail.${d}.request_price`,render:({field:i})=>e.jsxs(w,{children:[e.jsx(v,{children:e.jsx(D,{value:i.value,onChange:i.onChange})}),e.jsx(b,{})]})}))})}export{ns as AllowanceInputForm,nt as AllowanceRowInput,et as BussinesTripDestination,tt as BussinessDestinationForm,ss as BussinessTripFormV1,at as DetailAllowance,st as DetailAttedances,as as ResultTotalItem};
