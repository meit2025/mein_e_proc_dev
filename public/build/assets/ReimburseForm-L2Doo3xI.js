import{j as e,r as D,u as st,q as at}from"./app-DxIXuHs1.js";import{B as rt}from"./button-BbqPhXoo.js";import{h as z}from"./moment-C5S46NFB.js";import{z as h,t as nt}from"./index-BtMcEkZ0.js";import{f as J}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ot,F as N,a as S,b as C,c as F,f as lt,e as it}from"./form-0x7MRjrH.js";import{u as ct,b as mt}from"./index.esm-ozcV5ThE.js";import{T as Se}from"./textarea-BIxTzUMw.js";/* empty css                  */import{S as dt}from"./scroll-area-CzanJzwh.js";import{a as B}from"./axiosInstance-BT1pM21v.js";import{S as Ce}from"./separator-CVQ2l1tX.js";import{T as ut,a as pt,b as ht,c as ft}from"./tabs-D7e3cF29.js";import{S as K,a as X,b as Q,c as U,d as ee}from"./select-CXMd30bS.js";import{F as de}from"./formDropdown-pA4sQ-kV.js";import{C as Fe}from"./CustomDatePicker-DnGMrTyB.js";import{I as Ie}from"./input-CYNS4k6R.js";import{ReimburseFormType as b}from"./listModel-DVcy4QcM.js";import{u as te}from"./getDropdown-C80ndoeE.js";import{G as gt,a as qe,b as _t}from"./api-DXF7erOJ.js";import{L as bt}from"./LoadingSpin-CWLC6jDy.js";import{W as jt}from"./WorkflowComponent-B5xp2Y1r.js";import{C as xt}from"./CustomStatus-DfGBegsZ.js";import{F as Te}from"./FormHelperText-DWkOgFCG.js";import{B as yt}from"./Button-x7WKRqgV.js";import"./app-DQK4SJPx.js";import"./index-B-4kL3_T.js";import"./index-Bb4qSo10.js";import"./utils-B4ERH0HO.js";import"./createLucideIcon-D5HBOU_T.js";import"./index-DR3Iax8e.js";import"./index-OMZYiFBK.js";import"./index-BjG3Up6z.js";import"./index-BSbFCRbc.js";import"./index-aGkuBFrK.js";import"./index-BdQq_4o_.js";import"./index-BxPmdkzw.js";import"./index-CrGKoCpc.js";import"./index-Cs64a-sE.js";import"./index-CB5hQ-zQ.js";import"./index-C1bvrK1t.js";import"./Combination-XfXqhK5M.js";import"./index-DsSOWaNV.js";import"./TextField-BlywY1Ew.js";import"./createSvgIcon-D5Rr7Cow.js";import"./DefaultPropsProvider-BUfDQc9E.js";import"./useSlot-DAU6jov-.js";import"./createSimplePaletteValueFilter-BkquEIOU.js";import"./useControlled-DAV_LTtD.js";function wt({isLoading:ue=!1,children:pe}){return e.jsx("div",{className:"",children:ue?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(bt,{})})}):pe})}const bs=({onSuccess:ue,currencies:pe,taxDefaultValue:je,uomDefaultValue:xe,edit_url:Ee,update_url:ke,store_url:Re,type:g,currentUser:R})=>{const[ye,Ae]=D.useState("form1"),{showToast:q}=st();at().props;const{dataDropdown:se,getDropdown:ae}=te(gt);te();const{dataDropdown:Le,getDropdown:Me}=te(),{dataDropdown:re,getDropdown:ne}=te("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:oe,getDropdown:le}=te("api/master/cost-center/dropdown-list"),[Y,he]=D.useState([]),[Ye,fe]=D.useState([]),[T,$e]=D.useState(!1),[we,Ve]=D.useState(!1),[Be,ie]=D.useState(!1),[j,P]=D.useState([]),H=D.useRef([]);D.useState([]);const[W,Pe]=D.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ge=1*1024*1024,Oe=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],ze=h.object({formCount:h.string().min(1,"total form must be have value"),remark_group:h.string().min(1,"header remark is required"),cost_center:h.string().min(1,"cost center required"),requester:h.string().min(1,"requester required"),value:h.number().optional(),user_id:h.string().optional(),forms:h.array(h.object({reimburseId:h.string().optional(),for:h.string().optional(),group:h.string().optional(),reimburse_type:h.string().min(1,"reimburse type is required"),short_text:h.string().min(1,"remarks is required"),balance:h.string(),remaining_balance_when_request:h.number(),currency:h.string().min(1,"currency required"),tax_on_sales:h.string().min(1,"tax required"),purchase_requisition_unit_of_measure:h.string().min(1,"uom required"),purchasing_group:h.string().min(1,"Purchasing Group required"),type:h.any(),item_delivery_data:h.date(),claim_date:h.date(),attachment:h.array(h.instanceof(File).refine(t=>Oe.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=Ge,{message:"File size must be less than 1MB"})).min(g===b.create?1:0,"Attachment is required"),savedAttachment:h.array(h.any()).optional().nullable()}))});D.useEffect(()=>{(async()=>{var a,m;(g===b.edit||g===b.clone)&&(ie(!0),await He()),Me("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=parseInt(ye.split("form")[1])-1;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(a=r.getValues("forms")[s])!=null&&a.purchasing_group?"id":"",value:((m=r.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&g===b.create&&Z(0)})()},[g]);async function He(){r.setValue("forms",[]),ie(!0);try{const t=await B.get(Ee??""),s=t.data.data.group,a=t.data.data.forms;$e(s.reimbursementStatus);const m=a.map(o=>({reimburseId:String(o.id),for:String(o.for),group:String(o.group),reimburse_type:o.reimburse_type.code,short_text:o.short_text,balance:o.balance,currency:o.currency,tax_on_sales:String(o.tax_on_sales),purchase_requisition_unit_of_measure:String(o.purchase_requisition_unit_of_measure),remaining_balance_when_request:parseInt(o.remaining_balance_when_request)??0,purchasing_group:String(o.purchasing_group),type:o.type,item_delivery_data:new Date(o.item_delivery_data),claim_date:new Date(o.claim_date),attachment:[],savedAttachment:o.reimburse_attachment}));r.setValue("formCount",a.length.toString()),r.setValue("remark_group",s.remark),r.setValue("cost_center",String(s.cost_center.id)),r.setValue("requester",s.requester),H.current=a.map((o,p)=>({id:String(o.id),reimburse_type:o.reimburse_type.code,balance:a.filter((c,f)=>f>=p&&c.for===o.for&&c.reimburse_type.code===o.reimburse_type.code).reduce((c,f)=>c+parseInt(f.balance)||0,0),limit:a.filter((c,f)=>f>=p&&c.for===o.for&&c.reimburse_type.code===o.reimburse_type.code).reduce((c,f)=>c+1||0,0),for:String(o.for)})),r.setValue("forms",m);let d=0;for(const o of a)await Z(d,{reimburse_type:o.reimburse_type.code}),await ve(d,{type:o.type,reimburse_type:o.reimburse_type.code}),await _e(d,{reimburse_type:o.reimburse_type.code,for:o.reimburse_type.is_employee===1?null:o.for}),d++;ie(!1)}catch{ie(!1)}}const We={formCount:"1",remark_group:"",cost_center:"",requester:String(R==null?void 0:R.is_admin)==="1"?"":R==null?void 0:R.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:je,purchase_requisition_unit_of_measure:xe,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=ct({resolver:nt(ze),defaultValues:We}),{fields:ge,update:_}=mt({control:r.control,name:"forms"}),Z=async(t,s=null)=>{const a=r.getValues("requester");if(a===null||a===""){he(d=>{const o=[...d];return o[t]=[],o});return}const m=await B.get(qe,{params:{user:a,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});he(d=>{const o=[...d];return o[t]=m.data.data,o})},Ze=async(t,s)=>{if(t&&t.length>0)try{const a=await B.get(qe,{params:{search:t,user:r.getValues("requester")}});he(m=>{const d=[...m];return d[s]=a.data.data,d})}catch(a){console.error("Error searching reimburse types:",a)}},ve=async(t,s)=>{const a=await B.get(_t,{params:{user:r.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});fe(m=>{const d=[...m];return d[t]=a.data.data,d})},Je=t=>{for(let s=0;s<ge.length;s++)Z(s);if(t==null)for(let s=0;s<ge.length;s++)r.setValue(`forms.${s}.reimburse_type`,""),r.setValue(`forms.${s}.for`,"");P([]),fe([])};function Ke(t){const s=[...r.getValues("forms")];for(let a=0;a<parseInt(t);a++)if(a+1>s.length){Z(a);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:je,purchase_requisition_unit_of_measure:xe,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}r.setValue("forms",s)}const Xe=t=>{Ae(t)},Qe=async t=>{var a,m,d,o,p;if(j)for(let c=0;c<j.length;c++){if(t.forms.length==0||t.forms.length-1,((a=j[c])==null?void 0:a.type_limit)!=="Unlimited"&&parseInt((m=j[c])==null?void 0:m.limit)==0){q("Claim Limit for form "+(c+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[c].balance==""||parseInt(t.forms[c].balance)==0){q("Claim Balance for form "+(c+1)+" cannot be 0","error");return}if(parseInt(((d=j[c])==null?void 0:d.balance)??0)<parseInt(t.forms[c].balance??0)){q("Please check your balance input for forms "+(c+1)+"  is not must be above "+((o=j[c])==null?void 0:o.balance),"error");return}t.forms=t.forms.map((f,I)=>{var E;return{...f,claim_date:z(f.claim_date).format("YYYY-MM-DD"),item_delivery_data:z(f.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:parseInt(((E=j[I])==null?void 0:E.balance)??0)}})}const s=t.forms.reduce((c,f)=>c+parseInt(f.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let c;g===b.edit||g===b.clone?c=await B.post(ke??"",t,{headers:{"Content-Type":"multipart/form-data"}}):c=await B.post(Re??"",t,{headers:{"Content-Type":"multipart/form-data"}}),q((p=c==null?void 0:c.data)==null?void 0:p.data,"success"),ue()}catch{}};async function _e(t,s=null){var d,o;const a=r.getValues(`forms.${t}`),m={user:r.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:a.reimburse_type,for:s!=null?s.for:a.for};try{const p=await B.get("reimburse/data-limit-and-balance",{params:m});P(c=>{const I=r.getValues("forms").filter((L,V)=>V!==t&&L.reimburse_type===a.reimburse_type),E=I.reduce((L,V)=>L+parseInt(V.balance)||0,0);let A=0,y=0;if(g===b.clone){let L=a.for===""?r.getValues("requester"):a.for;a.reimburse_type===H.current[t].reimburse_type&&L===H.current[t].for&&(A=p.data.data.balance+parseInt(H.current[t].balance),y=Math.max(0,p.data.data.limit-I.length)+H.current[t].limit)}else A=p.data.data.balance-E,y=Math.max(0,p.data.data.limit-I.length);const $=[...c];return $[t]={...p.data.data,balance:A,limit:p.data.data.type_limit=="Unlimited"?p.data.data.type_limit:y},$})}catch(p){q((o=(d=p==null?void 0:p.response)==null?void 0:d.data)==null?void 0:o.message,"error")}}const De=async()=>{var t,s,a,m,d,o,p,c,f,I,E,A;try{const y=r.getValues("forms"),$=y.map((w,k)=>({index:k,value:w.balance?parseInt(w.balance):0}));if($.some(w=>w.value===0)){const w=$.findIndex(k=>k.value===0);q(`Please fill balance form ${w+1}`,"error");return}const V=y.reduce((w,k)=>w+(parseInt(k.balance)||0),0),M=await B.get("/check-approval",{params:{value:V,requester:r.getValues("requester"),type:"REIM"}});if(M.data.status_code===200){const w=(s=(t=M.data)==null?void 0:t.data)==null?void 0:s.approval.map(i=>(i==null?void 0:i.division_name)||null),k=(m=(a=M.data)==null?void 0:a.data)==null?void 0:m.approval.map(i=>(i==null?void 0:i.name)||null),l=[];(o=(d=M.data)==null?void 0:d.data)!=null&&o.hr&&l.push((f=(c=(p=M.data)==null?void 0:p.data)==null?void 0:c.hr)==null?void 0:f.name);const n=(((I=M.data.data)==null?void 0:I.approval)??[]).map(i=>({status:"",name:i.name,dateApproved:""}));Pe({approvalRequest:w,approvalFrom:k,acknowledgeFrom:l,approvalFromStatusRoute:n}),Ve(!0)}}catch(y){q((A=(E=y==null?void 0:y.response)==null?void 0:E.data)==null?void 0:A.message,"error")}};D.useEffect(()=>{r.getValues("forms").reduce((a,m)=>a+parseInt(m.balance)||0,0)>0&&we===!0&&De()},[r.watch("forms"),r.watch("requester")]);const Ue=t=>{const s=t;if(Object.keys(s).length>0){let a=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,d])=>{m==="forms"?d.forEach((o,p)=>{a+=`</br><strong>Form ${p+1}:</strong></br>`,Object.values(o).forEach(c=>{a+=`<li>${c.message}</li>`})}):a+=`<li>${d.message}</li>`}),a+="</ul>",q(e.jsx("div",{dangerouslySetInnerHTML:{__html:a}}),"error")}};return e.jsx(dt,{className:"h-[600px] w-full",children:e.jsx(wt,{isLoading:Be,children:e.jsx(ot,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Qe,t=>{Ue(t)}),children:[e.jsx("table",{className:"w-full mt-4 text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:T&&e.jsx(xt,{name:T==null?void 0:T.name,className:T==null?void 0:T.classname,code:T==null?void 0:T.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:"remark_group",render:({field:t})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(Se,{placeholder:"Insert remark",...t})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{fieldLabel:"",options:oe,fieldName:"cost_center",disabled:g===b.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=oe==null?void 0:oe.some(a=>a.label===t);t.length>0&&!s?await le(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=r.getValues("cost_center");le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{options:se,fieldName:"requester",disabled:String(R==null?void 0:R.is_admin)==="0"||g===b.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const a=se==null?void 0:se.some(m=>m.label===t);t.length>0&&!a?ae(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!a&&ae("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>Je(t),onFocus:()=>{const t=r.getValues("requester");ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(K,{disabled:g===b.edit,onValueChange:a=>{t.onChange(a),Ke(a);const m=r.getValues("forms");if(m.length>parseInt(a)){const d=m.slice(0,parseInt(a));r.setValue("forms",d),P(o=>{let p=[...o];return p=p.slice(0,parseInt(a)),p})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"Select number of forms"})}),e.jsx(U,{children:Array.from({length:3},(a,m)=>m+1).map(a=>e.jsx(ee,{value:a.toString(),children:a},a))})]})}),e.jsx(F,{})]})}})})]})]})}),e.jsx(Ce,{className:"my-4"}),e.jsxs(ut,{value:ye,onValueChange:Xe,className:"w-full",children:[e.jsxs(pt,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:r.watch("formCount")||1}).map((t,s)=>e.jsxs(ht,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),ge.map((t,s)=>{var a,m,d,o,p,c,f,I,E,A,y,$,L,V,M,w,k;return e.jsxs(ft,{value:`form${s+1}`,children:[e.jsx(N,{control:r.control,name:`forms.${s}.reimburseId`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(Ie,{className:"sr-only",value:t.reimburseId,onChange:l.onChange})}),e.jsx(F,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{options:Y[s],fieldName:`forms.${s}.reimburse_type`,disabled:Y[s]===void 0||Y[s].length===0||g===b.edit,placeholder:"Select Reimburse Type",onSearch:async l=>{var u;((u=Y[s])==null?void 0:u.some(i=>i.label===l))||await Ze(l,s)},onChangeOutside:async l=>{if(l){const n=Y[s].filter(u=>u.value==l)[0];_(s,{...t,reimburse_type:l,type:n.is_employee===1?"Employee":"Family"}),n.is_employee===1?_e(s,{reimburse_type:l,for:null}):(P(u=>{const i=[...u];return i[s]=[],i}),r.setValue(`forms.${s}.balance`,""),ve(s,{type:"Family",reimburse_type:l}))}else{P(u=>{const i=[...u];return i[s]=[],i}),_(s,{...t,balance:""}),r.setValue(`forms.${s}.for`,""),fe(u=>{const i=[...u];return i[s]=[],i});const n=r.getValues("forms");n.forEach((u,i)=>{var v,x;if(i>s&&n[i].reimburse_type===t.reimburse_type){const ce=((v=j[i])==null?void 0:v.balance)||0,Ne=((x=j[i])==null?void 0:x.limit)||0;P(me=>{var O;const G=[...me];return G[i]={...G[i],balance:ce+parseInt(t.balance||"0")},((O=j[i])==null?void 0:O.type_limit)!=="Unlimited"&&(G[i]={...G[i],limit:Ne+1}),G}),r.setValue(`forms.${i}.balance`,"")}})}},onFocus:()=>{Z(s)},classNames:"mt-2 w-full"}),((d=(m=(a=r.formState.errors)==null?void 0:a.forms)==null?void 0:m[s])==null?void 0:d.reimburse_type)&&e.jsx(Te,{error:!0,children:(f=(c=(p=(o=r.formState.errors)==null?void 0:o.forms)==null?void 0:p[s])==null?void 0:c.reimburse_type)==null?void 0:f.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:`forms.${s}.for`,render:({field:l})=>{var n,u,i,v;return e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(K,{disabled:((i=(u=(n=Y==null?void 0:Y[s])==null?void 0:n.filter(x=>(x==null?void 0:x.value)==r.getValues(`forms.${s}.reimburse_type`)))==null?void 0:u[0])==null?void 0:i.is_employee)===1||g===b.edit,onValueChange:x=>{_(s,{...t,for:x}),_e(s,{reimburse_type:r.getValues(`forms.${s}.reimburse_type`),for:x})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(v=Ye[s])==null?void 0:v.map(x=>e.jsx(ee,{value:x.value.toString(),children:x.label},x.value))})]})}),e.jsx(F,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{fieldLabel:"",options:re,fieldName:`forms.${s}.purchasing_group`,disabled:g===b.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:l=>{const n=re==null?void 0:re.some(u=>u.label===l);l.length>0&&!n?ne(l,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:l}):l.length==0&&!n&&ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:l=>{l&&_(s,{...t,purchasing_group:l})},onFocus:()=>{var n;const l=(n=r.getValues("forms")[s])==null?void 0:n.purchasing_group;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:l?"id":"",value:l??""}})}}),((A=(E=(I=r.formState.errors)==null?void 0:I.forms)==null?void 0:E[s])==null?void 0:A.purchasing_group)&&e.jsx(Te,{error:!0,children:(V=(L=($=(y=r.formState.errors)==null?void 0:y.forms)==null?void 0:$[s])==null?void 0:L.purchasing_group)==null?void 0:V.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:`forms.${s}.tax_on_sales`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(K,{disabled:!0,onValueChange:n=>{_(s,{...t,tax_on_sales:n})},defaultValue:t.tax_on_sales,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(Le??[]).map((n,u)=>e.jsxs(ee,{value:n.value.toString(),children:[n.description," - ",n.label]},n.value))})]})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(K,{disabled:!0,onValueChange:n=>{_(s,{...t,purchase_requisition_unit_of_measure:String(n)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:e.jsx(ee,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:`forms.${s}.short_text`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(Se,{placeholder:"Insert remark",onChange:n=>{_(s,{...t,short_text:n.target.value})},defaultValue:t.short_text})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((M=j[s])==null?void 0:M.balance)&&J((w=j[s])==null?void 0:w.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(k=j[s])==null?void 0:k.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:`forms.${s}.item_delivery_data`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(Fe,{disabled:g===b.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:n=>{z(n).format("YYYY-MM-DD")>=z(new Date).format("YYYY-MM-DD")?(l.onChange(n),_(s,{...t,item_delivery_data:n})):(l.onChange(l.value),_(s,{...t,item_delivery_data:l.value}),q("Receipt date cannot be less than today","error"))}})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(N,{control:r.control,name:`forms.${s}.claim_date`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(Fe,{disabled:g===b.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:n=>{z(n).format("YYYY-MM-DD")>=z(new Date).format("YYYY-MM-DD")?(l.onChange(n),_(s,{...t,claim_date:n})):(l.onChange(l.value),_(s,{...t,claim_date:l.value}),q("Claim date cannot be less than today","error"))}})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid w-full grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(N,{control:r.control,name:`forms.${s}.currency`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(K,{disabled:g===b.edit,onValueChange:n=>{_(s,{...t,currency:n})},defaultValue:t.currency,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:pe.map(n=>e.jsxs(ee,{value:n.code,children:[n.name," (",n.code,")"]},n.code))})]})}),e.jsx(lt,{className:"h-6"}),e.jsx(F,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(N,{control:r.control,name:`forms.${s}.balance`,render:({field:l})=>{var n;return e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(Ie,{type:"text",placeholder:"0",onChange:u=>{var me;const i=u.target.value.replace(/[^0-9]/g,""),v=J(i,!1),x=parseInt(i)||0,ce=((me=j[s])==null?void 0:me.balance)||0;if(x>ce){u.target.value=J(i.slice(0,-1),!1);return}_(s,{...t,balance:i}),u.target.value=v,r.getValues("forms").forEach((G,O)=>{if(O>s&&G.reimburse_type===t.reimburse_type){const et=ce-x;P(tt=>{const be=[...tt];return be[O]={...be[O],balance:et},be}),_(O,{...t,balance:""})}})},defaultValue:J(t.balance,!1),value:J(t.balance,!1),disabled:typeof j[s]>"u"||((n=j[s])==null?void 0:n.length)===0||g===b.edit})}),e.jsx(F,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(N,{control:r.control,name:`forms.${s}.attachment`,render:({field:l})=>e.jsxs(S,{children:[e.jsx(it,{className:"mb-1 text-xs text-gray-500 font-extralight",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(C,{children:e.jsx("input",{className:"flex w-full px-3 py-1 text-xs transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:n=>{const u=n.target.files;if(u){const i=[...t.attachment],v=Array.from(u);i.push(...v),_(s,{...t,attachment:i})}}})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((l,n)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:l.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const u=t.attachment.filter((i,v)=>v!==n);_(s,{...t,attachment:u})},children:"Delete"})]},n))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((l,n)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:l.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const u=t.savedAttachment.filter((i,v)=>v!==n);_(s,{...t,savedAttachment:u})},children:"Delete"})]},n))})})]})]})]})]})})})]},s)})]}),e.jsx(yt,{onClick:async()=>await De(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:we&&e.jsx(jt,{workflowApproval:{approvalRequest:W.approvalRequest,approvalFrom:W.approvalFrom,acknowledgeFrom:W.acknowledgeFrom},workflowApprovalStep:W.approvalFromStatusRoute,workflowApprovalDiagram:W.approvalFrom})}),e.jsx(Ce,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(rt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{bs as ReimburseForm};
