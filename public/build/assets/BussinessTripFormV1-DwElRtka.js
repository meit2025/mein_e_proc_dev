import{r as i,u as Ze,j as e,b as He}from"./app-BzaQhCEc.js";import{d as Ke,F as w,a as y,b as S,c as F,e as Ue}from"./form-BiRVUInL.js";import{z as s,t as Qe}from"./index-BSRa4nPm.js";import{d as ae}from"./index-BbyXm1rw.js";import{B as et}from"./button-aGuJjIEp.js";import{T as tt}from"./textarea-Ba8KlVXw.js";import{u as at,b as ne,c as st}from"./index.esm-CqlmqirC.js";import{S as rt}from"./scroll-area-BNo2DHkl.js";import{S as se}from"./separator-B6kA2ZqP.js";/* empty css              */import{a as N}from"./axiosInstance-De5AoChh.js";import{W as nt}from"./WorkflowComponent-C2LCE6qc.js";import{F as ot}from"./formSwitchCustom-DLl64q3P.js";import{I as $}from"./input-BXAVFIoC.js";import{S as it,a as lt,b as ct,c as dt,d as pt}from"./select-CrN0MMjs.js";import{a as ut,C as mt,b as _t,c as ht,d as ft}from"./api-BlrZv04E.js";import{G as re,a as gt}from"./api-BEQetkWJ.js";import{h as A}from"./moment-C5S46NFB.js";import{BusinessTripType as j}from"./models-CrpJzAK7.js";import{u as b}from"./getDropdown-B5azRr59.js";import{F as B}from"./formDropdown-DTzXTXtk.js";import{f as xt}from"./rupiahCurrencyFormat-CP-6egij.js";import{BussinesTripDestination as jt}from"./BussinesTripDestination-DuZbGcvg.js";import{B as bt}from"./Button-B_H1lXc8.js";import"./app-DQK4SJPx.js";import"./index-D-x42Zh9.js";import"./utils-DPCdwje_.js";import"./index-CQnEy1lh.js";import"./index-nHXR6J8p.js";import"./index-Bb4qSo10.js";import"./createLucideIcon-3ktPa3h9.js";import"./index-CyEkyhfO.js";import"./index-5zNYgT0N.js";import"./index-DQT7pAgh.js";import"./index-BdQq_4o_.js";import"./createSvgIcon-BU2FmuwE.js";import"./DefaultPropsProvider-DQGxm-T8.js";import"./Switch-Dr_etAAG.js";import"./createSimplePaletteValueFilter-EEuM3cJK.js";import"./SwitchBase-Cw7FN4Gp.js";import"./FormHelperText-D1CrHRrz.js";import"./useControlled-Cpp5xqUI.js";import"./index-CpYIVgQO.js";import"./index-DYD2cb4R.js";import"./Combination-CDlkOftq.js";import"./index-BlEeG6MO.js";import"./index-gdD4TlKM.js";import"./CustomStatus-vxTjjQUd.js";import"./TextField-BFiejfUa.js";import"./useSlot-B2hDBRq9.js";import"./tabs-BxjUG2gJ.js";import"./index-CqU-jKZJ.js";import"./BussinessDestinationForm-DYvJR6vk.js";import"./CustomDatePicker-BTyXNxRP.js";import"./DetailAttedances-C0Gfrqdg.js";import"./DetailAllowance-Dx8Kks6e.js";import"./chevrons-up-down-CZ1UXbBE.js";import"./ResultTotalItem-BT_XpniO.js";import"./checkbox-DWKTvLYD.js";s.object({remark:s.string().min(1).max(50),reimburse_cost:s.number()});const wt=1*1024*1024,yt=["heic","image/jpeg","image/jpg","image/png","image/heic","image/heif","application/pdf"],Pa=({users:k,listPurposeType:oe,pajak:q,costcenter:R,purchasingGroup:V,type:h,id:f,isAdmin:u,idUser:m})=>{const ie=s.object({purpose_type_id:s.string().min(1,"Purpose type required"),request_for:s.string().min(1,"Request is required"),cost_center_id:s.string().min(1,"Cost Center is required"),remark:s.string().min(1,"Remark is required"),attachment:s.array(s.instanceof(File).refine(t=>yt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(t=>t.size<=wt,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:s.number().min(1,"Total Destinantion Required"),cash_advance:s.boolean().nullable().optional(),total_percent:s.number().nullable().optional(),total_cash_advance:s.string().nullable().optional(),destinations:s.array(s.object({destination:s.string().min(1,"Destinantion is Required"),restricted_area:s.boolean().nullable().optional(),pajak_id:s.string().min(1,"Pajak is required"),purchasing_group_id:s.string().min(1,"Purchasing Group is required"),business_trip_start_date:s.date().optional(),business_trip_end_date:s.date().optional(),detail_attedances:s.array(s.object({date:s.date().optional(),shift_code:s.string().optional(),shift_start:s.string().optional(),shift_end:s.string().optional(),start_time:s.string().optional(),end_time:s.string().optional(),start_date:s.date().optional(),end_date:s.date().optional()})),allowances:s.array(s.object({name:s.string().optional(),code:s.string().optional(),default_price:s.number().optional(),type:s.string().optional(),subtotal:s.number().optional(),currency:s.string().optional(),detail:s.array(s.object({date:s.date().nullish(),request_price:s.any().optional()}))})).min(1,"Allowances tidak boleh kosong")}))}).superRefine(({cash_advance:t,total_percent:r},a)=>{if(t===!0)if(!r||r.toString().trim()==="")a.addIssue({code:s.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent is required"});else{const o=Number(r);(isNaN(o)||o<1||o>100)&&a.addIssue({code:s.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent must be a number between 1 and 100"})}}),[T,M]=i.useState("1"),n=at({resolver:Qe(ie),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,total_percent:0,total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",restricted_area:!1,pajak_id:"V0",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[Y,G]=i.useState([]),[le,ce]=i.useState(null),[L,O]=i.useState([]);async function de(){const t=ht(f);n.setValue("destinations",[]);try{const a=(await He.get(t)).data.data;console.log(a,"data");const o=re(a.purpose_type_id,a.request_for.id),c=await N.get(o);O(c.data.data),X("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.purpose_type.type}}),ce(a.request_no),G(a.attachments),n.setValue("purpose_type_id",a.purpose_type_id.toString()),n.setValue("request_for",a.request_for.id.toString()),n.setValue("cost_center_id",a.cost_center.cost_center.toString()),n.setValue("remark",a.remarks),n.setValue("total_destination",a.total_destination),n.setValue("cash_advance",a.cash_advance==1),n.setValue("total_percent",a.total_percent),n.setValue("total_cash_advance",a.total_cash_advance),n.setValue("destinations",a.destinations.map(d=>({destination:d.destination,restricted_area:d.restricted_area==1,pajak_id:d.pajak.mwszkz,purchasing_group_id:d.purchasing_group.purchasing_group,business_trip_start_date:new Date(d.business_trip_start_date),business_trip_end_date:new Date(d.business_trip_end_date),detail_attedances:d.detail_attedances.map(l=>({...l,date:new Date(l.date),start_date:new Date(l.start_date),end_date:new Date(l.end_date)})),allowances:d.allowances.map(l=>({...l,default_price:parseInt(l.default_price),subtotal:parseInt(l.subtotal),detail:l.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?new Date(p.date):null}))}))})))}catch{}}const{dataDropdown:pe,getDropdown:X}=b(),[z,ue]=i.useState(u==="0"?m==null?void 0:m.toString():""),[me,_e]=i.useState([]);async function he(){const t=u=="0"?m||0:z||0,r=ft(t),a=await N.get(r);_e(a.data.data)}async function fe(t){n.setValue("purpose_type_id",t||"");const r=u=="0"?m||"":z||"",a=re(t,r),o=gt(t);try{const c=await N.get(a);console.log(c,"response");const d=await N.get(o);O(c.data.data),X("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:d.data.data.purpose.type}})}catch(c){console.log(c)}}const[ge,J]=i.useState([]),xe=t=>{n.setValue("total_destination",parseInt(t,10)),M(t),H(),J([])},[je,W]=i.useState("destination1");i.useEffect(()=>{parseInt(T,10)<1?M("1"):W(`destination${T}`)},[T]);const{showToast:D}=Ze(),[be,Z]=i.useState(!1),we=async t=>{const r=K();if(r===0){D("Please add at least one destination","error");return}try{Z(!0);const a=new FormData;a.append("user_id",t.request_for??""),a.append("value",r.toString()),a.append("purpose_type_id",t.purpose_type_id??""),a.append("request_for",t.request_for??""),a.append("cost_center_id",t.cost_center_id??""),a.append("remark",t.remark??""),a.append("cash_advance",`${t.cash_advance}`),a.append("total_percent",`${t.total_percent}`),a.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((o,c)=>{o&&a.append(`attachment[${c}]`,o)}),a.append("total_destination",`${t.total_destination}`),t.destinations.forEach((o,c)=>{const d={...o,business_trip_start_date:A(o.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:A(o.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:o.detail_attedances.map(l=>({...l,date:A(l.date).format("YYYY-MM-DD")})),allowances:o.allowances.map(l=>({...l,detail:l.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?A(p.date).format("YYYY-MM-DD"):null}))}))};a.append(`destinations[${c}]`,JSON.stringify(d))}),h==j.create?(await ae.Inertia.post(mt,a,{headers:{"Content-Type":"multipart/form-data"}}),D("succesfully created data","success")):(Y.forEach((o,c)=>{o&&a.append(`file_existing[${c}]`,JSON.stringify(o))}),await ae.Inertia.post(`${_t}/${f}`,a,{headers:{"Content-Type":"multipart/form-data"}}),D("succesfully updated data","success")),setTimeout(()=>{Z(!1)},1e3)}catch(a){console.log(a)}};function H(){const t=[],r=parseInt(T);for(let a=0;a<r;a++)t.push({destination:"",business_trip_start_date:"",business_trip_end_date:"",pajak_id:"V0",purchasing_group_id:"",restricted_area:!1,allowances:[],detail_attedances:[]});n.setValue("destinations",t)}const{fields:ye,append:St,remove:Tt,update:Se}=ne({control:n.control,name:"destinations"}),[Te,De]=i.useState(!1);i.useEffect(()=>{f&&h==j.clone&&(de(),De(!0))},[h]),i.useEffect(()=>{h==j.create&&H(),he()},[T,L,u,m]);const[ve,Ne]=i.useState(!1),[v,Fe]=i.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ce=(t,r)=>{var a;return t.type==="total"?parseFloat(((a=r==null?void 0:r[0])==null?void 0:a.request_price)||0):r==null?void 0:r.reduce((o,c)=>o+parseFloat(c.request_price||0),0)},K=()=>n.getValues("destinations").reduce((a,o,c)=>{const l=(o.allowances||[]).reduce((p,C,E)=>{const P=n.getValues(`destinations.${c}.allowances.${E}.detail`),I=Ce(C,P);return p+I},0);return a+l},0),Ee=async()=>{var t,r,a,o,c,d,l,p,C,E,P,I;try{const g=K();if(g===0){D("Please fill the balance","error");return}const x=await N.get("/check-approval",{params:{value:g,user_id:n.getValues("request_for"),type:"TRIP"}});if(x.data.status_code===200){const ze=(r=(t=x.data)==null?void 0:t.data)==null?void 0:r.approval.map(_=>(_==null?void 0:_.division_name)||null),Je=(o=(a=x.data)==null?void 0:a.data)==null?void 0:o.approval.map(_=>(_==null?void 0:_.name)||null),te=[];(d=(c=x.data)==null?void 0:c.data)!=null&&d.hr&&te.push((C=(p=(l=x.data)==null?void 0:l.data)==null?void 0:p.hr)==null?void 0:C.name);const We=(((E=x.data.data)==null?void 0:E.approval)??[]).map(_=>({status:"",name:_.name,dateApproved:""}));Fe({approvalRequest:ze,approvalFrom:Je,acknowledgeFrom:te,approvalFromStatusRoute:We}),Ne(!0)}}catch(g){D((I=(P=g==null?void 0:g.response)==null?void 0:P.data)==null?void 0:I.message,"error")}};i.useEffect(()=>{},[n.watch("destinations")]);const Pe=t=>{G(r=>r.filter(a=>a.id!==t))},[Ie,U]=i.useState(!1),Ae=t=>{U(t)},Q=st({control:n.control,name:"total_percent"}),[ke,qe]=i.useState(0),ee=ke;i.useEffect(()=>{h==j.clone&&U(n.getValues("cash_advance")??!1);const r=parseFloat((Q||"0").toString())/100*ee;n.setValue("total_cash_advance",xt(r.toFixed(0),!1))},[Q,ee]);const{dataDropdown:Re,getDropdown:Ve}=b(ut),{dataDropdown:Ye,getDropdown:Be}=b(),{dataDropdown:$e,getDropdown:Me}=b(),{dataDropdown:Ge,getDropdown:Le}=b(),{dataDropdown:Oe,getDropdown:Xe}=b();return i.useEffect(()=>{Ve("",{name:"name",id:"id",tabel:"users",idType:"string"}),Be("",{name:"name",id:"id",tabel:"purpose_types",idType:"string",softDelete:!0}),Me("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",idType:"string",isMapping:!0,hiddenZero:!0}),Le("",{name:"description",id:"mwszkz",tabel:"pajaks",idType:"string",isMapping:!0}),Xe("",{name:"purchasing_group_desc",id:"purchasing_group",tabel:"purchasing_groups",idType:"string",isMapping:!0})},[]),i.useEffect(()=>{h!=j.clone&&u=="0"&&n.setValue("request_for",(m==null?void 0:m.toString())??"")},[]),e.jsx(rt,{className:"h-[600px] w-full ",children:e.jsx(Ke,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(we),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),Te&&e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"From Request No."}),e.jsx("td",{className:"text-sm",children:le})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Request For ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(B,{fieldLabel:"",options:Re,fieldName:"request_for",isRequired:!0,disabled:u=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{ue(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussiness Trip Purpose Type",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(B,{fieldLabel:"",options:Ye,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,r)=>{await fe(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(B,{fieldLabel:"",options:$e,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Remark",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:"remark",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(tt,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:"attachment",render:({field:t})=>e.jsxs(y,{children:[e.jsx(Ue,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(S,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",multiple:!0,onChange:r=>{const a=r.target.files;if(a){const o=Array.from(a);t.onChange(o)}else t.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((r,a)=>e.jsx("span",{children:r.message},a)):n.formState.errors.attachment.message})]})})})]}),Y.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:Y.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:t.file_name},r),e.jsx("button",{type:"button",onClick:()=>Pe(t.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]},r))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Total Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[" ",e.jsx(w,{control:n.control,name:"total_destination",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(it,{value:t.value.toString(),onValueChange:xe,disabled:!1,children:[e.jsx(lt,{className:"w-[200px] py-2",children:e.jsx(ct,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(dt,{children:Array.from({length:5},(r,a)=>e.jsxs(pt,{value:(a+1).toString(),children:[" ",a+1," "]},a))})]})}),e.jsx(F,{})]})})]})]})]}),e.jsx(se,{className:"my-4"}),e.jsx(jt,{updateDestination:Se,destinationField:ye,form:n,listAllowances:L,totalDestination:n.getValues("total_destination").toString(),pajak:q,purchasingGroup:V,setTotalAllowance:qe,dataTax:Ge,dataPurchasingGroup:Oe,dataDestination:pe,type:h,btClone:j.clone,dateBusinessTripByUser:me,setSelectedDates:J,selectedDates:ge,setActiveTab:W,activeTab:je}),e.jsx(se,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(ot,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Ae(t.target.checked)})})]}),Ie&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(w,{control:n.control,name:"total_percent",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx($,{type:"number",...t,value:t.value||"",className:"w-[50%]",onChange:r=>{const a=r.target.value;if(!/^\d*$/.test(a))return;const o=parseInt(a,10);o>=1&&o<=100?t.onChange(o):a===""&&t.onChange("")}})}),e.jsx(F,{})]})}),e.jsx(w,{control:n.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx($,{value:t.value||"",readOnly:!0,className:"w-[50%] mt-3"})}),e.jsx(F,{})]})})]})]})})]}),e.jsx(bt,{onClick:async()=>await Ee(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ve&&e.jsx(nt,{workflowApproval:{approvalRequest:v.approvalRequest,approvalFrom:v.approvalFrom,acknowledgeFrom:v.acknowledgeFrom},workflowApprovalStep:v.approvalFromStatusRoute,workflowApprovalDiagram:v.approvalFrom})}),e.jsx(et,{type:"submit",loading:be,children:"submit"})]})})})};function Ia({form:k,type:oe,allowanceIndex:q,destinationIndex:R}){const{fields:V}=ne({control:k.control,name:`destinations.${R}.allowances.${q}.detail`});return e.jsx(e.Fragment,{children:V.map((h,f)=>e.jsx(w,{control:k.control,name:`destinations.${R}.allowances.${f}.detail.${f}.request_price`,render:({field:u})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx($,{value:u.value,onChange:u.onChange})}),e.jsx(F,{})]})}))})}export{Ia as AllowanceInputForm,Pa as BussinessTripFormV1};
