import{r as A,u as Se,j as e,b as Ye}from"./app-D6dSq_y1.js";/* empty css              */import{d as Te,F as j,a as g,b as f,c as v}from"./form-3KCHCGGM.js";import{u as Fe,b as K,a as Re,c as Q}from"./index.esm-BZjiq_H2.js";import{S as Ee,a as qe,b as Ve,c as Me,d as ke}from"./select-DB-TvI7Y.js";import{S as me}from"./separator-B4VfFw5r.js";import{T as Pe}from"./textarea-BYBaSw2k.js";import{I as b}from"./input-BtKq5bKF.js";import{T as Be,a as Oe,b as Ie,c as Le}from"./tabs-adzghXVy.js";import{z as o,t as Ge}from"./index-BjSRzOsg.js";import{S as Xe}from"./scroll-area-BJS8awNY.js";import{C as Je,E as Ue,G as We,b as ze}from"./api-DtjMnnyq.js";import{BusinessTripType as B}from"./models-CvSVMFY8.js";import{a as pe}from"./axiosInstance-BFed8ZjS.js";import{h as $}from"./moment-C5S46NFB.js";import{F as He}from"./formSwitchCustom-BjEn3oDy.js";import{B as ee}from"./button-Bbwlr0po.js";import{d as ue}from"./index-Ba01VVg1.js";import{W as Ze}from"./WorkflowComponent-rac62hmS.js";import{F as Ke}from"./formDropdown-Cw9SGPsX.js";import{u as xe}from"./getDropdown-Cf2aNMfi.js";import{f as O}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{B as Qe}from"./Button-DcCBd35k.js";import{C as et}from"./chevrons-up-down-BQz1IkP0.js";import"./app-DQK4SJPx.js";import"./index-iqSr5eJN.js";import"./utils-Be4s-jqX.js";import"./index-lAGIDahz.js";import"./index-B0bA9Xkv.js";import"./index-Bb4qSo10.js";import"./index-BYLJHeKm.js";import"./index-BAq02efy.js";import"./index-BdQq_4o_.js";import"./index-BhEIWPrw.js";import"./index-BniLND7a.js";import"./Combination-u8a_NUgF.js";import"./index-BgDuhhXy.js";import"./index-vVPcX5aW.js";import"./index-3qn4skLj.js";import"./index-De8voySP.js";import"./CustomStatus-tWSZFm30.js";import"./createLucideIcon-DlMdGd0M.js";import"./Switch-7prFqsD4.js";import"./createSimplePaletteValueFilter-TTGxiXax.js";import"./DefaultPropsProvider-Dh1irzis.js";import"./SwitchBase-CiZG4Nta.js";import"./FormHelperText-BI2dB5hR.js";import"./useControlled-_8L7LO-K.js";import"./createSvgIcon-FwMzqMeB.js";import"./TextField-CJVhWNf_.js";import"./useSlot-BEhBFJci.js";const tt=1*1024*1024,st=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],ds=({type:a,id:s})=>{var oe;const m=o.object({request_no:o.string().nonempty("Request for required"),remark:o.string().nonempty("Remark is required"),attachment:o.array(o.instanceof(File).refine(l=>st.includes(l.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(l=>l.size<=tt,{message:"File size must be less than 1MB"})),total_destination:o.number().int("Total Destinantion Required"),cash_advance:o.boolean().nullable().optional(),reference_number:o.string().nullable().optional(),total_percent:o.number().nullable().optional(),total_cash_advance:o.string().nullable().optional(),destinations:o.array(o.object({restricted_area:o.boolean().optional(),destination:o.string().nonempty("Destinantion Required"),business_trip_start_date:o.date().optional(),business_trip_end_date:o.date().optional(),detail_attedances:o.array(o.object({date:o.string().optional(),shift_code:o.string().optional(),shift_start:o.string().optional(),shift_end:o.string().optional(),start_time:o.string().optional(),end_time:o.string().optional(),start_date:o.string().optional(),end_date:o.string().optional(),request_start_time:o.string().optional(),request_end_time:o.string().optional()})),allowances:o.array(o.object({name:o.string().optional(),code:o.string().optional(),default_price:o.string().optional(),type:o.string().optional(),currency:o.string().optional(),subtotal:o.number().optional(),detail:o.array(o.object({date:o.string().nullish(),request_price:o.number().optional()}))})),other:o.array(o.object({value:o.number().optional()}))}))}).superRefine(({cash_advance:l,total_percent:d,attachment:r},c)=>{a===B.create&&r&&r.length===0&&c.addIssue({path:["attachment"],code:o.ZodIssueCode.too_small,minimum:1,type:"array",inclusive:!0,message:"Attachment is required"})}),i=Fe({resolver:Ge(m),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),Y=(l,d)=>{var r;return l.type==="total"?parseFloat(((r=d==null?void 0:d[0])==null?void 0:r.request_price)||0):d==null?void 0:d.reduce((c,D)=>c+parseFloat(D.request_price||0),0)},x=()=>{const l=i.getValues("destinations");i.getValues("destinations.0.other");const d=l.reduce((c,D,q)=>{const C=(D.allowances||[]).reduce((N,F,L)=>{const P=i.getValues(`destinations.${q}.allowances.${L}.detail`),Z=Y(F,P);return N+Z},0);return c+C},0);let r=0;try{r=l.reduce((c,D,q)=>{const C=(D.other||[]).reduce((N,F,L)=>{const P=i.getValues(`destinations.${q}.other.${L}.value`);return N+(P===void 0?0:P)},0);return c+C},0)}catch(c){console.log(c),r=0}return d+r},[h,t]=A.useState(!1),{showToast:S}=Se(),[w,y]=A.useState(!1),u=async l=>{var d,r;try{y(!0);const c=i.getValues("destinations"),D=re(c),q=(d=n==null?void 0:n.business_trip_destination)==null?void 0:d.some(N=>N.restricted_area===!0||N.restricted_area==="1"||N.restricted_area===1),I=x(),C=new FormData;C.append("is_restricted_area",q?"true":"false"),C.append("day",D.toString()),C.append("user_id",((r=n==null?void 0:n.request_for)==null?void 0:r.id.toString())??""),C.append("value",I.toString()),C.append("request_no",l.request_no??""),C.append("remark",l.remark??""),a===B.create?(l.attachment.forEach((N,F)=>{N&&C.append(`attachment[${F}]`,N)}),C.append("total_destination",`${l.total_destination}`),l.destinations.forEach((N,F)=>{C.append(`destinations[${F}]`,JSON.stringify(N))}),await ue.Inertia.post(Je,C,{headers:{"Content-Type":"multipart/form-data"}}),S("succesfully created data","success")):(l.attachment.forEach((N,F)=>{N&&C.append(`attachment[${F}]`,N)}),ne.forEach((N,F)=>{N&&C.append(`file_existing[${F}]`,JSON.stringify(N))}),await ue.Inertia.post(`${Ue}/${s}`,C,{headers:{"Content-Type":"multipart/form-data"}}),S("succesfully updated data","success")),setTimeout(()=>{y(!1)},1e3)}catch(c){console.log(c)}},[n,p]=A.useState(null),[_,M]=A.useState([]),[E,R]=A.useState([]),[k,J]=A.useState(!1);async function U(l){i.setValue("request_no",l||"");const d=We(l);try{const r=await pe.get(d);console.log(r.data.data,"response");const c=r.data.data;J(c.cash_advance==1),i.setValue("remark",c.remarks||""),i.setValue("total_destination",c.total_destination||1),i.setValue("cash_advance",c.cash_advance==1),i.setValue("reference_number",c.reference_number),i.setValue("total_percent",Number(c.total_percent)),i.setValue("request_no",l),i.setValue("total_cash_advance",(c==null?void 0:c.total_cash_advance)!==null?O(c.total_cash_advance,!1):"0"),p(r.data.data),R(c.destinations),H(c.total_destination),T(c.destinations)}catch(r){console.log(r)}}const[te,H]=A.useState(""),se=l=>{H(l)};function T(l){const d=l.map(r=>({destination:r.destination||"",pajak:r.pajak||"",purchasing_group:r.purchasing_group||"",business_trip_start_date:new Date(r.business_trip_start_date),business_trip_end_date:new Date(r.business_trip_end_date),allowances:r.allowances||[],detail_attedances:r.detail_attedances||[],total_allowance:r.total_allowance||0,other:r.other||[]}));i.setValue("destinations",d)}const{fields:ae,append:ct,remove:dt,update:je}=K({control:i.control,name:"destinations"});A.useEffect(()=>{},[n,te]);const[ht,ge]=A.useState(0),[fe,_e]=A.useState(!1),[W,ve]=A.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),re=l=>{const d=[];l.forEach(c=>{c.detail_attedances.forEach(D=>{D.date&&d.push(D.date),D.end_date&&d.push(D.end_date)})});const r=d.map(c=>new Date(c)).sort((c,D)=>c.getTime()-D.getTime());if(r.length===0)return 0;{const c=r[0],D=r[r.length-1];return Math.floor((D.getTime()-c.getTime())/(1e3*60*60*24))+1}},ye=async()=>{var l,d,r,c,D,q,I,C,N,F,L,P,Z,ce;try{const G=i.getValues("destinations"),Ne=re(G);console.log(G,"day");const De=(l=n==null?void 0:n.business_trip_destination)==null?void 0:l.some(z=>z.restricted_area===!0||z.restricted_area==="1"||z.restricted_area===1),de=x();if(de===0){S("Please fill the balance","error");return}const X=await pe.get("/check-approval",{params:{is_restricted_area:De,day:Ne,value:de,user_id:((d=n==null?void 0:n.request_for)==null?void 0:d.id)??"",type:"TRIP_DECLARATION"}});if(X.data.status_code===200){const z=(c=(r=X.data)==null?void 0:r.data)==null?void 0:c.approval.map(V=>(V==null?void 0:V.division_name)||null),Ce=(q=(D=X.data)==null?void 0:D.data)==null?void 0:q.approval.map(V=>(V==null?void 0:V.name)||null),he=[];(C=(I=X.data)==null?void 0:I.data)!=null&&C.hr&&he.push((L=(F=(N=X.data)==null?void 0:N.data)==null?void 0:F.hr)==null?void 0:L.name);const $e=(((P=X.data.data)==null?void 0:P.approval)??[]).map(V=>({status:"",name:V.name,dateApproved:""}));ve({approvalRequest:z,approvalFrom:Ce,acknowledgeFrom:he,approvalFromStatusRoute:$e}),_e(!0)}}catch(G){S((ce=(Z=G==null?void 0:G.response)==null?void 0:Z.data)==null?void 0:ce.message,"error")}},{dataDropdown:we,getDropdown:le}=xe();xe(),A.useEffect(()=>{le("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:B.create===a?"true":"false"})},[i.watch("destinations")]);const[ne,ie]=A.useState([]);async function be(){i.setValue("destinations",[]);const l=ze(s),d=await Ye.get(l);console.log(d.data.data,"response");const r=d.data.data;await U(r.parent_id.toString()),ie(r.attachments)}A.useEffect(()=>{s&&a===B.clone&&(le("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}),be())},[a]);const Ae=l=>{ie(d=>d.filter(r=>r.id!==l))};return e.jsx(Xe,{className:"h-[600px] w-full ",children:e.jsx(Te,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(u),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(Ke,{fieldLabel:"",options:we,fieldName:"request_no",isRequired:!0,disabled:B.create!==a,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:l=>{U(l)}})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:n.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:n.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(oe=n==null?void 0:n.cost_center)==null?void 0:oe.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(j,{control:i.control,name:"remark",render:({field:l})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(Pe,{placeholder:"Insert remark",...l,rows:4,className:"w-[300px]"})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(j,{control:i.control,name:"attachment",render:({field:l})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:d=>{const r=d.target.files;if(r){const c=Array.from(r);l.onChange(c)}else l.onChange([])}})}),i.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(i.formState.errors.attachment)?i.formState.errors.attachment.map((d,r)=>e.jsx("span",{children:d.message},r)):i.formState.errors.attachment.message})]})})})]}),ne.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ne.map((l,d)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:l.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:l.file_name},d),e.jsx("button",{type:"button",onClick:()=>Ae(l.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:i.control,name:"total_destination",render:({field:l})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(Ee,{value:te,onValueChange:se,disabled:!0,children:[e.jsx(qe,{className:"w-[200px] py-2",children:e.jsx(Ve,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Me,{children:Array.from({length:5},(d,r)=>e.jsxs(ke,{value:(r+1).toString(),children:[" ",r+1," "]},r))})]})}),e.jsx(v,{})]})})]})]})]}),e.jsx(me,{className:"my-4"}),e.jsx(at,{updateDestination:je,destinationField:ae,form:i,listAllowances:_,totalDestination:i.getValues("total_destination").toString(),setTotalAllowance:ge,businessTripDetail:n,type:a,btEdit:B.edit,setIsCashAdvance:J,isCashAdvance:k,setOtherAllowance:t,otherAllowance:h}),e.jsx(me,{className:"my-4"}),e.jsx(Qe,{onClick:async()=>await ye(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:fe&&e.jsx(Ze,{workflowApproval:{approvalRequest:W.approvalRequest,approvalFrom:W.approvalFrom,acknowledgeFrom:W.acknowledgeFrom},workflowApprovalStep:W.approvalFromStatusRoute,workflowApprovalDiagram:W.approvalFrom})}),e.jsx(ee,{type:"submit",loading:w,children:"submit"})]})})})};function at({totalDestination:a,listAllowances:s,form:m,destinationField:i,updateDestination:Y,setTotalAllowance:x,businessTripDetail:h,type:t,btEdit:S,setIsCashAdvance:w,isCashAdvance:y,setOtherAllowance:u,otherAllowance:n}){return e.jsxs(Be,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Oe,{className:"flex items-center justify-start space-x-4",children:i.map((p,_)=>e.jsxs(Ie,{value:`destination${_+1}`,children:["Destination ",_+1]}))}),i.map((p,_)=>e.jsx(nt,{listAllowances:s,updateDestination:Y,destination:p,form:m,index:_,setTotalAllowance:x,businessTripDetail:h,type:t,btEdit:B.edit,setIsCashAdvance:w,isCashAdvance:y,setOtherAllowance:u,otherAllowance:n},_))]})}function nt({form:a,index:s,destination:m,updateDestination:i,listAllowances:Y,setTotalAllowance:x,businessTripDetail:h,type:t,btEdit:S,setIsCashAdvance:w,isCashAdvance:y,setOtherAllowance:u,otherAllowance:n}){const{fields:p,update:_,append:M,remove:E}=K({control:a.control,name:`destinations[${s}].detail_attedances`}),{fields:R,update:k,append:J,remove:U,replace:te}=K({control:a.control,name:`destinations[${s}].allowances`}),H=T=>{w(T)};Re(),Q({control:a.control,name:"total_percent"});const se=h==null?void 0:h.total_cash_advance;return A.useEffect(()=>{},[se]),e.jsxs(Le,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:m.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:m==null?void 0:m.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:m==null?void 0:m.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:$(m.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:$(m.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(rt,{detailAttedanceFields:p,form:a,updateAttedanceFields:_,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(lt,{allowanceField:R,destinationIndex:s,form:a,setOtherAllowance:u,otherAllowance:n})]},s),e.jsx(ot,{allowanceField:R,destinationIndex:s,form:a,setTotalAllowance:x}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(He,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:T=>H(T.target.checked)})})]}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(j,{control:a.control,name:"reference_number",render:({field:T})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:T.value||"",onChange:ae=>T.onChange(ae.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(j,{control:a.control,name:"total_percent",render:({field:T})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{...T,value:T.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(v,{})]})}),e.jsx(j,{control:a.control,name:"total_cash_advance",render:({field:T})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:T.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(v,{})]})})]})]})]})]})]})}function rt({form:a,destinationIndex:s,detailAttedanceFields:m,updateAttedanceFields:i}){const Y=a.watch(`destinations[${s}].detail_attedances`);return A.useEffect(()=>{},[Y]),A.useEffect(()=>{},[m]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Request: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"})]}),e.jsx("tbody",{children:Y.map((x,h)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[$(x.date).format("DD/MM/YYYY"),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[x.shift_code,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.shift_code`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[x.shift_start,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.shift_start`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[x.shift_end,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.shift_end`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.request_start_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(v,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.request_start_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.request_end_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(v,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.request_end_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(v,{})]})})]})]},x.index))})]})})}),e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Declaration: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:Y.map((x,h)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[$(x.date).format("DD/MM/YYYY"),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[x.shift_code,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.shift_code`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[x.shift_start,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.shift_start`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[x.shift_end,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.shift_end`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.start_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(v,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.start_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.end_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:$(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(v,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${h}.end_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(v,{})]})})]})]},x.index))})]})})})]})}function lt({form:a,destinationIndex:s,allowanceField:m,setOtherAllowance:i,otherAllowance:Y}){const x=a.watch(`destinations[${s}].allowances`);A.useEffect(()=>{},[x]);const{fields:h,append:t,remove:S}=K({control:a.control,name:`destinations.${s}.other`}),w=Q({control:a.control,name:`destinations.${s}.other`}),y=()=>(w||[]).reduce((n,p)=>{const _=Number(p==null?void 0:p.value)||0;return isNaN(_)?n:n+_},0),u=()=>{t({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[x.map((n,p)=>e.jsx(it,{form:a,allowance:n,destinationIndex:s,allowanceIndex:p})),h.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(ee,{type:"button",className:"text-xl",onClick:u,children:"+"})})}),h.map((n,p)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:a.control,name:`destinations.${s}.other[${p}].value`,render:({field:_})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{min:"0",value:_.value??"",onChange:M=>{const E=M.target.value.trim();if(E===""){_.onChange(void 0);return}console.log(E,"value");const R=Number(E);!isNaN(R)&&R>=0&&_.onChange(R)}})}),e.jsx(v,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",O(y(),!1)]})})}),e.jsx("td",{children:e.jsx(ee,{type:"button",className:"text-xs",onClick:()=>S(p),children:"X"})})]},p))]})}function it({form:a,allowance:s,destinationIndex:m,allowanceIndex:i}){const[Y,x]=A.useState(!1);A.useState(0);const h=u=>{x(n=>!n)},t=Q({control:a.control,name:`destinations[${m}].allowances[${i}].detail[0].request_price`}),S=Q({control:a.control,name:`destinations[${m}].allowances[${i}].detail`}),w=()=>{if(s.type==="total")return parseFloat(t||0)*1;{let u=0;return S==null||S.forEach(n=>{const p=parseFloat(n.request_price||0);u+=p}),u}},y=(u,n)=>{const p=parseFloat(n),_=isNaN(p)?0:p,M=s.request_value;let E=!0;switch(M){case"unlimited":E=!0;break;case"fixed value":const R=s.default_price;_!==R&&(alert(`Please enter the fixed value of IDR ${R}`),E=!1);break;case"up to max value":const k=s.default_price;_>k&&(alert(`The value should not exceed IDR ${k}`),E=!1);break;default:E=!1}if(E){a.setValue(`destinations[${m}].allowances[${i}].detail[${u}].request_price`,_);const k=a.getValues(`destinations[${m}].allowances[${i}].detail`).reduce((J,U)=>J+(parseFloat(U.request_price)||0),0);a.setValue(`destinations[${m}].allowances[${i}].subtotal`,k)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:a.control,name:`destinations[${m}].allowances[${i}].detail[0].request_price`,render:({field:u})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:u.value,onChange:n=>y(0,n.target.value)})}),e.jsx(v,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",O(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",O(w(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>h(),children:e.jsxs(ee,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),Y&&e.jsx(e.Fragment,{children:s.detail.map((u,n)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:$(u.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(j,{control:a.control,name:`destinations[${m}].allowances[${i}].detail[${n}].request_price`,render:({field:p})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:p.value,onChange:_=>y(n,_.target.value)})}),e.jsx(v,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},u.id))})]})}function ot({allowanceField:a,destinationIndex:s,form:m,setTotalAllowance:i}){const[Y,x]=A.useState(0),h=m.watch(`destinations.${s}.other`),t=m.watch(`destinations[${s}].allowances`);A.useEffect(()=>{const w=t.reduce((u,n,p)=>{const _=m.getValues(`destinations.${s}.allowances.${p}.detail`),M=S(n,_);return u+M},0),y=(h||[]).reduce((u,n)=>{const p=Number(n==null?void 0:n.value)||0;return u+p},0);x(w+y)},[t,m.watch()]);const S=(w,y)=>{var u;return w.type==="total"?parseFloat(((u=y==null?void 0:y[0])==null?void 0:u.request_price)||0):y==null?void 0:y.reduce((n,p)=>n+parseFloat(p.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsxs("tbody",{children:[t.map((w,y)=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:O(w.subtotal)})]})]},w.id)),h.length>0&&e.jsx(e.Fragment,{children:h.map((w,y)=>e.jsxs("tr",{children:[e.jsx("td",{children:"Other Allowance"}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:w!=null&&w.value?O(w.value):"0"})]})]},y))})]}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:O(Y)})]})]})})]})})}export{it as AllowanceRowInput,at as BussinesTripDestination,nt as BussinessDestinationForm,ds as BussinessTripFormV1,lt as DetailAllowance,rt as DetailAttedances,ot as ResultTotalItem};
