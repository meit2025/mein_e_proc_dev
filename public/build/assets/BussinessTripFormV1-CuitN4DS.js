import{r as x,u as Ae,j as e,b as De}from"./app-DwTo-bcs.js";/* empty css              */import{d as Te,F as b,a as v,b as y,c as A}from"./form-AdDfAYmm.js";import{u as Se,b as Z,a as Ce,c as K}from"./index.esm-Cz0yjmW_.js";import{S as Fe,a as $e,b as Ee,c as Re,d as qe}from"./select-B4GLhLAR.js";import{S as ie}from"./separator-D6_XvV4D.js";import{T as ke}from"./textarea-COsXqq53.js";import{I as D}from"./input-upwRchQJ.js";import{T as Ve,a as Ye,b as Pe,c as Ie}from"./tabs-CTLDk-qc.js";import{z as i,t as Me}from"./index-CSSzSrDm.js";import{S as Be}from"./scroll-area-eICHPvwQ.js";import{C as Oe,E as Le,G as Ge,b as Xe}from"./api-DtjMnnyq.js";import{BusinessTripType as H}from"./models-DUZIWRXl.js";import{a as oe}from"./axiosInstance-BFPrgKR3.js";import{h as R}from"./moment-C5S46NFB.js";import{F as Je}from"./formSwitchCustom-CLirIgq-.js";import{B as Q}from"./button-DnccRgcO.js";import{d as ce}from"./index-eu6OTR6k.js";import{W as Ue}from"./WorkflowComponent-IgX6XqEP.js";import{F as We}from"./formDropdown-DJBKDZFG.js";import{u as de}from"./getDropdown-BI7hVxc5.js";import{f as B}from"./rupiahCurrencyFormat-CP-6egij.js";import{B as ze}from"./Button-ByihBQdD.js";import{C as He}from"./chevrons-up-down-BzdFftDo.js";import"./app-DQK4SJPx.js";import"./index-B32K5Uvl.js";import"./utils-C_7ErOQm.js";import"./index-CjkIVPbf.js";import"./index-Cj2jebnB.js";import"./index-Bb4qSo10.js";import"./index-CPYDYMKX.js";import"./index-zjgi0RCm.js";import"./index-qW-8SveR.js";import"./index-DMA9QUkx.js";import"./Combination-CVPnRXBt.js";import"./index-VejDH0Lc.js";import"./index-B_8NpzWa.js";import"./index-DLy_zBWo.js";import"./CustomStatus-DKb_Lghv.js";import"./createLucideIcon-B5fo3qwJ.js";import"./Switch-bRP9gqzx.js";import"./createSimplePaletteValueFilter-CM8rH-VB.js";import"./DefaultPropsProvider-DdIntrzY.js";import"./SwitchBase-C3c_RA4N.js";import"./FormHelperText-CfVHGLA7.js";import"./useControlled-B5phyitZ.js";import"./createSvgIcon-ww9L7NDx.js";import"./TextField-CIFWoQL6.js";import"./useSlot-ByOPLz5V.js";const Ze=1*1024*1024,Ke=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],rs=({type:l,id:s})=>{var re;const d=i.object({request_no:i.string().nonempty("Request for required"),remark:i.string().nonempty("Remark is required"),attachment:i.array(i.instanceof(File).refine(a=>Ke.includes(a.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(a=>a.size<=Ze,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:i.number().int("Total Destinantion Required"),cash_advance:i.boolean().nullable().optional(),reference_number:i.string().nullable().optional(),total_cash_advance:i.string().nullable().optional(),destinations:i.array(i.object({destination:i.string().nonempty("Destinantion Required"),business_trip_start_date:i.date().optional(),business_trip_end_date:i.date().optional(),detail_attedances:i.array(i.object({date:i.string().optional(),shift_code:i.string().optional(),shift_start:i.string().optional(),shift_end:i.string().optional(),start_time:i.string().optional(),end_time:i.string().optional(),request_start_time:i.string().optional(),request_end_time:i.string().optional()})),allowances:i.array(i.object({name:i.string().optional(),code:i.string().optional(),default_price:i.string().optional(),type:i.string().optional(),currency:i.string().optional(),subtotal:i.number().optional(),detail:i.array(i.object({date:i.string().nullish(),request_price:i.number().optional()}))})),other:i.array(i.object({value:i.number().optional()}))}))}),n=Se({resolver:Me(d),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),S=(a,p)=>{var t;return a.type==="total"?parseFloat(((t=p==null?void 0:p[0])==null?void 0:t.request_price)||0):p==null?void 0:p.reduce((r,w)=>r+parseFloat(w.request_price||0),0)},g=()=>{const a=n.getValues("destinations");n.getValues("destinations.0.other");const p=a.reduce((r,w,$)=>{const V=(w.allowances||[]).reduce((Y,J,P)=>{const k=n.getValues(`destinations.${$}.allowances.${P}.detail`),z=S(J,k);return Y+z},0);return r+V},0);let t=0;try{t=a.reduce((r,w,$)=>{const V=(w.other||[]).reduce((Y,J,P)=>{const k=n.getValues(`destinations.${$}.other.${P}.value`);return Y+(k===void 0?0:k)},0);return r+V},0)}catch(r){console.log(r),t=0}return p+t},[u,o]=x.useState(!1),{showToast:j}=Ae(),[_,N]=x.useState(!1),m=async a=>{var p;try{if(N(!0),l===H.create){const t=g(),r=new FormData;r.append("user_id",((p=c.request_for)==null?void 0:p.id.toString())??""),r.append("value",t.toString()),r.append("request_no",a.request_no??""),r.append("remark",a.remark??""),a.attachment.forEach((w,$)=>{w&&r.append(`attachment[${$}]`,w)}),r.append("total_destination",`${a.total_destination}`),a.destinations.forEach((w,$)=>{r.append(`destinations[${$}]`,JSON.stringify(w))}),await ce.Inertia.post(Oe,r,{headers:{"Content-Type":"multipart/form-data"}}),j("succesfully created data","success")}else{const t=new FormData;t.append("remark",a.remark??""),a.attachment.forEach((r,w)=>{r&&t.append(`attachment[${w}]`,r)}),ae.forEach((r,w)=>{r&&t.append(`file_existing[${w}]`,JSON.stringify(r))}),await ce.Inertia.post(`${Le}/${s}`,t,{headers:{"Content-Type":"multipart/form-data"}}),j("succesfully updated data","success")}setTimeout(()=>{N(!1)},1e3)}catch(t){console.log(t)}},[c,h]=x.useState([]),[f,O]=x.useState([]),[F,C]=x.useState([]),[q,L]=x.useState(!1);async function G(a){n.setValue("request_no",a||"");const p=Ge(a);try{const t=await oe.get(p),r=t.data.data;console.log(r,"businessTripData"),L(r.cash_advance==1),n.setValue("remark",r.remarks||""),n.setValue("total_destination",r.total_destination||1),n.setValue("cash_advance",r.cash_advance==1),n.setValue("reference_number",r.reference_number),n.setValue("total_percent",r.total_percent),n.setValue("total_cash_advance",B(r.total_cash_advance,!1)),h(t.data.data),C(r.destinations),U(r.total_destination),T(r.destinations)}catch(t){console.log(t)}}const[ee,U]=x.useState(""),te=a=>{U(a)};function T(a){const p=a.map(t=>({destination:t.destination||"",pajak:t.pajak||"",purchasing_group:t.purchasing_group||"",business_trip_start_date:new Date(t.business_trip_start_date),business_trip_end_date:new Date(t.business_trip_end_date),allowances:t.allowances||[],detail_attedances:t.detail_attedances||[],total_allowance:t.total_allowance||0,other:t.other||[]}));n.setValue("destinations",p)}const{fields:se,append:rt,remove:lt,update:pe}=Z({control:n.control,name:"destinations"});x.useEffect(()=>{},[c,ee]);const[it,he]=x.useState(0),[me,ue]=x.useState(!1),[X,xe]=x.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),je=async()=>{var a,p,t,r,w,$,W,V,Y,J,P,k,z;try{const I=g();if(I===0){j("Please fill the balance","error");return}const M=await oe.get("/check-approval",{params:{value:I,user_id:((a=c.request_for)==null?void 0:a.id)??"",type:"TRIP_DECLARATION"}});if(M.data.status_code===200){const ve=(t=(p=M.data)==null?void 0:p.data)==null?void 0:t.approval.map(E=>(E==null?void 0:E.division_name)||null),ye=(w=(r=M.data)==null?void 0:r.data)==null?void 0:w.approval.map(E=>(E==null?void 0:E.name)||null),le=[];(W=($=M.data)==null?void 0:$.data)!=null&&W.hr&&le.push((J=(Y=(V=M.data)==null?void 0:V.data)==null?void 0:Y.hr)==null?void 0:J.name);const Ne=(((P=M.data.data)==null?void 0:P.approval)??[]).map(E=>({status:"",name:E.name,dateApproved:""}));xe({approvalRequest:ve,approvalFrom:ye,acknowledgeFrom:le,approvalFromStatusRoute:Ne}),ue(!0)}}catch(I){j((z=(k=I==null?void 0:I.response)==null?void 0:k.data)==null?void 0:z.message,"error")}},{dataDropdown:fe,getDropdown:ge}=de(),{dataDropdown:ot,getDropdown:_e}=de();x.useEffect(()=>{ge("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[n.watch("destinations")]);const[ae,ne]=x.useState([]);async function we(){n.setValue("destinations",[]);const a=Xe(s),t=(await De.get(a)).data.data;await G(t.parent_id.toString()),ne(t.attachments)}x.useEffect(()=>{s&&l==H.clone&&(we(),_e("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[l]);const be=a=>{ne(p=>p.filter(t=>t.id!==a))};return e.jsx(Be,{className:"h-[600px] w-full ",children:e.jsx(Te,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(m),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:fe,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:a=>{G(a)}})})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:c.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:c.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(re=c==null?void 0:c.cost_center)==null?void 0:re.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(b,{control:n.control,name:"remark",render:({field:a})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(ke,{placeholder:"Insert remark",...a,rows:4,className:"w-[300px]"})}),e.jsx(A,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(b,{control:n.control,name:"attachment",render:({field:a})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:p=>{const t=p.target.files;if(t){const r=Array.from(t);a.onChange(r)}else a.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((p,t)=>e.jsx("span",{children:p.message},t)):n.formState.errors.attachment.message})]})})})]}),ae.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ae.map((a,p)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:a.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:a.file_name},p),e.jsx("button",{type:"button",onClick:()=>be(a.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(b,{control:n.control,name:"total_destination",render:({field:a})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs(Fe,{value:ee,onValueChange:te,disabled:!0,children:[e.jsx($e,{className:"w-[200px] py-2",children:e.jsx(Ee,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Re,{children:Array.from({length:5},(p,t)=>e.jsxs(qe,{value:(t+1).toString(),children:[" ",t+1," "]},t))})]})}),e.jsx(A,{})]})})]})]})]}),e.jsx(ie,{className:"my-4"}),e.jsx(Qe,{updateDestination:pe,destinationField:se,form:n,listAllowances:f,totalDestination:n.getValues("total_destination").toString(),setTotalAllowance:he,businessTripDetail:c,type:l,btEdit:H.edit,setIsCashAdvance:L,isCashAdvance:q,setOtherAllowance:o,otherAllowance:u}),e.jsx(ie,{className:"my-4"}),e.jsx(ze,{onClick:async()=>await je(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:me&&e.jsx(Ue,{workflowApproval:{approvalRequest:X.approvalRequest,approvalFrom:X.approvalFrom,acknowledgeFrom:X.acknowledgeFrom},workflowApprovalStep:X.approvalFromStatusRoute,workflowApprovalDiagram:X.approvalFrom})}),e.jsx(Q,{type:"submit",loading:_,children:"submit"})]})})})};function Qe({totalDestination:l,listAllowances:s,form:d,destinationField:n,updateDestination:S,setTotalAllowance:g,businessTripDetail:u,type:o,btEdit:j,setIsCashAdvance:_,isCashAdvance:N,setOtherAllowance:m,otherAllowance:c}){return e.jsxs(Ve,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ye,{className:"flex items-center justify-start space-x-4",children:n.map((h,f)=>e.jsxs(Pe,{value:`destination${f+1}`,children:["Destination ",f+1]}))}),n.map((h,f)=>e.jsx(et,{listAllowances:s,updateDestination:S,destination:h,form:d,index:f,setTotalAllowance:g,businessTripDetail:u,type:o,btEdit:H.edit,setIsCashAdvance:_,isCashAdvance:N,setOtherAllowance:m,otherAllowance:c}))]})}function et({form:l,index:s,destination:d,updateDestination:n,listAllowances:S,setTotalAllowance:g,businessTripDetail:u,type:o,btEdit:j,setIsCashAdvance:_,isCashAdvance:N,setOtherAllowance:m,otherAllowance:c}){const{fields:h,update:f,append:O,remove:F}=Z({control:l.control,name:`destinations[${s}].detail_attedances`}),{fields:C,update:q,append:L,remove:G,replace:ee}=Z({control:l.control,name:`destinations[${s}].allowances`}),U=T=>{_(T)};Ce(),K({control:l.control,name:"total_percent"});const te=u.total_cash_advance;return x.useEffect(()=>{},[te]),e.jsxs(Ie,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:d.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:d==null?void 0:d.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:d==null?void 0:d.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:R(d.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:R(d.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(tt,{detailAttedanceFields:h,form:l,updateAttedanceFields:f,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(st,{allowanceField:C,destinationIndex:s,form:l,setOtherAllowance:m,otherAllowance:c})]},s),e.jsx(nt,{allowanceField:C,destinationIndex:s,form:l,setTotalAllowance:g}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Je,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:T=>U(T.target.checked)})})]}),N&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(b,{control:l.control,name:"reference_number",render:({field:T})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{value:T.value||"",onChange:se=>T.onChange(se.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(A,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(b,{control:l.control,name:"total_percent",render:({field:T})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{...T,value:T.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(A,{})]})}),e.jsx(b,{control:l.control,name:"total_cash_advance",render:({field:T})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{value:T.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(A,{})]})})]})]})]})]})]})}function tt({form:l,destinationIndex:s,detailAttedanceFields:d,updateAttedanceFields:n}){const S=l.watch(`destinations[${s}].detail_attedances`);return x.useEffect(()=>{},[S]),x.useEffect(()=>{},[d]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:S.map((g,u)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[R(g.date).format("DD/MM/YYYY"),e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.date`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsxs("td",{children:[g.shift_code,e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.shift_code`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsxs("td",{children:[g.shift_start,e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.shift_start`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsxs("td",{children:[g.shift_end,e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.shift_end`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:R(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsx("td",{children:e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.start_time`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})}),e.jsx("td",{children:e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.end_time`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})}),e.jsx("td",{children:e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.request_start_time`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})}),e.jsx("td",{children:e.jsx(b,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.request_end_time`,render:({field:o})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})})]},g.index))})]})})})]})}function st({form:l,destinationIndex:s,allowanceField:d,setOtherAllowance:n,otherAllowance:S}){const g=l.watch(`destinations[${s}].allowances`);x.useEffect(()=>{},[g]);const{fields:u,append:o,remove:j}=Z({control:l.control,name:`destinations.${s}.other`}),_=K({control:l.control,name:`destinations.${s}.other`}),N=()=>(_||[]).reduce((c,h)=>{const f=Number((h==null?void 0:h.value)||0);return c+f},0),m=()=>{o({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[g.map((c,h)=>e.jsx(at,{form:l,allowance:c,destinationIndex:s,allowanceIndex:h})),u.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(Q,{type:"button",className:"text-xl",onClick:m,children:"+"})})}),u.map((c,h)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{control:l.control,name:`destinations.${s}.other[${h}].value`,render:({field:f})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{min:"0",value:f.value??"",onChange:O=>{const F=O.target.value;if(F===""){f.onChange(void 0);return}const C=Math.max(0,Number(F));f.onChange(C)}})}),e.jsx(A,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",B(N(),!1)]})})}),e.jsx("td",{children:e.jsx(Q,{type:"button",className:"text-xs",onClick:()=>j(h),children:"X"})})]},h))]})}function at({form:l,allowance:s,destinationIndex:d,allowanceIndex:n}){const[S,g]=x.useState(!1);x.useState(0);const u=m=>{g(c=>!c)},o=K({control:l.control,name:`destinations[${d}].allowances[${n}].detail[0].request_price`}),j=K({control:l.control,name:`destinations[${d}].allowances[${n}].detail`}),_=()=>{if(s.type==="total")return parseFloat(o||0)*1;{let m=0;return j==null||j.forEach(c=>{const h=parseFloat(c.request_price||0);m+=h}),m}},N=(m,c)=>{const h=parseFloat(c),f=isNaN(h)?0:h,O=s.request_value;let F=!0;switch(O){case"unlimited":F=!0;break;case"fixed value":const C=s.subtotal;f!==C&&(alert(`Please enter the fixed value of IDR ${C}`),F=!1);break;case"up to max value":const q=s.subtotal;f>q&&(alert(`The value should not exceed IDR ${q}`),F=!1);break;default:F=!1}if(F){l.setValue(`destinations[${d}].allowances[${n}].detail[${m}].request_price`,f);const C=l.getValues(`destinations[${d}].allowances[${n}].detail`);console.log(C,"details");const q=C.reduce((L,G)=>L+(parseFloat(G.request_price)||0),0);l.setValue(`destinations[${d}].allowances[${n}].subtotal`,q)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{control:l.control,name:`destinations[${d}].allowances[${n}].detail[0].request_price`,render:({field:m})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{value:m.value,onChange:c=>N(0,c.target.value)})}),e.jsx(A,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",B(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",B(_(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>u(),children:e.jsxs(Q,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),S&&e.jsx(e.Fragment,{children:s.detail.map((m,c)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:R(m.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(b,{control:l.control,name:`destinations[${d}].allowances[${n}].detail[${c}].request_price`,render:({field:h})=>e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(D,{value:h.value,onChange:f=>N(c,f.target.value)})}),e.jsx(A,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},m.id))})]})}function nt({allowanceField:l,destinationIndex:s,form:d,setTotalAllowance:n}){const[S,g]=x.useState(0),u=d.watch(`destinations[${s}].allowances`);x.useEffect(()=>{const j=u.reduce((_,N,m)=>{const c=d.getValues(`destinations.${s}.allowances.${m}.detail`),h=o(N,c);return _+h},0);g(j)},[u,d.watch()]);const o=(j,_)=>{var N;return j.type==="total"?parseFloat(((N=_==null?void 0:_[0])==null?void 0:N.request_price)||0):_==null?void 0:_.reduce((m,c)=>m+parseFloat(c.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:u.map((j,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:j.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:B(j.subtotal)})]})]},j.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:B(S)})]})]})})]})})}export{at as AllowanceRowInput,Qe as BussinesTripDestination,et as BussinessDestinationForm,rs as BussinessTripFormV1,st as DetailAllowance,tt as DetailAttedances,nt as ResultTotalItem};
