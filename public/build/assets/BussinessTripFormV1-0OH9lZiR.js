import{u as O,r as w,j as e}from"./app-ySnIjE8D.js";/* empty css              */import{F as G,a as j,b as u,c as g,d as f,e as W}from"./form-D4Exn2UR.js";import{u as U,b as F,a as z,c as q}from"./index.esm-C8wTv4Ti.js";import{S as M,a as B,b as I,c as P,d as L}from"./select-Bap3EkS0.js";import{S as H}from"./separator-De88C_0g.js";import{T as J}from"./textarea-2SrhIFSn.js";import{I as v}from"./input-BZYb72DI.js";import{T as K,a as Q,b as Z,c as ee}from"./tabs-uvJ4nMO-.js";import{z as n,t as te}from"./index-6Hir6SiA.js";import{S as se}from"./scroll-area-DgifY02Z.js";import{C as ae,G as ne}from"./api-BzUwn5yu.js";import{a as le}from"./axiosInstance-BC0OhrCm.js";import{h as $}from"./moment-C5S46NFB.js";import{B as R}from"./button-E5c0S4Af.js";import{d as re}from"./index-BcxigRMg.js";import{C as ie}from"./chevrons-up-down-CJXoJ3Gu.js";import"./app-HlhieNAw.js";import"./utils-DCxhhQGX.js";import"./index-BRAsP6NI.js";import"./index-DSU5tDx2.js";import"./index-BZM3ott2.js";import"./Combination-BanHX9_q.js";import"./index-QbDqtRj5.js";import"./index-BQXhlZbJ.js";import"./index-D2XJ0LqA.js";import"./index-Ckn8CRxD.js";import"./createLucideIcon-Cz-QHqyT.js";const Pe=({listBusinessTrip:l})=>{var k;const t=n.object({request_no:n.string().nonempty("Request for required"),remark:n.string().nonempty("Remark is required"),attachment:n.instanceof(File).nullable().optional(),total_destination:n.number().int("Total Destinantion Required"),destinations:n.array(n.object({destination:n.string().nonempty("Destinantion Required"),business_trip_start_date:n.date().optional(),business_trip_end_date:n.date().optional(),detail_attedances:n.array(n.object({date:n.string().optional(),shift_code:n.string().optional(),shift_start:n.string().optional(),shift_end:n.string().optional(),start_time:n.string().optional(),end_time:n.string().optional(),request_start_time:n.string().optional(),request_end_time:n.string().optional()})),allowances:n.array(n.object({name:n.string().optional(),code:n.string().optional(),default_price:n.string().optional(),type:n.string().optional(),currency:n.string().optional(),subtotal:n.number().optional(),detail:n.array(n.object({date:n.string().nullish(),request_price:n.string().optional()}))})),other:n.array(n.object({value:n.number().optional()}))}))}),s=U({resolver:te(t),defaultValues:{request_no:"",remark:"",attachment:null,total_destination:1,destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),{showToast:x}=O(),p=async d=>{console.log(d," valuesnya");try{const h=new FormData;h.append("request_no",d.request_no??""),h.append("remark",d.remark??""),h.append("attachment",d.attachment??""),h.append("total_destination",`${d.total_destination}`),d.destinations.forEach((o,y)=>{h.append(`destinations[${y}]`,JSON.stringify(o))}),await re.Inertia.post(ae,h,{headers:{"Content-Type":"multipart/form-data"}}),x("succesfully created data","success")}catch(h){console.log(h)}},[r,i]=w.useState([]),[a,_]=w.useState([]),[S,N]=w.useState([]);async function c(d){s.setValue("request_no",d||"");const h=ne(d);try{const o=await le.get(h),y=o.data.data;console.log(y," Response Detail Business Trip"),s.setValue("remark",y.remarks||""),s.setValue("total_destination",y.total_destination||1),i(o.data.data),N(y.destinations),b(y.total_destination),Y(y.destinations)}catch(o){console.log(o)}}const[m,b]=w.useState(""),A=d=>{b(d)};console.log(r,"businessTripDetail");function Y(d){const h=d.map(o=>({destination:o.destination||"",pajak:o.pajak||"",purchasing_group:o.purchasing_group||"",business_trip_start_date:new Date(o.business_trip_start_date),business_trip_end_date:new Date(o.business_trip_end_date),allowances:o.allowances||[],detail_attedances:o.detail_attedances||[],total_allowance:o.total_allowance||0,other:o.other||[]}));s.setValue("destinations",h)}const{fields:D,append:T,remove:C,update:V}=F({control:s.control,name:"destinations"});w.useEffect(()=>{},[r,m]);const[E,X]=w.useState(0);return e.jsx(se,{className:"h-[600px] w-full ",children:e.jsx(G,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(p),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(j,{control:s.control,name:"request_no",render:({field:d})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(M,{onValueChange:h=>c(h),value:d.value,children:[e.jsx(B,{className:"w-[200px] py-2",children:e.jsx(I,{placeholder:"-- Select One --"})}),e.jsx(P,{children:l.map(h=>e.jsx(L,{value:h.id.toString(),children:h.request_no}))})]})}),e.jsx(f,{})]})})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:r.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:r.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(k=r==null?void 0:r.cost_center)==null?void 0:k.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(j,{control:s.control,name:"remark",render:({field:d})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(J,{placeholder:"Insert remark",...d,rows:4,className:"w-[300px]"})}),e.jsx(f,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(j,{control:s.control,name:"attachment",render:({field:d})=>e.jsxs(u,{children:[e.jsx(W,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(g,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:h=>{var y;const o=(y=h.target.files)==null?void 0:y[0];o?d.onChange(o):d.onChange(null)}})}),e.jsx(f,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"Not Availabe"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:s.control,name:"total_destination",render:({field:d})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(M,{value:m,onValueChange:A,disabled:!0,children:[e.jsx(B,{className:"w-[200px] py-2",children:e.jsx(I,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(P,{children:Array.from({length:5},(h,o)=>e.jsxs(L,{value:(o+1).toString(),children:[" ",o+1," "]}))})]})}),e.jsx(f,{})]})})]})]})]}),e.jsx(H,{className:"my-4"}),e.jsx(ce,{updateDestination:V,destinationField:D,form:s,listAllowances:a,totalDestination:s.getValues("total_destination").toString(),setTotalAllowance:X,businessTripDetail:r}),e.jsx(R,{type:"submit",children:"submit"})]})})})};function ce({totalDestination:l,listAllowances:t,form:s,destinationField:x,updateDestination:p,setTotalAllowance:r,businessTripDetail:i}){return e.jsxs(K,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Q,{className:"flex items-center justify-start space-x-4",children:x.map((a,_)=>e.jsxs(Z,{value:`destination${_+1}`,children:["Destination ",_+1]}))}),x.map((a,_)=>e.jsx(oe,{listAllowances:t,updateDestination:p,destination:a,form:s,index:_,setTotalAllowance:r,businessTripDetail:i}))]})}function oe({form:l,index:t,destination:s,updateDestination:x,listAllowances:p,setTotalAllowance:r,businessTripDetail:i}){const{fields:a,update:_,append:S,remove:N}=F({control:l.control,name:`destinations[${t}].detail_attedances`}),{fields:c,update:m,append:b,remove:A,replace:Y}=F({control:l.control,name:`destinations[${t}].allowances`});w.useState(!1);const{setValue:D}=z(),T=q({control:l.control,name:"total_percent"}),C=i.total_cash_advance;return w.useEffect(()=>{const E=parseFloat(T||0)/100*C;D("total_cash_advance",E.toFixed(2))},[T,C,D]),e.jsxs(ee,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:s.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:s==null?void 0:s.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:s==null?void 0:s.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:$(s.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:$(s.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(de,{detailAttedanceFields:a,form:l,updateAttedanceFields:_,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(xe,{allowanceField:c,destinationIndex:t,form:l})]},t),e.jsx("table",{className:"w-full text-sm mt-10",children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[20%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[80%] flex",children:C})]})})]})}function Le({allowanceField:l,destinationIndex:t,form:s,setTotalAllowance:x}){const p=s.watch(`destinations[${t}].allowances`),r=s.watch(`destinations[${t}].total_allowance`);return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:p.map((i,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:i.subtotal})]})]},i.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:r})]})]})})]})})}function de({form:l,destinationIndex:t,detailAttedanceFields:s,updateAttedanceFields:x}){const p=l.watch(`destinations[${t}].detail_attedances`);return w.useEffect(()=>{},[p]),w.useEffect(()=>{},[s]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:p.map((r,i)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[$(r.date).format("DD/MM/YYYY"),e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.date`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(a.value).format("YYYY-MM-DD"),onChange:a.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[r.shift_code,e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.shift_code`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(a.value).format("YYYY-MM-DD"),onChange:a.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[r.shift_start,e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.shift_start`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(a.value).format("YYYY-MM-DD"),onChange:a.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[r.shift_end,e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.shift_end`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:$(a.value).format("YYYY-MM-DD"),onChange:a.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsx("td",{children:e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.start_time`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:a.value,onChange:a.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.end_time`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:a.value,onChange:a.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.request_start_time`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:a.value,onChange:a.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(j,{control:l.control,name:`destinations.${t}.detail_attedances.${i}.request_end_time`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{defaultValue:a.value,onChange:a.onChange})}),e.jsx(f,{})]})})})]},r.index))})]})})})]})}function xe({form:l,destinationIndex:t,allowanceField:s}){const x=l.watch(`destinations[${t}].allowances`);console.log("detailAllowanceceWatch",x),w.useEffect(()=>{},[x]);const{fields:p,append:r,remove:i}=F({control:l.control,name:`destinations.${t}.other`}),a=q({control:l.control,name:`destinations.${t}.other`}),_=()=>(a||[]).reduce((N,c)=>{const m=Number((c==null?void 0:c.value)||0);return N+m},0),S=()=>{r({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[x.map((N,c)=>e.jsx(he,{form:l,allowance:N,destinationIndex:t,allowanceIndex:c})),p.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(R,{type:"button",className:"text-xl",onClick:S,children:"+"})})}),p.map((N,c)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:l.control,name:`destinations.${t}.other[${c}].value`,render:({field:m})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{type:"number",value:m.value??"",onChange:b=>{const A=b.target.value===""?void 0:Number(b.target.value);m.onChange(A)}})}),e.jsx(f,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",_()]})})}),e.jsx("td",{children:e.jsx(R,{type:"button",className:"text-xs",onClick:()=>i(c),children:"X"})})]},c))]})}function he({form:l,allowance:t,destinationIndex:s,allowanceIndex:x}){const[p,r]=w.useState(!1);w.useState(0);const i=c=>{r(m=>!m)},a=q({control:l.control,name:`destinations[${s}].allowances[${x}].detail[0].request_price`}),_=q({control:l.control,name:`destinations[${s}].allowances[${x}].detail`}),S=()=>{if(t.type==="total")return parseFloat(a||0)*1;{let c=0;return _==null||_.forEach(m=>{const b=parseFloat(m.request_price||0);c+=b}),c}},N=(c,m)=>{const b=parseFloat(m),A=isNaN(b)?0:b,Y=t.request_value;let D=!0;switch(Y){case"unlimited":D=!0;break;case"fixed value":const T=t.subtotal;A!==T&&(alert(`Please enter the fixed value of IDR ${T}`),D=!1);break;case"up to max value":const C=t.subtotal;A>C&&(alert(`The value should not exceed IDR ${C}`),D=!1);break;default:D=!1}D&&l.setValue(`destinations[${s}].allowances[${x}].detail[${c}].request_price`,A)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:l.control,name:`destinations[${s}].allowances[${x}].detail[0].request_price`,render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:c.value,onChange:m=>N(0,m.target.value)})}),e.jsx(f,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",S()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>i(),children:e.jsxs(R,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),p&&e.jsx(e.Fragment,{children:t.detail.map((c,m)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:$(c.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(j,{control:l.control,name:`destinations[${s}].allowances[${x}].detail[${m}].request_price`,render:({field:b})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:b.value,onChange:A=>N(m,A.target.value)})}),e.jsx(f,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},c.id))})]})}function Xe({form:l,type:t,allowanceIndex:s,destinationIndex:x}){const{fields:p}=F({control:l.control,name:`destinations.${x}.allowances.${s}.detail`});return e.jsx(e.Fragment,{children:p.map((r,i)=>e.jsx(j,{control:l.control,name:`destinations.${x}.allowances.${i}.detail.${i}.request_price`,render:({field:a})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{value:a.value,onChange:a.onChange})}),e.jsx(f,{})]})}))})}export{Xe as AllowanceInputForm,he as AllowanceRowInput,ce as BussinesTripDestination,oe as BussinessDestinationForm,Pe as BussinessTripFormV1,xe as DetailAllowance,de as DetailAttedances,Le as ResultTotalItem};
