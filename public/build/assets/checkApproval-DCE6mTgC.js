import{b as L,r as u,u as q,j as o}from"./app-DA5imrGk.js";import{a as I}from"./axiosInstance-yfPjZDc9.js";import{L as V}from"./Loading-BChyHC5C.js";import{W as O}from"./WorkflowComponent-D8dJs6f0.js";import{F as b}from"./formDropdown-C1BsIW1r.js";import{u as W}from"./getDropdown-GccK3BYV.js";import{a as B}from"./index.esm-CqB6mZlD.js";import{B as H}from"./Button-DnM7tOXo.js";import"./app-DQK4SJPx.js";import"./index-DWwZojQS.js";import"./createSvgIcon-DJoR_bt_.js";import"./DefaultPropsProvider-DwLuDV76.js";import"./extends-CF3RwP-h.js";import"./createLucideIcon-DuRGkbtJ.js";import"./TextField-DkU-iRwL.js";import"./useSlot-BMTFeJjp.js";import"./createSimplePaletteValueFilter-Bqusc7aU.js";import"./useControlled-BwJ0GIeG.js";import"./FormHelperText-CBQLVqrH.js";const{Axios:me,AxiosError:M,CanceledError:ce,isCancel:de,CancelToken:ve,VERSION:fe,all:_e,Cancel:he,isAxiosError:ge,spread:we,toFormData:xe,AxiosHeaders:Ae,HttpStatusCode:ye,formToJSON:Fe,getAdapter:be,mergeConfig:ke}=L,Se=({isDisabled:U})=>{const{getValues:c,watch:d,setValue:k}=B(),[S,r]=u.useState(!1),[C,v]=u.useState(!1),[t,j]=u.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),{dataDropdown:N,getDropdown:R}=W(),{showToast:a}=q(),E=d("document_type"),D=d("metode_approval"),T=async()=>{var f,_,h,g,w,x,A;try{const e=c(),n=c("vendors").filter(p=>(p.winner||!1)===!0),s=n.length>0?n[0]:null;if(s==null){r(!1),a("Please Select Vendor Winner","error");return}const y=((s==null?void 0:s.units)||[]).reduce((p,m)=>p+m.total_amount,0);if(k("total_all_amount",y),e.document_type===null||e.document_type===void 0){r(!1),a("Please input Document Type","error");return}if(e.purchasing_groups===null||e.purchasing_groups===void 0){r(!1),a("Please input purchasing group","error");return}if(e.total_all_amount===null||e.total_all_amount===void 0){r(!1),a("Please input Item","error");return}if(e.user_id===null||e.user_id===void 0){r(!1),a("Please input Item","error");return}if(e.document_type==="ZENT"){if(e.metode_approval===null||e.metode_approval===void 0){r(!1),a("Please select metode approval","error");return}if(e.metode_approval==="chooses_approval"&&(e.chooses_approval_id===null||e.chooses_approval_id===void 0)){r(!1),a("Please select chooses approval","error");return}}const i=await I.get("/check-approval",{params:{document_type_id:e.document_type,purchasing_group_id:e.purchasing_groups,value:y,user_id:e.user_id,type:"PR",metode_approval:e.metode_approval,chooses_approval_id:e.chooses_approval_id}});if(i.data.status_code===200){const p=(_=(f=i.data)==null?void 0:f.data)==null?void 0:_.approval_route.map(l=>{var F;return((F=l.user.divisions)==null?void 0:F.name)||null}),m=(g=(h=i.data)==null?void 0:h.data)==null?void 0:g.approval_route.map(l=>l.user.name),P=(((x=(w=i.data)==null?void 0:w.data)==null?void 0:x.approval_route)??[]).map(l=>({status:"",name:l.user.name,dateApproved:""}));j({approvalRequest:p,approvalFrom:m,acknowledgeFrom:[],approvalFromStatusRoute:P}),v(!0)}r(!1)}catch(e){if(r(!1),v(!1),e instanceof M&&e.response){const n=((A=e.response.data)==null?void 0:A.message)||"An unexpected error occurred";a(n,"error")}else e instanceof Error?a(e.message,"error"):a("An unexpected error occurred","error")}};return u.useEffect(()=>{R("",{name:"name",id:"id",tabel:"approval_tracking_number_chooses"})},[]),o.jsx(o.Fragment,{children:o.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[o.jsx(V,{isLoading:S}),o.jsxs("div",{className:"card-body",children:[o.jsx("div",{className:"flex justify-start mt-4 mb-2",children:o.jsx(H,{onClick:async()=>await T(),variant:"contained",color:"primary",type:"button",children:"Check Approval"})}),E==="ZENT"&&o.jsxs(o.Fragment,{children:[o.jsx(b,{options:[{label:"Approval",value:"approval"},{label:"Chooses Approval Tracking Number",value:"chooses_approval"},{label:"Automatic Approval Tracking Number",value:"automatic_approval_by_purchasing_group"}],fieldLabel:"Metode Approval",fieldName:"metode_approval",disabled:!1,style:{width:"58.5rem"},placeholder:"Metode Approval",classNames:"mt-2"}),D==="chooses_approval"&&o.jsx(b,{options:N,fieldLabel:"Select Chooses approval",fieldName:"chooses_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2"})]}),C&&o.jsx(O,{workflowApproval:{approvalRequest:t.approvalRequest,approvalFrom:t.approvalFrom,acknowledgeFrom:t.acknowledgeFrom},workflowApprovalStep:t.approvalFromStatusRoute,workflowApprovalDiagram:t.approvalFrom})]})]})})};export{Se as default};
