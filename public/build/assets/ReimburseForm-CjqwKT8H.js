import{j as e,r as k,u as tt,q as st}from"./app-5H0Die1W.js";import{B as at}from"./button-Dsr2JJXE.js";import{h as G}from"./moment-C5S46NFB.js";import{z as p,t as rt}from"./index-CdQOqXWH.js";import{f as H}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as nt,F as v,a as D,b as N,c as S,f as ot,e as lt}from"./form-BKpyM0b9.js";import{u as it,b as ct}from"./index.esm-aaalzsiv.js";import{T as Se}from"./textarea-BsAnHKEw.js";/* empty css                  */import{S as mt}from"./scroll-area-C07uoKmP.js";import{a as Y}from"./axiosInstance-CjADaL-M.js";import{S as Fe}from"./separator-CcVXNmkS.js";import{T as dt,a as ut,b as pt,c as ht}from"./tabs-ChxN3zXJ.js";import{S as W,a as Z,b as J,c as K,d as X}from"./select-BkvaGXh3.js";import{F as ce}from"./formDropdown-CcIwe8Q3.js";import{C as Ce}from"./CustomDatePicker-BUfhJHmW.js";import{I as Ie}from"./input-CjP_0wAs.js";import{ReimburseFormType as b}from"./listModel-CCqLNed3.js";import{u as Q}from"./getDropdown-DkKNRlRV.js";import{G as ft,a as qe,b as gt}from"./api-DXF7erOJ.js";import{L as _t}from"./LoadingSpin-BeJaBOiB.js";import{W as jt}from"./WorkflowComponent--gNOAHL1.js";import{C as bt}from"./CustomStatus-BjchYQHL.js";import{F as Te}from"./FormHelperText-CdzS1yZ2.js";import{B as xt}from"./Button-DPtgzsA9.js";import"./app-DQK4SJPx.js";import"./index-BhnZgQXx.js";import"./index-Bb4qSo10.js";import"./utils-BDb1SZJl.js";import"./createLucideIcon-4Wsw4oBM.js";import"./index-CeBiynaU.js";import"./index-rsnVIP9O.js";import"./index-Baqx2b1v.js";import"./index-COBYTt1n.js";import"./index-BjvAr8Or.js";import"./index-BdQq_4o_.js";import"./index-BVIxOBx_.js";import"./index-CRAfxAIu.js";import"./index-BGFDHFbT.js";import"./index-Bv2JkKHi.js";import"./index-BDJipaY3.js";import"./Combination-6K5SpBEG.js";import"./index-JPR1rCMp.js";import"./TextField-EJlIa8RA.js";import"./createSvgIcon-DxUADPjL.js";import"./DefaultPropsProvider-qQr80kfA.js";import"./useSlot-4eDXAfvw.js";import"./createSimplePaletteValueFilter-CsJMUHu4.js";import"./useControlled-Xm4YLVwg.js";function yt({isLoading:me=!1,children:de}){return e.jsx("div",{className:"",children:me?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(_t,{})})}):de})}const _s=({onSuccess:me,currencies:de,taxDefaultValue:je,uomDefaultValue:be,edit_url:Ee,update_url:ke,store_url:Re,type:f,currentUser:R})=>{const[xe,Le]=k.useState("form1"),{showToast:C}=tt();st().props;const{dataDropdown:U,getDropdown:ee}=Q(ft);Q();const{dataDropdown:Me,getDropdown:Ve}=Q(),{dataDropdown:te,getDropdown:se}=Q("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:ae,getDropdown:re}=Q("api/master/cost-center/dropdown-list"),[P,ue]=k.useState([]),[Ye,pe]=k.useState([]),[I,$e]=k.useState(!1),[ye,Ae]=k.useState(!1),[Be,ne]=k.useState(!1),[g,$]=k.useState([]),[O,Pe]=k.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ge=1*1024*1024,Oe=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],ze=p.object({formCount:p.string().min(1,"total form must be have value"),remark_group:p.string().min(1,"header remark is required"),cost_center:p.string().min(1,"cost center required"),requester:p.string().min(1,"requester required"),value:p.number().optional(),user_id:p.string().optional(),forms:p.array(p.object({reimburseId:p.string().optional(),for:p.string().optional(),group:p.string().optional(),reimburse_type:p.string().min(1,"reimburse type is required"),short_text:p.string().min(1,"remarks is required"),balance:p.string(),remaining_balance_when_request:p.number(),currency:p.string().min(1,"currency required"),tax_on_sales:p.string().min(1,"tax required"),purchase_requisition_unit_of_measure:p.string().min(1,"uom required"),purchasing_group:p.string().min(1,"Purchasing Group required"),type:p.any(),item_delivery_data:p.date(),claim_date:p.date(),attachment:p.array(p.instanceof(File).refine(t=>Oe.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=Ge,{message:"File size must be less than 1MB"})).min(f===b.create?1:0,"Attachment is required")}))});k.useEffect(()=>{(async()=>{var r,c;(f===b.edit||f===b.clone)&&(ne(!0),await He()),Ve("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});let s=parseInt(xe.split("form")[1])-1;se("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(r=a.getValues("forms")[s])!=null&&r.purchasing_group?"id":"",value:((c=a.getValues("forms")[s])==null?void 0:c.purchasing_group)??""}}),re("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:a.getValues("cost_center")?"id":"",value:a.getValues("cost_center")??""}}),ee("",{name:"name",id:"nip",tabel:"users",hasValue:{key:a.getValues("requester")?"nip":"",value:a.getValues("requester")??""}}),a.getValues("requester")!==""&&f===b.create&&z(0)})()},[f]);async function He(){a.setValue("forms",[]),ne(!0);try{const t=await Y.get(Ee??""),s=t.data.data.group,r=t.data.data.forms;$e(s.reimbursementStatus);const c=r.map(i=>({reimburseId:String(i.id),for:String(i.for),group:String(i.group),reimburse_type:i.reimburse_type.code,short_text:i.short_text,balance:f===b.edit?i.balance:"",currency:i.currency,tax_on_sales:String(i.tax_on_sales),purchase_requisition_unit_of_measure:String(i.purchase_requisition_unit_of_measure),purchasing_group:String(i.purchasing_group),type:i.type,item_delivery_data:new Date(i.item_delivery_data),claim_date:new Date(i.claim_date),attachment:[]}));a.setValue("formCount",r.length.toString()),a.setValue("remark_group",s.remark),a.setValue("cost_center",String(s.cost_center.id)),a.setValue("requester",s.requester);let m=0;for(const i of r)await z(m,{reimburse_type:i.reimburse_type.code}),await we(m,{type:i.type,reimburse_type:i.reimburse_type.code}),await fe(m,{reimburse_type:i.reimburse_type.code,for:i.reimburse_type.is_employee===1?null:i.for}),m++;a.setValue("forms",c),ne(!1)}catch{ne(!1)}}const We={formCount:"1",remark_group:"",cost_center:"",requester:String(R==null?void 0:R.is_admin)==="1"?"":R==null?void 0:R.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:je,purchase_requisition_unit_of_measure:be,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},a=it({resolver:rt(ze),defaultValues:We}),{fields:he,update:_}=ct({control:a.control,name:"forms"}),z=async(t,s=null)=>{const r=a.getValues("requester");if(r===null||r===""){ue(m=>{const i=[...m];return i[t]=[],i});return}const c=await Y.get(qe,{params:{user:r,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});ue(m=>{const i=[...m];return i[t]=c.data.data,i})},Ze=async(t,s)=>{if(t&&t.length>0)try{const r=await Y.get(qe,{params:{search:t,user:a.getValues("requester")}});ue(c=>{const m=[...c];return m[s]=r.data.data,m})}catch(r){console.error("Error searching reimburse types:",r)}},we=async(t,s)=>{const r=await Y.get(gt,{params:{user:a.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});pe(c=>{const m=[...c];return m[t]=r.data.data,m})},Je=t=>{for(let s=0;s<he.length;s++)z(s);if(t==null)for(let s=0;s<he.length;s++)a.setValue(`forms.${s}.reimburse_type`,""),a.setValue(`forms.${s}.for`,"");$([]),pe([])};function Ke(t){const s=[...a.getValues("forms")];for(let r=0;r<parseInt(t);r++)if(r+1>s.length){z(r);const c={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:je,purchase_requisition_unit_of_measure:be,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(c)}a.setValue("forms",s)}const ve=t=>{Le(t)},Xe=async t=>{var r,c,m,i,h;if(g)for(let d=0;d<g.length;d++){if(t.forms.length==0||t.forms.length-1,((r=g[d])==null?void 0:r.type_limit)!=="Unlimited"&&parseInt((c=g[d])==null?void 0:c.limit)==0){C("Claim Limit for form "+(d+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[d].balance==""||parseInt(t.forms[d].balance)==0){C("Claim Balance for form "+(d+1)+" cannot be 0","error");return}if(parseInt(((m=g[d])==null?void 0:m.balance)??0)<parseInt(t.forms[d].balance??0)){C("Please check your balance input for forms "+(d+1)+"  is not must be above "+((i=g[d])==null?void 0:i.balance),"error");return}t.forms=t.forms.map((w,q)=>{var T;return{...w,claim_date:G(w.claim_date).format("YYYY-MM-DD"),item_delivery_data:G(w.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:parseInt(((T=g[q])==null?void 0:T.balance)??0)}})}const s=t.forms.reduce((d,w)=>d+parseInt(w.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let d;f===b.edit?d=await Y.put(ke??"",t,{headers:{"Content-Type":"multipart/form-data"}}):d=await Y.post(Re??"",t,{headers:{"Content-Type":"multipart/form-data"}}),C((h=d==null?void 0:d.data)==null?void 0:h.data,"success"),me()}catch{}};async function fe(t,s=null){var m,i;const r=a.getValues(`forms.${t}`),c={user:a.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:r.reimburse_type,for:s!=null?s.for:r.for};try{const h=await Y.get("reimburse/data-limit-and-balance",{params:c});$(d=>{const q=a.getValues("forms").filter((x,L)=>L!==t&&x.reimburse_type===r.reimburse_type),T=q.reduce((x,L)=>x+parseInt(L.balance)||0,0),V=[...d];return V[t]={...h.data.data,balance:h.data.data.balance-T,limit:h.data.data.type_limit=="Unlimited"?h.data.data.type_limit:Math.max(0,h.data.data.limit-q.length)},V})}catch(h){C((i=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:i.message,"error")}}const De=async()=>{var t,s,r,c,m,i,h,d,w,q,T,V;try{const x=a.getValues("forms"),L=x.map((y,E)=>({index:E,value:y.balance?parseInt(y.balance):0}));if(L.some(y=>y.value===0)){const y=L.findIndex(E=>E.value===0);C(`Please fill the balance for form ${y+1}`,"error");return}const oe=x.reduce((y,E)=>y+(parseInt(E.balance)||0),0),M=await Y.get("/check-approval",{params:{value:oe,requester:a.getValues("requester"),type:"REIM"}});if(M.data.status_code===200){const y=(s=(t=M.data)==null?void 0:t.data)==null?void 0:s.approval.map(l=>(l==null?void 0:l.division_name)||null),E=(c=(r=M.data)==null?void 0:r.data)==null?void 0:c.approval.map(l=>(l==null?void 0:l.name)||null),o=[];(i=(m=M.data)==null?void 0:m.data)!=null&&i.hr&&o.push((w=(d=(h=M.data)==null?void 0:h.data)==null?void 0:d.hr)==null?void 0:w.name);const n=(((q=M.data.data)==null?void 0:q.approval)??[]).map(l=>({status:"",name:l.name,dateApproved:""}));Pe({approvalRequest:y,approvalFrom:E,acknowledgeFrom:o,approvalFromStatusRoute:n}),Ae(!0)}}catch(x){C((V=(T=x==null?void 0:x.response)==null?void 0:T.data)==null?void 0:V.message,"error")}};k.useEffect(()=>{a.getValues("forms").reduce((r,c)=>r+parseInt(c.balance)||0,0)>0&&ye===!0&&De()},[a.watch("forms"),a.watch("requester")]);const Qe=t=>{const s=t;if(Object.keys(s).length>0){let r=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>       
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([c,m])=>{c==="forms"?m.forEach((i,h)=>{r+=`</br><strong>Form ${h+1}:</strong></br>`,Object.values(i).forEach(d=>{r+=`<li>${d.message}</li>`})}):r+=`<li>${m.message}</li>`}),r+="</ul>",C(e.jsx("div",{dangerouslySetInnerHTML:{__html:r}}),"error")}};return e.jsx(mt,{className:"h-[600px] w-full",children:e.jsx(yt,{isLoading:Be,children:e.jsx(nt,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(Xe,t=>{Qe(t)}),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:I&&e.jsx(bt,{name:I==null?void 0:I.name,className:I==null?void 0:I.classname,code:I==null?void 0:I.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:"remark_group",render:({field:t})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Se,{placeholder:"Insert remark",...t})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(ce,{fieldLabel:"",options:ae,fieldName:"cost_center",disabled:f===b.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=ae==null?void 0:ae.some(r=>r.label===t);t.length>0&&!s?await re(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&re("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{let t=a.getValues("cost_center");re("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(ce,{options:U,fieldName:"requester",disabled:String(R==null?void 0:R.is_admin)==="0"||f===b.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const r=U==null?void 0:U.some(c=>c.label===t);t.length>0&&!r?ee(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!r&&ee("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>Je(t),onFocus:()=>{let t=a.getValues("requester");ee("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:f===b.edit,onValueChange:r=>{t.onChange(r),Ke(r),ve(`form${parseInt(r)}`);const c=a.getValues("forms");if(c.length>parseInt(r)){const m=c.slice(0,parseInt(r));a.setValue("forms",m),$(i=>{let h=[...i];return h=h.slice(0,parseInt(r)),h})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"Select number of forms"})}),e.jsx(K,{children:Array.from({length:3},(r,c)=>c+1).map(r=>e.jsx(X,{value:r.toString(),children:r},r))})]})}),e.jsx(S,{})]})}})})]})]})}),e.jsx(Fe,{className:"my-4"}),e.jsxs(dt,{value:xe,onValueChange:ve,className:"w-full",children:[e.jsxs(ut,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((t,s)=>e.jsxs(pt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),he.map((t,s)=>{var r,c,m,i,h,d,w,q,T,V,x,L,ge,oe,M,y,E;return e.jsxs(ht,{value:`form${s+1}`,children:[e.jsx(v,{control:a.control,name:`forms.${s}.reimburseId`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ie,{className:"sr-only",value:t.reimburseId,onChange:o.onChange})}),e.jsx(S,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(ce,{options:P[s],fieldName:`forms.${s}.reimburse_type`,disabled:a.getValues("requester")==""||f===b.edit,placeholder:"Select Reimburse Type",onSearch:async o=>{var u;((u=P[s])==null?void 0:u.some(l=>l.label===o))||await Ze(o,s)},onChangeOutside:async o=>{if(o){let n=P[s].filter(u=>u.value==o)[0];_(s,{...t,reimburse_type:o,type:n.is_employee===1?"Employee":"Family"}),n.is_employee===1?fe(s,{reimburse_type:o,for:null}):($(u=>{const l=[...u];return l[s]=[],l}),a.setValue(`forms.${s}.balance`,""),we(s,{type:"Family",reimburse_type:o}))}else{$(u=>{const l=[...u];return l[s]=[],l}),_(s,{...t,balance:""}),a.setValue(`forms.${s}.for`,""),pe(u=>{const l=[...u];return l[s]=[],l});const n=a.getValues("forms");n.forEach((u,l)=>{var F,j;if(l>s&&n[l].reimburse_type===t.reimburse_type){const le=((F=g[l])==null?void 0:F.balance)||0,Ne=((j=g[l])==null?void 0:j.limit)||0;$(ie=>{var B;const A=[...ie];return A[l]={...A[l],balance:le+parseInt(t.balance||"0")},((B=g[l])==null?void 0:B.type_limit)!=="Unlimited"&&(A[l]={...A[l],limit:Ne+1}),A}),a.setValue(`forms.${l}.balance`,"")}})}},onFocus:()=>{z(s)},classNames:"mt-2 w-full"}),((m=(c=(r=a.formState.errors)==null?void 0:r.forms)==null?void 0:c[s])==null?void 0:m.reimburse_type)&&e.jsx(Te,{error:!0,children:(w=(d=(h=(i=a.formState.errors)==null?void 0:i.forms)==null?void 0:h[s])==null?void 0:d.reimburse_type)==null?void 0:w.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${s}.for`,render:({field:o})=>{var n,u,l,F;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:((l=(u=(n=P==null?void 0:P[s])==null?void 0:n.filter(j=>(j==null?void 0:j.value)==a.getValues(`forms.${s}.reimburse_type`)))==null?void 0:u[0])==null?void 0:l.is_employee)===1||f===b.edit,onValueChange:j=>{_(s,{...t,for:j}),fe(s,{reimburse_type:a.getValues(`forms.${s}.reimburse_type`),for:j})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(F=Ye[s])==null?void 0:F.map(j=>e.jsx(X,{value:j.value.toString(),children:j.label},j.value))})]})}),e.jsx(S,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(ce,{fieldLabel:"",options:te,fieldName:`forms.${s}.purchasing_group`,disabled:f===b.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:o=>{const n=te==null?void 0:te.some(u=>u.label===o);o.length>0&&!n?se(o,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:o}):o.length==0&&!n&&se("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:o=>{o&&_(s,{...t,purchasing_group:o})},onFocus:()=>{var n;let o=(n=a.getValues("forms")[s])==null?void 0:n.purchasing_group;se("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:o?"id":"",value:o??""}})}}),((V=(T=(q=a.formState.errors)==null?void 0:q.forms)==null?void 0:T[s])==null?void 0:V.purchasing_group)&&e.jsx(Te,{error:!0,children:(oe=(ge=(L=(x=a.formState.errors)==null?void 0:x.forms)==null?void 0:L[s])==null?void 0:ge.purchasing_group)==null?void 0:oe.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${s}.tax_on_sales`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:!0,onValueChange:n=>{_(s,{...t,tax_on_sales:n})},defaultValue:t.tax_on_sales,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(Me??[]).map((n,u)=>e.jsxs(X,{value:n.value.toString(),children:[n.description," - ",n.label]},n.value))})]})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:!0,onValueChange:n=>{_(s,{...t,purchase_requisition_unit_of_measure:String(n)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:e.jsx(X,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${s}.short_text`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Se,{placeholder:"Insert remark",onChange:n=>{_(s,{...t,short_text:n.target.value})},defaultValue:t.short_text})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((M=g[s])==null?void 0:M.balance)&&H((y=g[s])==null?void 0:y.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(E=g[s])==null?void 0:E.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${s}.item_delivery_data`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ce,{disabled:f===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:n=>{G(n).format("YYYY-MM-DD")>=G(new Date).format("YYYY-MM-DD")?(o.onChange(n),_(s,{...t,item_delivery_data:n})):(o.onChange(o.value),_(s,{...t,item_delivery_data:o.value}),C("Receipt date cannot be less than today","error"))}})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${s}.claim_date`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ce,{disabled:f===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:n=>{G(n).format("YYYY-MM-DD")>=G(new Date).format("YYYY-MM-DD")?(o.onChange(n),_(s,{...t,claim_date:n})):(o.onChange(o.value),_(s,{...t,claim_date:o.value}),C("Claim date cannot be less than today","error"))}})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(v,{control:a.control,name:`forms.${s}.currency`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:f===b.edit,onValueChange:n=>{_(s,{...t,currency:n})},defaultValue:t.currency,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:de.map(n=>e.jsxs(X,{value:n.code,children:[n.name," (",n.code,")"]},n.code))})]})}),e.jsx(ot,{className:"h-6"}),e.jsx(S,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(v,{control:a.control,name:`forms.${s}.balance`,render:({field:o})=>{var n;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ie,{type:"text",placeholder:"0",onChange:u=>{var ie;const l=u.target.value.replace(/[^0-9]/g,""),F=H(l,!1),j=parseInt(l)||0,le=((ie=g[s])==null?void 0:ie.balance)||0;if(j>le){u.target.value=H(l.slice(0,-1),!1);return}_(s,{...t,balance:l}),u.target.value=F,a.getValues("forms").forEach((A,B)=>{if(B>s&&A.reimburse_type===t.reimburse_type){const Ue=le-j;$(et=>{const _e=[...et];return _e[B]={..._e[B],balance:Ue},_e}),_(B,{...t,balance:""})}})},defaultValue:H(t.balance,!1),value:H(t.balance,!1),disabled:typeof g[s]>"u"||((n=g[s])==null?void 0:n.length)===0||f===b.edit})}),e.jsx(S,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(v,{control:a.control,name:`forms.${s}.attachment`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(lt,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(N,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:n=>{const u=n.target.files;if(u){const l=[...t.attachment],F=Array.from(u);l.push(...F),_(s,{...t,attachment:l})}}})}),e.jsx(S,{})]})}),e.jsx("div",{className:"mt-2",children:t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((o,n)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsx("button",{type:"button",className:"text-red-500 ml-2",onClick:()=>{const u=t.attachment.filter((l,F)=>F!==n);_(s,{...t,attachment:u})},children:"Delete"})]},n))})})]})]})]})})})]},s)})]}),e.jsx(xt,{onClick:async()=>await De(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ye&&e.jsx(jt,{workflowApproval:{approvalRequest:O.approvalRequest,approvalFrom:O.approvalFrom,acknowledgeFrom:O.acknowledgeFrom},workflowApprovalStep:O.approvalFromStatusRoute,workflowApprovalDiagram:O.approvalFrom})}),e.jsx(Fe,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(at,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{_s as ReimburseForm};
