import{r as f,u as ne,q as oe,j as e}from"./app-DWu1jApy.js";import{B as le}from"./button-CyKCT6wu.js";import{F as ce,a as l,b as c,c as d,d as i}from"./form-CnTsyk_s.js";import{u as de}from"./index.esm-Dyw1BQkh.js";import{T as $}from"./textarea-Cj2YKoxf.js";/* empty css                  */import{S as ie}from"./scroll-area-NiJLTAqt.js";import{a as _}from"./axiosInstance-CbJa867x.js";import{S as F}from"./separator-CIaaE9Kt.js";import{T as he,a as me,b as xe,c as je}from"./tabs-BtI383Vd.js";import{S as m,a as x,b as j,c as u,d as p}from"./select-Dc4fprd_.js";import{C as D}from"./CustomDatePicker-92_uNTEh.js";import{I as R}from"./input-CbCUQ6Fh.js";import{F as ue}from"./utils-BGKRosPI.js";import{u as pe}from"./getDropdown-5hN0hWPZ.js";import"./app-CTy9eNAz.js";import"./index-D8Sgy2iv.js";import"./index-DL9yo46i.js";import"./index-kE90aCLc.js";import"./index-CQlMNBWq.js";import"./index-BWTc_D1k.js";import"./index-CBA3OMIY.js";import"./index-DWGHnBSz.js";import"./Combination-Df9QIHAc.js";import"./index-u6R7JbrK.js";import"./createLucideIcon-DokpAUWF.js";const He=({onSuccess:v,purchasing_groups:T,currencies:E,categories:k,periods:q,users:A,taxes:I,cost_center:B,edit_url:L,update_url:ge,store_url:P,type:U})=>{const[z,G]=f.useState("form1"),{showToast:y}=ne();oe().props;const[fe,M]=f.useState(1),[S,O]=f.useState([]),[w,H]=f.useState([[]]),[_e,J]=f.useState(),[K,Q]=f.useState([]),[C,W]=f.useState([[]]),{dataDropdown:X,getDropdown:Y}=pe(),a=de({defaultValues:{formCount:"1",remark_group:"",cost_center:"",requester:"",forms:Array.from({length:1}).map(()=>({id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:0,currency:"IDR",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date}))}}),Z=o=>{M(o);const s=a.getValues("forms"),n=Array.from({length:o}).map((h,t)=>s[t]||{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:0,currency:"IDR",tax_on_sales:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date});a.setValue("forms",n),a.setValue("formCount",o.toString())};async function ee(){try{const s=(await _.get(L)).data.data[0];a.setValue("remark_group",s.remark),a.setValue("cost_center",s.cost_center),a.setValue("requester",s.users.nip),a.setValue("formCount",s.reimburses.length.toString()),a.setValue("forms",s.reimburses.map(n=>({id:n.id,for:n.for,group:n.group,reimburse_type:n.reimburse_type,short_text:n.short_text,balance:Number(n.balance),currency:n.currency,tax_on_sales:n.tax_on_sales,purchasing_group:n.purchasing_group,period:n.period,type:n.type,item_delivery_data:new Date(n.item_delivery_data),start_date:new Date(n.start_date),end_date:new Date(n.end_date)}))),s.reimburses.forEach((n,h)=>{N(h,n.reimburse_type)})}catch(o){y(o,"error")}}f.useEffect(()=>{U===ue.edit&&ee()}),f.useEffect(()=>{Y("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms"})},[]);const se=async o=>{try{const n=(await _.get(`/family/show/${o}`)).data;Q(n),J(o),a.setValue("requester",o)}catch(s){const h=s.response.data;y(h.message,"error")}},re=o=>{G(o)};async function N(o,s){try{const h=(await _.get(`reimburse/type/${s}`??"")).data.data;H(t=>{const r=[...t];return r[o]=h,r}),W(t=>{const r=[...t];return r[o]=s==="Family",r}),a.setValue(`forms.${o}.type`,s)}catch(n){const t=n.response.data;y(t.message,"error")}}const te=async(o,s,n,h,t)=>{const g=(await _.post("/reimburse/is_required",{user:s,is_employee:n,type:h,period:t})).data.data;O(b=>{const V=[...b];return V[o]={plafon:g==null?void 0:g.plafon,limit:g==null?void 0:g.limit},V}),a.setValue(`forms.${o}.for`,s)},ae=async o=>{try{await _.post(P??"",o),y("succesfully created data","success"),v==null||v(!0)}catch{}};return e.jsx(ie,{className:"h-[600px] w-full",children:e.jsx(ce,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(ae),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("td",{width:200,children:"Reimburse Request No."})}),e.jsx("tr",{children:e.jsx("td",{width:200,children:"Request Status"})}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:"remark_group",render:({field:o})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx($,{placeholder:"Insert remark",...o})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:"cost_center",render:({field:o})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:s=>o.onChange(s),value:o.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:B.map(s=>e.jsx(p,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:"requester",render:({field:o})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:s=>se(s),value:o.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"Requester"})}),e.jsx(u,{children:A.map(s=>e.jsxs(p,{value:s.nip,children:[s.name," [",s.nip,"]"]},s.nip))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:"formCount",render:({field:o})=>{var s;return e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:n=>Z(n),value:(s=o.value)==null?void 0:s.toString(),children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"Select number of forms"})}),e.jsx(u,{children:Array.from({length:20},(n,h)=>h+1).map(n=>e.jsx(p,{value:n.toString(),children:n},n))})]})}),e.jsx(i,{})]})}})})]})]})}),e.jsx(F,{className:"my-4"}),e.jsxs(he,{value:z,onValueChange:re,className:"w-full",children:[e.jsxs(me,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((o,s)=>e.jsxs(xe,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),Array.from({length:a.watch("formCount")||1}).map((o,s)=>{var n,h;return e.jsxs(je,{value:`form${s+1}`,children:[e.jsx(l,{control:a.control,name:`forms.${s}.id`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(R,{className:"sr-only",value:t.value,onChange:t.onChange})}),e.jsx(i,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(l,{control:a.control,name:`forms.${s}.type`,render:({field:t})=>e.jsxs(m,{onValueChange:r=>N(s,r),value:t.value,children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Select type"})}),e.jsx(u,{children:k.map(r=>e.jsx(p,{value:r,children:r},r))})]})}),e.jsx(l,{control:a.control,name:`forms.${s}.reimburse_type`,render:({field:t})=>e.jsxs(m,{disabled:!w[s]||w[s].length===0,onValueChange:r=>a.setValue(`forms.${s}.reimburse_type`,r),value:t.value,children:[e.jsx(x,{children:e.jsx(j,{placeholder:"Select detail"})}),e.jsx(u,{children:w[s]&&w[s].map(r=>e.jsx(p,{value:r.code,children:r.name},r.code))})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.purchasing_group`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:T.map(r=>e.jsxs(p,{value:r.id.toString(),children:[r.purchasing_group_desc," - ",r.purchasing_group]},r.id))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.period`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:q.map(r=>e.jsxs(p,{value:r.code,children:[r.start," - ",r.end," (",r.code,")"]},r.code))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.for`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{disabled:!C[s]||C[s].length===0,onValueChange:r=>te(s,r,!C[s],a.getValues(`forms.${s}.reimburse_type`),a.getValues(`forms.${s}.period`)),value:t.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:K.map(r=>e.jsx(p,{value:r.id.toString(),children:r.name},r.id))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Tax"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.tax_on_sales`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:I.map(r=>e.jsx(p,{value:r.id.toString(),children:r.mwszkz},r.id))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Uom"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.uom`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:(X??[]).map((r,g)=>e.jsx(p,{value:r.value.toString(),children:r.label},r.value))})]})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.short_text`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx($,{placeholder:"Insert remark",...t})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsx("td",{children:(n=S[s])==null?void 0:n.plafon})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Limit per claim"}),e.jsx("td",{children:(h=S[s])==null?void 0:h.limit})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.item_delivery_data`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(D,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(i,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(l,{control:a.control,name:`forms.${s}.start_date`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(D,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(i,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(l,{control:a.control,name:`forms.${s}.end_date`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(D,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(i,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(l,{control:a.control,name:`forms.${s}.currency`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs(m,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(x,{className:"w-[200px]",children:e.jsx(j,{placeholder:"-"})}),e.jsx(u,{children:E.map(r=>e.jsxs(p,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(i,{})]})}),e.jsx(l,{control:a.control,name:`forms.${s}.balance`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(R,{type:"number",placeholder:"0.0",...t,onChange:r=>t.onChange(Number(r.target.value)),value:t.value||0})}),e.jsx(i,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(l,{control:a.control,name:`forms.${s}.attachment`,render:({field:t})=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:r=>{const g=r.target.files;if(g){const b=Array.from(g);t.onChange(b)}}})}),e.jsx(i,{})]})})})]})]})})})]},s)})]}),e.jsx(F,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(le,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{He as ReimburseForm};
