import{r as _,j as e}from"./app-BnmUwhWw.js";/* empty css              */import{F as W,a as j,b as u,c as f,d as g,e as H}from"./form-BoRG5OxW.js";import{u as J,b as E,a as K,c as V}from"./index.esm-DO0QSKbU.js";import{S as q,a as M,b as I,c as k,d as B}from"./select-Ytu7zxOF.js";import{S as Q}from"./separator-BvFL-baG.js";import{T as Z}from"./textarea-Bvm58tOb.js";import{I as N}from"./input-BkyJkoVe.js";import{T as ee,a as te,b as se,c as ne}from"./tabs-7PD1moLr.js";import{z as a,t as ae}from"./index-Dsm-CSwv.js";import{S as le}from"./scroll-area-Dc4My1dF.js";import{a as ie}from"./axiosInstance-Cxz19zcI.js";import{h as A,C as re}from"./moment-Cn8EX0-0.js";import{B as P}from"./button-DNUxuwVj.js";import{d as oe}from"./index-Ds1syxLm.js";const R="/api/business-trip-declaration",Se=`${R}/list`,de=`${R}/create`,ce=s=>`${R}/detail/${s}`,Fe=`${R}/delete`,xe=({listBusinessTrip:s})=>{const t=a.object({request_no:a.string().min(1,"Request for required"),remark:a.string().min(1,"Remark is required"),attachment:a.instanceof(File).nullable().optional(),total_destination:a.number().min(1,"Total Destinantion Required"),destinations:a.array(a.object({destination:a.string().min(1,"Destinantion Required"),business_trip_start_date:a.date().optional(),business_trip_end_date:a.date().optional(),detail_attedances:a.array(a.object({date:a.string().optional(),shift_code:a.string().optional(),shift_start:a.string().optional(),shift_end:a.string().optional(),start_time:a.string().optional(),end_time:a.string().optional()})),allowances:a.array(a.object({name:a.string().optional(),code:a.string().optional(),type:a.string().optional(),subtotal:a.string().optional(),detail:a.array(a.object({date:a.string().nullish(),request_price:a.any().optional()}))}))}))}),n=J({resolver:ae(t),defaultValues:{request_no:"",remark:"",attachment:null,total_destination:1,destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[]}]}}),c=async i=>{console.log(i," data");try{const r=new FormData;r.append("request_no",i.request_no??""),r.append("remark",i.remark??""),r.append("attachment",i.attachment??""),r.append("total_destination",`${i.total_destination}`),i.destinations.forEach((d,b)=>{r.append(`destinations[${b}]`,JSON.stringify(d))}),await oe.Inertia.post(de,r,{headers:{"Content-Type":"multipart/form-data"}}),me("succesfully created data","success"),S==null||S(!0)}catch(r){const d=r;S==null||S(),console.log(d)}},[h,x]=_.useState([]),[o,l]=_.useState([]),[F,T]=_.useState([]);async function C(i){n.setValue("request_no",i||"");const r=ce(i);try{const d=await ie.get(r),b=d.data.data;n.setValue("remark",b.remarks||""),x(d.data.data),T(b.destinations),console.log(b," businessTripData"),console.log(b.destinations," businessTripData.destinations"),p(b.total_destination),w(b.destinations)}catch(d){console.log(d)}}const[m,p]=_.useState(""),D=i=>{p(i)};function w(i){const r=i.map(d=>({destination:d.destination||"",business_trip_start_date:new Date(d.business_trip_start_date),business_trip_end_date:new Date(d.business_trip_end_date),allowances:d.allowances||[],detail_attedances:d.detail_attedances||[]}));console.log(r," destinationForm"),n.setValue("destinations",r)}const{fields:v,append:y,remove:Y,update:$}=E({control:n.control,name:"destinations"});return _.useEffect(()=>{},[h,m]),e.jsx(le,{className:"h-[600px] w-full ",children:e.jsx(W,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(c),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(j,{control:n.control,name:"request_no",render:({field:i})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(q,{onValueChange:r=>C(r),value:i.value,children:[e.jsx(M,{className:"w-[200px] py-2",children:e.jsx(I,{placeholder:"-- Select One --"})}),e.jsx(k,{children:s.map(r=>e.jsx(B,{value:r.id.toString(),children:r.request_no}))})]})}),e.jsx(g,{})]})})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:h.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:h.name_request})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(j,{control:n.control,name:"remark",render:({field:i})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(Z,{placeholder:"Insert remark",...i,rows:4,className:"w-[300px]"})}),e.jsx(g,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(j,{control:n.control,name:"attachment",render:({field:i})=>e.jsxs(u,{children:[e.jsx(H,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(f,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:r=>{var b;const d=(b=r.target.files)==null?void 0:b[0];d?i.onChange(d):i.onChange(null)}})}),e.jsx(g,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"Not Availabe"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:n.control,name:"total_destination",render:({field:i})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs(q,{value:m,onValueChange:D,children:[e.jsx(M,{className:"w-[200px] py-2",children:e.jsx(I,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(k,{children:Array.from({length:5},(r,d)=>e.jsxs(B,{value:(d+1).toString(),children:[" ",d+1," "]}))})]})}),e.jsx(g,{})]})})]})]})]}),e.jsx(Q,{className:"my-4"}),e.jsx(L,{updateDestination:$,destinationField:v,form:n,listAllowances:o,totalDestination:n.getValues("total_destination").toString()}),e.jsx(P,{type:"submit",children:"submit"})]})})})};function L({totalDestination:s,listAllowances:t,form:n,destinationField:c,updateDestination:h}){return e.jsxs(ee,{defaultValue:"destination1",className:"w-full",children:[e.jsx(te,{className:"flex items-center justify-start space-x-4",children:c.map((x,o)=>e.jsxs(se,{value:`destination${o+1}`,children:["Destination ",o+1]}))}),c.map((x,o)=>e.jsx(O,{listAllowances:t,updateDestination:h,destination:x,form:n,index:o}))]})}function O({form:s,index:t,destination:n,updateDestination:c,listAllowances:h}){const{fields:x,update:o,append:l,remove:F}=E({control:s.control,name:`destinations[${t}].detail_attedances`}),{fields:T,update:C,append:m,remove:p,replace:D}=E({control:s.control,name:`destinations[${t}].allowances`});_.useState(!1);const{setValue:w}=K(),v=V({control:s.control,name:"total_percent"}),y=1e6;return _.useEffect(()=>{const $=parseFloat(v||0)/100*y;w("total_cash_advance",$.toFixed(2))},[v,y,w]),console.log(n,"destinationxxxx"),e.jsxs(ne,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:n.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:A(n.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:A(n.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(U,{detailAttedanceFields:x,form:s,updateAttedanceFields:o,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(G,{allowanceField:T,destinationIndex:t,form:s}),e.jsx("table",{className:"w-full text-sm mt-10",children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[20%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[80%] flex"})]})})]},t),e.jsx(X,{allowanceField:T})]})}function X({allowanceField:s}){return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:s.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{})]})]},t.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{})]})]})})]})})}function U({form:s,destinationIndex:t,detailAttedanceFields:n,updateAttedanceFields:c}){const h=s.watch(`destinations[${t}].detail_attedances`);return _.useEffect(()=>{},[h]),_.useEffect(()=>{console.log(n," Detail Attedance fields")},[n]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:h.map((x,o)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[A(x.date).format("DD/MM/YYYY"),e.jsx(j,{control:s.control,name:`destinations.${t}.detail_attedances.${o}.date`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{defaultValue:A(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(j,{control:s.control,name:`destinations.${t}.detail_attedances.${o}.shift_code`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{defaultValue:A(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(j,{control:s.control,name:`destinations.${t}.detail_attedances.${o}.shift_start`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{defaultValue:A(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(j,{control:s.control,name:`destinations.${t}.detail_attedances.${o}.shift_end`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{defaultValue:A(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsx("td",{children:e.jsx(j,{control:s.control,name:`destinations.${t}.detail_attedances.${o}.start_time`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{defaultValue:l.value,onChange:l.onChange})}),e.jsx(g,{})]})})}),e.jsx("td",{children:e.jsx(j,{control:s.control,name:`destinations.${t}.detail_attedances.${o}.end_time`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{defaultValue:l.value,onChange:l.onChange})}),e.jsx(g,{})]})})})]},x.index))})]})})})]})}function G({form:s,destinationIndex:t,allowanceField:n}){const c=s.watch(`destinations[${t}].allowances`);return _.useEffect(()=>{},[c]),e.jsx("table",{className:"w-full allowance-table",children:c.map((h,x)=>e.jsx(z,{form:s,allowance:h,destinationIndex:t,allowanceIndex:x}))})}function z({form:s,allowance:t,destinationIndex:n,allowanceIndex:c}){const[h,x]=_.useState(!1);_.useState(0);const o=m=>{x(p=>!p)},l=V({control:s.control,name:`destinations[${n}].allowances[${c}].detail[0].request_price`}),F=V({control:s.control,name:`destinations[${n}].allowances[${c}].detail`}),T=()=>{if(t.type==="total")return parseFloat(l||0)*1;{let m=0;return F==null||F.forEach(p=>{const D=parseFloat(p.request_price||0);m+=D}),m}},C=(m,p)=>{const D=parseFloat(p),w=isNaN(D)?0:D,v=t.request_value;let y=!0;switch(console.log(v),v){case"unlimited":y=!0;break;case"fixed value":const Y=t.subtotal;w!==Y&&(alert(`Please enter the fixed value of IDR ${Y}`),y=!1);break;case"up to max value":const $=t.subtotal;w>$&&(alert(`The value should not exceed IDR ${$}`),y=!1);break;default:y=!1}y&&s.setValue(`destinations[${n}].allowances[${c}].detail[${m}].request_price`,w)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:s.control,name:`destinations[${n}].allowances[${c}].detail[0].request_price`,render:({field:m})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{value:m.value,onChange:p=>C(0,p.target.value)})}),e.jsx(g,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",T()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>o(),children:e.jsxs(P,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),h&&e.jsx(e.Fragment,{children:t.detail.map((m,p)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:A(m.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(j,{control:s.control,name:`destinations[${n}].allowances[${c}].detail[${p}].request_price`,render:({field:D})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{value:D.value,onChange:w=>C(p,w.target.value)})}),e.jsx(g,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},m.id))})]})}function he({form:s,type:t,allowanceIndex:n,destinationIndex:c}){const{fields:h}=E({control:s.control,name:`destinations.${c}.allowances.${n}.detail`});return e.jsx(e.Fragment,{children:h.map((x,o)=>e.jsx(j,{control:s.control,name:`destinations.${c}.allowances.${o}.detail.${o}.request_price`,render:({field:l})=>e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(N,{value:l.value,onChange:l.onChange})}),e.jsx(g,{})]})}))})}function me(s,t){throw new Error("Function not implemented.")}function S(s){throw new Error("Function not implemented.")}const Ce=Object.freeze(Object.defineProperty({__proto__:null,AllowanceInputForm:he,AllowanceRowInput:z,BussinesTripDestination:L,BussinessDestinationForm:O,BussinessTripFormV1:xe,DetailAllowance:G,DetailAttedances:U,ResultTotalItem:X},Symbol.toStringTag,{value:"Module"}));export{xe as B,Fe as D,Se as G,Ce as a};
