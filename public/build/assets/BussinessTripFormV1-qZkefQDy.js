import{r as j,j as e}from"./app-DNuiccyu.js";/* empty css              */import{F as O,a as u,b as f,c as g,d as _,e as U}from"./form-BFacE67e.js";import{u as W,b as R,a as H,c as q}from"./index.esm-BcJX4rF5.js";import{S as I,a as B,b as P,c as L,d as X}from"./select-Dy9DsFSZ.js";import{S as J}from"./separator-cPnQUmYX.js";import{T as K}from"./textarea-C2glZBZ_.js";import{I as N}from"./input-B47TkicD.js";import{T as Q,a as Z,b as ee,c as te}from"./tabs-C6oZImh0.js";import{z as i,t as se}from"./zod-D9eZXHnj.js";import{S as ae}from"./scroll-area-Bn5SUfz7.js";import{C as ne,G as le}from"./api-UdznVawo.js";import{a as ie}from"./axiosInstance-D0MU2t6I.js";import{h as $,C as re}from"./moment-CGyasSJ5.js";import{B as z}from"./button-D8tf04qm.js";import{d as de}from"./index-DsszJLLj.js";import"./app-CTy9eNAz.js";import"./index-BkbGbtK4.js";import"./index-DEnZETA_.js";import"./index-CA_XpnUd.js";import"./index-Bsjqh-qZ.js";import"./Combination-jYzjnSHQ.js";import"./index-DRSGIQuX.js";import"./index-BnY2o-Bx.js";import"./index-CkYonrDW.js";import"./index-DxuuIrXu.js";import"./createLucideIcon-Bi1dVcSg.js";const Xe=({listBusinessTrip:s})=>{var E,M,k;const t=i.object({request_no:i.string().min(1,"Request for required"),remark:i.string().min(1,"Remark is required"),attachment:i.instanceof(File).nullable().optional(),total_destination:i.number().min(1,"Total Destinantion Required"),destinations:i.array(i.object({destination:i.string().min(1,"Destinantion Required"),business_trip_start_date:i.date().optional(),business_trip_end_date:i.date().optional(),detail_attedances:i.array(i.object({date:i.string().optional(),shift_code:i.string().optional(),shift_start:i.string().optional(),shift_end:i.string().optional(),start_time:i.string().optional(),end_time:i.string().optional()})),allowances:i.array(i.object({name:i.string().optional(),code:i.string().optional(),type:i.string().optional(),subtotal:i.string().optional(),detail:i.array(i.object({date:i.string().nullish(),request_price:i.any().optional()}))}))}))}),a=W({resolver:se(t),defaultValues:{request_no:"",remark:"",attachment:null,total_destination:1,destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[]}]}}),c=async d=>{try{const o=new FormData;o.append("request_no",d.request_no??""),o.append("remark",d.remark??""),o.append("attachment",d.attachment??""),o.append("total_destination",`${d.total_destination}`),d.destinations.forEach((r,b)=>{o.append(`destinations[${b}]`,JSON.stringify(r))}),await de.Inertia.post(ne,o,{headers:{"Content-Type":"multipart/form-data"}}),je("succesfully created data","success"),F==null||F(!0)}catch(o){const r=o;F==null||F(),console.log(r)}},[n,x]=j.useState([]),[h,l]=j.useState([]),[w,T]=j.useState([]);async function S(d){a.setValue("request_no",d||"");const o=le(d);try{const r=await ie.get(o),b=r.data.data;a.setValue("remark",b.remarks||""),a.setValue("total_destination",b.total_destination||1),x(r.data.data),T(b.destinations),p(b.total_destination),v(b.destinations)}catch(r){console.log(r)}}const[m,p]=j.useState(""),y=d=>{p(d)};console.log(n,"businessTripDetail");function v(d){const o=d.map(r=>({destination:r.destination||"",business_trip_start_date:new Date(r.business_trip_start_date),business_trip_end_date:new Date(r.business_trip_end_date),allowances:r.allowances||[],detail_attedances:r.detail_attedances||[],allowances_result_item:r.allowancesResultItem||[]}));a.setValue("destinations",o)}const{fields:Y,append:D,remove:C,update:A}=R({control:a.control,name:"destinations"});j.useEffect(()=>{},[n,m]);const[G,V]=j.useState(0);return e.jsx(ae,{className:"h-[600px] w-full ",children:e.jsx(O,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(c),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(u,{control:a.control,name:"request_no",render:({field:d})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:o=>S(o),value:d.value,children:[e.jsx(B,{className:"w-[200px] py-2",children:e.jsx(P,{placeholder:"-- Select One --"})}),e.jsx(L,{children:s.map(o=>e.jsx(X,{value:o.id.toString(),children:o.request_no}))})]})}),e.jsx(_,{})]})})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:n.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:n.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:(E=n==null?void 0:n.pajak)==null?void 0:E.mwszkz})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(M=n==null?void 0:n.cost_center)==null?void 0:M.company_code})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:(k=n==null?void 0:n.purchasing_group)==null?void 0:k.purchasing_group})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(u,{control:a.control,name:"remark",render:({field:d})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(K,{placeholder:"Insert remark",...d,rows:4,className:"w-[300px]"})}),e.jsx(_,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(u,{control:a.control,name:"attachment",render:({field:d})=>e.jsxs(f,{children:[e.jsx(U,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(g,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:o=>{var b;const r=(b=o.target.files)==null?void 0:b[0];r?d.onChange(r):d.onChange(null)}})}),e.jsx(_,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"Not Availabe"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(u,{control:a.control,name:"total_destination",render:({field:d})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{value:m,onValueChange:y,children:[e.jsx(B,{className:"w-[200px] py-2",children:e.jsx(P,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(L,{children:Array.from({length:5},(o,r)=>e.jsxs(X,{value:(r+1).toString(),children:[" ",r+1," "]}))})]})}),e.jsx(_,{})]})})]})]})]}),e.jsx(J,{className:"my-4"}),e.jsx(oe,{updateDestination:A,destinationField:Y,form:a,listAllowances:h,totalDestination:a.getValues("total_destination").toString(),setTotalAllowance:V,businessTripDetail:n}),e.jsx(z,{type:"submit",children:"submit"})]})})})};function oe({totalDestination:s,listAllowances:t,form:a,destinationField:c,updateDestination:n,setTotalAllowance:x,businessTripDetail:h}){return e.jsxs(Q,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Z,{className:"flex items-center justify-start space-x-4",children:c.map((l,w)=>e.jsxs(ee,{value:`destination${w+1}`,children:["Destination ",w+1]}))}),c.map((l,w)=>e.jsx(ce,{listAllowances:t,updateDestination:n,destination:l,form:a,index:w,setTotalAllowance:x,businessTripDetail:h}))]})}function ce({form:s,index:t,destination:a,updateDestination:c,listAllowances:n,setTotalAllowance:x,businessTripDetail:h}){const{fields:l,update:w,append:T,remove:S}=R({control:s.control,name:`destinations[${t}].detail_attedances`}),{fields:m,update:p,append:y,remove:v,replace:Y}=R({control:s.control,name:`destinations[${t}].allowances`});j.useState(!1);const{setValue:D}=H(),C=q({control:s.control,name:"total_percent"}),A=h.total_cash_advance;return j.useEffect(()=>{const V=parseFloat(C||0)/100*A;D("total_cash_advance",V.toFixed(2))},[C,A,D]),e.jsxs(te,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:a.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:$(a.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:$(a.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(he,{detailAttedanceFields:l,form:s,updateAttedanceFields:w,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(me,{allowanceField:m,destinationIndex:t,form:s})]},t),e.jsx(xe,{allowanceField:m,destinationIndex:t,form:s,setTotalAllowance:x}),e.jsx("table",{className:"w-full text-sm mt-10",children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[20%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[80%] flex",children:A})]})})]})}function xe({allowanceField:s,destinationIndex:t,form:a,setTotalAllowance:c}){const n=a.watch(`destinations[${t}].allowances`);return console.log(n),e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:s.map((x,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:x.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{})]})]},x.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{})]})]})})]})})}function he({form:s,destinationIndex:t,detailAttedanceFields:a,updateAttedanceFields:c}){const n=s.watch(`destinations[${t}].detail_attedances`);return j.useEffect(()=>{},[n]),j.useEffect(()=>{},[a]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:n.map((x,h)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[$(x.date).format("DD/MM/YYYY"),e.jsx(u,{control:s.control,name:`destinations.${t}.detail_attedances.${h}.date`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(u,{control:s.control,name:`destinations.${t}.detail_attedances.${h}.shift_code`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(u,{control:s.control,name:`destinations.${t}.detail_attedances.${h}.shift_start`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(u,{control:s.control,name:`destinations.${t}.detail_attedances.${h}.shift_end`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsx("td",{children:e.jsx(u,{control:s.control,name:`destinations.${t}.detail_attedances.${h}.start_time`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:l.value,onChange:l.onChange})}),e.jsx(_,{})]})})}),e.jsx("td",{children:e.jsx(u,{control:s.control,name:`destinations.${t}.detail_attedances.${h}.end_time`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:l.value,onChange:l.onChange})}),e.jsx(_,{})]})})})]},x.index))})]})})})]})}function me({form:s,destinationIndex:t,allowanceField:a}){const c=s.watch(`destinations[${t}].allowances`);return j.useEffect(()=>{},[c]),e.jsx("table",{className:"w-full allowance-table",children:c.map((n,x)=>e.jsx(pe,{form:s,allowance:n,destinationIndex:t,allowanceIndex:x}))})}function pe({form:s,allowance:t,destinationIndex:a,allowanceIndex:c}){const[n,x]=j.useState(!1);j.useState(0);const h=m=>{x(p=>!p)},l=q({control:s.control,name:`destinations[${a}].allowances[${c}].detail[0].request_price`}),w=q({control:s.control,name:`destinations[${a}].allowances[${c}].detail`}),T=()=>{if(t.type==="total")return parseFloat(l||0)*1;{let m=0;return w==null||w.forEach(p=>{const y=parseFloat(p.request_price||0);m+=y}),m}},S=(m,p)=>{const y=parseFloat(p),v=isNaN(y)?0:y,Y=t.request_value;let D=!0;switch(Y){case"unlimited":D=!0;break;case"fixed value":const C=t.subtotal;v!==C&&(alert(`Please enter the fixed value of IDR ${C}`),D=!1);break;case"up to max value":const A=t.subtotal;v>A&&(alert(`The value should not exceed IDR ${A}`),D=!1);break;default:D=!1}D&&s.setValue(`destinations[${a}].allowances[${c}].detail[${m}].request_price`,v)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{control:s.control,name:`destinations[${a}].allowances[${c}].detail[0].request_price`,render:({field:m})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{value:m.value,onChange:p=>S(0,p.target.value)})}),e.jsx(_,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",T()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>h(),children:e.jsxs(z,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),n&&e.jsx(e.Fragment,{children:t.detail.map((m,p)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:$(m.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(u,{control:s.control,name:`destinations[${a}].allowances[${c}].detail[${p}].request_price`,render:({field:y})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{value:y.value,onChange:v=>S(p,v.target.value)})}),e.jsx(_,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},m.id))})]})}function ze({form:s,type:t,allowanceIndex:a,destinationIndex:c}){const{fields:n}=R({control:s.control,name:`destinations.${c}.allowances.${a}.detail`});return e.jsx(e.Fragment,{children:n.map((x,h)=>e.jsx(u,{control:s.control,name:`destinations.${c}.allowances.${h}.detail.${h}.request_price`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(N,{value:l.value,onChange:l.onChange})}),e.jsx(_,{})]})}))})}function je(s,t){throw new Error("Function not implemented.")}function F(s){throw new Error("Function not implemented.")}export{ze as AllowanceInputForm,pe as AllowanceRowInput,oe as BussinesTripDestination,ce as BussinessDestinationForm,Xe as BussinessTripFormV1,me as DetailAllowance,he as DetailAttedances,xe as ResultTotalItem};
