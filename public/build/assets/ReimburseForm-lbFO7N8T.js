import{j as e,r as C,u as at,q as nt}from"./app-CK8zdBlR.js";import{B as ot}from"./button-uLxOSSp2.js";import{h as O}from"./moment-C5S46NFB.js";import{z as p,t as lt}from"./index-DaqB-Cpl.js";import{f as J}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as it,F,a as q,b as T,c as R,f as ct,e as mt}from"./form-DdaCx1E2.js";import{u as dt,b as ut}from"./index.esm-D2Uzqmwq.js";import{T as Fe}from"./textarea-aJl_iZZW.js";/* empty css                  */import{S as pt}from"./scroll-area-D-C8V9_c.js";import{a as V}from"./axiosInstance-CeLyhcGb.js";import{S as qe}from"./separator-BQHKgO90.js";import{T as ht,a as ft,b as gt,c as bt}from"./tabs-BWCHd4HD.js";import{S as K,a as X,b as Q,c as U,d as ee}from"./select-gCgp3phc.js";import{F as de}from"./formDropdown-BKF6To6_.js";import{C as Te}from"./CustomDatePicker-DuyudqnC.js";import{I as Re}from"./input-TUld38yI.js";import{ReimburseFormType as y}from"./listModel-DztGyhLy.js";import{u as te}from"./getDropdown-CqmSzqMv.js";import{G as _t,a as Ee,b as jt}from"./api-BeRu2Z8X.js";import{L as xt}from"./LoadingSpin-DOMWX-xV.js";import{W as yt}from"./WorkflowComponent-Dcy-t37W.js";import{C as wt}from"./CustomStatus-VeGbMRod.js";import{F as ke}from"./FormHelperText-Cf5qMLtf.js";import{B as vt}from"./Button-rJCFEtHV.js";import"./app-DQK4SJPx.js";import"./index-DKoVp4Lx.js";import"./index-Bb4qSo10.js";import"./utils-CEXdcuzS.js";import"./createLucideIcon-BOiw4WTc.js";import"./index-gNzY82LG.js";import"./index-DAPw0sbi.js";import"./index-DYj2m36X.js";import"./index-BWopQlfo.js";import"./index-BGLBDbMJ.js";import"./index-BdQq_4o_.js";import"./index-X6amTui5.js";import"./index-DzSo-L9r.js";import"./index-DKVfE9zl.js";import"./index-tdDtewB8.js";import"./index-DRG4VDTO.js";import"./Combination-D1BMnKW2.js";import"./index-DZafSscO.js";import"./TextField-BzPt6F4x.js";import"./createSvgIcon-B0NBxkKf.js";import"./DefaultPropsProvider-CI3F7hH7.js";import"./useSlot-SETN5HGy.js";import"./createSimplePaletteValueFilter-CFyHy7Na.js";import"./useControlled-CkAoVr1Y.js";function Nt({isLoading:ue=!1,children:pe}){return e.jsx("div",{className:"",children:ue?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(xt,{})})}):pe})}const xs=({onSuccess:ue,currencies:pe,taxDefaultValue:xe,uomDefaultValue:ye,edit_url:Le,update_url:Me,store_url:Ae,type:_,currentUser:A})=>{const[we,ve]=C.useState("form1"),{showToast:L}=at();nt().props;const{dataDropdown:se,getDropdown:re}=te(_t);te();const{dataDropdown:Ie,getDropdown:Ye}=te(),{dataDropdown:ae,getDropdown:ne}=te("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:oe,getDropdown:le}=te("api/master/cost-center/dropdown-list"),[Y,he]=C.useState([]),[$e,fe]=C.useState([]),[M,Ve]=C.useState(!1),[Ne,Be]=C.useState(!1),[Pe,ie]=C.useState(!1),[w,B]=C.useState([]),ge=C.useRef([]),[Ge,z]=C.useState([]),[H,Oe]=C.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),ze=1*1024*1024,He=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],We=p.object({formCount:p.string().min(1,"total form must be have value"),remark_group:p.string().min(1,"header remark is required"),cost_center:p.string().min(1,"cost center required"),requester:p.string().min(1,"requester required"),value:p.number().optional(),user_id:p.string().optional(),forms:p.array(p.object({reimburseId:p.string().optional(),for:p.string().optional(),group:p.string().optional(),reimburse_type:p.string().min(1,"reimburse type is required"),short_text:p.string().min(1,"remarks is required"),balance:p.string(),remaining_balance_when_request:p.number(),currency:p.string().min(1,"currency required"),tax_on_sales:p.string().min(1,"tax required"),purchase_requisition_unit_of_measure:p.string().min(1,"uom required"),purchasing_group:p.string().min(1,"Purchasing Group required"),type:p.any(),item_delivery_data:p.date(),claim_date:p.date(),attachment:p.array(p.instanceof(File).refine(t=>He.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=ze,{message:"File size must be less than 1MB"})).min(_===y.create?1:0,"Attachment is required"),savedAttachment:p.array(p.any()).optional().nullable()}))});C.useEffect(()=>{(async()=>{var a,m;(_===y.edit||_===y.clone)&&(ie(!0),await Ze()),Ye("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=Number(we.split("form")[1])-1;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(a=r.getValues("forms")[s])!=null&&a.purchasing_group?"id":"",value:((m=r.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),re("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&_===y.create&&W(0)})()},[_]);async function Ze(){r.setValue("forms",[]),ie(!0);try{const t=await V.get(Le??""),s=t.data.data.group,a=t.data.data.forms;Ve(s.reimbursementStatus),z(a.reduce((o,f)=>(o.push(String(f.id)),o),[]));const m=a.map(o=>({reimburseId:String(o.id),for:String(o.for),group:String(o.group),reimburse_type:o.reimburse_type.code,short_text:o.short_text,balance:o.balance,currency:o.currency,tax_on_sales:String(o.tax_on_sales),purchase_requisition_unit_of_measure:String(o.purchase_requisition_unit_of_measure),remaining_balance_when_request:Number(o.remaining_balance_when_request)??0,purchasing_group:String(o.purchasing_group),type:o.type,item_delivery_data:new Date(o.item_delivery_data),claim_date:new Date(o.claim_date),attachment:[],savedAttachment:o.reimburse_attachment}));ge.current=a.map((o,f)=>({id:String(o.id),reimburse_type:o.reimburse_type.code,balance:a.filter((n,b)=>b>=f&&n.for===o.for&&n.reimburse_type.code===o.reimburse_type.code).reduce((n,b)=>n+Number(b.balance)||0,0),limit:a.filter((n,b)=>b>=f&&n.for===o.for&&n.reimburse_type.code===o.reimburse_type.code).reduce((n,b)=>n+1||0,0),for:String(o.for)})),r.setValue("formCount",a.length.toString()),r.setValue("remark_group",s.remark),r.setValue("cost_center",String(s.cost_center.id)),r.setValue("requester",s.requester),r.setValue("forms",m);let d=0;for(const o of a)await W(d,{reimburse_type:o.reimburse_type.code}),await De(d,{type:o.type,reimburse_type:o.reimburse_type.code}),await _e(d,{reimburse_type:o.reimburse_type.code,for:o.reimburse_type.is_employee===1?null:o.for},!0),d++;ie(!1)}catch{ie(!1)}}const Je={formCount:"1",remark_group:"",cost_center:"",requester:String(A==null?void 0:A.is_admin)==="1"?"":A==null?void 0:A.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:xe,purchase_requisition_unit_of_measure:ye,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=dt({resolver:lt(We),defaultValues:Je}),{fields:be,update:j}=ut({control:r.control,name:"forms"}),W=async(t,s=null)=>{const a=r.getValues("requester");if(a===null||a===""){he(d=>{const o=[...d];return o[t]=[],o});return}const m=await V.get(Ee,{params:{user:a,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});he(d=>{const o=[...d];return o[t]=m.data.data,o})},Ke=async(t,s)=>{if(t&&t.length>0)try{const a=await V.get(Ee,{params:{search:t,user:r.getValues("requester")}});he(m=>{const d=[...m];return d[s]=a.data.data,d})}catch(a){console.error("Error searching reimburse types:",a)}},De=async(t,s)=>{const a=await V.get(jt,{params:{user:r.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});fe(m=>{const d=[...m];return d[t]=a.data.data,d})},Xe=t=>{for(let s=0;s<be.length;s++)W(s);if(t==null)for(let s=0;s<be.length;s++)r.setValue(`forms.${s}.reimburse_type`,""),r.setValue(`forms.${s}.for`,"");B([]),fe([])};function Qe(t){const s=[...r.getValues("forms")];for(let a=0;a<Number(t);a++)if(a+1>s.length){W(a);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:xe,purchase_requisition_unit_of_measure:ye,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}r.setValue("forms",s)}const Ue=t=>{ve(t)},et=async t=>{var a,m,d,o,f;if(w)for(let n=0;n<w.length;n++){if(t.forms.length==0||t.forms.length-1,((a=w[n])==null?void 0:a.type_limit)!=="Unlimited"&&Number((m=w[n])==null?void 0:m.limit)==0){L("Claim Limit for form "+(n+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[n].balance==""||Number(t.forms[n].balance)==0){L("Claim Balance for form "+(n+1)+" cannot be 0","error");return}if(Number(((d=w[n])==null?void 0:d.balance)??0)<Number(t.forms[n].balance??0)){L("Please check your balance input for forms "+(n+1)+"  is not must be above "+((o=w[n])==null?void 0:o.balance),"error");return}t.forms=t.forms.map((b,E)=>{var k;return{...b,claim_date:O(b.claim_date).format("YYYY-MM-DD"),item_delivery_data:O(b.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:Number(((k=w[E])==null?void 0:k.balance)??0)}})}const s=t.forms.reduce((n,b)=>n+Number(b.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let n;_===y.edit||_===y.clone?n=await V.post(Me??"",t,{headers:{"Content-Type":"multipart/form-data"}}):n=await V.post(Ae??"",t,{headers:{"Content-Type":"multipart/form-data"}}),L((f=n==null?void 0:n.data)==null?void 0:f.data,"success"),ue()}catch{}};async function _e(t,s=null,a=!1){var o,f;const m=r.getValues(`forms.${t}`),d={user:r.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:m.reimburse_type,for:s!=null?s.for:m.for};try{const n=await V.get("reimburse/data-limit-and-balance",{params:d}),E=r.getValues("forms").filter((x,h)=>h!==t&&x.reimburse_type===m.reimburse_type&&x.for===m.for);let k=E.reduce((x,h)=>x+Number(h.balance)||0,0),I=0,N=0;if(_===y.clone)if(a){let x=ge.current.find(h=>m.reimburseId==h.id);I=k+Number(x.balance),N=E.length+Number(x.limit),z(h=>{const g=[...h];return g[t]=x.id,g})}else{let x=m.for===""?r.getValues("requester"):m.for,h=ge.current.find(g=>g.reimburse_type===m.reimburse_type&&g.for===x&&!Ge.includes(g.id));h!==void 0&&(I=Number(h.balance),N=Number(h.limit),z(g=>{const D=[...g];return D[t]=h.id,D}))}let P=n.data.data.balance-k+I,Z=Math.max(0,n.data.data.limit-E.length+N);B(x=>{const h=[...x];return h[t]={...n.data.data,balance:P,limit:n.data.data.type_limit=="Unlimited"?n.data.data.type_limit:Z},h})}catch(n){L((f=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:f.message,"error")}}const Se=async()=>{var t,s,a,m,d,o,f,n,b,E,k,I;try{const N=r.getValues("forms"),P=N.map((g,D)=>({index:D,value:g.balance?Number(g.balance):0}));if(P.some(g=>g.value===0)){const g=P.findIndex(D=>D.value===0);L(`Please fill balance form ${g+1}`,"error");return}const x=N.reduce((g,D)=>g+(Number(D.balance)||0),0),h=await V.get("/check-approval",{params:{value:x,requester:r.getValues("requester"),type:"REIM"}});if(h.data.status_code===200){const g=(s=(t=h.data)==null?void 0:t.data)==null?void 0:s.approval.map(c=>(c==null?void 0:c.division_name)||null),D=(m=(a=h.data)==null?void 0:a.data)==null?void 0:m.approval.map(c=>(c==null?void 0:c.name)||null),i=[];(o=(d=h.data)==null?void 0:d.data)!=null&&o.hr&&i.push((b=(n=(f=h.data)==null?void 0:f.data)==null?void 0:n.hr)==null?void 0:b.name);const l=(((E=h.data.data)==null?void 0:E.approval)??[]).map(c=>({status:"",name:c.name,dateApproved:""}));Oe({approvalRequest:g,approvalFrom:D,acknowledgeFrom:i,approvalFromStatusRoute:l}),Be(!0)}}catch(N){L((I=(k=N==null?void 0:N.response)==null?void 0:k.data)==null?void 0:I.message,"error")}};C.useEffect(()=>{r.getValues("forms").reduce((a,m)=>a+Number(m.balance)||0,0)>0&&Ne===!0&&Se()},[r.watch("forms"),r.watch("requester")]);const tt=t=>{const s=t;if(Object.keys(s).length>0){let a=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,d])=>{m==="forms"?d.forEach((o,f)=>{a+=`</br><strong>Form ${f+1}:</strong></br>`,Object.values(o).forEach(n=>{a+=`<li>${n.message}</li>`})}):a+=`<li>${d.message}</li>`}),a+="</ul>",L(e.jsx("div",{dangerouslySetInnerHTML:{__html:a}}),"error")}};return e.jsx(pt,{className:"h-[600px] w-full",children:e.jsx(Nt,{isLoading:Pe,children:e.jsx(it,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(et,t=>{tt(t)}),children:[e.jsx("table",{className:"w-full mt-4 text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:M&&e.jsx(wt,{name:M==null?void 0:M.name,className:M==null?void 0:M.classname,code:M==null?void 0:M.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:"remark_group",render:({field:t})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(Fe,{placeholder:"Insert remark",...t})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{fieldLabel:"",options:oe,fieldName:"cost_center",disabled:_===y.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=oe==null?void 0:oe.some(a=>a.label===t);t.length>0&&!s?await le(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=r.getValues("cost_center");le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{options:se,fieldName:"requester",disabled:String(A==null?void 0:A.is_admin)==="0"||_===y.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const a=se==null?void 0:se.some(m=>m.label===t);t.length>0&&!a?re(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!a&&re("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>Xe(t),onFocus:()=>{const t=r.getValues("requester");re("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(q,{children:[e.jsx(T,{children:e.jsxs(K,{disabled:_===y.edit,onValueChange:a=>{t.onChange(a),Qe(a);const m=r.getValues("forms");let d=Number(a);if(m.length>d){const o=m.slice(0,d);r.setValue("forms",o),B(f=>{let n=[...f];return n=n.slice(0,d),n}),ve(`form${Math.max(1,d)}`),z(f=>{const n=[...f];return n[d]="",n})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"Select number of forms"})}),e.jsx(U,{children:Array.from({length:3},(a,m)=>m+1).map(a=>e.jsx(ee,{value:a.toString(),children:a},a))})]})}),e.jsx(R,{})]})}})})]})]})}),e.jsx(qe,{className:"my-4"}),e.jsxs(ht,{value:we,onValueChange:Ue,className:"w-full",children:[e.jsxs(ft,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:r.watch("formCount")||1}).map((t,s)=>e.jsxs(gt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),be.map((t,s)=>{var a,m,d,o,f,n,b,E,k,I,N,P,Z,x,h,g,D;return e.jsxs(bt,{value:`form${s+1}`,children:[e.jsx(F,{control:r.control,name:`forms.${s}.reimburseId`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(Re,{className:"sr-only",value:t.reimburseId,onChange:i.onChange})}),e.jsx(R,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{options:Y[s],fieldName:`forms.${s}.reimburse_type`,disabled:Y[s]===void 0||Y[s].length===0||_===y.edit,placeholder:"Select Reimburse Type",onSearch:async i=>{var u;((u=Y[s])==null?void 0:u.some(c=>c.label===i))||await Ke(i,s)},onChangeOutside:async i=>{if(i){const l=Y[s].filter(u=>u.value==i)[0];j(s,{...t,reimburse_type:i,type:l.is_employee===1?"Employee":"Family"}),l.is_employee===1?_e(s,{reimburse_type:i,for:null}):(B(u=>{const c=[...u];return c[s]=[],c}),r.setValue(`forms.${s}.balance`,""),De(s,{type:"Family",reimburse_type:i}))}else{B(u=>{const c=[...u];return c[s]=[],c}),j(s,{...t,balance:""}),z(u=>{const c=[...u];return c[s]="",c}),r.setValue(`forms.${s}.for`,""),fe(u=>{const c=[...u];return c[s]=[],c});const l=r.getValues("forms");l.forEach((u,c)=>{var S,v;if(c>s&&l[c].reimburse_type===t.reimburse_type){const ce=((S=w[c])==null?void 0:S.balance)||0,Ce=((v=w[c])==null?void 0:v.limit)||0;B(me=>{var G;const $=[...me];return $[c]={...$[c],balance:ce+Number(t.balance||"0")},((G=w[c])==null?void 0:G.type_limit)!=="Unlimited"&&($[c]={...$[c],limit:Ce+1}),$}),r.setValue(`forms.${c}.balance`,"")}})}},onFocus:()=>{W(s)},classNames:"mt-2 w-full"}),((d=(m=(a=r.formState.errors)==null?void 0:a.forms)==null?void 0:m[s])==null?void 0:d.reimburse_type)&&e.jsx(ke,{error:!0,children:(b=(n=(f=(o=r.formState.errors)==null?void 0:o.forms)==null?void 0:f[s])==null?void 0:n.reimburse_type)==null?void 0:b.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:`forms.${s}.for`,render:({field:i})=>{var l,u,c,S;return e.jsxs(q,{children:[e.jsx(T,{children:e.jsxs(K,{disabled:((c=(u=(l=Y==null?void 0:Y[s])==null?void 0:l.filter(v=>(v==null?void 0:v.value)==r.getValues(`forms.${s}.reimburse_type`)))==null?void 0:u[0])==null?void 0:c.is_employee)===1||_===y.edit,onValueChange:v=>{j(s,{...t,for:v}),_e(s,{reimburse_type:r.getValues(`forms.${s}.reimburse_type`),for:v})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(S=$e[s])==null?void 0:S.map(v=>e.jsx(ee,{value:v.value.toString(),children:v.label},v.value))})]})}),e.jsx(R,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{fieldLabel:"",options:ae,fieldName:`forms.${s}.purchasing_group`,disabled:_===y.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:i=>{const l=ae==null?void 0:ae.some(u=>u.label===i);i.length>0&&!l?ne(i,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:i}):i.length==0&&!l&&ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:i=>{i&&j(s,{...t,purchasing_group:i})},onFocus:()=>{var l;const i=(l=r.getValues("forms")[s])==null?void 0:l.purchasing_group;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:i?"id":"",value:i??""}})}}),((I=(k=(E=r.formState.errors)==null?void 0:E.forms)==null?void 0:k[s])==null?void 0:I.purchasing_group)&&e.jsx(ke,{error:!0,children:(x=(Z=(P=(N=r.formState.errors)==null?void 0:N.forms)==null?void 0:P[s])==null?void 0:Z.purchasing_group)==null?void 0:x.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:`forms.${s}.tax_on_sales`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsxs(K,{disabled:!0,onValueChange:l=>{j(s,{...t,tax_on_sales:l})},defaultValue:t.tax_on_sales,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(Ie??[]).map((l,u)=>e.jsxs(ee,{value:l.value.toString(),children:[l.description," - ",l.label]},l.value))})]})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsxs(K,{disabled:!0,onValueChange:l=>{j(s,{...t,purchase_requisition_unit_of_measure:String(l)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:e.jsx(ee,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:`forms.${s}.short_text`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(Fe,{placeholder:"Insert remark",onChange:l=>{j(s,{...t,short_text:l.target.value})},defaultValue:t.short_text})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((h=w[s])==null?void 0:h.balance)&&J((g=w[s])==null?void 0:g.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(D=w[s])==null?void 0:D.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:`forms.${s}.item_delivery_data`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(Te,{disabled:_===y.edit,initialDate:i.value instanceof Date?i.value:new Date(i.value),minDate:new Date,onDateChange:l=>{O(l).format("YYYY-MM-DD")>=O(new Date).format("YYYY-MM-DD")?(i.onChange(l),j(s,{...t,item_delivery_data:l})):(i.onChange(i.value),j(s,{...t,item_delivery_data:i.value}),L("Receipt date cannot be less than today","error"))}})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(F,{control:r.control,name:`forms.${s}.claim_date`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(Te,{disabled:_===y.edit,initialDate:i.value instanceof Date?i.value:new Date(i.value),minDate:new Date,onDateChange:l=>{O(l).format("YYYY-MM-DD")>=O(new Date).format("YYYY-MM-DD")?(i.onChange(l),j(s,{...t,claim_date:l})):(i.onChange(i.value),j(s,{...t,claim_date:i.value}),L("Claim date cannot be less than today","error"))}})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid w-full grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(F,{control:r.control,name:`forms.${s}.currency`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(T,{children:e.jsxs(K,{disabled:_===y.edit,onValueChange:l=>{j(s,{...t,currency:l})},defaultValue:t.currency,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:pe.map(l=>e.jsxs(ee,{value:l.code,children:[l.name," (",l.code,")"]},l.code))})]})}),e.jsx(ct,{className:"h-6"}),e.jsx(R,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(F,{control:r.control,name:`forms.${s}.balance`,render:({field:i})=>{var l;return e.jsxs(q,{children:[e.jsx(T,{children:e.jsx(Re,{type:"text",placeholder:"0",onChange:u=>{var me;const c=u.target.value.replace(/[^0-9]/g,""),S=J(c,!1),v=Number(c)||0,ce=((me=w[s])==null?void 0:me.balance)||0;if(v>ce){u.target.value=J(c.slice(0,-1),!1);return}j(s,{...t,balance:c}),u.target.value=S,r.getValues("forms").forEach(($,G)=>{if(G>s&&$.reimburse_type===t.reimburse_type){const st=ce-v;B(rt=>{const je=[...rt];return je[G]={...je[G],balance:st},je}),j(G,{...$,balance:""})}})},defaultValue:J(t.balance,!1),value:J(t.balance,!1),disabled:typeof w[s]>"u"||((l=w[s])==null?void 0:l.length)===0||_===y.edit})}),e.jsx(R,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(F,{control:r.control,name:`forms.${s}.attachment`,render:({field:i})=>e.jsxs(q,{children:[e.jsx(mt,{className:"mb-1 text-xs text-gray-500 font-extralight",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(T,{children:e.jsx("input",{className:"flex w-full px-3 py-1 text-xs transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:l=>{const u=l.target.files;if(u){const c=[...t.attachment],S=Array.from(u);c.push(...S),j(s,{...t,attachment:c})}}})}),e.jsx(R,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((i,l)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:i.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const u=t.attachment.filter((c,S)=>S!==l);j(s,{...t,attachment:u})},children:"Delete"})]},l))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((i,l)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:i.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const u=t.savedAttachment.filter((c,S)=>S!==l);j(s,{...t,savedAttachment:u})},children:"Delete"})]},l))})})]})]})]})]})})})]},s)})]}),e.jsx(vt,{onClick:async()=>await Se(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Ne&&e.jsx(yt,{workflowApproval:{approvalRequest:H.approvalRequest,approvalFrom:H.approvalFrom,acknowledgeFrom:H.acknowledgeFrom},workflowApprovalStep:H.approvalFromStatusRoute,workflowApprovalDiagram:H.approvalFrom})}),e.jsx(qe,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ot,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{xs as ReimburseForm};
