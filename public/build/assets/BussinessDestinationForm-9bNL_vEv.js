import{u as X,r as Z,j as e}from"./app-CTh3kvOX.js";/* empty css              */import{F as w,a as g,b as y,c as A}from"./form-D__EzdxD.js";import{c as ee}from"./tabs-CBiNJF-i.js";import{b as $}from"./index.esm-DS68CA5F.js";import{B as te}from"./button-DWH0Xgy5.js";import{C as se}from"./checkbox-DnANMRIR.js";import{C as T}from"./CustomDatePicker-CugQGRV-.js";import{DetailAllowance as re}from"./DetailAllowance-C0CwT_Uk.js";import{DetailAttedances as ae}from"./DetailAttedances--wu91WUI.js";import{F as k}from"./formDropdown-B3JkNxjE.js";import{ResultTotalItem as oe}from"./ResultTotalItem-2A1yL5wX.js";import{h as u}from"./moment-C5S46NFB.js";import{u as le}from"./getDropdown-BTYOkewo.js";import"./app-CfpADx9m.js";import"./utils-Dh97R192.js";import"./index-Cq8hzMGu.js";import"./index-CEXoxLN6.js";import"./index-CZmIq-64.js";import"./index-Bb4qSo10.js";import"./index-DtGKePfb.js";import"./index-Csq47a0z.js";import"./index-B3UEZXde.js";import"./index-DaiRYLfv.js";import"./index-BGb9SAxe.js";import"./index-Dji0ht4z.js";import"./createLucideIcon-CPVK6x5j.js";import"./index-BN7VOD__.js";import"./index-KRiSHzA7.js";import"./Combination-C99O56-Y.js";import"./rupiahCurrencyFormat-D0mkqwcl.js";import"./chevrons-up-down-Df3gphkF.js";import"./select-CiJOnR_9.js";import"./index-BdQq_4o_.js";import"./TextField-FxrA5W9M.js";import"./createSvgIcon-BkohkIM7.js";import"./DefaultPropsProvider-DYV0MD-a.js";import"./useSlot-CebwZN1g.js";import"./createSimplePaletteValueFilter-ZNaaQ3s1.js";import"./useControlled-CjsMLuco.js";import"./FormHelperText-EIpBRZtY.js";import"./axiosInstance-DzGPJiez.js";import"./index-DkhbIixU.js";function et({key:q,form:d,index:r,destination:a,updateDestination:n,listAllowances:B,setTotalAllowance:G,pajak:ie,purchasingGroup:ne,dataTax:L,dataPurchasingGroup:P,dataDestination:p,type:v,btClone:C,setSelectedDates:h,selectedDates:F,dateBusinessTripByUser:f}){const{fields:V,update:M,append:H,remove:Y}=$({control:d.control,name:`destinations.${r}.detail_attedances`}),{fields:N,update:de,append:ce,remove:z,replace:J}=$({control:d.control,name:`destinations.${r}.allowances`}),{showToast:j}=X(),{dataDropdown:S,getDropdown:b}=le();function K(){let t=u(a.business_trip_start_date).startOf("day");const s=u(a.business_trip_end_date).startOf("day");if(!a.business_trip_start_date||!a.business_trip_end_date||!t.isValid()||!s.isValid()){j("Please Pick The Date","error");return}if(Y(),z(),t.isAfter(s)){j("Start date must be before end date","error");return}let i=!1;for(const l in f){const c=u(f[l].from).startOf("day"),m=u(f[l].to).startOf("day");if(t.isBetween(c,m,null,"[)")||s.isBetween(c,m,null,"(]")||t.isBefore(c)&&s.isAfter(m)){i=!0;break}}if(i){j("Your Selected Range is Unavailable. Please Select Other Days","error");return}for(;t.isBefore(s)||t.isSame(s);){const l={date:t.toDate(),shift_code:"REGULERSHIFT",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00",start_date:t.toDate(),end_date:t.toDate()};H(l),t=t.add(1,"days")}function o(l){let c=u(a.business_trip_start_date).startOf("day");const m=u(a.business_trip_end_date).startOf("day"),I=[];for(;c.isBefore(m)||c.isSame(m);)I.push({date:c.toDate(),request_price:l}),c=c.add(1,"days");return I}const W=B.map(l=>({name:l.name,code:l.code,default_price:parseInt(l.grade_price),type:l.type,subtotal:parseInt(l.grade_price),currency:l.currency_id,request_value:l.request_value,detail:l.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(l.grade_price)}]:o(l.grade_price)}));J(W)}const R=(t,s)=>{n(s,{...a,business_trip_start_date:t}),h(i=>{const o=[...i];return o[s]={...o[s],from:t},o})},O=(t,s)=>{n(s,{...a,business_trip_end_date:t}),h(i=>{const o=[...i];return o[s]={...o[s],to:t},o})},[D,_]=Z.useState(),x={};D&&(x.selected=D);const E=(t,s)=>{s==="start"&&(n(t,{...a,business_trip_start_date:null}),h(i=>{const o=[...i];return o[t]={...o[t],from:void 0},o})),s==="end"&&(n(t,{...a,business_trip_end_date:null}),h(i=>{const o=[...i];return o[t]={...o[t],to:void 0},o})),_(void 0)},Q=e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>E(r,"start"),children:"Reset"})}),U=e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>E(r,"end"),children:"Reset"})});return e.jsxs(ee,{value:`destination${r+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(k,{fieldLabel:"",options:p,fieldName:`destinations.${r}.destination`,isRequired:!0,disabled:!1,placeholder:"Select Destination",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,destination:t})},onSearch:async t=>{const s=p==null?void 0:p.some(i=>i.label===t);t.length>0&&!s?await b(t,{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type},search:t}):t.length==0&&!s&&await b("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type}}),p=S},onFocus:async()=>{const t=d.getValues("cost_center");await b("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type},hasValue:{key:t?"id":"",value:t??""}}),p=S}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsxs("td",{className:"flex gap-2",children:[e.jsx(w,{control:d.control,name:`destinations.${r}.restricted_area`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(se,{checked:a.restricted_area,onCheckedChange:s=>{n(r,{...a,restricted_area:s})}})}),e.jsx(A,{})]})}),"Restricted Area"]})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Tax",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(k,{fieldLabel:"",options:L,fieldName:`destinations.${r}.pajak_id`,isRequired:!0,disabled:!1,placeholder:"Select Tax",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,pajak_id:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(k,{fieldLabel:"",options:P,fieldName:`destinations.${r}.purchasing_group_id`,isRequired:!0,disabled:!1,placeholder:"Select Purchasing Group",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,purchasing_group_id:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussines Trip Date",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{className:"flex items-center space-x-2",children:[e.jsx(w,{control:d.control,name:`destinations.${r}.business_trip_start_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(T,{initialDate:a.business_trip_start_date,modifiers:x,onDayClick:(s,i)=>{i.selected?(R(void 0,r),_(void 0),n(r,{...a,business_trip_start_date:void 0,business_trip_end_date:void 0})):(R(s,r),_(s),n(r,{...a,business_trip_start_date:s,business_trip_end_date:s}))},disabledDays:F,footer:Q})}),e.jsx(A,{})]})}),e.jsx("span",{children:"To"}),e.jsx(w,{control:d.control,name:`destinations.${r}.business_trip_end_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(T,{initialDate:a.business_trip_end_date,modifiers:x,onDayClick:(s,i)=>{i.selected?(O(void 0,r),_(void 0),n(r,{...a,business_trip_end_date:void 0})):(O(s,r),_(s),n(r,{...a,business_trip_end_date:s}))},disabled:!1,disabledDays:F,footer:U})}),e.jsx(A,{})]})}),e.jsx(te,{type:"button",onClick:()=>K(),children:"Get Detail"})]})]})]}),e.jsx(ae,{detailAttedanceFields:V,form:d,updateAttedanceFields:M,destinationIndex:r,type:v,btClone:C}),e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(re,{allowanceField:N,destinationIndex:r,form:d,type:v,btClone:C})]},r),e.jsx(oe,{allowanceField:N,destinationIndex:r,form:d,setTotalAllowance:G})]},q)}export{et as BussinessDestinationForm};
