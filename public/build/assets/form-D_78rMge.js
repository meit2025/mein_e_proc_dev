import{r as h,u as Y,j as e}from"./app-CxTA7Glv.js";import{d as $,F as o,a as i,b as n,c as d,e as w}from"./form-CSEZgHgO.js";import{z as t,t as q}from"./index-BWfj9iTM.js";import{B as J}from"./button-D7nLMexi.js";import{u as K,b as Q}from"./index.esm-BRlEtMSt.js";import{S as X}from"./scroll-area-CIUFw7OE.js";import{S as N,a as C,b as F,c as S,d as m}from"./select-t-sHiOyk.js";import{I as c}from"./input-B0oR7BEQ.js";import{a as j}from"./axiosInstance-o1uEpFkd.js";import{F as u}from"./utils-DQNdRV2r.js";import{M as Z}from"./MultiSelect-CWHwaNeV.js";import{R as ee,a as M}from"./radio-group-DGp43LTh.js";import{C as ae}from"./api-BBkWHPRN.js";import{L as re}from"./Loading-CX-B1COd.js";import{F as V}from"./formDropdown-0Y9ESN1G.js";import{u as I}from"./getDropdown-CTRQ52ri.js";import{f as G}from"./rupiahCurrencyFormat-CP-6egij.js";import"./app-DQK4SJPx.js";import"./index-jDmWXUqi.js";import"./index-CFHacufK.js";import"./index-Bb4qSo10.js";import"./index-CFoeP21r.js";import"./index-CELHcUuI.js";import"./index-Df9ohyhm.js";import"./index-B8-M9k-x.js";import"./Combination-DHdRCRqc.js";import"./index-Cc-oATeB.js";import"./index-xR3_7S6f.js";import"./index-qQviQR-H.js";import"./index-c9hGGzMl.js";import"./checkbox-HwYjRYNu.js";import"./index-B6j6-1X3.js";import"./TextField-B2i4JPdj.js";import"./createSvgIcon-DUfFu8_Y.js";import"./DefaultPropsProvider-WmMxOSu2.js";import"./extends-CF3RwP-h.js";import"./useSlot-mIPvEK0I.js";import"./createSimplePaletteValueFilter-BNPmXMRD.js";import"./useControlled-Dh2gcSoF.js";import"./FormHelperText-CiqcUT75.js";function Ue({onSuccess:p,type:x=u.create,listGrades:R,editURL:E,updateURL:L,id:se}){const A=t.object({code:t.string(),name:t.string().min(1,"Name is required"),is_employee:t.boolean(),family_status:t.string().optional(),limit:t.number(),material_group:t.number().refine(a=>a>0,{message:"Material Group must be chosen"}),material_number:t.number().refine(a=>a>0,{message:"Material Number must be chosen"}),grade_option:t.string().min(1,"Grade must be selected"),grade_all_price:t.string().optional(),grades:t.array(t.object({grade:t.string(),id:t.number(),plafon:t.string().min(1,"balance required")}))}),[D,g]=h.useState(!1);h.useState("");const{dataDropdown:T,getDropdown:B}=I(),{dataDropdown:k,getDropdown:f}=I(),O={code:"",name:"",material_group:null,material_number:null,family_status:"",is_employee:!0,grade_option:"all",grade_all_price:"0",grades:[],limit:0},s=K({resolver:q(A),defaultValues:O});async function P(){try{const r=(await j.get(E||"")).data.data;s.reset({code:r.code,name:r.name,limit:r.limit,is_employee:r.is_employee,family_status:r.family_status,material_group:parseInt(r.material_group.id),material_number:parseInt(r.material_number),grade_option:r.grade_option,grade_all_price:r.grade_all_price,grades:r.grades}),b(r.material_group.material_group||"")}catch{}}const{fields:z}=Q({control:s.control,name:"grades"}),{showToast:_}=Y(),H=async a=>{var r;g(!0);try{let l;x===u.edit?l=await j.put(L??"",a):l=await j.post(ae??"",a),p&&p(!0),_((r=l==null?void 0:l.data)==null?void 0:r.message,"success")}catch(l){p&&p(!1),_(l==null?void 0:l.message,"error")}g(!1)},b=async a=>{a.length>0&&f(a,{name:"material_number",id:"id",tabel:"master_materials",where:{key:"material_group",parameter:a}})},U=async(a,r)=>{a.length>0&&f(a,{name:"material_number",id:"id",tabel:"master_materials",search:a,where:{key:"material_group",parameter:r}})};return h.useEffect(()=>{B("",{name:"material_group",id:"id",tabel:"material_groups"}),x===u.edit&&P()},[]),e.jsxs(X,{className:"h-[600px] w-full",children:[e.jsx(re,{isLoading:D}),e.jsx($,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(H),children:[e.jsxs("table",{className:"text-xs mt-4 table font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"code",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{type:"text",placeholder:"Insert code",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value),disabled:x===u.edit})}),e.jsx(d,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Name"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"name",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{type:"text",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value)})}),e.jsx(d,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"For"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"is_employee",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(N,{onValueChange:r=>a.onChange(r==="true"),value:a.value?"true":"false",children:[e.jsx(C,{className:"w-[200px]",children:e.jsx(F,{placeholder:"-"})}),e.jsxs(S,{children:[e.jsx(m,{value:"true",children:"Employee"},"is_employee"),e.jsx(m,{value:"false",children:"Family"},"is_employee")]})]})}),e.jsx(d,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family Status"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"family_status",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(N,{onValueChange:r=>a.onChange(r),value:a.value,disabled:s.getValues("is_employee")===!0,children:[e.jsx(C,{className:"w-[200px]",children:e.jsx(F,{placeholder:"Select Family"})}),e.jsxs(S,{children:[e.jsx(m,{value:"husband",children:"Husband"}),e.jsx(m,{value:"wife",children:"Wife"}),e.jsx(m,{value:"child",children:"Child"})]})]})}),e.jsx(d,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Limit ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"limit",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{onChange:r=>a.onChange(Number(r.target.value)),value:a.value})}),e.jsx(d,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"block",width:200,children:"Balance"}),e.jsxs("td",{children:[e.jsx(o,{control:s.control,name:"grade_option",render:({field:a})=>e.jsx(i,{children:e.jsx(n,{children:e.jsxs(ee,{value:a.value,onValueChange:a.onChange,className:"flex flex space-x-1 mb-3",children:[e.jsxs(i,{className:"flex text-xs items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(M,{value:"all"})}),e.jsx(w,{className:"text-xs",children:"All"})]}),e.jsxs(i,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(M,{value:"grade"})}),e.jsx(w,{className:"text-xs",children:"Grade"})]})]})})})}),s.getValues("grade_option")==="all"?e.jsx("div",{children:e.jsx(o,{control:s.control,name:"grade_all_price",render:({field:a})=>e.jsx(i,{children:e.jsx(n,{children:e.jsx(c,{...a})})})})}):e.jsx("div",{children:e.jsx(Z,{label:"grade",id:"id",options:R||[],value:s.getValues("grades").map(a=>a.id),onSelect:a=>{s.setValue("grades",a.map(r=>({id:r.id,grade:r.grade,plafon:0})))}})}),s.getValues("grade_option")==="grade"?e.jsx("div",{className:"mt-4",children:e.jsx("table",{children:z.map((a,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Balance Grade ",a.grade]}),e.jsx("td",{children:":"}),e.jsx("td",{children:e.jsx("div",{children:e.jsx(o,{control:s.control,name:`grades.${r}.plafon`,render:({field:l})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(c,{type:"text",placeholder:"0",onChange:v=>{const y=v.target.value.replace(/[^0-9]/g,""),W=G(y,!1);l.onChange(y),v.target.value=W},value:G(l.value,!1)})}),e.jsx(d,{})]})})})})]},a))})}):null]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Group"}),e.jsx("td",{children:e.jsx(V,{options:T,fieldName:"material_group",isRequired:!0,disabled:!1,placeholder:"Material Group",classNames:"mt-2 w-full",onChangeOutside:async(a,r)=>{await b(r==null?void 0:r.label)},fieldLabel:""})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Number"}),e.jsx("td",{children:e.jsx(V,{fieldLabel:"",options:k,fieldName:"material_number",isRequired:!0,disabled:!1,placeholder:"Material Number",classNames:"mt-2 w-full",onChangeOutside:async a=>await U(a,String(s.getValues("material_group")))})})]})]}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(J,{type:"submit",children:"Save"})})]})})]})}export{Ue as default};
