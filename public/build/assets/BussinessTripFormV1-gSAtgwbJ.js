import{r as v,u as $e,j as e,b as Ye}from"./app-D7bkbgw5.js";/* empty css              */import{BusinessTripType as k}from"./models-zh_kS55V.js";import{C as Te,E as Fe,G as Ee,b as Re}from"./api-DtjMnnyq.js";import{u as qe,b as Q,a as Ve,c as ee}from"./index.esm-CrR-gKib.js";import{d as Me,F as x,a as j,b as _,c as g,I as y}from"./form-D2R9pz0W.js";import{S as ke,a as Pe,b as Be,c as Ie,d as Oe}from"./select-C6LlswU-.js";import{T as Le,a as Ge,b as Xe,c as Je}from"./tabs-Cl9Lx5KR.js";import{W as Ue}from"./WorkflowComponent-Dtv9pAYX.js";import{B as ue}from"./button-D457NNzm.js";import{F as We}from"./formDropdown-DMDCKAao.js";import{F as ze}from"./formSwitchCustom-BaGG4BV0.js";import{d as de}from"./index-CQl3MWzB.js";import{S as He}from"./scroll-area-8p6aKG7N.js";import{S as he}from"./separator-jNpnTeE-.js";import{T as Ze}from"./textarea-CE3gQSDF.js";import{a as me}from"./axiosInstance-CA7-wFjo.js";import{f as G}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{h as C}from"./moment-C5S46NFB.js";import{u as pe}from"./getDropdown-IwjX7fzT.js";import{z as n,t as Ke}from"./index-Bi3Sh8-3.js";import{B as Qe}from"./Button-D5J6nmsR.js";import{C as et}from"./chevrons-up-down-D4YRlH8a.js";import"./app-CfpADx9m.js";import"./CustomStatus-5MFYHqXt.js";import"./utils-DzpwfQyE.js";import"./createLucideIcon-DM1jNTYr.js";import"./index-JhKyf-Bp.js";import"./index-B12pdtN3.js";import"./index-BOZ9tTHv.js";import"./index-Bb4qSo10.js";import"./index-Dm3jz8Pq.js";import"./index-B6DSB332.js";import"./index-BdQq_4o_.js";import"./index-Djs5kr_A.js";import"./index-WJmRneL0.js";import"./Combination-JRM1GdkP.js";import"./index-fc5mIKBv.js";import"./index-De-7ZJuK.js";import"./index-YGwcm_1J.js";import"./index-BhKpdj2x.js";import"./createSvgIcon-Dvag0oQw.js";import"./DefaultPropsProvider-Bjfv3iFq.js";import"./TextField-CAEVkmiS.js";import"./useSlot-DYDINE2Y.js";import"./createSimplePaletteValueFilter-CXOlb8EV.js";import"./useControlled-B9Fy1pJe.js";import"./FormHelperText-BPYnxJzg.js";import"./Switch-DYF-JgpJ.js";import"./SwitchBase-C5giL6Xd.js";const tt=1*1024*1024,st=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],cs=({type:r,id:a})=>{var le;const m=n.object({request_no:n.string().nonempty("Request for required"),remark:n.string().nonempty("Remark is required"),attachment:n.array(n.instanceof(File).refine(o=>st.includes(o.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(o=>o.size<=tt,{message:"File size must be less than 1MB"})),total_destination:n.number().int("Total Destinantion Required"),cash_advance:n.boolean().nullable().optional(),reference_number:n.string().nullable().optional(),total_percent:n.number().nullable().optional(),total_cash_advance:n.string().nullable().optional(),destinations:n.array(n.object({restricted_area:n.boolean().optional(),destination:n.string().nonempty("Destinantion Required"),business_trip_start_date:n.date().optional(),business_trip_end_date:n.date().optional(),pajak_id:n.string().optional(),purchasing_group_id:n.string().optional(),detail_attedances:n.array(n.object({date:n.string().optional(),shift_code:n.string().optional(),shift_start:n.string().optional(),shift_end:n.string().optional(),start_time:n.string().optional(),end_time:n.string().optional(),start_date:n.string().optional(),end_date:n.string().optional(),request_start_time:n.string().optional(),request_end_time:n.string().optional()})),allowances:n.array(n.object({id:n.number().optional(),data_type:n.string().optional(),name:n.string().optional(),code:n.string().optional(),default_price:n.string().optional(),type:n.string().optional(),currency:n.string().optional(),subtotal:n.number().optional(),detail:n.array(n.object({id:n.number().optional(),data_type:n.string().optional(),date:n.string().nullish(),request_price:n.number().optional()}))})),other:n.array(n.object({value:n.number().optional()}))}))}).superRefine(({cash_advance:o,total_percent:h,attachment:s},c)=>{r===k.create&&s&&s.length===0&&c.addIssue({path:["attachment"],code:n.ZodIssueCode.too_small,minimum:1,type:"array",inclusive:!0,message:"Attachment is required"})}),l=qe({resolver:Ke(m),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{restricted_area:!1,destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),Y=(o,h)=>{var s;return o.type==="total"?parseFloat(((s=h==null?void 0:h[0])==null?void 0:s.request_price)||0):h==null?void 0:h.reduce((c,b)=>c+parseFloat(b.request_price||0),0)},p=()=>{const o=l.getValues("destinations");l.getValues("destinations.0.other");const h=o.reduce((c,b,q)=>{const A=(b.allowances||[]).reduce((N,E,$)=>{const R=l.getValues(`destinations.${q}.allowances.${$}.detail`),K=Y(E,R);return N+K},0);return c+A},0);let s=0;try{s=o.reduce((c,b,q)=>{const A=(b.other||[]).reduce((N,E,$)=>{const R=l.getValues(`destinations.${q}.other.${$}.value`);return N+(R===void 0?0:R)},0);return c+A},0)}catch(c){console.log(c),s=0}return h+s},[d,t]=v.useState(!1),{showToast:T}=$e(),[w,f]=v.useState(!1),u=async o=>{var h,s;try{f(!0);const c=l.getValues("destinations"),b=re(c),q=(h=i==null?void 0:i.business_trip_destination)==null?void 0:h.some(N=>N.restricted_area===!0||N.restricted_area==="1"||N.restricted_area===1),I=p(),A=new FormData;if(A.append("is_restricted_area",q?"true":"false"),A.append("day",b.toString()),A.append("user_id",((s=i==null?void 0:i.request_for)==null?void 0:s.id.toString())??""),A.append("value",I.toString()),A.append("request_no",o.request_no??""),A.append("remark",o.remark??""),A.append("total_destination",`${o.total_destination}`),o.destinations.forEach((N,E)=>{console.log(N,"item"),A.append(`destinations[${E}]`,JSON.stringify(N))}),r===k.create)o.attachment.forEach((N,E)=>{N&&A.append(`attachment[${E}]`,N)}),await de.Inertia.post(Te,A,{headers:{"Content-Type":"multipart/form-data"}}),T("succesfully created data","success");else{o.attachment.forEach(($,R)=>{$&&A.append(`attachment[${R}]`,$)}),Z.forEach(($,R)=>{$&&A.append(`file_existing[${R}]`,JSON.stringify($))});const N=Z.some($=>$),E=o.attachment.some($=>$);if(!N&&!E){T("Please add at least one attachment","error"),f(!1);return}await de.Inertia.post(`${Fe}/${a}`,A,{headers:{"Content-Type":"multipart/form-data"}}),T("succesfully updated data","success")}setTimeout(()=>{f(!1)},1e3)}catch(c){console.log(c)}},[i,D]=v.useState(null),[S,X]=v.useState([]),[P,M]=v.useState([]),[B,J]=v.useState(!1);async function U(o){const h=Ee(o);try{const s=await me.get(h),c=s.data.data;r===k.clone?(console.log(c.parent_id,"businessTripData"),l.setValue("request_no",c.parent_id.toString()||"")):l.setValue("request_no",o.toString()||""),J(c.cash_advance==1),l.setValue("remark",c.remarks||""),l.setValue("total_destination",c.total_destination||1),l.setValue("cash_advance",c.cash_advance==1),l.setValue("reference_number",c.reference_number),l.setValue("total_percent",Number(c.total_percent)),l.setValue("total_cash_advance",(c==null?void 0:c.total_cash_advance)!==null?G(c.total_cash_advance,!1):"0"),D(s.data.data),M(c.destinations),F(c.destinations),H(c.total_destination),console.log(l.getValues())}catch(s){console.log(s)}}const[te,H]=v.useState(""),se=o=>{H(o)};function F(o){const h=o.map(s=>({destination:s.destination||"",pajak:s.pajak||"",purchasing_group:s.purchasing_group||"",business_trip_start_date:new Date(s.business_trip_start_date),business_trip_end_date:new Date(s.business_trip_end_date),allowances:s.allowances||[],detail_attedances:s.detail_attedances||[],total_allowance:s.total_allowance||0,other:s.other||[],pajak_id:s.pajak_id.toString(),purchasing_group_id:s.purchasing_group_id.toString(),restricted_area:s.restricted_area==1||s.restricted_area==!0||s.restricted_area=="1"||s.restricted_area=="true"}));l.setValue("destinations",h)}const{fields:ae,append:ct,remove:dt,update:xe}=Q({control:l.control,name:"destinations"});v.useEffect(()=>{},[i,te]);const[ht,je]=v.useState(0),[_e,ge]=v.useState(!1),[W,fe]=v.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),re=o=>{const h=[];o.forEach(c=>{c.detail_attedances.forEach(b=>{b.date&&h.push(b.date),b.end_date&&h.push(b.end_date)})});const s=h.map(c=>new Date(c)).sort((c,b)=>c.getTime()-b.getTime());if(s.length===0)return 0;{const c=s[0],b=s[s.length-1];return Math.floor((b.getTime()-c.getTime())/(1e3*60*60*24))+1}},ve=async()=>{var o,h,s,c,b,q,I,A,N,E,$,R,K,oe;try{const O=l.getValues("destinations"),De=re(O);console.log(O,"day");const Ne=(o=i==null?void 0:i.business_trip_destination)==null?void 0:o.some(z=>z.restricted_area===!0||z.restricted_area==="1"||z.restricted_area===1),ie=p();if(ie===0){T("Please fill the balance","error");return}const L=await me.get("/check-approval",{params:{is_restricted_area:Ne,day:De,value:ie,user_id:((h=i==null?void 0:i.request_for)==null?void 0:h.id)??"",type:"TRIP_DECLARATION"}});if(L.data.status_code===200){const z=(c=(s=L.data)==null?void 0:s.data)==null?void 0:c.approval.map(V=>(V==null?void 0:V.division_name)||null),Se=(q=(b=L.data)==null?void 0:b.data)==null?void 0:q.approval.map(V=>(V==null?void 0:V.name)||null),ce=[];(A=(I=L.data)==null?void 0:I.data)!=null&&A.hr&&ce.push(($=(E=(N=L.data)==null?void 0:N.data)==null?void 0:E.hr)==null?void 0:$.name);const Ce=(((R=L.data.data)==null?void 0:R.approval)??[]).map(V=>({status:"",name:V.name,dateApproved:""}));fe({approvalRequest:z,approvalFrom:Se,acknowledgeFrom:ce,approvalFromStatusRoute:Ce}),ge(!0)}}catch(O){T((oe=(K=O==null?void 0:O.response)==null?void 0:K.data)==null?void 0:oe.message,"error")}},{dataDropdown:ye,getDropdown:we}=pe();pe(),v.useEffect(()=>{we("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:k.create===r?"true":"false"})},[l.watch("destinations")]);const[Z,ne]=v.useState([]);async function be(){l.setValue("destinations",[]);const o=Re(a),s=(await Ye.get(o)).data.data;await U(s.id),ne(s.attachments)}v.useEffect(()=>{a&&r===k.clone&&be()},[r]);const Ae=o=>{ne(h=>h.filter(s=>s.id!==o))};return e.jsx(He,{className:"h-[600px] w-full ",children:e.jsx(Me,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(u),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:ye,fieldName:"request_no",isRequired:!0,disabled:k.create!==r,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:o=>{U(o)}})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:i.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:i.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(le=i==null?void 0:i.cost_center)==null?void 0:le.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(x,{control:l.control,name:"remark",render:({field:o})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(Ze,{placeholder:"Insert remark",...o,rows:4,className:"w-[300px]"})}),e.jsx(g,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(x,{control:l.control,name:"attachment",render:({field:o})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:h=>{const s=h.target.files;if(s){const c=Array.from(s);o.onChange(c)}else o.onChange([])}})}),l.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(l.formState.errors.attachment)?l.formState.errors.attachment.map((h,s)=>e.jsx("span",{children:h.message},s)):l.formState.errors.attachment.message})]})})})]}),Z.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:Z.map((o,h)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:o.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:o.file_name},h),e.jsx("button",{type:"button",onClick:()=>Ae(o.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(x,{control:l.control,name:"total_destination",render:({field:o})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsxs(ke,{value:te,onValueChange:se,disabled:!0,children:[e.jsx(Pe,{className:"w-[200px] py-2",children:e.jsx(Be,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Ie,{children:Array.from({length:5},(h,s)=>e.jsxs(Oe,{value:(s+1).toString(),children:[" ",s+1," "]},s))})]})}),e.jsx(g,{})]})})]})]})]}),e.jsx(he,{className:"my-4"}),e.jsx(at,{updateDestination:xe,destinationField:ae,form:l,listAllowances:S,totalDestination:l.getValues("total_destination").toString(),setTotalAllowance:je,businessTripDetail:i,type:r,btEdit:k.edit,setIsCashAdvance:J,isCashAdvance:B,setOtherAllowance:t,otherAllowance:d}),e.jsx(he,{className:"my-4"}),e.jsx(Qe,{onClick:async()=>await ve(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:_e&&e.jsx(Ue,{workflowApproval:{approvalRequest:W.approvalRequest,approvalFrom:W.approvalFrom,acknowledgeFrom:W.acknowledgeFrom},workflowApprovalStep:W.approvalFromStatusRoute,workflowApprovalDiagram:W.approvalFrom})}),e.jsx(ue,{type:"submit",loading:w,children:"submit"})]})})})};function at({totalDestination:r,listAllowances:a,form:m,destinationField:l,updateDestination:Y,setTotalAllowance:p,businessTripDetail:d,type:t,btEdit:T,setIsCashAdvance:w,isCashAdvance:f,setOtherAllowance:u,otherAllowance:i}){return e.jsxs(Le,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ge,{className:"flex items-center justify-start space-x-4",children:l.map((D,S)=>e.jsxs(Xe,{value:`destination${S+1}`,children:["Destination ",S+1]}))}),l.map((D,S)=>e.jsx(rt,{listAllowances:a,updateDestination:Y,destination:D,form:m,index:S,setTotalAllowance:p,businessTripDetail:d,type:t,btEdit:k.edit,setIsCashAdvance:w,isCashAdvance:f,setOtherAllowance:u,otherAllowance:i},S))]})}function rt({form:r,index:a,destination:m,updateDestination:l,listAllowances:Y,setTotalAllowance:p,businessTripDetail:d,type:t,btEdit:T,setIsCashAdvance:w,isCashAdvance:f,setOtherAllowance:u,otherAllowance:i}){const{fields:D,update:S,append:X,remove:P}=Q({control:r.control,name:`destinations[${a}].detail_attedances`}),{fields:M,update:B,append:J,remove:U,replace:te}=Q({control:r.control,name:`destinations[${a}].allowances`}),H=F=>{w(F)};Ve(),ee({control:r.control,name:"total_percent"});const se=d==null?void 0:d.total_cash_advance;return v.useEffect(()=>{},[se]),e.jsxs(Je,{value:`destination${a+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:m.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Restricted Area"}),e.jsx("td",{children:m.restricted_area==!0||m.restricted_area==1?"Yes":"No"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:m==null?void 0:m.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:m==null?void 0:m.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:C(m.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:C(m.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(nt,{detailAttedanceFields:D,form:r,updateAttedanceFields:S,destinationIndex:a}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(lt,{allowanceField:M,destinationIndex:a,form:r,setOtherAllowance:u,otherAllowance:i})]},a),e.jsx(it,{allowanceField:M,destinationIndex:a,form:r,setTotalAllowance:p}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(ze,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:F=>H(F.target.checked)})})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(x,{control:r.control,name:"reference_number",render:({field:F})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{value:F.value||"",onChange:ae=>F.onChange(ae.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(g,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(x,{control:r.control,name:"total_percent",render:({field:F})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{...F,value:F.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:"total_cash_advance",render:({field:F})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{value:F.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(g,{})]})})]})]})]})]})]})}function nt({form:r,destinationIndex:a,detailAttedanceFields:m,updateAttedanceFields:l}){const Y=r.watch(`destinations[${a}].detail_attedances`);return v.useEffect(()=>{},[Y]),v.useEffect(()=>{},[m]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Request: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"})]}),e.jsx("tbody",{children:Y.map((p,d)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[C(p.date).format("DD/MM/YYYY"),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_code,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.shift_code`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_start,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.shift_start`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_end,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.shift_end`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.request_start_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.request_start_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.request_end_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.request_end_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(g,{})]})})]})]},p.index))})]})})}),e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Declaration: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:Y.map((p,d)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[C(p.date).format("DD/MM/YYYY"),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_code,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.shift_code`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_start,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.shift_start`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_end,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.shift_end`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.start_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.start_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.end_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${d}.end_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(g,{})]})})]})]},p.index))})]})})})]})}function lt({form:r,destinationIndex:a,allowanceField:m,setOtherAllowance:l,otherAllowance:Y}){const p=r.watch(`destinations[${a}].allowances`);return v.useEffect(()=>{},[p]),Q({control:r.control,name:`destinations.${a}.other`}),ee({control:r.control,name:`destinations.${a}.other`}),e.jsx("table",{className:"w-full allowance-table",children:p.map((d,t)=>e.jsx(ot,{form:r,allowance:d,destinationIndex:a,allowanceIndex:t},t))})}function ot({form:r,allowance:a,destinationIndex:m,allowanceIndex:l}){const[Y,p]=v.useState(!1);v.useState(0);const d=u=>{p(i=>!i)},t=ee({control:r.control,name:`destinations[${m}].allowances[${l}].detail[0].request_price`}),T=ee({control:r.control,name:`destinations[${m}].allowances[${l}].detail`}),w=()=>{if(a.type==="total")return parseFloat(t||0)*1;{let u=0;return T==null||T.forEach(i=>{const D=parseFloat(i.request_price||0);u+=D}),u}},f=(u,i)=>{const D=parseFloat(i),S=isNaN(D)?0:D,X=a.request_value;let P=!0;switch(X){case"unlimited":P=!0;break;case"fixed value":const M=a.default_price;S!==M&&(alert(`Please enter the fixed value of IDR ${M}`),P=!1);break;case"up to max value":const B=a.default_price;S>B&&(alert(`The value should not exceed IDR ${B}`),P=!1);break;default:P=!1}if(P){r.setValue(`destinations[${m}].allowances[${l}].detail[${u}].request_price`,S);const B=r.getValues(`destinations[${m}].allowances[${l}].detail`).reduce((J,U)=>J+(parseFloat(U.request_price)||0),0);r.setValue(`destinations[${m}].allowances[${l}].subtotal`,B)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:a.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:a.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:a.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{control:r.control,name:`destinations[${m}].allowances[${l}].detail[0].request_price`,render:({field:u})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{value:u.value,onChange:i=>f(0,i.target.value)})}),e.jsx(g,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",a.detail.length," Days * ",G(a.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",G(w(),!1)]})})}),a.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(ue,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},a.id),Y&&e.jsx(e.Fragment,{children:a.detail.map((u,i)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:C(u.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(x,{control:r.control,name:`destinations[${m}].allowances[${l}].detail[${i}].request_price`,render:({field:D})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(y,{value:D.value,onChange:S=>f(i,S.target.value)})}),e.jsx(g,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},u.id))})]})}function it({allowanceField:r,destinationIndex:a,form:m,setTotalAllowance:l}){const[Y,p]=v.useState(0),d=m.watch(`destinations.${a}.other`),t=m.watch(`destinations[${a}].allowances`);v.useEffect(()=>{const w=t.reduce((u,i,D)=>{const S=m.getValues(`destinations.${a}.allowances.${D}.detail`),X=T(i,S);return u+X},0),f=Array.isArray(d)?d.reduce((u,i)=>{const D=Number(i==null?void 0:i.value)||0;return u+D},0):0;p(w+f)},[t,m.watch()]);const T=(w,f)=>{var u;return w.type==="total"?parseFloat(((u=f==null?void 0:f[0])==null?void 0:u.request_price)||0):f==null?void 0:f.reduce((i,D)=>i+parseFloat(D.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsxs("tbody",{children:[t.map((w,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:G(w.subtotal)})]})]},w.id)),Array.isArray(d)&&d.length>0&&e.jsx(e.Fragment,{children:d.map((w,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:"Other Allowance"}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:w!=null&&w.value?G(w.value):"0"})]})]},f))})]}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:G(Y)})]})]})})]})})}export{ot as AllowanceRowInput,at as BussinesTripDestination,rt as BussinessDestinationForm,cs as BussinessTripFormV1,lt as DetailAllowance,nt as DetailAttedances,it as ResultTotalItem};
