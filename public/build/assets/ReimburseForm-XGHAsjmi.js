import{j as e,r as F,u as at,q as st}from"./app-CBNdeMY3.js";import{B as rt}from"./button-CK-KPJR9.js";import{h as G}from"./moment-C5S46NFB.js";import{z as u,t as nt}from"./index-DKSMznVL.js";import{f as H}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ot,F as v,a as D,b as N,c as C,f as it,e as lt}from"./form-DaDW26tQ.js";import{u as ct,b as mt}from"./index.esm-CjbQQAAR.js";import{T as we}from"./textarea-DLXZhlD8.js";/* empty css                  */import{S as dt}from"./scroll-area-CkuvEse8.js";import{a as $}from"./axiosInstance-SHrf3PCJ.js";import{S as ve}from"./separator-47egh_Lu.js";import{T as pt,a as ut,b as ht,c as ft}from"./tabs-yQOzjaEh.js";import{S as W,a as Z,b as J,c as K,d as X}from"./select-kXx7MwUz.js";import{F as se}from"./formDropdown-C6BLP9RM.js";import{C as De}from"./CustomDatePicker-BLloHZ-y.js";import{I as Ne}from"./input-BS9HkrKp.js";import{ReimburseFormType as b}from"./listModel-DZBl0p_L.js";import{u as Q}from"./getDropdown-xcgmSbmk.js";import{G as gt,a as Ce,b as _t}from"./api-DXF7erOJ.js";import{L as jt}from"./LoadingSpin-CeB6459s.js";import{W as bt}from"./WorkflowComponent-CodP_BA3.js";import{C as xt}from"./CustomStatus-BpRDCPNw.js";import{F as Se}from"./FormHelperText-CG3ASoGQ.js";import{B as yt}from"./Button-8XZwUIZ_.js";import"./app-DQK4SJPx.js";import"./index-DVwPJElP.js";import"./index-Bb4qSo10.js";import"./utils-Ce9RAZZe.js";import"./createLucideIcon-DdG0jIGK.js";import"./index-AaHwPcrS.js";import"./index-BxgO_58K.js";import"./index-C-sEdfZj.js";import"./index-mWuEXGHR.js";import"./index-DBETj0W1.js";import"./index-BdQq_4o_.js";import"./index-BU1n5lpW.js";import"./index-CxTyHqNU.js";import"./index-Cnf1uR4C.js";import"./index-D2vJxOId.js";import"./index-BWFMFcao.js";import"./Combination-BG_-S06P.js";import"./index-mM5gB3fP.js";import"./TextField-B47rpMUr.js";import"./createSvgIcon-hYQn8GBM.js";import"./DefaultPropsProvider-qKt8bEUR.js";import"./useSlot-DDBo6OnS.js";import"./createSimplePaletteValueFilter-CokTK5Bk.js";import"./useControlled-DFZMTYkI.js";function wt({isLoading:re=!1,children:ne}){return e.jsx("div",{className:"",children:re?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(jt,{})})}):ne})}const xa=({onSuccess:re,currencies:ne,taxDefaultValue:pe,uomDefaultValue:ue,categories:vt,users:Dt,edit_url:Fe,update_url:Ie,store_url:qe,type:f,currentUser:R})=>{const[Ee,Te]=F.useState("form1"),{showToast:k}=at();st().props;const{dataDropdown:Re,getDropdown:he}=Q(gt),{dataDropdown:ke,getDropdown:Le}=Q(),{dataDropdown:Ye,getDropdown:Me}=Q(),{dataDropdown:$e,getDropdown:fe}=Q("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:Ae,getDropdown:ge}=Q("api/master/cost-center/dropdown-list"),[V,oe]=F.useState([]),[Be,ie]=F.useState([]),[I,Pe]=F.useState(!1),[_e,Ve]=F.useState(!1),[Ge,U]=F.useState(!1),[g,A]=F.useState([]),[z,ze]=F.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Oe=1*1024*1024,He=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],We=u.object({formCount:u.string().min(1,"total form must be have value"),remark_group:u.string().min(1,"header remark is required"),cost_center:u.string().min(1,"cost center required"),requester:u.string().min(1,"requester required"),value:u.number().optional(),user_id:u.string().optional(),forms:u.array(u.object({reimburseId:u.string().optional(),for:u.string().optional(),group:u.string().optional(),reimburse_type:u.string().min(1,"reimburse type is required"),short_text:u.string().min(1,"remarks is required"),balance:u.string(),remaining_balance_when_request:u.number(),currency:u.string().min(1,"currency required"),tax_on_sales:u.string().min(1,"tax required"),purchase_requisition_unit_of_measure:u.string().min(1,"uom required"),purchasing_group:u.string().min(1,"Purchasing Group required"),type:u.any(),item_delivery_data:u.date(),claim_date:u.date(),attachment:u.array(u.instanceof(File).refine(a=>He.includes(a.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(a=>a.size<=Oe,{message:"File size must be less than 1MB"})).min(f===b.create?1:0,"Attachment is required")}))});F.useEffect(()=>{Me("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}}),Le("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms",where:{key:"iso_code",parameter:"PCE"}}),fe("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),ge("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),he("",{name:"name",id:"nip",tabel:"users"}),s.getValues("requester")!==""&&O(0)},[]);const Ze={formCount:"1",remark_group:"",cost_center:"",requester:String(R==null?void 0:R.is_admin)==="1"?"":R==null?void 0:R.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:pe,purchase_requisition_unit_of_measure:ue,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},s=ct({resolver:nt(We),defaultValues:Ze}),{fields:le,update:_}=mt({control:s.control,name:"forms"});async function Je(){s.setValue("forms",[]),U(!0);try{const a=await $.get(Fe??""),t=a.data.data.group,n=a.data.data.forms;Pe(t.reimbursementStatus);const p=n.map(l=>({reimburseId:String(l.id),for:String(l.for),group:String(l.group),reimburse_type:l.reimburse_type.code,short_text:l.short_text,balance:f===b.edit?l.balance:"",currency:l.currency,tax_on_sales:String(l.tax_on_sales),purchase_requisition_unit_of_measure:String(l.purchase_requisition_unit_of_measure),purchasing_group:String(l.purchasing_group),type:l.type,item_delivery_data:new Date(l.item_delivery_data),claim_date:new Date(l.claim_date),attachment:[]}));s.setValue("formCount",n.length.toString()),s.setValue("remark_group",t.remark),s.setValue("cost_center",String(t.cost_center.id)),s.setValue("requester",t.requester);let m=0;for(const l of n)await O(m,{reimburse_type:l.reimburse_type.code}),await je(m,{type:l.type,reimburse_type:l.reimburse_type.code}),await ce(m,{reimburse_type:l.reimburse_type.code,for:l.reimburse_type.is_employee===1?null:l.for}),m++;s.setValue("forms",p),U(!1)}catch{U(!1)}}F.useEffect(()=>{(f===b.edit||f===b.clone)&&(U(!0),Je())},[f]);const O=async(a,t=null)=>{const n=s.getValues("requester");if(n===null){oe(m=>{const l=[...m];return l[a]=[],l});return}const p=await $.get(Ce,{params:{user:n,hasValue:t!=null?t.reimburse_type:null},headers:{"Content-Type":"application/json"}});oe(m=>{const l=[...m];return l[a]=p.data.data,l})},Ke=async(a,t)=>{if(a&&a.length>0)try{const n=await $.get(Ce,{params:{search:a,user:s.getValues("requester")}});oe(p=>{const m=[...p];return m[t]=n.data.data,m})}catch(n){console.error("Error searching reimburse types:",n)}},je=async(a,t)=>{const n=await $.get(_t,{params:{user:s.getValues("requester"),familyRelationship:t.type=="Family"?"0":"1",reimburseType:t.reimburse_type},headers:{"Content-Type":"application/json"}});ie(p=>{const m=[...p];return m[a]=n.data.data,m})},Xe=a=>{for(let t=0;t<le.length;t++)O(t);if(a==null)for(let t=0;t<le.length;t++)s.setValue(`forms.${t}.reimburse_type`,""),s.setValue(`forms.${t}.for`,"");A([]),ie([])};function Qe(a){const t=[...s.getValues("forms")];for(let n=0;n<parseInt(a);n++)if(n+1>t.length){O(n);const p={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:pe,purchase_requisition_unit_of_measure:ue,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};t.push(p)}s.setValue("forms",t)}const be=a=>{Te(a)},Ue=async a=>{var n,p,m,l,h;if(g)for(let c=0;c<g.length;c++){if(a.forms.length==0||a.forms.length-1,((n=g[c])==null?void 0:n.type_limit)!=="Unlimited"&&parseInt((p=g[c])==null?void 0:p.limit)==0){k("Claim Limit for form "+(c+1)+" is Empty, Please Contact the Admin","error");return}if(a.forms[c].balance==""||parseInt(a.forms[c].balance)==0){k("Claim Balance for form "+(c+1)+" cannot be 0","error");return}if(parseInt(((m=g[c])==null?void 0:m.balance)??0)<parseInt(a.forms[c].balance??0)){k("Please check your balance input for forms "+(c+1)+"  is not must be above "+((l=g[c])==null?void 0:l.balance),"error");return}a.forms=a.forms.map((w,q)=>{var E;return{...w,claim_date:G(w.claim_date).format("YYYY-MM-DD"),item_delivery_data:G(w.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:parseInt(((E=g[q])==null?void 0:E.balance)??0)}})}const t=a.forms.reduce((c,w)=>c+parseInt(w.balance)||0,0);a.value=t,a.user_id=(a==null?void 0:a.requester)||"0";try{let c;f===b.edit?c=await $.put(Ie??"",a,{headers:{"Content-Type":"multipart/form-data"}}):c=await $.post(qe??"",a,{headers:{"Content-Type":"multipart/form-data"}}),k((h=c==null?void 0:c.data)==null?void 0:h.data,"success"),re()}catch{}};async function ce(a,t=null){var m,l;const n=s.getValues(`forms.${a}`),p={user:s.getValues("requester"),reimbuse_type:t!=null?t.reimburse_type:n.reimburse_type,for:t!=null?t.for:n.for};try{const h=await $.get("reimburse/data-limit-and-balance",{params:p});A(c=>{const q=s.getValues("forms").filter((x,L)=>L!==a&&x.reimburse_type===n.reimburse_type),E=q.reduce((x,L)=>x+parseInt(L.balance)||0,0),M=[...c];return M[a]={...h.data.data,balance:h.data.data.balance-E,limit:h.data.data.type_limit=="Unlimited"?h.data.data.type_limit:Math.max(0,h.data.data.limit-q.length)},M})}catch(h){k((l=(m=h==null?void 0:h.response)==null?void 0:m.data)==null?void 0:l.message,"error")}}const xe=async()=>{var a,t,n,p,m,l,h,c,w,q,E,M;try{const x=s.getValues("forms"),L=x.map((y,T)=>({index:T,value:y.balance?parseInt(y.balance):0}));if(L.some(y=>y.value===0)){const y=L.findIndex(T=>T.value===0);k(`Please fill the balance for form ${y+1}`,"error");return}const ee=x.reduce((y,T)=>y+(parseInt(T.balance)||0),0),Y=await $.get("/check-approval",{params:{value:ee,requester:s.getValues("requester"),type:"REIM"}});if(Y.data.status_code===200){const y=(t=(a=Y.data)==null?void 0:a.data)==null?void 0:t.approval.map(i=>(i==null?void 0:i.division_name)||null),T=(p=(n=Y.data)==null?void 0:n.data)==null?void 0:p.approval.map(i=>(i==null?void 0:i.name)||null),o=[];(l=(m=Y.data)==null?void 0:m.data)!=null&&l.hr&&o.push((w=(c=(h=Y.data)==null?void 0:h.data)==null?void 0:c.hr)==null?void 0:w.name);const r=(((q=Y.data.data)==null?void 0:q.approval)??[]).map(i=>({status:"",name:i.name,dateApproved:""}));ze({approvalRequest:y,approvalFrom:T,acknowledgeFrom:o,approvalFromStatusRoute:r}),Ve(!0)}}catch(x){k((M=(E=x==null?void 0:x.response)==null?void 0:E.data)==null?void 0:M.message,"error")}};return F.useEffect(()=>{s.getValues("forms").reduce((n,p)=>n+parseInt(p.balance)||0,0)>0&&_e===!0&&xe()},[s.watch("forms"),s.watch("requester")]),e.jsx(dt,{className:"h-[600px] w-full",children:e.jsx(wt,{isLoading:Ge,children:e.jsx(ot,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(Ue),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:I&&e.jsx(xt,{name:I==null?void 0:I.name,className:I==null?void 0:I.classname,code:I==null?void 0:I.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:"remark_group",render:({field:a})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(we,{placeholder:"Insert remark",...a})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(se,{fieldLabel:"",options:Ae,fieldName:"cost_center",disabled:f===b.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async a=>{a.length>0&&await ge(a,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(se,{options:Re,fieldName:"requester",disabled:String(R==null?void 0:R.is_admin)==="0"||f===b.edit,placeholder:"Select Employee",onSearch:async a=>{a.length>0&&await he(a,{name:"name",id:"nip",tabel:"users"})},onChangeOutside:a=>Xe(a),classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:"formCount",render:({field:a})=>{var t;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:f===b.edit,onValueChange:n=>{a.onChange(n),Qe(n),be(`form${parseInt(n)}`);const p=s.getValues("forms");if(p.length>parseInt(n)){const m=p.slice(0,parseInt(n));s.setValue("forms",m),A(l=>{let h=[...l];return h=h.slice(0,parseInt(n)),h})}},value:(t=a.value)==null?void 0:t.toString(),children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"Select number of forms"})}),e.jsx(K,{children:Array.from({length:3},(n,p)=>p+1).map(n=>e.jsx(X,{value:n.toString(),children:n},n))})]})}),e.jsx(C,{})]})}})})]})]})}),e.jsx(ve,{className:"my-4"}),e.jsxs(pt,{value:Ee,onValueChange:be,className:"w-full",children:[e.jsxs(ut,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:s.watch("formCount")||1}).map((a,t)=>e.jsxs(ht,{value:`form${t+1}`,children:["Form ",t+1]},t))]}),le.map((a,t)=>{var n,p,m,l,h,c,w,q,E,M,x,L,me,ee,Y,y,T;return e.jsxs(ft,{value:`form${t+1}`,children:[e.jsx(v,{control:s.control,name:`forms.${t}.reimburseId`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ne,{className:"sr-only",value:a.reimburseId,onChange:o.onChange})}),e.jsx(C,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(se,{options:V[t],fieldName:`forms.${t}.reimburse_type`,disabled:s.getValues("requester")==""||f===b.edit,placeholder:"Select Reimburse Type",onSearch:async o=>{var d;((d=V[t])==null?void 0:d.some(i=>i.label===o))||await Ke(o,t)},onChangeOutside:async o=>{if(await O(t),o){let r=V[t].filter(d=>d.value==o)[0];_(t,{...a,reimburse_type:o,type:r.is_employee===1?"Employee":"Family"}),r.is_employee===1?ce(t,{reimburse_type:o,for:null}):(A(d=>{const i=[...d];return i[t]=[],i}),s.setValue(`forms.${t}.balance`,""),je(t,{type:"Family",reimburse_type:o}))}else{A(d=>{const i=[...d];return i[t]=[],i}),_(t,{...a,balance:""}),s.setValue(`forms.${t}.for`,""),ie(d=>{const i=[...d];return i[t]=[],i});const r=s.getValues("forms");r.forEach((d,i)=>{var S,j;if(i>t&&r[i].reimburse_type===a.reimburse_type){const te=((S=g[i])==null?void 0:S.balance)||0,ye=((j=g[i])==null?void 0:j.limit)||0;A(ae=>{var P;const B=[...ae];return B[i]={...B[i],balance:te+parseInt(a.balance||"0")},((P=g[i])==null?void 0:P.type_limit)!=="Unlimited"&&(B[i]={...B[i],limit:ye+1}),B}),s.setValue(`forms.${i}.balance`,"")}})}},classNames:"mt-2 w-full"}),((m=(p=(n=s.formState.errors)==null?void 0:n.forms)==null?void 0:p[t])==null?void 0:m.reimburse_type)&&e.jsx(Se,{error:!0,children:(w=(c=(h=(l=s.formState.errors)==null?void 0:l.forms)==null?void 0:h[t])==null?void 0:c.reimburse_type)==null?void 0:w.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:`forms.${t}.for`,render:({field:o})=>{var r,d,i,S;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:((i=(d=(r=V==null?void 0:V[t])==null?void 0:r.filter(j=>(j==null?void 0:j.value)==s.getValues(`forms.${t}.reimburse_type`)))==null?void 0:d[0])==null?void 0:i.is_employee)===1||f===b.edit,onValueChange:j=>{_(t,{...a,for:j}),ce(t,{reimburse_type:s.getValues(`forms.${t}.reimburse_type`),for:j})},defaultValue:a==null?void 0:a.for,value:a.for,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(S=Be[t])==null?void 0:S.map(j=>e.jsx(X,{value:j.value.toString(),children:j.label},j.value))})]})}),e.jsx(C,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(se,{fieldLabel:"",options:$e,fieldName:`forms.${t}.purchasing_group`,disabled:f===b.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:async o=>{o.length>0&&await fe(o,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:async o=>{o&&_(t,{...a,purchasing_group:o})}}),((M=(E=(q=s.formState.errors)==null?void 0:q.forms)==null?void 0:E[t])==null?void 0:M.purchasing_group)&&e.jsx(Se,{error:!0,children:(ee=(me=(L=(x=s.formState.errors)==null?void 0:x.forms)==null?void 0:L[t])==null?void 0:me.purchasing_group)==null?void 0:ee.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:`forms.${t}.tax_on_sales`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:!0,onValueChange:r=>{_(t,{...a,tax_on_sales:r})},defaultValue:a.tax_on_sales,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(Ye??[]).map((r,d)=>e.jsxs(X,{value:r.value.toString(),children:[r.description," - ",r.label]},r.value))})]})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:`forms.${t}.purchase_requisition_unit_of_measure`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:!0,onValueChange:r=>{_(t,{...a,purchase_requisition_unit_of_measure:String(r)})},defaultValue:a.purchase_requisition_unit_of_measure,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(ke??[]).map((r,d)=>e.jsx(X,{value:r.value.toString(),children:`${r.label} - ${r.iso_code}`},r.value))})]})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:`forms.${t}.short_text`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(we,{placeholder:"Insert remark",onChange:r=>{_(t,{...a,short_text:r.target.value})},defaultValue:a.short_text})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((Y=g[t])==null?void 0:Y.balance)&&H((y=g[t])==null?void 0:y.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(T=g[t])==null?void 0:T.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:`forms.${t}.item_delivery_data`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(De,{disabled:f===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:r=>{G(r).format("YYYY-MM-DD")>=G(new Date).format("YYYY-MM-DD")?(o.onChange(r),_(t,{...a,item_delivery_data:r})):(o.onChange(o.value),_(t,{...a,item_delivery_data:o.value}),k("Receipt date cannot be less than today","error"))}})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(v,{control:s.control,name:`forms.${t}.claim_date`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(De,{disabled:f===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:r=>{G(r).format("YYYY-MM-DD")>=G(new Date).format("YYYY-MM-DD")?(o.onChange(r),_(t,{...a,claim_date:r})):(o.onChange(o.value),_(t,{...a,claim_date:o.value}),k("Claim date cannot be less than today","error"))}})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(v,{control:s.control,name:`forms.${t}.currency`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:f===b.edit,onValueChange:r=>{_(t,{...a,currency:r})},defaultValue:a.currency,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:ne.map(r=>e.jsxs(X,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(it,{className:"h-6"}),e.jsx(C,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(v,{control:s.control,name:`forms.${t}.balance`,render:({field:o})=>{var r;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ne,{type:"text",placeholder:"0",onChange:d=>{var ae;const i=d.target.value.replace(/[^0-9]/g,""),S=H(i,!1),j=parseInt(i)||0,te=((ae=g[t])==null?void 0:ae.balance)||0;if(j>te){d.target.value=H(i.slice(0,-1),!1);return}_(t,{...a,balance:i}),d.target.value=S,s.getValues("forms").forEach((B,P)=>{if(P>t&&B.reimburse_type===a.reimburse_type){const et=te-j;A(tt=>{const de=[...tt];return de[P]={...de[P],balance:et},de}),_(P,{...a,balance:""})}})},defaultValue:H(a.balance,!1),value:H(a.balance,!1),disabled:typeof g[t]>"u"||((r=g[t])==null?void 0:r.length)===0||f===b.edit})}),e.jsx(C,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(v,{control:s.control,name:`forms.${t}.attachment`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(lt,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(N,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:r=>{const d=r.target.files;if(d){const i=[...a.attachment],S=Array.from(d);i.push(...S),_(t,{...a,attachment:i})}}})}),e.jsx(C,{})]})}),e.jsx("div",{className:"mt-2",children:a.attachment&&a.attachment.length>0&&e.jsx("ul",{children:a.attachment.map((o,r)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsx("button",{type:"button",className:"text-red-500 ml-2",onClick:()=>{const d=a.attachment.filter((i,S)=>S!==r);_(t,{...a,attachment:d})},children:"Delete"})]},r))})})]})]})]})})})]},t)})]}),e.jsx(yt,{onClick:async()=>await xe(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:_e&&e.jsx(bt,{workflowApproval:{approvalRequest:z.approvalRequest,approvalFrom:z.approvalFrom,acknowledgeFrom:z.acknowledgeFrom},workflowApprovalStep:z.approvalFromStatusRoute,workflowApprovalDiagram:z.approvalFrom})}),e.jsx(ve,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(rt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{xa as ReimburseForm};
