import{r as m,u as we,j as e,a as Ie}from"./app-Be6M2fT_.js";/* empty css              */import{BusinessTripType as K}from"./models-DFx3Rh9a.js";import{d as ke,C as Re,E as Me}from"./api-C1Ya95ai.js";import{d as Be,F as j,a as _,b as f,c as b,e as Ge}from"./form-Bqj9W90p.js";import{G as Le,a as Oe}from"./api-BG2DVmVj.js";import{S as k,a as R,b as M,c as B,d as Y}from"./select-Cl9ppFD3.js";import{T as Xe,a as ze,b as Ue,c as We}from"./tabs-BOkOrrXf.js";import{W as Je}from"./WorkflowComponent-C6NcesJ8.js";import{u as He,b as oe,c as ee}from"./index.esm-DvGcgfJd.js";import{B as pe}from"./button-D9I6fqsa.js";import{C as fe}from"./CustomDatePicker-BKica14g.js";import{F as Ke}from"./formSwitchCustom-Cbzz5wkE.js";import{b as ge}from"./api-Cpn27s-b.js";import{d as be}from"./index-DoSqtrdw.js";import{I as P}from"./input-CLqpzjU7.js";import{S as Ze}from"./scroll-area-x40DKWSx.js";import{S as ye}from"./separator-BGSkmmLG.js";import{T as Qe}from"./textarea-Dsk0YdK3.js";import{a as Z}from"./axiosInstance-BLjOFJnu.js";import{h as $}from"./moment-C5S46NFB.js";import{o as U,a as Q,s as w,b as et,n as le,d as re,c as tt,i as st,t as at}from"./types-B2LRMPRC.js";import{B as nt}from"./Button-B6PzDcOW.js";import{C as rt}from"./chevrons-up-down-6ZpNY2LX.js";import"./app-DGQxOE2s.js";import"./CustomStatus-BLlG1q5J.js";import"./utils-Dk20wIs4.js";import"./createLucideIcon-f9UzA3ry.js";import"./index-M0f3qnFz.js";import"./index-Dfgv-xyP.js";import"./index-O6OmLSSH.js";import"./index-DfgcakwC.js";import"./index-D8Ucsd7w.js";import"./index-CIqNE1bK.js";import"./index-BdQq_4o_.js";import"./index-Bn1ppAsc.js";import"./index-D6L2dfih.js";import"./index-B6OTybxb.js";import"./index-B6iGFQvo.js";import"./index-COaEoZfB.js";import"./index-BuFOivdq.js";import"./index-BBKP0_5R.js";import"./createSvgIcon-BWnJAA5N.js";import"./DefaultPropsProvider-CzVas_rO.js";import"./Switch-3yY1flSF.js";import"./createSimplePaletteValueFilter-DXT-pLYJ.js";import"./SwitchBase-D3YK3ppx.js";import"./FormHelperText-USbXtn8_.js";import"./useSlot-Ddczxza8.js";import"./CircularProgress-B3CYqmq0.js";U({remark:w().min(1).max(50),reimburse_cost:le()});const lt=1*1024*1024,ot=["image/jpeg","image/png","application/pdf"],xs=({users:o,listPurposeType:n,pajak:l,costcenter:d,purchasingGroup:D,type:p,id:u,isAdmin:r,idUser:h})=>{const E=U({purpose_type_id:w().min(1,"Purpose type required"),request_for:w().min(1,"Request is required"),cost_center_id:w().min(1,"Cost Center is required"),remark:w().min(1,"Remark is required"),attachment:Q(st(File).refine(s=>ot.includes(s.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(s=>s.size<=lt,{message:"File size must be less than 1MB"})),total_destination:le().min(1,"Total Destinantion Required"),cash_advance:et().nullable().optional(),reference_number:w().nullable().optional(),total_percent:w().nullable().optional(),total_cash_advance:w().nullable().optional(),destinations:Q(U({destination:w().min(1,"Destinantion is Required"),pajak_id:w().min(1,"Pajak is required"),purchasing_group_id:w().min(1,"Purchasing Group is required"),business_trip_start_date:re().optional(),business_trip_end_date:re().optional(),detail_attedances:Q(U({date:re().optional(),shift_code:w().optional(),shift_start:w().optional(),shift_end:w().optional(),start_time:w().optional(),end_time:w().optional()})),allowances:Q(U({name:w().optional(),code:w().optional(),default_price:le().optional(),type:w().optional(),subtotal:le().optional(),currency:w().optional(),detail:Q(U({date:re().nullish(),request_price:tt().optional()}))}))}))}),[A,x]=m.useState("1"),a=He({resolver:at(E),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[N,V]=m.useState([]);async function z(){const s=ke(u);a.setValue("destinations",[]);try{const i=(await Ie.get(s)).data.data,g=ge(i.purpose_type_id),F=await Z.get(g);c(F.data.data),V(i.attachments),a.setValue("purpose_type_id",i.purpose_type_id.toString()),a.setValue("request_for",i.request_for.id.toString()),a.setValue("cost_center_id",i.cost_center_id.toString()),a.setValue("remark",i.remarks),a.setValue("total_destination",i.total_destination),a.setValue("cash_advance",i.cash_advance==1),a.setValue("reference_number",i.reference_number),a.setValue("total_percent",i.total_percent),a.setValue("total_cash_advance",i.total_cash_advance),a.setValue("destinations",i.destinations.map(S=>({destination:S.destination,pajak_id:S.pajak_id,purchasing_group_id:S.purchasing_group_id,business_trip_start_date:new Date(S.business_trip_start_date),business_trip_end_date:new Date(S.business_trip_end_date),detail_attedances:S.detail_attedances.map(y=>({...y,date:new Date(y.date)})),allowances:S.allowances.map(y=>({...y,default_price:parseInt(y.default_price),subtotal:parseInt(y.subtotal),detail:y.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?new Date(T.date):null}))}))})))}catch{}}const[G,q]=m.useState([]),[v,c]=m.useState([]),[ie,ce]=m.useState(""),[C,L]=m.useState(r==="0"?h.toString():"");async function te(s){a.setValue("purpose_type_id",s||"");const t=r=="0"?h||"":C||"",i=Le(s,t),g=ge(s),F=Oe(s);try{const S=await Z.get(i),y=await Z.get(g),O=(await Z.get(F)).data.data.purpose.type;O=="international"&&W("1"),ce(O),q(S.data.data),c(y.data.data)}catch(S){console.log(S)}}const W=s=>{a.setValue("total_destination",parseInt(s,10)),x(s),ue()},{showToast:se}=we(),ve=async s=>{try{const t=new FormData,i=de();t.append("user_id",s.request_for??""),t.append("value",i.toString()),t.append("purpose_type_id",s.purpose_type_id??""),t.append("request_for",s.request_for??""),t.append("cost_center_id",s.cost_center_id??""),t.append("remark",s.remark??""),t.append("reference_number",`${s.reference_number}`),t.append("cash_advance",`${s.cash_advance}`),t.append("total_percent",`${s.total_percent}`),t.append("total_cash_advance",`${s.total_cash_advance}`),s.attachment.forEach((g,F)=>{g&&t.append(`attachment[${F}]`,g)}),t.append("total_destination",`${s.total_destination}`),s.destinations.forEach((g,F)=>{const S={...g,business_trip_start_date:$(g.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:$(g.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:g.detail_attedances.map(y=>({...y,date:$(y.date).format("YYYY-MM-DD")})),allowances:g.allowances.map(y=>({...y,detail:y.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?$(T.date).format("YYYY-MM-DD"):null}))}))};t.append(`destinations[${F}]`,JSON.stringify(S))}),p==K.create?(await be.Inertia.post(Re,t,{headers:{"Content-Type":"multipart/form-data"}}),se("succesfully created data","success")):(await be.Inertia.post(`${Me}/${u}`,t,{headers:{"Content-Type":"multipart/form-data"}}),se("succesfully updated data","success"))}catch(t){console.log(t)}};function ue(){const s=[],t=parseInt(A);for(let i=0;i<t;i++)s.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});a.setValue("destinations",s)}const{fields:De,update:Se}=oe({control:a.control,name:"destinations"});m.useEffect(()=>{console.log(K.edit," business edit"),console.log(p," id type"),u&&p==K.edit&&z()},[]),m.useEffect(()=>{p==K.create&&ue()},[A,G,u,p,r,h]);const[Te,Ce]=m.useState(!1),[J,Ae]=m.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),Ne=(s,t)=>{var i;return s.type==="total"?parseFloat(((i=t==null?void 0:t[0])==null?void 0:i.request_price)||0):t==null?void 0:t.reduce((g,F)=>g+parseFloat(F.request_price||0),0)},de=()=>a.getValues("destinations").reduce((i,g,F)=>{const y=(g.allowances||[]).reduce((T,O,ae)=>{const ne=a.getValues(`destinations.${F}.allowances.${ae}.detail`),I=Ne(O,ne);return T+I},0);return i+y},0),he=async()=>{var s,t,i,g,F,S,y,T,O,ae,ne;try{const I=de();if(I===0){se("Please fill the balance","error");return}const H=await Z.get("/check-approval",{params:{value:I,user_id:a.getValues("request_for"),type:"TRIP"}});if(H.data.status_code===200){const Ve=(t=(s=H.data)==null?void 0:s.data)==null?void 0:t.approval.map(X=>(X==null?void 0:X.division_name)||null),qe=(g=(i=H.data)==null?void 0:i.data)==null?void 0:g.approval.map(X=>(X==null?void 0:X.name)||null),_e=[];(S=(F=H.data)==null?void 0:F.data)!=null&&S.hr&&_e.push((O=(T=(y=H.data)==null?void 0:y.data)==null?void 0:T.hr)==null?void 0:O.name),Ae({approvalRequest:Ve,approvalFrom:qe,acknowledgeFrom:_e}),Ce(!0)}}catch(I){se((ne=(ae=I==null?void 0:I.response)==null?void 0:ae.data)==null?void 0:ne.message,"error")}};m.useEffect(()=>{de()>0&&he()},[a.watch("destinations")]);const[mt,jt]=m.useState([]),Fe=s=>{V(t=>t.filter(i=>i.id!==s))},[$e,xe]=m.useState(!1),Ee=s=>{xe(s)},me=ee({control:a.control,name:"total_percent"}),[Ye,Pe]=m.useState(0),je=Ye;return m.useEffect(()=>{p==K.edit&&xe(a.getValues("cash_advance")??!1);const t=parseFloat((me||"0").toString())/100*je;a.setValue("total_cash_advance",t.toFixed(0))},[me,je]),e.jsx(Ze,{className:"h-[600px] w-full ",children:e.jsx(Be,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(ve),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(j,{control:a.control,name:"request_for",render:({field:s})=>(r==="0"&&!s.value&&s.onChange(h.toString()),e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{onValueChange:t=>{L(t),s.onChange(t)},value:s.value,disabled:r==="0",children:[e.jsx(R,{className:"w-[200px] py-2",children:e.jsx(M,{placeholder:"-- Select Business Purpose Type --"})}),e.jsx(B,{children:r==="1"?o.map(t=>e.jsx(Y,{value:t.id.toString(),children:t.name},t.id)):o.filter(t=>t.id===h).map(t=>e.jsx(Y,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(b,{})]}))})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:a.control,name:"purpose_type_id",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{onValueChange:t=>te(t),value:s.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Bussiness Purpose Type --"})}),e.jsx(B,{children:n.map(t=>e.jsx(Y,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:a.control,name:"cost_center_id",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{onValueChange:t=>s.onChange(t),value:s.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Cost Center --"})}),e.jsx(B,{children:d.map(t=>e.jsx(Y,{value:t.id.toString(),children:t.cost_center},t.id))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(j,{control:a.control,name:"remark",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(Qe,{placeholder:"Insert remark",...s,rows:4,className:"w-[300px]"})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(j,{control:a.control,name:"attachment",render:({field:s})=>e.jsxs(_,{children:[e.jsx(Ge,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(f,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:t=>{const i=t.target.files;if(i){const g=Array.from(i);s.onChange(g)}else s.onChange([])}})}),a.formState.errors.attachment&&Array.isArray(a.formState.errors.attachment)?a.formState.errors.attachment.map((t,i)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:t.message},i)):null]})})})]}),N.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),N.map((s,t)=>e.jsxs("td",{className:"flex flex-col pb-3",children:[e.jsx("a",{href:s.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:s.file_name},t),e.jsx("button",{type:"button",onClick:()=>Fe(s.id),className:"text-red-500 mt-2",children:"Delete"})]}))]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:a.control,name:"total_destination",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{value:s.value.toString(),onValueChange:W,disabled:ie==="international",children:[e.jsx(R,{className:"w-[200px] py-2",children:e.jsx(M,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(B,{children:Array.from({length:5},(t,i)=>e.jsxs(Y,{value:(i+1).toString(),children:[" ",i+1," "]},i))})]})}),e.jsx(b,{})]})})]})]})]}),e.jsx(ye,{className:"my-4"}),e.jsx(it,{updateDestination:Se,destinationField:De,listDestination:v,form:a,listAllowances:G,totalDestination:a.getValues("total_destination").toString(),pajak:l,purchasingGroup:D,setTotalAllowance:Pe}),e.jsx(ye,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Ke,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:s=>Ee(s.target.checked)})})]}),$e&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(j,{control:a.control,name:"reference_number",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{value:s.value||"",onChange:t=>s.onChange(t.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(b,{})]})}),e.jsx(j,{control:a.control,name:"total_percent",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{value:s.value||void 0,onValueChange:t=>s.onChange(t),children:[e.jsx(R,{className:"w-[50%] mb-2",children:e.jsx(M,{placeholder:"-- Select Total Percent --"})}),e.jsxs(B,{children:[e.jsx(Y,{value:"10",children:"10%"}),e.jsx(Y,{value:"25",children:"25%"}),e.jsx(Y,{value:"50",children:"50%"})]})]})}),e.jsx(b,{})]})}),e.jsx(j,{control:a.control,name:"total_cash_advance",render:({field:s})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{value:s.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(b,{})]})})]})]})})]}),e.jsx(nt,{onClick:async()=>await he(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Te&&e.jsx(Je,{workflowApproval:{approvalRequest:J.approvalRequest,approvalFrom:J.approvalFrom,acknowledgeFrom:J.acknowledgeFrom},workflowApprovalStep:J.approvalFrom,workflowApprovalDiagram:J.approvalFrom})}),e.jsx(pe,{type:"submit",children:"submit"})]})})})};function it({totalDestination:o,listAllowances:n,destinationField:l,form:d,updateDestination:D,setTotalAllowance:p,listDestination:u=[],pajak:r,purchasingGroup:h,typeEdit:E}){const[A,x]=m.useState(),[a,N]=m.useState(),[V,z]=m.useState(0),{showToast:G}=we();return e.jsxs(Xe,{defaultValue:"destination1",className:"w-full",children:[e.jsx(ze,{className:"flex items-center justify-start space-x-4",children:l.map((q,v)=>e.jsxs(Ue,{value:`destination${v+1}`,children:["Destination ",v+1]}))}),l.map((q,v)=>e.jsx(ct,{listAllowances:n,updateDestination:D,destination:q,form:d,index:v,setTotalAllowance:p,listDestination:u,pajak:r,purchasingGroup:h,typeEdit:E}))]})}function ct({form:o,index:n,destination:l,updateDestination:d,listAllowances:D,setTotalAllowance:p,listDestination:u,pajak:r,purchasingGroup:h,typeEdit:E}){const{fields:A,update:x,append:a,remove:N}=oe({control:o.control,name:`destinations.${n}.detail_attedances`}),{fields:V,remove:z,replace:G}=oe({control:o.control,name:`destinations.${n}.allowances`});function q(){let v=$(l.business_trip_start_date).startOf("day");const c=$(l.business_trip_end_date).startOf("day");for(N(),z();v.isBefore(c)||v.isSame(c);){const C={date:v.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};a(C),v=v.add(1,"days")}function ie(C){let L=$(l.business_trip_start_date).startOf("day");const te=$(l.business_trip_end_date).startOf("day"),W=[];for(;L.isBefore(te)||L.isSame(te);)W.push({date:L.toDate(),request_price:C}),L=L.add(1,"days");return W}const ce=D.map(C=>({name:C.name,code:C.code,default_price:parseInt(C.grade_price),type:C.type,subtotal:parseInt(C.grade_price),currency:C.currency_id,request_value:C.request_value,detail:C.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(C.grade_price)}]:ie(C.grade_price)}));G(ce)}return e.jsxs(We,{value:`destination${n+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",l.destination]}),e.jsx("td",{children:e.jsx(j,{control:o.control,name:`destinations.${n}.destination`,render:({field:v})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{onValueChange:c=>{d(n,{...l,destination:c})},defaultValue:l.destination,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"Destination"})}),e.jsx(B,{children:u.map(c=>e.jsx(Y,{value:c.destination,className:"uppercase",children:c.destination}))})]})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:o.control,name:`destinations.${n}.pajak_id`,render:({field:v})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{onValueChange:c=>{d(n,{...l,pajak_id:c})},defaultValue:l.pajak_id,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Pajak --"})}),e.jsx(B,{children:r.map(c=>e.jsx(Y,{value:c.id.toString(),children:c.mwszkz}))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:o.control,name:`destinations.${n}.purchasing_group_id`,render:({field:v})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsxs(k,{onValueChange:c=>{d(n,{...l,purchasing_group_id:c})},defaultValue:l.purchasing_group_id,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Purchasing Group --"})}),e.jsx(B,{children:h.map(c=>e.jsx(Y,{value:c.id.toString(),children:c.purchasing_group}))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(j,{control:o.control,name:`destinations.${n}.business_trip_start_date`,render:({field:v})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(fe,{initialDate:l.business_trip_start_date,onDateChange:c=>{d(n,{...l,business_trip_start_date:c})}})}),e.jsx(b,{})]})}),e.jsx("span",{children:"To"}),e.jsx(j,{control:o.control,name:`destinations.${n}.business_trip_end_date`,render:({field:v})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(fe,{initialDate:l.business_trip_end_date,onDateChange:c=>{d(n,{...l,business_trip_end_date:c})}})}),e.jsx(b,{})]})}),e.jsx(pe,{type:"button",onClick:()=>q(),children:"Get Detail"})]})]})]}),e.jsx(ut,{detailAttedanceFields:A,form:o,updateAttedanceFields:x,destinationIndex:n}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(ht,{allowanceField:V,destinationIndex:n,form:o})]},n),e.jsx(dt,{allowanceField:V,destinationIndex:n,form:o,setTotalAllowance:p})]})}function dt({allowanceField:o,destinationIndex:n,form:l,setTotalAllowance:d}){const[D,p]=m.useState(0);m.useEffect(()=>{const r=o.reduce((A,x,a)=>{const N=l.getValues(`destinations.${n}.allowances.${a}.detail`),V=u(x,N);return A+V},0),E=l.getValues("destinations").reduce((A,x,a)=>{const V=(x.allowances||[]).reduce((z,G,q)=>{const v=l.getValues(`destinations.${a}.allowances.${q}.detail`),c=u(G,v);return z+c},0);return A+V},0);p(r),d(E)},[o,l.watch()]);const u=(r,h)=>{var E;return r.type==="total"?parseFloat(((E=h==null?void 0:h[0])==null?void 0:E.request_price)||0):h==null?void 0:h.reduce((A,x)=>A+parseFloat(x.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:o.map((r,h)=>e.jsx(pt,{allowance:r,destinationIndex:n,form:l,allowanceIndex:h}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:D})})]})]})})]})})}function pt({allowance:o,destinationIndex:n,form:l,allowanceIndex:d}){const D=ee({control:l.control,name:`destinations.${n}.allowances.${d}.detail.0.request_price`}),p=ee({control:l.control,name:`destinations.${n}.allowances.${d}.detail`}),u=()=>{if(o.type==="total")return parseFloat(D||0)*1;{let r=0;return p==null||p.forEach(h=>{const E=parseFloat(h.request_price||0);r+=E}),r}};return e.jsxs("tr",{children:[e.jsx("td",{children:o.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:u()})]})]},o.id)}function ut({form:o,destinationIndex:n,detailAttedanceFields:l,updateAttedanceFields:d}){const D=o.watch(`destinations.${n}.detail_attedances`);return m.useEffect(()=>{},[D]),m.useEffect(()=>{},[l]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:l.map((p,u)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[$(p.date).format("DD/MM/YYYY"),e.jsx(j,{control:o.control,name:`destinations.${n}.detail_attedances.${u}.date`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{defaultValue:$(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[p.shift_code,e.jsx(j,{control:o.control,name:`destinations.${n}.detail_attedances.${u}.shift_code`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{defaultValue:$(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[p.shift_start,e.jsx(j,{control:o.control,name:`destinations.${n}.detail_attedances.${u}.shift_start`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{defaultValue:$(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[p.shift_end,e.jsx(j,{control:o.control,name:`destinations.${n}.detail_attedances.${u}.shift_end`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{defaultValue:$(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsx("td",{children:e.jsx(j,{control:o.control,name:`destinations.${n}.detail_attedances.${u}.start_time`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(b,{})]})})}),e.jsx("td",{children:e.jsx(j,{control:o.control,name:`destinations.${n}.detail_attedances.${u}.end_time`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(b,{})]})})})]},p.index))})]})})})]})}function ht({form:o,destinationIndex:n,allowanceField:l}){return e.jsx("table",{className:"w-full allowance-table",children:l.map((d,D)=>e.jsx(xt,{form:o,allowance:d,destinationIndex:n,allowanceIndex:D}))})}function xt({form:o,allowance:n,destinationIndex:l,allowanceIndex:d}){const[D,p]=m.useState(!1),u=x=>{p(a=>!a)},r=ee({control:o.control,name:`destinations.${l}.allowances.${d}.detail.0.request_price`}),h=ee({control:o.control,name:`destinations.${l}.allowances.${d}.detail`}),E=()=>{if(n.type==="total")return parseFloat(r||0)*1;{let x=0;return h==null||h.forEach(a=>{const N=parseFloat(a.request_price||0);x+=N}),x}},A=x=>a=>{const N=parseFloat(a.target.value)||0;n.request_value==="unlimited"?x.onChange(a):n.request_value==="up to max value"?N<=n.subtotal?x.onChange(a):alert(`Value cannot exceed the subtotal of IDR ${n.subtotal}`):n.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:n.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:n.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:n.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:o.control,name:`destinations.${l}.allowances.${d}.detail.0.request_price`,render:({field:x})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{value:x.value,onChange:A(x)})}),e.jsx(b,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",n.detail.length," Days * ",n.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",E()]})})}),n.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>u(),children:e.jsxs(pe,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},n.id),D&&e.jsx(e.Fragment,{children:n.detail.map((x,a)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:$(x.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(j,{control:o.control,name:`destinations.${l}.allowances.${d}.detail.${a}.request_price`,render:({field:N})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{value:N.value,onChange:A(N)})}),e.jsx(b,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},x.id))})]})}function ms({form:o,type:n,allowanceIndex:l,destinationIndex:d}){const{fields:D}=oe({control:o.control,name:`destinations.${d}.allowances.${l}.detail`});return e.jsx(e.Fragment,{children:D.map((p,u)=>e.jsx(j,{control:o.control,name:`destinations.${d}.allowances.${u}.detail.${u}.request_price`,render:({field:r})=>e.jsxs(_,{children:[e.jsx(f,{children:e.jsx(P,{value:r.value,onChange:r.onChange})}),e.jsx(b,{})]})}))})}export{ms as AllowanceInputForm,xt as AllowanceRowInput,it as BussinesTripDestination,ct as BussinessDestinationForm,xs as BussinessTripFormV1,ht as DetailAllowance,ut as DetailAttedances,pt as ResultPerItem,dt as ResultTotalItem};
