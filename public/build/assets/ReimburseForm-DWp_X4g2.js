import{r as y,j as e}from"./app-BIOi_O7g.js";import{B as L}from"./button-D9RCpmB9.js";import{d as $}from"./index-CUsis8Jc.js";import{z as d,t as P,F as K,a as i,b as h,d as j,e as m,I as N}from"./index-xVSCDvl5.js";import{u as X}from"./index.esm-BVoG1Nd3.js";import{T as k}from"./textarea-B3h3MJF8.js";import{S as z}from"./scroll-area-D2vZFU-X.js";import{S as F,T as M,a as U,b as G,c as H,C as S}from"./CustomDatePicker-BWwTxA2L.js";import{S as x,a as p,b as u,c as f,d as g}from"./select-BQEeHfE3.js";/* empty css            */import"./index-Dox7fKga.js";import"./index-B1DW66uR.js";import"./Combination-v-JBI_-j.js";import"./react-icons.esm-Bx38emjL.js";import"./createLucideIcon-BufXkK1k.js";import"./index-CTfkAyHj.js";const je=({reimbursement:l,reimburses:R,currencies:b,types:_,periods:q,users:V,csrf_token:D})=>{const[J,I]=y.useState(1);y.useState(R);const T=d.object({remark_group:d.string().nonempty("Remark is required"),requester:d.string().nonempty("Requester is required"),forms:d.array(d.object({rn:d.string(),type:d.string().nonempty("Type is required"),period:d.string().nonempty("Period is required"),remark:d.string().nonempty("Remark is required"),balance:d.number().min(1,"Balance must be at least 1"),receipt_date:d.date(),start_date:d.date(),end_date:d.date(),currency:d.string().nonempty("Currency is required"),attachment:d.array(d.instanceof(File)).optional()})),formCount:d.string().nonempty("Currency is required")}),o=X({resolver:P(T),defaultValues:{formCount:"1",remark_group:"",requester:"",forms:Array.from({length:1}).map(()=>({rn:"",type:"",remark:"",period:"",balance:0,receipt_date:new Date,start_date:new Date,end_date:new Date,currency:"IDR",attachment:null}))}});y.useEffect(()=>{l&&(o.setValue("remark_group",l.remark),o.setValue("requester",l.users.nip),o.setValue("formCount",l.reimburses.length.toString()),o.setValue("forms",l.reimburses.map(t=>({rn:t.rn,type:t.type,remark:t.remark,balance:Number(t.balance),currency:t.currency,period:t.period,receipt_date:new Date(t.receipt_date),start_date:new Date(t.start_date),end_date:new Date(t.end_date),attachment:t.attachment||null}))),l.reimburses.forEach((t,r)=>{v(r,t.type)}))},[l]);const E=t=>{I(t);const r=o.getValues("forms"),n=Array.from({length:t}).map((c,a)=>r[a]||{rn:"",type:"",remark:"",period:"",balance:0,receipt_date:new Date,start_date:new Date,end_date:new Date,currency:"IDR"});o.setValue("forms",n),o.setValue("formCount",t.toString())},[w,A]=y.useState([]),v=(t,r)=>{const n=_.find(c=>c.code===r);A(c=>{const a=[...c];return a[t]={plafon:(n==null?void 0:n.plafon)??0,claim:(n==null?void 0:n.claim_limit)??"Unlimited"},a}),o.setValue(`forms.${t}.type`,r)},O=async t=>{const r=new FormData;r.append("remark_group",t.remark_group),r.append("requester",t.requester),t.forms.forEach((n,c)=>{r.append(`forms[${c}][rn]`,n.rn),r.append(`forms[${c}][type]`,n.type),r.append(`forms[${c}][remark]`,n.remark),r.append(`forms[${c}][balance]`,n.balance.toString()),r.append(`forms[${c}][period]`,n.period),r.append(`forms[${c}][currency]`,n.currency),r.append(`forms[${c}][receipt_date]`,n.receipt_date.toISOString()),r.append(`forms[${c}][start_date]`,n.start_date.toISOString()),r.append(`forms[${c}][end_date]`,n.end_date.toISOString()),n.attachment.forEach(a=>{r.append(`forms[${c}][attachments][]`,a)})}),l?$.Inertia.put(`/reimburse/${l.id}`,t,{headers:{"X-CSRF-TOKEN":D}}):await $.Inertia.post("/reimburse",r,{headers:{"X-CSRF-TOKEN":D,"Content-Type":"multipart/form-data"}})};return e.jsx(z,{className:"h-[600px] w-full",children:e.jsx(K,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(O),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Request No."}),e.jsx("td",{children:(l==null?void 0:l.code)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request Status"}),e.jsx("td",{children:(l==null?void 0:l.status)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:"remark_group",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(k,{disabled:l!==null,placeholder:"Insert remark",...t})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:"requester",render:({field:t})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(x,{disabled:l!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"Requester"})}),e.jsx(f,{children:V.map(r=>e.jsxs(g,{value:r.nip,children:[r.name," [",r.nip,"]"]},r.id))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:"formCount",render:({field:t})=>{var r;return e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(x,{disabled:l!==null,onValueChange:n=>E(n),value:(r=t.value)==null?void 0:r.toString(),children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"Select number of forms"})}),e.jsx(f,{children:Array.from({length:20},(n,c)=>c+1).map(n=>e.jsx(g,{value:n.toString(),children:n},n))})]})}),e.jsx(m,{})]})}})})]})]})}),e.jsx(F,{className:"my-4"}),Array.from({length:o.watch("formCount")||1}).map((t,r)=>{var n,c;return e.jsxs(M,{defaultValue:`form${r+1}`,className:"w-full",children:[e.jsx(U,{className:"grid w-full grid-cols-2",children:e.jsxs(G,{value:`form${r+1}`,children:["Form ",r+1]})}),e.jsxs(H,{value:`form${r+1}`,children:[e.jsx(i,{control:o.control,name:`forms.${r}.rn`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(N,{className:"sr-only",value:a.value,onChange:a.onChange})}),e.jsx(m,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:`forms.${r}.type`,render:({field:a})=>e.jsxs(x,{disabled:l!==null,onValueChange:s=>v(r,s),value:a.value,children:[e.jsx(p,{children:e.jsx(u,{placeholder:"Select type"})}),e.jsx(f,{children:_.map(s=>e.jsxs(g,{value:s.code,children:[s.name," (",s.code,")"]},s.code))})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:`forms.${r}.period`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(x,{disabled:l!==null,onValueChange:s=>a.onChange(s),value:a.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(f,{children:q.map(s=>e.jsxs(g,{value:s.code,children:[s.start," - ",s.end," (",s.code,")"]},s.code))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:`forms.${r}.remark`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(k,{placeholder:"Insert remark",...a})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsx("td",{children:((n=w[r])==null?void 0:n.plafon)||"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Limit per claim"}),e.jsx("td",{children:((c=w[r])==null?void 0:c.claim)||"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:`forms.${r}.receipt_date`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(S,{disabled:l!==null,initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(i,{control:o.control,name:`forms.${r}.start_date`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(S,{disabled:l!==null,initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(m,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(i,{control:o.control,name:`forms.${r}.end_date`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(S,{disabled:l!==null,initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(m,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(i,{control:o.control,name:`forms.${r}.currency`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(x,{disabled:l!==null,onValueChange:s=>a.onChange(s),value:a.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(f,{children:b.map(s=>e.jsxs(g,{value:s.code,children:[s.name," (",s.code,")"]},s.code))})]})}),e.jsx(m,{})]})}),e.jsx(i,{control:o.control,name:`forms.${r}.balance`,render:({field:a})=>{var s;return e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(N,{disabled:l!==null,type:"number",placeholder:"0.0",max:(s=w[r])==null?void 0:s.plafon,...a,onChange:C=>a.onChange(Number(C.target.value)),value:a.value||0})}),e.jsx(m,{})]})}})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(i,{control:o.control,name:`forms.${r}.attachment`,render:({field:a})=>e.jsxs(h,{children:[e.jsx(j,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:s=>{const C=s.target.files;if(C){const B=Array.from(C);a.onChange(B)}}})}),e.jsx(m,{})]})})})]})]})})})]})]},r)}),e.jsx(F,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(L,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{je as ReimburseForm};
