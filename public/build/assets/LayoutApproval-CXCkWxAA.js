import{q as x,r,j as a}from"./app-D29rfeOn.js";import{a as F}from"./axiosInstance-ZL1OApau.js";import{L as M}from"./Loading-DZXI227T.js";import{F as E}from"./FormMapping-wuCcJ4L0.js";import{F as _}from"./formTextArea-CttuXSfz.js";import{u as k}from"./index.esm-CpkvjiPo.js";import{D as q}from"./detailApproval-Dk3_5GCH.js";import{h as B}from"./moment-C5S46NFB.js";import{B as h}from"./Button-Cyjjr7cA.js";import{M as D}from"./TextField-BRwDv0ma.js";import{B as I}from"./Box-DkcbynL-.js";const Y={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",pt:2,px:4,pb:3},U=({id:p,children:j,type:n,status_id:m})=>{x();const{auth:i}=x().props,e=k({mode:"onChange",reValidateMode:"onChange"}),[g,d]=r.useState(!1),[V,b]=r.useState(!1),[y,u]=r.useState(!1),c=r.useCallback(async()=>{var l;d(!0);try{const s=(await F.get("/api/approval/route/getApproval?id="+p+"&type="+n)).data;e.reset(s.data.data);const A=(s.data??[]).map(t=>{var v;return((v=t.user.divisions)==null?void 0:v.name)||null}),R=(s.data??[]).map(t=>t.user.name),o=(s.data??[]).find(t=>t.is_status===!1);m!==4&&(o==null?void 0:o.user_id)===((l=i==null?void 0:i.user)==null?void 0:l.id)&&b(!0);const w=(s.data??[]).map(t=>({status:t.status,name:t.user.name,dateApproved:B(t.updated_at).format("YYYY-MM-DD")}));e.setValue("approvalFromStatusRoute",w),e.setValue("approvalRequest",A),e.setValue("approvalFrom",R),e.setValue("approvalId",o==null?void 0:o.id),e.setValue("function_name",n.toLowerCase()),e.setValue("type",n.toLowerCase()),e.setValue("id",p)}catch{d(!1)}finally{d(!1)}},[e,p,n,m]);r.useEffect(()=>{c()},[c]);const C=()=>{u(!1),e.setValue("note",""),e.setValue("id_approval",""),e.setValue("status",""),e.setValue("type","")},f=l=>{u(!0),e.setValue("status",l)};return a.jsxs(a.Fragment,{children:[a.jsx(M,{isLoading:g}),a.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[V&&a.jsx("div",{className:"card-header",children:a.jsxs("div",{children:[a.jsx(h,{variant:"contained",onClick:()=>f("Approved"),color:"primary",type:"button",children:"APPROVE"}),a.jsx(h,{onClick:()=>f("Rejected"),style:{marginLeft:"1rem"},variant:"contained",color:"error",type:"button",children:"REJECT"})]})}),j,a.jsx(q,{methods:e}),a.jsx(D,{open:y,onClose:C,"aria-labelledby":"parent-modal-title","aria-describedby":"parent-modal-description",children:a.jsx(I,{sx:{...Y,width:900},children:a.jsx(E,{isCustom:!0,formCustom:a.jsx(a.Fragment,{children:a.jsx(_,{fieldLabel:"note",fieldName:"note",isRequired:!0,requiredMessage:"",rows:20,style:{width:"100%"}})}),methods:e,url:"api/approval/approval_or_rejceted"})})})]})]})};export{U as L};
