import{j as e,r,u as Ue,X as Fe,x as $,a as Z}from"./app-fns7tIxo.js";import{a as I}from"./axiosInstance-D4Pnf9nn.js";import{D as Me,b as De,c as Be}from"./dialog-Bj5pqFPb.js";import{B as R}from"./button-DV-0oZWC.js";import{L as Ae}from"./LoadingSpin-C-6cziMg.js";import{D as ze,a as Te,b as _e,c as Oe,d as z,e as ee}from"./dropdown-menu-DAlGexhL.js";import{D as Ie}from"./index-g7UsOrf2.js";import{c as ae}from"./createLucideIcon-zy6RN5iN.js";import{B as T}from"./Box-CSYvmaqw.js";import{T as Le,a as se}from"./Tabs-Dkhvz3oI.js";import{B as L}from"./Button-wJn_xDS9.js";import{D as Re,G as Pe}from"./DataGrid-Bp75Uh_W.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=ae("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=ae("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),He=({open:v,onOpenChange:P,onDelete:S,onClose:C,children:a,className:D,isLoading:c,title:h,description:d,labelConfirmButton:g="Delete"})=>e.jsx(Me,{open:v,onOpenChange:C,children:e.jsxs(De,{className:D||"md:max-w-[768px]",children:[d||"Are you sure delete this item?",e.jsxs(Be,{children:[C?e.jsx(R,{variant:"outline",onClick:C,children:"Close"}):null,S?e.jsx(e.Fragment,{children:c?e.jsx(Ae,{}):e.jsx(R,{type:"submit",onClick:S,children:g})}):null]})]})}),te=v=>({id:`simple-tab-${v}`,"aria-controls":`simple-tabpanel-${v}`}),rs=({columns:v,buttonCustome:P,onExport:S,onExportXls:C,url:a,labelFilter:D="Search",onEdit:c,onDelete:h,onDetail:d,onPrint:g,onCreate:B,onClone:U,onSendSap:_,defaultSearch:O,actionType:ie,buttonActionCustome:G,deleteConfirmationText:ne,titleConfirmationText:Ve,isHistory:re=!1,isLoading:q=!1,isClone:le=!1,role:t,tabelFooter:ce})=>{var X,E,J,K,Q;const[de,oe]=r.useState([]),[xe,H]=r.useState(!1),[l,pe]=r.useState({page:0,pageSize:10}),[u,he]=r.useState([]),[j,me]=r.useState({items:[]}),[We,Xe]=r.useState(null),[fe,m]=r.useState(!1),[x,ge]=r.useState(0),[ue,je]=r.useState(0),[w,we]=r.useState(""),[V,ye]=r.useState(""),{showToast:b}=Ue(),[y,N]=r.useState({isOpen:!1,labelConfirmButton:"Delete",message:"",onConfirm:async()=>{}}),{props:A}=Fe(),p=((X=A.auth)==null?void 0:X.permission)||[],F=r.useCallback(async(s,i,k,o,n,M)=>{H(!0);const Ne=o.length>0?o[0].field:"id",$e=o.length>0?o[0].sort:"desc",Se=n.items.map(f=>`${f.field}=${f.operator},${f.value}`).join("&");try{const f=`${O||"?"}page=${s+1}&per_page=${i}&search=${k}&sort_by=${Ne}&sort_direction=${$e}&approval=${M}&${Se}`;ye(f);const Y=await I.get(`${a.url}${f}`);oe(Y.data.data.data),je(Y.data.data.total)}catch(f){console.error("Error fetching data:",f)}finally{H(!1)}},[O,u,j,w,x,l,B,c,U]);r.useEffect(()=>{F(l.page,l.pageSize,w,u,j,x)},[F,j,l,w,u]);const W=async s=>{var i,k,o;m(!0);try{const n=await I.delete(`${a.deleteUrl}/${s}`);b(((i=n==null?void 0:n.data)==null?void 0:i.message)||"Record deleted successfully","success"),m(!1),N({...y,isOpen:!1}),h&&await h(s),F(l.page,l.pageSize,w,u,j,0)}catch(n){if(m(!1),Z.isAxiosError(n)){const M=((o=(k=n.response)==null?void 0:k.data)==null?void 0:o.message)||"Failed to delete record";b(M,"error")}else b("An unexpected error occurred","error");m(!1)}},ke=async s=>{var i,k,o;m(!0);try{const n=await I.post("api/approval/approval_or_rejceted",{id:s,type:a.cancelApproval,status:"Cancel",function_name:a.cancelApproval});b(((i=n==null?void 0:n.data)==null?void 0:i.message)||"cancel successfully","success"),m(!1),N({...y,isOpen:!1}),h&&await h(s),F(l.page,l.pageSize,w,u,j,0)}catch(n){if(m(!1),Z.isAxiosError(n)){const M=((o=(k=n.response)==null?void 0:k.data)==null?void 0:o.message)||"Failed to cancel record";b(M,"error")}else b("An unexpected error occurred","error");m(!1)}},ve=c||h||d||g||a.detailUrl||a.printUrl||a.editUrl||a.deleteUrl||G?[{field:"actions",headerName:"Actions",width:250,renderCell:s=>e.jsx(e.Fragment,{children:ie==="dropdown"?e.jsxs(ze,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(R,{variant:"ghost",className:"w-8 h-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"..."}),e.jsx(Ie,{className:"w-4 h-4"})]})}),e.jsxs(_e,{align:"end",children:[e.jsx(Oe,{children:"Actions"}),(c||a.editUrl)&&x===0&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.update)??""))&&e.jsx(z,{onClick:()=>c&&c(s.row.id),children:e.jsxs("span",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{children:"Edit"}),e.jsx(Ge,{size:14})]})})}),e.jsx(ee,{}),(a.deleteUrl||h)&&x===0&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.delete)??""))&&e.jsx(z,{className:"bg-red-400 text-white hover:!bg-red-500 hover:!text-white transition-all duration-300",onClick:()=>N({isOpen:!0,labelConfirmButton:"Delete",message:ne??"Are you sure you want to delete this record?",onConfirm:async()=>{W(s.row.id)}}),children:e.jsxs("span",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{children:"Delete"}),e.jsx(qe,{size:14})]})})}),e.jsx(ee,{}),(g||a.printUrl)&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.detail)??""))&&e.jsx(z,{onClick:()=>{g&&g(s.row.id),a.printUrl&&window.open(`${a.printUrl}/${s.row.id}`,"_blank")},children:"Print"})}),(d||a.detailUrl)&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.detail)??""))&&e.jsx(z,{onClick:()=>{d&&d(s.row.id),a.detailUrl&&(window.location.href=`${a.detailUrl}/${s.row.id}`)},children:"View details"})})]})]}):e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[(d||a.detailUrl)&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.detail)??""))&&e.jsx($,{href:a.detailUrl===""?"#":`${a.detailUrl}/${s.row.id}`,onClick:i=>{d&&(i.preventDefault(),d&&d(s.row.id))},alt:"detail",children:e.jsx("i",{className:"text-2xl ki-duotone ki-size text-info"})})}),(g||a.printUrl)&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.detail)??""))&&e.jsx("a",{href:a.printUrl===""?"#":`${a.printUrl}/${s.row.id}`,target:"_blank",children:e.jsx("i",{className:"text-2xl text-blue-500 ki-duotone ki-printer"})})}),(U||a.clone)&&e.jsx(e.Fragment,{children:(s.row.status_id=="6"||le)&&x===0&&e.jsx($,{href:a.clone===""?"#":`${a.clone}/${s.row.id}`,onClick:i=>{U&&(i.preventDefault(),U&&U(s.row.id))},alt:"detail",children:e.jsx("i",{className:"text-2xl ki-filled ki-copy text-warning"})})}),(c||a.editUrl)&&x===0&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.update)??""))&&e.jsx($,{href:a.editUrl===""?"#":`${a.editUrl}/${s.row.id}`,onClick:i=>{c&&(i.preventDefault(),c&&c(s.row.id))},alt:"edit",children:e.jsx("i",{className:"text-2xl ki-duotone ki-notepad-edit text-success"})})}),(a.deleteUrl||h)&&x===0&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.delete)??""))&&e.jsx($,{href:"",onClick:i=>{i.preventDefault(),N({isOpen:!0,labelConfirmButton:"Delete",message:"Are you sure you want to delete this record?",onConfirm:async()=>{W(s.row.id)}})},alt:"delete",children:e.jsx("i",{className:"text-2xl ki-duotone ki-trash-square text-danger"})})}),a.cancelApproval&&(s.row.status_id===1||s.row.status_id===6)&&x===0?e.jsx(e.Fragment,{children:e.jsx($,{href:"",onClick:i=>{i.preventDefault(),N({isOpen:!0,labelConfirmButton:"Cancel Approval",message:"Are you sure want to cancel this request?",onConfirm:async()=>{ke(s.row.id)}})},alt:"delete",children:e.jsx("i",{className:"text-2xl ki-filled ki-cross-square text-danger"})})}):e.jsx(e.Fragment,{}),G]})})}]:[],Ce=(s,i)=>{ge(i),F(l.page,l.pageSize,w,u,j,i)},be=s=>e.jsxs(e.Fragment,{children:[ce,e.jsx(Pe,{...s})]});return e.jsx(T,{children:e.jsx(T,{sx:{height:"45rem",width:"100%",overflowX:"auto"},children:e.jsxs(T,{sx:{width:"100%"},children:[re&&((J=(E=A.auth)==null?void 0:E.user)==null?void 0:J.is_approval)&&e.jsx(T,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Le,{value:x,onChange:Ce,"aria-label":"dynamic tabs example",children:[e.jsx(se,{label:"List",...te(0)},0),e.jsx(se,{label:"Approval",...te(0)},1)]})}),e.jsx("div",{className:"mt-2 lg:col-span-2",children:e.jsx("div",{className:"grid",children:e.jsxs("div",{className:"h-full min-w-full card card-grid",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:e.jsxs("div",{className:"input input-sm max-w-48",children:[e.jsx("i",{className:"ki-filled ki-magnifier"}),e.jsx("input",{placeholder:D,type:"text",value:w,onChange:s=>we(s.target.value),style:{width:"100%",maxWidth:"200px",marginBottom:"10p"}})]})}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[(B||a.addUrl)&&e.jsx(e.Fragment,{children:(!t||p.includes((t==null?void 0:t.create)??""))&&e.jsxs($,{href:a.addUrl??"#",className:"btn btn-success",onClick:s=>{B&&(s.preventDefault(),B())},style:{marginRight:"10px",marginBottom:"10px"},children:[e.jsx("i",{className:"ki-filled ki-additem"}),"Add New"]})}),S&&e.jsx(L,{className:"btn",variant:"contained",onClick:()=>S(V),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Export TXT"}),A.auth.setting_export==((Q=(K=A.auth)==null?void 0:K.user)==null?void 0:Q.username)&&_&&e.jsx(L,{className:"btn",variant:"contained",onClick:()=>_&&_(),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Send TXT To Sap"}),C&&e.jsx(L,{className:"btn",variant:"contained",onClick:()=>C(V),color:"primary",disabled:q,startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:q?"Downloading...":"Export to Excel"}),P]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx(He,{isLoading:fe,description:y.message,open:y.isOpen,labelConfirmButton:y.labelConfirmButton,onClose:()=>{N({...y,isOpen:!1})},onDelete:async()=>y.onConfirm()}),e.jsx("div",{"data-datatable":"true","data-datatable-page-size":l.pageSize,children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsx(Re,{rows:de,columns:[...v,...ve],loading:xe,paginationMode:"server",rowCount:ue,paginationModel:l,onPaginationModelChange:pe,pageSizeOptions:[10,20],sortingMode:"server",sortModel:u,onSortModelChange:s=>he(s),filterMode:"server",filterModel:j,onFilterModelChange:s=>me(s),slots:{footer:be}})})})]})]})})})]})})})};export{He as C,rs as D};
