import{j as e,r as c,u as Be,b as Me}from"./app-D29rfeOn.js";import{d as Ge,F as b,a as y,b as S,c as T,e as Le}from"./form-bmKmrvt5.js";import{z as r,t as Oe}from"./index-D6qaWJmp.js";import{a as L,d as te}from"./axiosInstance-ZL1OApau.js";import{B as Xe}from"./button-DjRXmiG1.js";import{T as ze}from"./textarea-BRIZa4Rg.js";import{a as Je,C as We,u as He,b as ie,c as Ke}from"./index.esm-CpkvjiPo.js";import{S as Ze}from"./scroll-area-DmpPh8F9.js";import{S as ae}from"./separator-CulM7qxQ.js";/* empty css              */import{W as Qe}from"./WorkflowComponent-WFHAR-QS.js";import{S as Ue}from"./Switch-CKCaq2Os.js";import{F as et}from"./FormHelperText-DPY2tDCT.js";import{I as X}from"./input-BOk0TzHt.js";import{S as se,a as re,b as ne,c as oe,d as B}from"./select-DD5YSHEO.js";import{C as tt,E as at,b as st}from"./api-D52m_Wz0.js";import{G as rt,a as nt}from"./api-BEQetkWJ.js";import{h as M}from"./moment-C5S46NFB.js";import{BusinessTripType as h}from"./models-B6CB02cl.js";import{u as D}from"./getDropdown-BAb4W28R.js";import{F as O}from"./formDropdown-DFK5GmdN.js";import{BussinesTripDestination as ot}from"./BussinesTripDestination-MyzlkFII.js";import{B as it}from"./Button-Cyjjr7cA.js";import"./app-HlhieNAw.js";import"./index-B_eBcZZD.js";import"./utils-eSIEr-wj.js";import"./index-Bb4qSo10.js";import"./index-UH-LbHcR.js";import"./index-DQTnQjPn.js";import"./createSimplePaletteValueFilter-Cwk5xq00.js";import"./DefaultPropsProvider-DRDKerCg.js";import"./extends-CF3RwP-h.js";import"./createLucideIcon-CF_GU2c3.js";import"./SwitchBase-D_3FXQr6.js";import"./useSlot-CLCwUtOz.js";import"./index-CuI19Oi5.js";import"./index-DxoDkuDW.js";import"./Combination-DMqbIhv0.js";import"./index-pXDSnuaF.js";import"./index-CS5neMuY.js";import"./index-BNIQcsZd.js";import"./CustomStatus-DC9o69Db.js";import"./TextField-BRwDv0ma.js";import"./tabs-BWYtDgYa.js";import"./index-iZATFzBw.js";import"./BussinessDestinationForm-BDWpmfHf.js";import"./CustomDatePicker-Balvt1Z5.js";import"./popover-DSuXvxSu.js";import"./DetailAttedances-FQMPtBiP.js";import"./DetailAllowance-Ouux48jv.js";import"./rupiahCurrencyFormat-CnMdu_8N.js";import"./chevrons-up-down-Da-nfAsB.js";import"./ResultTotalItem-CcB-Eq0h.js";const lt=({fieldLabel:j,fieldName:F,isRequired:v=!1,disabled:C=!1,style:N,requiredMessage:d,classNames:f,defaultChecked:m=!1,note:u,onChanges:A})=>{var s;const{control:q,formState:{errors:I}}=Je();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[j&&e.jsxs("label",{className:"form-label max-w-32",children:[j," ",e.jsxs("span",{className:"text-red-700",children:[" ",v?"*":""]})]}),e.jsx(We,{name:F,control:q,rules:{required:v?d??`${j} is required`:!1},render:({field:x})=>e.jsx("div",{style:N,className:f,children:e.jsx(Ue,{...x,checked:!!(x.value??m),onChange:E=>{x.onChange(E),A&&A(E)},disabled:C})})}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),I[F]&&e.jsx(et,{error:!0,children:String((s=I[F])==null?void 0:s.message)})]})]})};r.object({remark:r.string().min(1).max(50),reimburse_cost:r.number()});const ct=1*1024*1024,dt=["image/jpeg","image/png","application/pdf"],ua=({users:j,listPurposeType:F,pajak:v,costcenter:C,purchasingGroup:N,type:d,id:f,isAdmin:m,idUser:u})=>{const A=r.object({purpose_type_id:r.string().min(1,"Purpose type required"),request_for:r.string().min(1,"Request is required"),cost_center_id:r.string().min(1,"Cost Center is required"),remark:r.string().min(1,"Remark is required"),attachment:r.array(r.instanceof(File).refine(t=>dt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(t=>t.size<=ct,{message:"File size must be less than 1MB"})),total_destination:r.number().min(1,"Total Destinantion Required"),cash_advance:r.boolean().nullable().optional(),reference_number:r.string().nullable().optional(),total_percent:r.string().nullable().optional(),total_cash_advance:r.string().nullable().optional(),destinations:r.array(r.object({destination:r.string().min(1,"Destinantion is Required"),pajak_id:r.string().min(1,"Pajak is required"),purchasing_group_id:r.string().min(1,"Purchasing Group is required"),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.date().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),default_price:r.number().optional(),type:r.string().optional(),subtotal:r.number().optional(),currency:r.string().optional(),detail:r.array(r.object({date:r.date().nullish(),request_price:r.any().optional()}))}))}))}),[q,I]=c.useState("1"),s=He({resolver:Oe(A),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[x,E]=c.useState([]);async function le(){const t=st(f);s.setValue("destinations",[]);try{const a=await Me.get(t),n=a.data.data;J("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.data.data.purpose_type.type}}),E(n.attachments),s.setValue("purpose_type_id",n.purpose_type_id.toString()),s.setValue("request_for",n.request_for.id.toString()),s.setValue("cost_center_id",n.cost_center_id.toString()),s.setValue("remark",n.remarks),s.setValue("total_destination",n.total_destination),s.setValue("cash_advance",n.cash_advance==1),s.setValue("reference_number",n.reference_number),s.setValue("total_percent",n.total_percent),s.setValue("total_cash_advance",n.total_cash_advance),console.log(n.destinations," data.destinations"),s.setValue("destinations",n.destinations.map(o=>({destination:o.destination,pajak_id:o.pajak_id,purchasing_group_id:o.purchasing_group_id,business_trip_start_date:new Date(o.business_trip_start_date),business_trip_end_date:new Date(o.business_trip_end_date),detail_attedances:o.detail_attedances.map(i=>({...i,date:new Date(i.date)})),allowances:o.allowances.map(i=>({...i,default_price:parseInt(i.default_price),subtotal:parseInt(i.subtotal),detail:i.detail.map(l=>({...l,date:(l==null?void 0:l.date)!=null?new Date(l.date):null}))}))})))}catch{}}const[z,ce]=c.useState([]),[de,pe]=c.useState(""),{dataDropdown:me,getDropdown:J}=D(),[ue,_e]=c.useState(m==="0"?u==null?void 0:u.toString():"");async function he(t){s.setValue("purpose_type_id",t||"");const a=m=="0"?u||"":ue||"",n=rt(t,a),o=nt(t);try{const i=await L.get(n),l=await L.get(o),p=l.data.data.purpose.type;p=="international"&&W("1"),pe(p),ce(i.data.data),J("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:l.data.data.purpose.type}})}catch(i){console.log(i)}}const W=t=>{s.setValue("total_destination",parseInt(t,10)),I(t),H()},{showToast:V}=Be(),fe=async t=>{console.log(x," valuesss");try{const a=new FormData,n=G();if(a.append("user_id",t.request_for??""),a.append("value",n.toString()),a.append("purpose_type_id",t.purpose_type_id??""),a.append("request_for",t.request_for??""),a.append("cost_center_id",t.cost_center_id??""),a.append("remark",t.remark??""),a.append("reference_number",`${t.reference_number}`),a.append("cash_advance",`${t.cash_advance}`),a.append("total_percent",`${t.total_percent}`),a.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((o,i)=>{o&&a.append(`attachment[${i}]`,o)}),a.append("total_destination",`${t.total_destination}`),t.destinations.forEach((o,i)=>{const l={...o,business_trip_start_date:M(o.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:M(o.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:o.detail_attedances.map(p=>({...p,date:M(p.date).format("YYYY-MM-DD")})),allowances:o.allowances.map(p=>({...p,detail:p.detail.map(_=>({..._,date:(_==null?void 0:_.date)!=null?M(_.date).format("YYYY-MM-DD"):null}))}))};a.append(`destinations[${i}]`,JSON.stringify(l))}),d==h.create)await te.Inertia.post(tt,a,{headers:{"Content-Type":"multipart/form-data"}}),V("succesfully created data","success");else{const o=new FormData;o.append("remark",t.remark??""),t.attachment.forEach((i,l)=>{i&&o.append(`attachment[${l}]`,i)}),x.forEach((i,l)=>{i&&o.append(`file_existing[${l}]`,JSON.stringify(i))}),await te.Inertia.post(`${at}/${f}`,o,{headers:{"Content-Type":"multipart/form-data"}}),V("succesfully updated data","success")}}catch(a){console.log(a)}};function H(){const t=[],a=parseInt(q);for(let n=0;n<a;n++)t.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});s.setValue("destinations",t)}const{fields:xe,append:pt,remove:mt,update:ge}=ie({control:s.control,name:"destinations"});c.useEffect(()=>{f&&d==h.edit&&le()},[d]),c.useEffect(()=>{d==h.create&&H()},[q,z,m,u]);const[je,we]=c.useState(!1),[P,be]=c.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),ye=(t,a)=>{var n;return t.type==="total"?parseFloat(((n=a==null?void 0:a[0])==null?void 0:n.request_price)||0):a==null?void 0:a.reduce((o,i)=>o+parseFloat(i.request_price||0),0)},G=()=>s.getValues("destinations").reduce((n,o,i)=>{const p=(o.allowances||[]).reduce((_,R,Y)=>{const $=s.getValues(`destinations.${i}.allowances.${Y}.detail`),g=ye(R,$);return _+g},0);return n+p},0),K=async()=>{var t,a,n,o,i,l,p,_,R,Y,$;try{const g=G();if(g===0){V("Please fill the balance","error");return}const k=await L.get("/check-approval",{params:{value:g,user_id:s.getValues("request_for"),type:"TRIP"}});if(k.data.status_code===200){const Ye=(a=(t=k.data)==null?void 0:t.data)==null?void 0:a.approval.map(w=>(w==null?void 0:w.division_name)||null),$e=(o=(n=k.data)==null?void 0:n.data)==null?void 0:o.approval.map(w=>(w==null?void 0:w.name)||null),ee=[];(l=(i=k.data)==null?void 0:i.data)!=null&&l.hr&&ee.push((R=(_=(p=k.data)==null?void 0:p.data)==null?void 0:_.hr)==null?void 0:R.name),be({approvalRequest:Ye,approvalFrom:$e,acknowledgeFrom:ee}),we(!0)}}catch(g){V(($=(Y=g==null?void 0:g.response)==null?void 0:Y.data)==null?void 0:$.message,"error")}};c.useEffect(()=>{G()>0&&K()},[s.watch("destinations")]),c.useState([]);const Se=t=>{E(a=>a.filter(n=>n.id!==t))},[ve,Z]=c.useState(!1),De=t=>{Z(t)},Q=Ke({control:s.control,name:"total_percent"}),[Te,Fe]=c.useState(0),U=Te;c.useEffect(()=>{d==h.edit&&Z(s.getValues("cash_advance")??!1);const a=parseFloat((Q||"0").toString())/100*U;s.setValue("total_cash_advance",a.toFixed(0))},[Q,U]);const{dataDropdown:Ce,getDropdown:Ne}=D(),{dataDropdown:Ee,getDropdown:Pe}=D(),{dataDropdown:ke,getDropdown:Ae}=D(),{dataDropdown:qe,getDropdown:Ie}=D(),{dataDropdown:Ve,getDropdown:Re}=D();return c.useEffect(()=>{Ne("",{name:"name",id:"id",tabel:"users",idType:"string"}),Pe("",{name:"name",id:"id",tabel:"purpose_types",idType:"string"}),Ae("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),Ie("",{name:"mwszkz",id:"id",tabel:"pajaks",idType:"string"}),Re("",{name:"purchasing_group",id:"id",tabel:"purchasing_groups",idType:"string"})},[]),c.useEffect(()=>{d!=h.edit&&m=="0"&&s.setValue("request_for",(u==null?void 0:u.toString())??"")},[]),e.jsx(Ze,{className:"h-[600px] w-full ",children:e.jsx(Ge,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(fe),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(O,{fieldLabel:"",options:Ce,fieldName:"request_for",isRequired:!0,disabled:d==h.edit?!!s.watch("request_for"):m=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{_e(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsx("td",{children:e.jsx(O,{fieldLabel:"",options:Ee,fieldName:"purpose_type_id",isRequired:!0,disabled:d==h.edit?!!s.watch("purpose_type_id"):!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,a)=>{await he(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(O,{fieldLabel:"",options:ke,fieldName:"cost_center_id",isRequired:!0,disabled:d==h.edit?!!s.watch("cost_center_id"):!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(b,{control:s.control,name:"remark",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(ze,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(T,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(b,{control:s.control,name:"attachment",render:({field:t})=>e.jsxs(y,{children:[e.jsx(Le,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(S,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:a=>{const n=a.target.files;if(n){const o=Array.from(n);t.onChange(o)}else t.onChange([])}})}),s.formState.errors.attachment&&Array.isArray(s.formState.errors.attachment)?s.formState.errors.attachment.map((a,n)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:a.message},n)):null]})})})]}),x.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:x.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",children:t.file_name},a),e.jsx("button",{type:"button",onClick:()=>Se(t.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(b,{control:s.control,name:"total_destination",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(se,{value:t.value.toString(),onValueChange:W,disabled:d==h.edit?!!s.watch("total_destination"):de=="international",children:[e.jsx(re,{className:"w-[200px] py-2",children:e.jsx(ne,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(oe,{children:Array.from({length:5},(a,n)=>e.jsxs(B,{value:(n+1).toString(),children:[" ",n+1," "]},n))})]})}),e.jsx(T,{})]})})]})]})]}),e.jsx(ae,{className:"my-4"}),e.jsx(ot,{updateDestination:ge,destinationField:xe,form:s,listAllowances:z,totalDestination:s.getValues("total_destination").toString(),pajak:v,purchasingGroup:N,setTotalAllowance:Fe,dataTax:qe,dataPurchasingGroup:Ve,dataDestination:me,type:d,btEdit:h.edit}),e.jsx(ae,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(lt,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>De(t.target.checked)})})]}),ve&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(b,{control:s.control,name:"reference_number",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(X,{value:t.value||"",onChange:a=>t.onChange(a.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(T,{})]})}),e.jsx(b,{control:s.control,name:"total_percent",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(se,{value:t.value||void 0,onValueChange:a=>t.onChange(a),children:[e.jsx(re,{className:"w-[50%] mb-2",children:e.jsx(ne,{placeholder:"-- Select Total Percent --"})}),e.jsxs(oe,{children:[e.jsx(B,{value:"10",children:"10%"}),e.jsx(B,{value:"25",children:"25%"}),e.jsx(B,{value:"50",children:"50%"})]})]})}),e.jsx(T,{})]})}),e.jsx(b,{control:s.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(X,{value:t.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(T,{})]})})]})]})})]}),e.jsx(it,{onClick:async()=>await K(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:je&&e.jsx(Qe,{workflowApproval:{approvalRequest:P.approvalRequest,approvalFrom:P.approvalFrom,acknowledgeFrom:P.acknowledgeFrom},workflowApprovalStep:P.approvalFrom,workflowApprovalDiagram:P.approvalFrom})}),e.jsx(Xe,{type:"submit",children:"submit"})]})})})};function _a({form:j,type:F,allowanceIndex:v,destinationIndex:C}){const{fields:N}=ie({control:j.control,name:`destinations.${C}.allowances.${v}.detail`});return e.jsx(e.Fragment,{children:N.map((d,f)=>e.jsx(b,{control:j.control,name:`destinations.${C}.allowances.${f}.detail.${f}.request_price`,render:({field:m})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(X,{value:m.value,onChange:m.onChange})}),e.jsx(T,{})]})}))})}export{_a as AllowanceInputForm,ua as BussinessTripFormV1};
