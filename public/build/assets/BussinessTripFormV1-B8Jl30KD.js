import{j as e,r as x,u as Se,b as Je}from"./app-BOjS1G36.js";import{F as Ke,a as y,b as v,c as D,d as C,e as Ze}from"./form-VFcjn9mT.js";import{z as i,t as Qe}from"./index-DlH4TA2o.js";import{d as _e}from"./index-DQAIzLvg.js";import{B as re}from"./button-sww3pA8a.js";import{T as et}from"./textarea-GjinfNma.js";import{a as tt,C as st,u as at,b as ae,c as H}from"./index.esm-AGEark6h.js";import{S as nt}from"./scroll-area-CEElgfio.js";import{S as fe}from"./separator-C0nm_1_X.js";/* empty css              */import{T as rt,a as lt,b as ot,c as it}from"./tabs-BMuFq4pG.js";import{a as X}from"./axiosInstance-CKW7bq9X.js";import{C as ge}from"./CustomDatePicker-CiCtpmNs.js";import{W as ct}from"./WorkflowComponent-Dtt5cXO0.js";import{S as dt}from"./Switch-TiCrwWrx.js";import{F as pt}from"./FormHelperText-BZLioER1.js";import{I}from"./input-yuHJshSP.js";import{S as be,a as we,b as ye,c as ve,d as se}from"./select-DkZsoCPt.js";import{b as ut,c as mt,d as ht,e as xt,f as jt,g as _t,C as ft,E as gt,h as bt}from"./api-BBOcLXSV.js";import{G as wt,a as yt}from"./api-BEQetkWJ.js";import{h as E}from"./moment-C5S46NFB.js";import{BusinessTripType as z}from"./models-DXk0vRs1.js";import{b as De}from"./api-Cpn27s-b.js";import{u as B}from"./getDropdown-CiL7d4fn.js";import{F as W}from"./formDropdown-fm4abtut.js";import{f as ne}from"./rupiahCurrencyFormat-CnMdu_8N.js";import{c as vt}from"./utils-j_8TWWs2.js";import{C as Dt,a as St,b as Tt,c as Ct,d as Nt,e as At,f as Et}from"./command-DmyA7Ta6.js";import{P as Pt,a as Ft,b as $t}from"./popover-uMUdzIFz.js";import{C as Te}from"./chevrons-up-down-DXUffNXs.js";import{B as It}from"./Button-Jbux7Rkj.js";import"./app-HlhieNAw.js";import"./index-BkduZ3lj.js";import"./index-DWOikKGh.js";import"./index-BGJg-jco.js";import"./index-DFBaxLEB.js";import"./index-ltEgiJBu.js";import"./index-CAO7WugR.js";import"./index-CQ6TIfMB.js";import"./createLucideIcon-CuLsWuTU.js";import"./createSvgIcon-DK7QfAM-.js";import"./DefaultPropsProvider-C0dUKpZ-.js";import"./createSimplePaletteValueFilter-kqlL2BAd.js";import"./SwitchBase-Ccgxf2NH.js";import"./useSlot-CUg28-S3.js";import"./Combination-DaDr2YXt.js";import"./index-CVi0g3Js.js";import"./CustomStatus-pYQXr0Lu.js";import"./TextField-cJLol3WP.js";import"./dialog-C4hCgPoi.js";const Yt=({fieldLabel:l,fieldName:s,isRequired:o=!1,disabled:h=!1,style:j,requiredMessage:p,classNames:u,defaultChecked:r=!1,note:d,onChanges:b})=>{var a;const{control:w,formState:{errors:m}}=tt();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[l&&e.jsxs("label",{className:"form-label max-w-32",children:[l," ",e.jsxs("span",{className:"text-red-700",children:[" ",o?"*":""]})]}),e.jsx(st,{name:s,control:w,rules:{required:o?p??`${l} is required`:!1},render:({field:_})=>e.jsx("div",{style:j,className:u,children:e.jsx(dt,{..._,checked:!!(_.value??r),onChange:F=>{_.onChange(F),b&&b(F)},disabled:h})})}),e.jsx("span",{children:d})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),m[s]&&e.jsx(pt,{error:!0,children:String((a=m[s])==null?void 0:a.message)})]})]})};function qt({data:l,onSelect:s}){var r;const[o,h]=x.useState(!1),[j,p]=x.useState(""),u=d=>{const b=d===j?"":d;p(b),s==null||s(b),h(!1)};return e.jsxs(Pt,{open:o,onOpenChange:h,children:[e.jsx(Ft,{asChild:!0,children:e.jsxs(re,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-[200px] justify-between",children:[j?(r=l.find(d=>d.value===j))==null?void 0:r.label:"Select option...",e.jsx(Te,{className:"opacity-50"})]})}),e.jsx($t,{className:"w-[200px] p-0",children:e.jsxs(Dt,{children:[e.jsx(St,{placeholder:"Search option...",className:"h-9"}),e.jsxs(Tt,{children:[e.jsx(Ct,{children:"No data found."}),e.jsx(Nt,{children:l.map(d=>e.jsxs(At,{value:d.value,onSelect:()=>u(d.value),children:[d.label,e.jsx(Et,{className:vt("ml-auto",j===d.value?"opacity-100":"opacity-0")})]},d.value))})]})]})})]})}i.object({remark:i.string().min(1).max(50),reimburse_cost:i.number()});const Rt=1*1024*1024,kt=["image/jpeg","image/png","application/pdf"],Ls=({users:l,listPurposeType:s,pajak:o,costcenter:h,purchasingGroup:j,type:p,id:u,isAdmin:r,idUser:d})=>{const b=i.object({purpose_type_id:i.string().min(1,"Purpose type required"),request_for:i.string().min(1,"Request is required"),cost_center_id:i.string().min(1,"Cost Center is required"),remark:i.string().min(1,"Remark is required"),attachment:i.array(i.instanceof(File).refine(t=>kt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(t=>t.size<=Rt,{message:"File size must be less than 1MB"})),total_destination:i.number().min(1,"Total Destinantion Required"),cash_advance:i.boolean().nullable().optional(),reference_number:i.string().nullable().optional(),total_percent:i.string().nullable().optional(),total_cash_advance:i.string().nullable().optional(),destinations:i.array(i.object({destination:i.string().min(1,"Destinantion is Required"),pajak_id:i.string().min(1,"Pajak is required"),purchasing_group_id:i.string().min(1,"Purchasing Group is required"),business_trip_start_date:i.date().optional(),business_trip_end_date:i.date().optional(),detail_attedances:i.array(i.object({date:i.date().optional(),shift_code:i.string().optional(),shift_start:i.string().optional(),shift_end:i.string().optional(),start_time:i.string().optional(),end_time:i.string().optional()})),allowances:i.array(i.object({name:i.string().optional(),code:i.string().optional(),default_price:i.number().optional(),type:i.string().optional(),subtotal:i.number().optional(),currency:i.string().optional(),detail:i.array(i.object({date:i.date().nullish(),request_price:i.any().optional()}))}))}))}),[w,m]=x.useState("1"),a=at({resolver:Qe(b),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[_,F]=x.useState([]);async function O(){const t=bt(u);a.setValue("destinations",[]);try{const c=(await Je.get(t)).data.data,f=De(c.purpose_type_id),A=await X.get(f);G(A.data.data),F(c.attachments),a.setValue("purpose_type_id",c.purpose_type_id.toString()),a.setValue("request_for",c.request_for.id.toString()),a.setValue("cost_center_id",c.cost_center_id.toString()),a.setValue("remark",c.remarks),a.setValue("total_destination",c.total_destination),a.setValue("cash_advance",c.cash_advance==1),a.setValue("reference_number",c.reference_number),a.setValue("total_percent",c.total_percent),a.setValue("total_cash_advance",c.total_cash_advance),a.setValue("destinations",c.destinations.map(S=>({destination:S.destination,pajak_id:S.pajak_id,purchasing_group_id:S.purchasing_group_id,business_trip_start_date:new Date(S.business_trip_start_date),business_trip_end_date:new Date(S.business_trip_end_date),detail_attedances:S.detail_attedances.map(g=>({...g,date:new Date(g.date)})),allowances:S.allowances.map(g=>({...g,default_price:parseInt(g.default_price),subtotal:parseInt(g.subtotal),detail:g.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?new Date(T.date):null}))}))})))}catch{}}const[R,J]=x.useState([]),[K,G]=x.useState([]),[le,oe]=x.useState(""),[ie,P]=x.useState(r==="0"?d.toString():"");async function $(t){a.setValue("purpose_type_id",t||"");const n=r=="0"?d||"":ie||"",c=wt(t,n),f=De(t),A=yt(t);try{const S=await X.get(c),g=await X.get(f);console.log(g.data.data,"responseDestination");const k=(await X.get(A)).data.data.purpose.type;k=="international"&&Z("1"),oe(k),J(S.data.data),G(g.data.data)}catch(S){console.log(S)}}const Z=t=>{a.setValue("total_destination",parseInt(t,10)),m(t),Y()},{showToast:M}=Se(),N=async t=>{console.log(t," valuesss");try{const n=new FormData,c=de();n.append("user_id",t.request_for??""),n.append("value",c.toString()),n.append("purpose_type_id",t.purpose_type_id??""),n.append("request_for",t.request_for??""),n.append("cost_center_id",t.cost_center_id??""),n.append("remark",t.remark??""),n.append("reference_number",`${t.reference_number}`),n.append("cash_advance",`${t.cash_advance}`),n.append("total_percent",`${t.total_percent}`),n.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((f,A)=>{f&&n.append(`attachment[${A}]`,f)}),n.append("total_destination",`${t.total_destination}`),t.destinations.forEach((f,A)=>{const S={...f,business_trip_start_date:E(f.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:E(f.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:f.detail_attedances.map(g=>({...g,date:E(g.date).format("YYYY-MM-DD")})),allowances:f.allowances.map(g=>({...g,detail:g.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?E(T.date).format("YYYY-MM-DD"):null}))}))};n.append(`destinations[${A}]`,JSON.stringify(S))}),p==z.create?(await _e.Inertia.post(ft,n,{headers:{"Content-Type":"multipart/form-data"}}),M("succesfully created data","success")):(await _e.Inertia.post(`${gt}/${u}`,n,{headers:{"Content-Type":"multipart/form-data"}}),M("succesfully updated data","success"))}catch(n){console.log(n)}};function Y(){const t=[],n=parseInt(w);for(let c=0;c<n;c++)t.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});a.setValue("destinations",t)}const{fields:Q,append:ce,remove:Xt,update:Ce}=ae({control:a.control,name:"destinations"});x.useEffect(()=>{u&&p==z.edit&&O()},[]),x.useEffect(()=>{p==z.create&&Y()},[w,R,u,p,r,d]);const[Ne,Ae]=x.useState(!1),[L,Ee]=x.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),Pe=(t,n)=>{var c;return t.type==="total"?parseFloat(((c=n==null?void 0:n[0])==null?void 0:c.request_price)||0):n==null?void 0:n.reduce((f,A)=>f+parseFloat(A.request_price||0),0)},de=()=>a.getValues("destinations").reduce((c,f,A)=>{const g=(f.allowances||[]).reduce((T,k,ee)=>{const te=a.getValues(`destinations.${A}.allowances.${ee}.detail`),q=Pe(k,te);return T+q},0);return c+g},0),pe=async()=>{var t,n,c,f,A,S,g,T,k,ee,te;try{const q=de();if(q===0){M("Please fill the balance","error");return}const U=await X.get("/check-approval",{params:{value:q,user_id:a.getValues("request_for"),type:"TRIP"}});if(U.data.status_code===200){const We=(n=(t=U.data)==null?void 0:t.data)==null?void 0:n.approval.map(V=>(V==null?void 0:V.division_name)||null),He=(f=(c=U.data)==null?void 0:c.data)==null?void 0:f.approval.map(V=>(V==null?void 0:V.name)||null),xe=[];(S=(A=U.data)==null?void 0:A.data)!=null&&S.hr&&xe.push((k=(T=(g=U.data)==null?void 0:g.data)==null?void 0:T.hr)==null?void 0:k.name);const je={approvalRequest:We,approvalFrom:He,acknowledgeFrom:xe};console.log(je),Ee(je),Ae(!0)}}catch(q){M((te=(ee=q==null?void 0:q.response)==null?void 0:ee.data)==null?void 0:te.message,"error")}};x.useEffect(()=>{de()>0&&pe()},[a.watch("destinations")]),x.useState([]);const Fe=t=>{F(n=>n.filter(c=>c.id!==t))},[$e,ue]=x.useState(!1),Ie=t=>{ue(t)},me=H({control:a.control,name:"total_percent"}),[Ye,qe]=x.useState(0),he=Ye;x.useEffect(()=>{p==z.edit&&ue(a.getValues("cash_advance")??!1);const n=parseFloat((me||"0").toString())/100*he;a.setValue("total_cash_advance",n.toFixed(0))},[me,he]);const{dataDropdown:Re,getDropdown:ke}=B(ut),{dataDropdown:Ve,getDropdown:Ge}=B(mt),{dataDropdown:Me,getDropdown:Be}=B(ht),{dataDropdown:zt,getDropdown:Oe}=B(xt),{dataDropdown:Le,getDropdown:Ue}=B(jt),{dataDropdown:Xe,getDropdown:ze}=B(_t);return x.useEffect(()=>{ke("",{name:"name",id:"id",tabel:"users"}),Ge("",{name:"name",id:"id",tabel:"purpose_types"}),Be("",{name:"cost_center",id:"id",tabel:"master_cost_centers"}),Oe("",{name:"destination",id:"destination",tabel:"destinations"}),Ue("",{name:"mwszkz",id:"id",tabel:"pajaks"}),ze("",{name:"purchasing_group",id:"id",tabel:"purchasing_groups"})},[]),x.useEffect(()=>{p!=z.edit&&r=="0"&&(console.log(d," idUseridUseridUser"),a.setValue("request_for",d??""))},[]),e.jsx(nt,{className:"h-[600px] w-full ",children:e.jsx(Ke,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(N),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(W,{options:Re,fieldName:"request_for",isRequired:!0,disabled:r=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{P(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsx("td",{children:e.jsx(W,{options:Ve,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:t=>{$(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(W,{options:Me,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(y,{control:a.control,name:"remark",render:({field:t})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(et,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(y,{control:a.control,name:"attachment",render:({field:t})=>e.jsxs(v,{children:[e.jsx(Ze,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(D,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:n=>{const c=n.target.files;if(c){const f=Array.from(c);t.onChange(f)}else t.onChange([])}})}),a.formState.errors.attachment&&Array.isArray(a.formState.errors.attachment)?a.formState.errors.attachment.map((n,c)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:n.message},c)):null]})})})]}),_.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),_.map((t,n)=>e.jsxs("td",{className:"flex flex-col pb-3",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",children:t.file_name},n),e.jsx("button",{type:"button",onClick:()=>Fe(t.id),className:"text-red-500 mt-2",children:"Delete"})]}))]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(y,{control:a.control,name:"total_destination",render:({field:t})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsxs(be,{value:t.value.toString(),onValueChange:Z,disabled:le==="international",children:[e.jsx(we,{className:"w-[200px] py-2",children:e.jsx(ye,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(ve,{children:Array.from({length:5},(n,c)=>e.jsxs(se,{value:(c+1).toString(),children:[" ",c+1," "]},c))})]})}),e.jsx(C,{})]})})]})]})]}),e.jsx(fe,{className:"my-4"}),e.jsx(Vt,{updateDestination:Ce,destinationField:Q,listDestination:K,form:a,listAllowances:R,totalDestination:a.getValues("total_destination").toString(),pajak:o,purchasingGroup:j,setTotalAllowance:qe,dataTax:Le,dataPurchasingGroup:Xe}),e.jsx(fe,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Yt,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Ie(t.target.checked)})})]}),$e&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(y,{control:a.control,name:"reference_number",render:({field:t})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{value:t.value||"",onChange:n=>t.onChange(n.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(C,{})]})}),e.jsx(y,{control:a.control,name:"total_percent",render:({field:t})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsxs(be,{value:t.value||void 0,onValueChange:n=>t.onChange(n),children:[e.jsx(we,{className:"w-[50%] mb-2",children:e.jsx(ye,{placeholder:"-- Select Total Percent --"})}),e.jsxs(ve,{children:[e.jsx(se,{value:"10",children:"10%"}),e.jsx(se,{value:"25",children:"25%"}),e.jsx(se,{value:"50",children:"50%"})]})]})}),e.jsx(C,{})]})}),e.jsx(y,{control:a.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{value:t.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(C,{})]})})]})]})})]}),e.jsx(It,{onClick:async()=>await pe(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Ne&&e.jsx(ct,{workflowApproval:{approvalRequest:L.approvalRequest,approvalFrom:L.approvalFrom,acknowledgeFrom:L.acknowledgeFrom},workflowApprovalStep:L.approvalFrom,workflowApprovalDiagram:L.approvalFrom})}),e.jsx(re,{type:"submit",children:"submit"})]})})})};function Vt({totalDestination:l,listAllowances:s,destinationField:o,form:h,updateDestination:j,setTotalAllowance:p,listDestination:u=[],pajak:r,purchasingGroup:d,typeEdit:b,dataTax:w,dataPurchasingGroup:m}){return x.useState(),x.useState(),x.useState(0),Se(),e.jsxs(rt,{defaultValue:"destination1",className:"w-full",children:[e.jsx(lt,{className:"flex items-center justify-start space-x-4",children:o.map((a,_)=>e.jsxs(ot,{value:`destination${_+1}`,children:["Destination ",_+1]}))}),o.map((a,_)=>e.jsx(Gt,{listAllowances:s,updateDestination:j,destination:a,form:h,index:_,setTotalAllowance:p,listDestination:u,pajak:r,purchasingGroup:d,typeEdit:b,dataTax:w,dataPurchasingGroup:m}))]})}function Gt({form:l,index:s,destination:o,updateDestination:h,listAllowances:j,setTotalAllowance:p,listDestination:u,pajak:r,purchasingGroup:d,typeEdit:b,dataTax:w,dataPurchasingGroup:m}){const{fields:a,update:_,append:F,remove:O}=ae({control:l.control,name:`destinations.${s}.detail_attedances`}),{fields:R,update:J,append:K,remove:G,replace:le}=ae({control:l.control,name:`destinations.${s}.allowances`});function oe(){let P=E(o.business_trip_start_date).startOf("day");const $=E(o.business_trip_end_date).startOf("day");for(O(),G();P.isBefore($)||P.isSame($);){const N={date:P.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};F(N),P=P.add(1,"days")}function Z(N){let Y=E(o.business_trip_start_date).startOf("day");const Q=E(o.business_trip_end_date).startOf("day"),ce=[];for(;Y.isBefore(Q)||Y.isSame(Q);)ce.push({date:Y.toDate(),request_price:N}),Y=Y.add(1,"days");return ce}const M=j.map(N=>({name:N.name,code:N.code,default_price:parseInt(N.grade_price),type:N.type,subtotal:parseInt(N.grade_price),currency:N.currency_id,request_value:N.request_value,detail:N.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(N.grade_price)}]:Z(N.grade_price)}));le(M)}const ie=P=>{h(s,{...o,destination:P})};return e.jsxs(it,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",o.destination]}),e.jsx("td",{children:e.jsx(y,{control:l.control,name:`destinations.${s}.destination`,render:({field:P})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(qt,{data:u.map($=>({value:$.destination??"",label:$.destination??""})),onSelect:ie})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{children:e.jsx(W,{options:w,fieldName:`destinations.${s}.pajak_id`,isRequired:!0,disabled:!1,placeholder:"Select Pajak",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(W,{options:m,fieldName:`destinations.${s}.purchasing_group_id`,isRequired:!0,disabled:!1,placeholder:"Select Purchasing Group",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(y,{control:l.control,name:`destinations.${s}.business_trip_start_date`,render:({field:P})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(ge,{initialDate:o.business_trip_start_date,onDateChange:$=>{h(s,{...o,business_trip_start_date:$})}})}),e.jsx(C,{})]})}),e.jsx("span",{children:"To"}),e.jsx(y,{control:l.control,name:`destinations.${s}.business_trip_end_date`,render:({field:P})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(ge,{initialDate:o.business_trip_end_date,onDateChange:$=>{h(s,{...o,business_trip_end_date:$})}})}),e.jsx(C,{})]})}),e.jsx(re,{type:"button",onClick:()=>oe(),children:"Get Detail"})]})]})]}),e.jsx(Ot,{detailAttedanceFields:a,form:l,updateAttedanceFields:_,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(Lt,{allowanceField:R,destinationIndex:s,form:l})]},s),e.jsx(Mt,{allowanceField:R,destinationIndex:s,form:l,setTotalAllowance:p})]})}function Mt({allowanceField:l,destinationIndex:s,form:o,setTotalAllowance:h}){const[j,p]=x.useState(0);x.useEffect(()=>{const r=l.reduce((w,m,a)=>{const _=o.getValues(`destinations.${s}.allowances.${a}.detail`),F=u(m,_);return w+F},0),b=o.getValues("destinations").reduce((w,m,a)=>{const F=(m.allowances||[]).reduce((O,R,J)=>{const K=o.getValues(`destinations.${a}.allowances.${J}.detail`),G=u(R,K);return O+G},0);return w+F},0);p(r),h(b)},[l,o.watch()]);const u=(r,d)=>{var b;return r.type==="total"?parseFloat(((b=d==null?void 0:d[0])==null?void 0:b.request_price)||0):d==null?void 0:d.reduce((w,m)=>w+parseFloat(m.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:l.map((r,d)=>e.jsx(Bt,{allowance:r,destinationIndex:s,form:o,allowanceIndex:d}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:ne(j)})})]})]})})]})})}function Bt({allowance:l,destinationIndex:s,form:o,allowanceIndex:h}){const j=H({control:o.control,name:`destinations.${s}.allowances.${h}.detail.0.request_price`}),p=H({control:o.control,name:`destinations.${s}.allowances.${h}.detail`}),u=()=>{if(l.type==="total")return parseFloat(j||0)*1;{let r=0;return p==null||p.forEach(d=>{const b=parseFloat(d.request_price||0);r+=b}),r}};return e.jsxs("tr",{children:[e.jsx("td",{children:l.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:ne(u())})]})]},l.id)}function Ot({form:l,destinationIndex:s,detailAttedanceFields:o,updateAttedanceFields:h}){const j=l.watch(`destinations.${s}.detail_attedances`);return x.useEffect(()=>{},[j]),x.useEffect(()=>{},[o]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:o.map((p,u)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[E(p.date).format("DD/MM/YYYY"),e.jsx(y,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.date`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{defaultValue:E(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(C,{})]})})]}),e.jsxs("td",{children:[p.shift_code,e.jsx(y,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.shift_code`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{defaultValue:E(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(C,{})]})})]}),e.jsxs("td",{children:[p.shift_start,e.jsx(y,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.shift_start`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{defaultValue:E(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(C,{})]})})]}),e.jsxs("td",{children:[p.shift_end,e.jsx(y,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.shift_end`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{defaultValue:E(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(C,{})]})})]}),e.jsx("td",{children:e.jsx(y,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.start_time`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(C,{})]})})}),e.jsx("td",{children:e.jsx(y,{control:l.control,name:`destinations.${s}.detail_attedances.${u}.end_time`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(C,{})]})})})]},p.index))})]})})})]})}function Lt({form:l,destinationIndex:s,allowanceField:o}){return e.jsx("table",{className:"w-full allowance-table",children:o.map((h,j)=>e.jsx(Ut,{form:l,allowance:h,destinationIndex:s,allowanceIndex:j}))})}function Ut({form:l,allowance:s,destinationIndex:o,allowanceIndex:h}){const[j,p]=x.useState(!1),u=m=>{p(a=>!a)},r=H({control:l.control,name:`destinations.${o}.allowances.${h}.detail.0.request_price`}),d=H({control:l.control,name:`destinations.${o}.allowances.${h}.detail`}),b=()=>{if(s.type==="total")return parseFloat(r||0)*1;{let m=0;return d==null||d.forEach(a=>{const _=parseFloat(a.request_price||0);m+=_}),m}},w=m=>a=>{const _=parseFloat(a.target.value)||0;s.request_value==="unlimited"?m.onChange(a):s.request_value==="up to max value"?_<=s.subtotal?m.onChange(a):alert(`Value cannot exceed the subtotal of IDR ${s.subtotal}`):s.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{control:l.control,name:`destinations.${o}.allowances.${h}.detail.0.request_price`,render:({field:m})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{value:m.value,onChange:w(m)})}),e.jsx(C,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",ne(s.subtotal)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",ne(b())]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>u(),children:e.jsxs(re,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),j&&e.jsx(e.Fragment,{children:s.detail.map((m,a)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:E(m.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(y,{control:l.control,name:`destinations.${o}.allowances.${h}.detail.${a}.request_price`,render:({field:_})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{value:_.value,onChange:w(_)})}),e.jsx(C,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},m.id))})]})}function Us({form:l,type:s,allowanceIndex:o,destinationIndex:h}){const{fields:j}=ae({control:l.control,name:`destinations.${h}.allowances.${o}.detail`});return e.jsx(e.Fragment,{children:j.map((p,u)=>e.jsx(y,{control:l.control,name:`destinations.${h}.allowances.${u}.detail.${u}.request_price`,render:({field:r})=>e.jsxs(v,{children:[e.jsx(D,{children:e.jsx(I,{value:r.value,onChange:r.onChange})}),e.jsx(C,{})]})}))})}export{Us as AllowanceInputForm,Ut as AllowanceRowInput,Vt as BussinesTripDestination,Gt as BussinessDestinationForm,Ls as BussinessTripFormV1,Lt as DetailAllowance,Ot as DetailAttedances,Bt as ResultPerItem,Mt as ResultTotalItem};
