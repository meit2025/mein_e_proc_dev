import{j as e,r as N,u as _e,b as ve}from"./app-00v03VzZ.js";import{F as we,a as g,b as f,c as b,d as v,e as ye}from"./form-iCQMsl4W.js";import{z as l,t as Se}from"./index-CfKVgqWH.js";import{d as ue}from"./index-CKPB7EWy.js";import{B as pe}from"./button-DhndZVcC.js";import{T as Ce}from"./textarea-Bh4sn7Rj.js";import{a as De,C as Ne,u as Te,b as te,c as W}from"./index.esm-D_57pwTi.js";import{S as Ae}from"./scroll-area-DFtGxwCZ.js";import{S as xe}from"./separator-BA6rxjNR.js";/* empty css              */import{T as $e,a as Fe,b as Ye,c as qe}from"./tabs-BnBhoUxB.js";import{a as me}from"./axiosInstance-rdkLL0kt.js";import{C as je}from"./CustomDatePicker-cSpci6pu.js";import{W as Ve}from"./WorkflowComponent-CqwRlk-q.js";import{S as ke}from"./Switch-B69AG-Kk.js";import{F as Re}from"./FormHelperText-CiOI471K.js";import{I as A}from"./input-5rNmDZQC.js";import{S as k,a as R,b as E,c as I,d as $}from"./select-BFjmY9Zb.js";import{C as Ee,E as Ie,b as Pe}from"./api-B9TTe-Ow.js";import{G as Me}from"./api-BEQetkWJ.js";import{h as T}from"./moment-C5S46NFB.js";import{BusinessTripType as ee}from"./models-wXc54cbY.js";import{B as Be}from"./Button-CSew7ugD.js";import{C as Ge}from"./chevrons-up-down-C022_WXx.js";import"./app-HlhieNAw.js";import"./index-DlAwB2tx.js";import"./utils-3yA9f3hb.js";import"./index-9HpGyLfJ.js";import"./index-DSP8EmDa.js";import"./index-DndTfNuC.js";import"./index-C4HA4TJM.js";import"./index-C0f1LlfG.js";import"./index-Bmuc9XVv.js";import"./popover-C82SzmdF.js";import"./Combination-Bt_aj--v.js";import"./createLucideIcon-CJjfsxxm.js";import"./createSimplePaletteValueFilter-CdxC_KWn.js";import"./DefaultPropsProvider-D8QK9QNT.js";import"./extends-CF3RwP-h.js";import"./SwitchBase-DWh7uunE.js";import"./useControlled-DZD05zgY.js";import"./index-B4z1SRWz.js";import"./CustomStatus-DXkEbf8v.js";const Oe=({fieldLabel:a,fieldName:t,isRequired:o=!1,disabled:j=!1,style:y,requiredMessage:x,classNames:m,defaultChecked:n=!1,note:h,onChanges:S})=>{var D;const{control:C,formState:{errors:_}}=De();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[a&&e.jsxs("label",{className:"form-label max-w-32",children:[a," ",e.jsxs("span",{className:"text-red-700",children:[" ",o?"*":""]})]}),e.jsx(Ne,{name:t,control:C,rules:{required:o?x??`${a} is required`:!1},render:({field:i})=>e.jsx("div",{style:y,className:m,children:e.jsx(ke,{...i,checked:!!(i.value??n),onChange:G=>{i.onChange(G),S&&S(G)},disabled:j})})}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),_[t]&&e.jsx(Re,{error:!0,children:String((D=_[t])==null?void 0:D.message)})]})]})};l.object({remark:l.string().min(1).max(50),reimburse_cost:l.number()});const Bt=({users:a,listPurposeType:t,pajak:o,costcenter:j,purchasingGroup:y,type:x,id:m,isAdmin:n,idUser:h,listDestination:S=[]})=>{const C=l.object({purpose_type_id:l.string().min(1,"Purpose type required"),request_for:l.string().min(1,"Request is required"),cost_center_id:l.string().min(1,"Cost Center is required"),remark:l.string().min(1,"Remark is required"),attachment:l.instanceof(File).nullable().optional(),total_destination:l.number().min(1,"Total Destinantion Required"),destinations:l.array(l.object({destination:l.string().min(1,"Destinantion is Required"),pajak_id:l.string().min(1,"Pajak is required"),purchasing_group_id:l.string().min(1,"Purchasing Group is required"),cash_advance:l.boolean().nullable().optional(),reference_number:l.string().nullable().optional(),total_percent:l.string().nullable().optional(),total_cash_advance:l.string().nullable().optional(),business_trip_start_date:l.date().optional(),business_trip_end_date:l.date().optional(),detail_attedances:l.array(l.object({date:l.date().optional(),shift_code:l.string().optional(),shift_start:l.string().optional(),shift_end:l.string().optional(),start_time:l.string().optional(),end_time:l.string().optional()})),allowances:l.array(l.object({name:l.string().optional(),code:l.string().optional(),default_price:l.number().optional(),type:l.string().optional(),subtotal:l.number().optional(),currency:l.string().optional(),detail:l.array(l.object({date:l.date().nullish(),request_price:l.any().optional()}))}))}))}),[_,D]=N.useState("1");console.log("list destiantion",S);const i=Te({resolver:Se(C),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:null,total_destination:1,destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",business_trip_start_date:new Date,business_trip_end_date:new Date}]}});async function G(){const r=Pe(m);i.setValue("destinations",[]);try{const d=(await ve.get(r)).data.data;console.log(d," Response Detailxxxx"),i.setValue("purpose_type_id",d.purpose_type_id),i.setValue("request_for",d.request_for.id),i.setValue("cost_center_id",d.cost_center_id),i.setValue("remark",d.remarks),i.setValue("total_destination",d.total_destination),console.log(d.destinations," data.destinations"),i.setValue("destinations",d.destinations.map(c=>({destination:c.destination,pajak_id:c.pajak_id,purchasing_group_id:c.purchasing_group_id,cash_advance:c.cash_advance,reference_number:c.reference_number,total_percent:c.total_percent,total_cash_advance:c.total_cash_advance,business_trip_start_date:new Date(c.business_trip_start_date),business_trip_end_date:new Date(c.business_trip_end_date),detail_attedances:c.detail_attedances,allowances:c.allowances})))}catch{}}const[se,ae]=N.useState([]),[ne,re]=N.useState(n==="0"?h.toString():"");async function le(r){i.setValue("purpose_type_id",r||"");const s=n=="0"?h||"":ne||"";console.log(s," ---- ");const d=Me(r,s);try{const c=await me.get(d);ae(c.data.data)}catch(c){console.log(c)}}const z=r=>{i.setValue("total_destination",parseInt(r,10)),D(r),H()},{showToast:B}=_e(),U=async r=>{try{const s=new FormData,d=O();s.append("user_id",r.purpose_type_id??""),s.append("value",d.toString()),s.append("purpose_type_id",r.purpose_type_id??""),s.append("purpose_type_id",r.purpose_type_id??""),s.append("request_for",r.request_for??""),s.append("cost_center_id",r.cost_center_id??""),s.append("remark",r.remark??""),s.append("attachment",r.attachment??""),s.append("total_destination",`${r.total_destination}`),r.destinations.forEach((c,q)=>{const X={...c,business_trip_start_date:T(c.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:T(c.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:c.detail_attedances.map(F=>({...F,date:T(F.date).format("YYYY-MM-DD")})),allowances:c.allowances.map(F=>({...F,detail:F.detail.map(Y=>({...Y,date:(Y==null?void 0:Y.date)!=null?T(Y.date).format("YYYY-MM-DD"):null}))}))};s.append(`destinations[${q}]`,JSON.stringify(X))}),console.log(s," test"),x==ee.create?(await ue.Inertia.post(Ee,s,{headers:{"Content-Type":"multipart/form-data"}}),B("succesfully created data","success")):(await ue.Inertia.put(`${Ie}/${m}`,s,{headers:{"Content-Type":"multipart/form-data"}}),B("succesfully updated data","success"))}catch(s){console.log(s)}};function H(){const r=[],s=parseInt(_);for(let d=0;d<s;d++)r.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});i.setValue("destinations",r)}const{fields:oe,append:ie,remove:u,update:p}=te({control:i.control,name:"destinations"});N.useEffect(()=>{m&&x==ee.edit&&G()},[]),N.useEffect(()=>{x==ee.create&&H()},[_,se,m,x,n,h]);const[ce,de]=N.useState(!1),[w,P]=N.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),J=(r,s)=>{var d;return r.type==="total"?parseFloat(((d=s==null?void 0:s[0])==null?void 0:d.request_price)||0):s==null?void 0:s.reduce((c,q)=>c+parseFloat(q.request_price||0),0)},O=()=>i.getValues("destinations").reduce((d,c,q)=>{const F=(c.allowances||[]).reduce((Y,K,Q)=>{const Z=i.getValues(`destinations.${q}.allowances.${Q}.detail`),V=J(K,Z);return Y+V},0);return d+F},0),ge=async()=>{var r,s,d,c,q,X,F,Y,K,Q,Z;try{const V=O();if(V===0){B("Please fill the balance","error");return}const L=await me.get("/check-approval",{params:{value:V,user_id:i.getValues("purpose_type_id"),type:"TRIP"}});if(L.data.status_code===200){const fe=(s=(r=L.data)==null?void 0:r.data)==null?void 0:s.approval.map(M=>(M==null?void 0:M.division_name)||null),be=(c=(d=L.data)==null?void 0:d.data)==null?void 0:c.approval.map(M=>(M==null?void 0:M.name)||null),he=[];(X=(q=L.data)==null?void 0:q.data)!=null&&X.hr&&he.push((K=(Y=(F=L.data)==null?void 0:F.data)==null?void 0:Y.hr)==null?void 0:K.name),P({approvalRequest:fe,approvalFrom:be,acknowledgeFrom:he}),de(!0)}}catch(V){B((Z=(Q=V==null?void 0:V.response)==null?void 0:Q.data)==null?void 0:Z.message,"error")}};return e.jsx(Ae,{className:"h-[600px] w-full ",children:e.jsx(we,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(U),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(g,{control:i.control,name:"request_for",render:({field:r})=>(n==="0"&&!r.value&&r.onChange(h.toString()),e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:s=>{re(s),r.onChange(s)},value:r.value,disabled:n==="0",children:[e.jsx(R,{className:"w-[200px] py-2",children:e.jsx(E,{placeholder:"-- Select Business Purpose Type --"})}),e.jsx(I,{children:n==="1"?a.map(s=>e.jsx($,{value:s.id.toString(),children:s.name},s.id)):a.filter(s=>s.id===h).map(s=>e.jsx($,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(v,{})]}))})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:i.control,name:"purpose_type_id",render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:s=>le(s),value:r.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(E,{placeholder:"-- Select Bussiness Purpose Type --"})}),e.jsx(I,{children:t.map(s=>e.jsx($,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:i.control,name:"cost_center_id",render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:s=>r.onChange(s),value:r.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(E,{placeholder:"-- Select Cost Center --"})}),e.jsx(I,{children:j.map(s=>e.jsx($,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(g,{control:i.control,name:"remark",render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Ce,{placeholder:"Insert remark",...r,rows:4,className:"w-[300px]"})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(g,{control:i.control,name:"attachment",render:({field:r})=>e.jsxs(f,{children:[e.jsx(ye,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(b,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:s=>{var c;const d=(c=s.target.files)==null?void 0:c[0];d?r.onChange(d):r.onChange(null)}})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:i.control,name:"total_destination",render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{value:r.value.toString(),onValueChange:z,children:[e.jsx(R,{className:"w-[200px] py-2",children:e.jsx(E,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(I,{children:Array.from({length:5},(s,d)=>e.jsxs($,{value:(d+1).toString(),children:[" ",d+1," "]},d))})]})}),e.jsx(v,{})]})})]})]})]}),e.jsx(xe,{className:"my-4"}),e.jsx(Xe,{updateDestination:p,destinationField:oe,listDestination:S,form:i,listAllowances:se,totalDestination:i.getValues("total_destination").toString(),pajak:o,purchasingGroup:y,typeEdit:x}),e.jsx(xe,{className:"my-4"}),e.jsx(Be,{onClick:async()=>await ge(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ce&&e.jsx(Ve,{workflowApproval:{approvalRequest:w.approvalRequest,approvalFrom:w.approvalFrom,acknowledgeFrom:w.acknowledgeFrom},workflowApprovalStep:w.approvalFrom,workflowApprovalDiagram:w.approvalFrom})}),e.jsx(pe,{type:"submit",children:"submit"})]})})})};function Xe({totalDestination:a,listAllowances:t,destinationField:o,form:j,updateDestination:y,listDestination:x=[],pajak:m,purchasingGroup:n,typeEdit:h}){return N.useState(),N.useState(),N.useState(0),_e(),e.jsxs($e,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Fe,{className:"flex items-center justify-start space-x-4",children:o.map((S,C)=>e.jsxs(Ye,{value:`destination${C+1}`,children:["Destination ",C+1]}))}),o.map((S,C)=>e.jsx(Le,{listAllowances:t,updateDestination:y,destination:S,form:j,index:C,listDestination:x,pajak:m,purchasingGroup:n,typeEdit:h}))]})}function Le({form:a,index:t,destination:o,updateDestination:j,listAllowances:y,listDestination:x,pajak:m,purchasingGroup:n,typeEdit:h}){const{fields:S,update:C,append:_,remove:D}=te({control:a.control,name:`destinations.${t}.detail_attedances`}),{fields:i,update:G,append:se,remove:ae,replace:ne}=te({control:a.control,name:`destinations.${t}.allowances`});function re(){let u=T(o.business_trip_start_date).startOf("day");const p=T(o.business_trip_end_date).startOf("day");for(D(),ae();u.isBefore(p)||u.isSame(p);){const w={date:u.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};_(w),u=u.add(1,"days")}function ce(w){let P=T(o.business_trip_start_date).startOf("day");const J=T(o.business_trip_end_date).startOf("day"),O=[];for(;P.isBefore(J)||P.isSame(J);)O.push({date:P.toDate(),request_price:w}),P=P.add(1,"days");return O}const de=y.map(w=>({name:w.name,code:w.code,default_price:parseInt(w.grade_price),type:w.type,subtotal:parseInt(w.grade_price),currency:w.currency_id,request_value:w.request_value,detail:w.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(w.grade_price)}]:ce(w.grade_price)}));ne(de)}const[le,z]=N.useState(!1),B=u=>{z(u)},U=W({control:a.control,name:`destinations.${t}.total_percent`}),[H,oe]=N.useState(0),ie=H;return N.useEffect(()=>{h==ee.edit&&z(a.getValues(`destinations.${t}.cash_advance`));const p=parseFloat((U||"0").toString())/100*ie;a.setValue(`destinations.${t}.total_cash_advance`,p.toFixed(0))},[U,ie]),e.jsxs(qe,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",o.destination]}),e.jsx("td",{children:e.jsx(g,{control:a.control,name:`destinations.${t}.destination`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:p=>{j(t,{...o,destination:p})},defaultValue:o.destination,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(E,{placeholder:"Destination"})}),e.jsx(I,{children:x.map(p=>e.jsx($,{value:p.destination,className:"uppercase",children:p.destination}))})]})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:a.control,name:`destinations.${t}.pajak_id`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:p=>u.onChange(p),value:u.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(E,{placeholder:"-- Select Pajak --"})}),e.jsx(I,{children:m.map(p=>e.jsx($,{value:p.id,children:p.mwszkz}))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:a.control,name:`destinations.${t}.purchasing_group_id`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:p=>u.onChange(p),value:u.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(E,{placeholder:"-- Select Purchasing Group --"})}),e.jsx(I,{children:n.map(p=>e.jsx($,{value:p.id,children:p.purchasing_group}))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(g,{control:a.control,name:`destinations.${t}.business_trip_start_date`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(je,{initialDate:o.business_trip_start_date,onDateChange:p=>{j(t,{...o,business_trip_start_date:p})}})}),e.jsx(v,{})]})}),e.jsx("span",{children:"To"}),e.jsx(g,{control:a.control,name:`destinations.${t}.business_trip_end_date`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(je,{initialDate:o.business_trip_end_date,onDateChange:p=>{console.log("end date",p),j(t,{...o,business_trip_end_date:p})}})}),e.jsx(v,{})]})}),e.jsx(pe,{type:"button",onClick:()=>re(),children:"Get Detail"})]})]})]}),e.jsx(Ue,{detailAttedanceFields:S,form:a,updateAttedanceFields:C,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(He,{allowanceField:i,destinationIndex:t,form:a})]},t),e.jsx(We,{allowanceField:i,destinationIndex:t,form:a,setTotalAllowance:oe}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Oe,{fieldName:`destinations.${t}.cash_advance`,isRequired:!1,disabled:!1,onChanges:u=>B(u.target.checked)})})]}),le&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(g,{control:a.control,name:`destinations.${t}.reference_number`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{value:u.value||"",onChange:p=>u.onChange(p.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(v,{})]})}),e.jsx(g,{control:a.control,name:`destinations.${t}.total_percent`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{value:u.value||void 0,onValueChange:p=>u.onChange(p),children:[e.jsx(R,{className:"w-[50%] mb-2",children:e.jsx(E,{placeholder:"-- Select Total Percent --"})}),e.jsxs(I,{children:[e.jsx($,{value:"10",children:"10%"}),e.jsx($,{value:"25",children:"25%"}),e.jsx($,{value:"50",children:"50%"})]})]})}),e.jsx(v,{})]})}),e.jsx(g,{control:a.control,name:`destinations.${t}.total_cash_advance`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{value:u.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(v,{})]})})]})]})})]})]})}function We({allowanceField:a,destinationIndex:t,form:o,setTotalAllowance:j}){const[y,x]=N.useState(0);N.useEffect(()=>{const n=a.reduce((h,S,C)=>{const _=o.getValues(`destinations.${t}.allowances.${C}.detail`),D=m(S,_);return h+D},0);x(n),j(n)},[a,o.watch()]);const m=(n,h)=>{var S;return n.type==="total"?parseFloat(((S=h==null?void 0:h[0])==null?void 0:S.request_price)||0):h==null?void 0:h.reduce((C,_)=>C+parseFloat(_.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:a.map((n,h)=>e.jsx(ze,{allowance:n,destinationIndex:t,form:o,allowanceIndex:h}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:y})})]})]})})]})})}function ze({allowance:a,destinationIndex:t,form:o,allowanceIndex:j}){const y=W({control:o.control,name:`destinations.${t}.allowances.${j}.detail.0.request_price`}),x=W({control:o.control,name:`destinations.${t}.allowances.${j}.detail`}),m=()=>{if(a.type==="total")return parseFloat(y||0)*1;{let n=0;return x==null||x.forEach(h=>{const S=parseFloat(h.request_price||0);n+=S}),n}};return e.jsxs("tr",{children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:m()})]})]},a.id)}function Ue({form:a,destinationIndex:t,detailAttedanceFields:o,updateAttedanceFields:j}){const y=a.watch(`destinations.${t}.detail_attedances`);return N.useEffect(()=>{},[y]),N.useEffect(()=>{},[o]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:o.map((x,m)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[T(x.date).format("DD/MM/YYYY"),e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.date`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:T(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.shift_code`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:T(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.shift_start`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:T(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.shift_end`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:T(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsx("td",{children:e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.start_time`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(v,{})]})})}),e.jsx("td",{children:e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.end_time`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(v,{})]})})})]},x.index))})]})})})]})}function He({form:a,destinationIndex:t,allowanceField:o}){return e.jsx("table",{className:"w-full allowance-table",children:o.map((j,y)=>e.jsx(Je,{form:a,allowance:j,destinationIndex:t,allowanceIndex:y}))})}function Je({form:a,allowance:t,destinationIndex:o,allowanceIndex:j}){const[y,x]=N.useState(!1),m=_=>{x(D=>!D)},n=W({control:a.control,name:`destinations.${o}.allowances.${j}.detail.0.request_price`}),h=W({control:a.control,name:`destinations.${o}.allowances.${j}.detail`}),S=()=>{if(t.type==="total")return parseFloat(n||0)*1;{let _=0;return h==null||h.forEach(D=>{const i=parseFloat(D.request_price||0);_+=i}),_}},C=_=>D=>{const i=parseFloat(D.target.value)||0;t.request_value==="unlimited"?_.onChange(D):t.request_value==="up to max value"?i<=t.subtotal?_.onChange(D):alert(`Value cannot exceed the subtotal of IDR ${t.subtotal}`):t.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{control:a.control,name:`destinations.${o}.allowances.${j}.detail.0.request_price`,render:({field:_})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{value:_.value,onChange:C(_)})}),e.jsx(v,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",S()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>m(),children:e.jsxs(pe,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),y&&e.jsx(e.Fragment,{children:t.detail.map((_,D)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:T(_.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(g,{control:a.control,name:`destinations.${o}.allowances.${j}.detail.${D}.request_price`,render:({field:i})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{value:i.value,onChange:C(i)})}),e.jsx(v,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},_.id))})]})}function Gt({form:a,type:t,allowanceIndex:o,destinationIndex:j}){const{fields:y}=te({control:a.control,name:`destinations.${j}.allowances.${o}.detail`});return e.jsx(e.Fragment,{children:y.map((x,m)=>e.jsx(g,{control:a.control,name:`destinations.${j}.allowances.${m}.detail.${m}.request_price`,render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(A,{value:n.value,onChange:n.onChange})}),e.jsx(v,{})]})}))})}export{Gt as AllowanceInputForm,Je as AllowanceRowInput,Xe as BussinesTripDestination,Le as BussinessDestinationForm,Bt as BussinessTripFormV1,He as DetailAllowance,Ue as DetailAttedances,ze as ResultPerItem,We as ResultTotalItem};
