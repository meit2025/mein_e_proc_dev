import{j as e,r as F,u as ze,q as Oe}from"./app-BCO0zkLY.js";import{B as Ye}from"./button-DzavHqFO.js";import{z as d,t as We}from"./index-DYDidF-i.js";import{f as V}from"./rupiahCurrencyFormat-CP-6egij.js";import{d as Ze,F as w,a as v,b as C,c as N,f as Je,e as He}from"./form-Erevh9Yc.js";import{u as Ke,b as Xe}from"./index.esm-C1Tot7-T.js";import{T as me}from"./textarea-3Suv0PC6.js";/* empty css                  */import{S as Qe}from"./scroll-area-Csh0OSs3.js";import{a as R}from"./axiosInstance-BNr2V5Oe.js";import{S as de}from"./separator-CMO2hYnH.js";import{T as Ue,a as et,b as tt,c as st}from"./tabs-By0spZSQ.js";import{S as B,a as P,b as G,c as M,d as z}from"./select-BKMW0gkm.js";import{F as J}from"./formDropdown-DS8lXhV-.js";import{C as ue}from"./CustomDatePicker-IbXziJ_n.js";import{I as pe}from"./input-BXB_xUnG.js";import{ReimburseFormType as j}from"./listModel-Ci8ODzSM.js";import{u as O}from"./getDropdown-C48BRRBk.js";import{G as rt,a as he,b as at}from"./api-DXF7erOJ.js";import{L as nt}from"./LoadingSpin-CyMj-lf3.js";import{W as ot}from"./WorkflowComponent-FCmoP1ht.js";import{C as lt}from"./CustomStatus-Y56cC5Oc.js";import{B as it}from"./Button-CwRa6GtS.js";import"./app-DQK4SJPx.js";import"./index-lRwZTuNx.js";import"./index-Bb4qSo10.js";import"./utils-BEDhwzm_.js";import"./index-Cpgqj98A.js";import"./index-BMjHJMz5.js";import"./index-Bb7VEPDt.js";import"./index-DDgBrNxa.js";import"./index-CWGjcL8K.js";import"./index-BNNjNoit.js";import"./index-BoPHo2Hs.js";import"./index-CPZ76xD1.js";import"./index-DJt-ca-r.js";import"./Combination-Bal7uxb1.js";import"./index-DEyaQP4E.js";import"./TextField-D--mamGw.js";import"./createSvgIcon-C8ywk2y-.js";import"./DefaultPropsProvider-BsiuONW-.js";import"./useSlot-GZu7wXZh.js";import"./createSimplePaletteValueFilter-Du_QZQXB.js";import"./useControlled-Cu4eMxFy.js";import"./FormHelperText-BJQi4ZYT.js";import"./createLucideIcon-BiSoYIBl.js";function ct({isLoading:H=!1,children:K}){return e.jsx("div",{className:"",children:H?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(nt,{})})}):K})}const ns=({onSuccess:H,currencies:K,taxDefaultValue:ee,uomDefaultValue:te,categories:mt,users:dt,edit_url:fe,update_url:ge,store_url:je,type:h,currentUser:E})=>{const[xe,_e]=F.useState("form1"),{showToast:k}=ze();Oe().props;const{dataDropdown:be,getDropdown:se}=O(rt),{dataDropdown:ye,getDropdown:we}=O(),{dataDropdown:ve,getDropdown:Ce}=O(),{dataDropdown:Ne,getDropdown:re}=O("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:Se,getDropdown:ae}=O("api/master/cost-center/dropdown-list"),[L,ne]=F.useState([]),[Fe,X]=F.useState([]),[D,De]=F.useState(!1),[oe,Ie]=F.useState(!1),[Ee,Y]=F.useState(!1),[g,T]=F.useState([]),[$,qe]=F.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Re=1*1024*1024,Te=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],ke=d.object({formCount:d.string().min(1,"total form must be have value"),remark_group:d.string().optional(),cost_center:d.string().min(1,"cost center required"),requester:d.string().min(1,"requester required"),value:d.number().optional(),user_id:d.string().optional(),forms:d.array(d.object({reimburseId:d.string().optional(),for:d.string().optional(),group:d.string().optional(),reimburse_type:d.string().min(1,"reimburse type is required"),short_text:d.string().min(1,"remarks is required"),balance:d.string().min(1,"balance required"),currency:d.string().min(1,"currency required"),tax_on_sales:d.string().min(1,"tax required"),purchase_requisition_unit_of_measure:d.string().min(1,"uom required"),purchasing_group:d.string().min(1,"Purchasing Group required"),type:d.any(),item_delivery_data:d.date(),claim_date:d.date(),attachment:d.array(d.instanceof(File).refine(s=>Te.includes(s.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(s=>s.size<=Re,{message:"File size must be less than 1MB"})).min(h===j.create?1:0,"Attachment is required")}))});F.useEffect(()=>{Ce("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}}),we("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms",where:{key:"iso_code",parameter:"PCE"}}),re("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),ae("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),se("",{name:"name",id:"nip",tabel:"users"}),n.getValues("requester")!==""&&W(0)},[]);const Ae={formCount:"1",remark_group:"test",cost_center:"",requester:String(E==null?void 0:E.is_admin)==="1"?"":E==null?void 0:E.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"IDR",tax_on_sales:ee,purchase_requisition_unit_of_measure:te,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},n=Ke({resolver:We(ke),defaultValues:Ae}),{fields:Q,update:b}=Xe({control:n.control,name:"forms"});async function Le(){n.setValue("forms",[]),Y(!0);try{const s=await R.get(fe??""),t=s.data.data.group,o=s.data.data.forms;De(t.reimbursementStatus);const c=o.map(a=>({reimburseId:String(a.id),for:String(a.for),group:String(a.group),reimburse_type:a.reimburse_type.code,short_text:a.short_text,balance:h===j.edit?a.balance:"",currency:a.currency,tax_on_sales:String(a.tax_on_sales),purchase_requisition_unit_of_measure:String(a.purchase_requisition_unit_of_measure),purchasing_group:String(a.purchasing_group),type:a.type,item_delivery_data:new Date(a.item_delivery_data),claim_date:new Date(a.claim_date),attachment:[]}));n.setValue("formCount",o.length.toString()),n.setValue("remark_group",t.remark),n.setValue("cost_center",String(t.cost_center.id)),n.setValue("requester",t.requester);let m=0;for(const a of o)await W(m,{reimburse_type:a.reimburse_type.code}),await le(m,{type:a.type,reimburse_type:a.reimburse_type.code}),await U(m,{reimburse_type:a.reimburse_type.code}),m++;n.setValue("forms",c),Y(!1)}catch{Y(!1)}}F.useEffect(()=>{(h===j.edit||h===j.clone)&&(Y(!0),Le())},[h]);const $e=async s=>{s.length>0&&se("",{name:"name",id:"nip",tabel:"users"})},W=async(s,t=null)=>{const o=await R.get(he,{params:{user:n.getValues("requester"),hasValue:t!=null?t.reimburse_type:null},headers:{"Content-Type":"application/json"}});ne(c=>{const m=[...c];return m[s]=o.data.data,m})},Ve=async(s,t)=>{if(s&&s.length>0)try{const o=await R.get(he,{params:{search:s,user:n.getValues("requester")}});ne(c=>{const m=[...c];return m[t]=o.data.data,m})}catch(o){console.error("Error searching reimburse types:",o)}},le=async(s,t)=>{const o=await R.get(at,{params:{user:n.getValues("requester"),familyRelationship:t.type=="Family"?"0":"1",reimburseType:t.reimburse_type},headers:{"Content-Type":"application/json"}});X(c=>{const m=[...c];return m[s]=o.data.data,m})},Be=s=>{for(let t=0;t<Q.length;t++)W(t);if(s==null)for(let t=0;t<Q.length;t++)n.setValue(`forms.${t}.reimburse_type`,""),n.setValue(`forms.${t}.for`,"");T([]),X([])};function Pe(s){const t=[...n.getValues("forms")];for(let o=0;o<parseInt(s);o++)if(o+1>t.length){W(o);const c={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"IDR",tax_on_sales:ee,purchase_requisition_unit_of_measure:te,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};t.push(c)}n.setValue("forms",t)}const ie=s=>{_e(s)},Ge=async s=>{var o,c,m,a,r;if(g)for(let l=0;l<g.length;l++){if(s.forms.length==0||s.forms.length-1,((o=g[l])==null?void 0:o.type_limit)!=="Unlimited"&&parseInt((c=g[l])==null?void 0:c.limit)==0){k("Claim Limit for form "+(l+1)+" is Empty, Please Contact the Admin","error");return}if(parseInt(((m=g[l])==null?void 0:m.balance)??0)<parseInt(s.forms[l].balance??0)){k("Please check your balance input for forms "+(l+1)+"  is not must be above "+((a=g[l])==null?void 0:a.balance),"error");return}}const t=s.forms.reduce((l,u)=>l+parseInt(u.balance)||0,0);s.value=t,s.user_id=(s==null?void 0:s.requester)||"0";try{let l;h===j.edit?l=await R.put(ge??"",s,{headers:{"Content-Type":"multipart/form-data"}}):l=await R.post(je??"",s,{headers:{"Content-Type":"multipart/form-data"}}),k((r=l==null?void 0:l.data)==null?void 0:r.data,"success"),H()}catch{}};async function U(s,t=null){var m,a;const o=n.getValues(`forms.${s}`),c={user:n.getValues("requester"),reimbuse_type:t!=null?t.reimburse_type:o.reimburse_type};try{const r=await R.get("reimburse/data-limit-and-balance",{params:c});T(l=>{const p=n.getValues("forms").filter((y,x)=>x!==s&&y.reimburse_type===o.reimburse_type),i=p.reduce((y,x)=>y+parseInt(x.balance)||0,0),S=[...l];return S[s]={...r.data.data,balance:r.data.data.balance-i,limit:r.data.data.type_limit=="Unlimited"?r.data.data.type_limit:Math.max(0,r.data.data.limit-p.length)},S})}catch(r){k((a=(m=r==null?void 0:r.response)==null?void 0:m.data)==null?void 0:a.message,"error")}}const ce=async()=>{var s,t,o,c,m,a,r,l,u,p,i,S;try{const x=n.getValues("forms").map((f,I)=>({index:I,value:f.balance?parseInt(f.balance):0}));if(x.some(f=>f.value===0)){const f=x.findIndex(I=>I.value===0);k(`Please fill the balance for form ${f+1}`,"error");return}const _=await R.get("/check-approval",{params:{value:x==null?void 0:x[0].value,requester:n.getValues("requester"),type:"REIM"}});if(_.data.status_code===200){const f=(t=(s=_.data)==null?void 0:s.data)==null?void 0:t.approval.map(q=>(q==null?void 0:q.division_name)||null),I=(c=(o=_.data)==null?void 0:o.data)==null?void 0:c.approval.map(q=>(q==null?void 0:q.name)||null),A=[];(a=(m=_.data)==null?void 0:m.data)!=null&&a.hr&&A.push((u=(l=(r=_.data)==null?void 0:r.data)==null?void 0:l.hr)==null?void 0:u.name);const Me=(((p=_.data.data)==null?void 0:p.approval)??[]).map(q=>({status:"",name:q.name,dateApproved:""}));qe({approvalRequest:f,approvalFrom:I,acknowledgeFrom:A,approvalFromStatusRoute:Me}),Ie(!0)}}catch(y){k((S=(i=y==null?void 0:y.response)==null?void 0:i.data)==null?void 0:S.message,"error")}};return F.useEffect(()=>{n.getValues("forms").reduce((o,c)=>o+parseInt(c.balance)||0,0)>0&&oe===!0&&ce()},[n.watch("forms"),n.watch("requester")]),e.jsx(Qe,{className:"h-[600px] w-full",children:e.jsx(ct,{isLoading:Ee,children:e.jsx(Ze,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(Ge),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:D&&e.jsx(lt,{name:D==null?void 0:D.name,className:D==null?void 0:D.classname,code:D==null?void 0:D.code})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Remark"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:"remark_group",render:({field:s})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(me,{placeholder:"Insert remark",...s})}),e.jsx(N,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Cost Center"}),e.jsx("td",{children:e.jsx(J,{fieldLabel:"",options:Se,fieldName:"cost_center",disabled:h===j.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onChangeOutside:async(s,t)=>{s.length>0&&s!==(t==null?void 0:t.value)&&ae(s,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:s})}})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Employee"}),e.jsx("td",{children:e.jsx(J,{options:be,fieldName:"requester",isRequired:!0,disabled:String(E==null?void 0:E.is_admin)==="0"||h===j.edit,placeholder:"Select Employee",onSearch:$e,onChangeOutside:s=>Be(s),classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:"formCount",render:({field:s})=>{var t;return e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(B,{disabled:h===j.edit,onValueChange:o=>{s.onChange(o),Pe(o),ie(`form${parseInt(o)}`);const c=n.getValues("forms");if(c.length>parseInt(o)){const m=c.slice(0,parseInt(o));n.setValue("forms",m),T(a=>{let r=[...a];return r=r.slice(0,parseInt(o)),r})}},value:(t=s.value)==null?void 0:t.toString(),children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(G,{placeholder:"Select number of forms"})}),e.jsx(M,{children:Array.from({length:3},(o,c)=>c+1).map(o=>e.jsx(z,{value:o.toString(),children:o},o))})]})}),e.jsx(N,{})]})}})})]})]})}),e.jsx(de,{className:"my-4"}),e.jsxs(Ue,{value:xe,onValueChange:ie,className:"w-full",children:[e.jsxs(et,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:n.watch("formCount")||1}).map((s,t)=>e.jsxs(tt,{value:`form${t+1}`,children:["Form ",t+1]},t))]}),Q.map((s,t)=>{var o,c,m;return e.jsxs(st,{value:`form${t+1}`,children:[e.jsx(w,{control:n.control,name:`forms.${t}.reimburseId`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(pe,{className:"sr-only",value:s.reimburseId,onChange:a.onChange})}),e.jsx(N,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Type of Reimbursement "}),e.jsx("td",{className:"flex items-center space-x-3",children:e.jsx(J,{options:L[t],fieldName:`forms.${t}.reimburse_type`,isRequired:!0,disabled:n.getValues("requester")==""||h===j.edit,placeholder:"Select Reimburse Type",onChangeOutside:(a,r)=>{const l=n.getValues("requester");if(a!==(r==null?void 0:r.value)&&l!==""&&Ve(a,t),r!=null&&r.value){let u=L[t].filter(p=>p.value==r.value)[0];b(t,{...s,reimburse_type:r==null?void 0:r.value,type:u.is_employee===1?"Employee":"Family"}),u.is_employee===1?U(t):(T(p=>{const i=[...p];return i[t]=[],i}),n.setValue(`forms.${t}.balance`,""),le(t,{type:"Family",reimburse_type:r==null?void 0:r.value}))}else{T(p=>{const i=[...p];return i[t]=[],i}),b(t,{...s,balance:""}),n.setValue(`forms.${t}.for`,""),X(p=>{const i=[...p];return i[t]=[],i});const u=n.getValues("forms");u.forEach((p,i)=>{var S,y;if(i>t&&u[i].reimburse_type===s.reimburse_type){const x=((S=g[i])==null?void 0:S.balance)||0,Z=((y=g[i])==null?void 0:y.limit)||0;T(_=>{var I;const f=[..._];return f[i]={...f[i],balance:x+parseInt(s.balance||"0")},((I=g[i])==null?void 0:I.type_limit)!=="Unlimited"&&(f[i]={...f[i],limit:Z+1}),f}),n.setValue(`forms.${i}.balance`,"")}})}},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:`forms.${t}.for`,render:({field:a})=>{var r,l,u,p;return e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(B,{disabled:((u=(l=(r=L==null?void 0:L[t])==null?void 0:r.filter(i=>(i==null?void 0:i.value)==n.getValues(`forms.${t}.reimburse_type`)))==null?void 0:l[0])==null?void 0:u.is_employee)===1||h===j.edit,onValueChange:i=>{b(t,{...s,for:i}),U(t,{reimburse_type:n.getValues(`forms.${t}.reimburse_type`)})},defaultValue:s==null?void 0:s.for,value:s.for,children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(G,{placeholder:"-"})}),e.jsx(M,{children:(p=Fe[t])==null?void 0:p.map(i=>e.jsx(z,{value:i.value.toString(),children:i.label},i.value))})]})}),e.jsx(N,{})]})}})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(J,{fieldLabel:"",options:Ne,fieldName:`forms.${t}.purchasing_group`,disabled:h===j.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onChangeOutside:async(a,r)=>{a.length>0&&a!==(r==null?void 0:r.value)&&await re(a,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:a}),r!=null&&r.value&&b(t,{...s,purchasing_group:r==null?void 0:r.value})}})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:`forms.${t}.tax_on_sales`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(B,{disabled:!0,onValueChange:r=>{b(t,{...s,tax_on_sales:r})},defaultValue:s.tax_on_sales,children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(G,{placeholder:"-"})}),e.jsx(M,{children:(ve??[]).map((r,l)=>e.jsx(z,{value:r.value.toString(),children:r.label},r.value))})]})}),e.jsx(N,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:`forms.${t}.purchase_requisition_unit_of_measure`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(B,{disabled:!0,onValueChange:r=>{b(t,{...s,purchase_requisition_unit_of_measure:String(r)})},defaultValue:s.purchase_requisition_unit_of_measure,children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(G,{placeholder:"-"})}),e.jsx(M,{children:(ye??[]).map((r,l)=>e.jsx(z,{value:r.value.toString(),children:r.label},r.value))})]})}),e.jsx(N,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Remark"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:`forms.${t}.short_text`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(me,{placeholder:"Insert remark",onChange:r=>{b(t,{...s,short_text:r.target.value})},defaultValue:s.short_text})}),e.jsx(N,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((o=g[t])==null?void 0:o.balance)&&V((c=g[t])==null?void 0:c.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(m=g[t])==null?void 0:m.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:`forms.${t}.item_delivery_data`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(ue,{disabled:h===j.edit,initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:r=>a.onChange(r)})}),e.jsx(N,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:`forms.${t}.claim_date`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(ue,{disabled:h===j.edit,initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:r=>a.onChange(r)})}),e.jsx(N,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(w,{control:n.control,name:`forms.${t}.currency`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(B,{disabled:h===j.edit,onValueChange:r=>{b(t,{...s,currency:r})},defaultValue:s.currency,children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(G,{placeholder:"-"})}),e.jsx(M,{children:K.map(r=>e.jsxs(z,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(Je,{className:"h-6"}),e.jsx(N,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(w,{control:n.control,name:`forms.${t}.balance`,render:({field:a})=>{var r;return e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(pe,{type:"text",placeholder:"0",onChange:l=>{var x;const u=l.target.value.replace(/[^0-9]/g,""),p=V(u,!1),i=parseInt(u)||0,S=((x=g[t])==null?void 0:x.balance)||0;if(i>S){l.target.value=V(u.slice(0,-1),!1);return}b(t,{...s,balance:u}),l.target.value=p,n.getValues("forms").forEach((Z,_)=>{if(_>t&&Z.reimburse_type===s.reimburse_type){const f=S-i;T(I=>{const A=[...I];return A[_]={...A[_],balance:f},A}),b(_,{...s,balance:""})}})},defaultValue:V(s.balance,!1),value:V(s.balance,!1),disabled:typeof g[t]>"u"||((r=g[t])==null?void 0:r.length)===0||h===j.edit})}),e.jsx(N,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"File Attachment"}),e.jsxs("td",{children:[e.jsx(w,{control:n.control,name:`forms.${t}.attachment`,render:({field:a})=>e.jsxs(v,{children:[e.jsx(He,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(C,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:r=>{const l=r.target.files;if(l){const u=[...s.attachment],p=Array.from(l);u.push(...p),b(t,{...s,attachment:u})}}})}),e.jsx(N,{})]})}),e.jsx("div",{className:"mt-2",children:s.attachment&&s.attachment.length>0&&e.jsx("ul",{children:s.attachment.map((a,r)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:a.name}),e.jsx("button",{type:"button",className:"text-red-500 ml-2",onClick:()=>{const l=s.attachment.filter((u,p)=>p!==r);b(t,{...s,attachment:l})},children:"Delete"})]},r))})})]})]})]})})})]},t)})]}),e.jsx(it,{onClick:async()=>await ce(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:oe&&e.jsx(ot,{workflowApproval:{approvalRequest:$.approvalRequest,approvalFrom:$.approvalFrom,acknowledgeFrom:$.acknowledgeFrom},workflowApprovalStep:$.approvalFromStatusRoute,workflowApprovalDiagram:$.approvalFrom})}),e.jsx(de,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(Ye,{type:"submit",className:"w-32",children:"Save"})})]})})})})};export{ns as ReimburseForm};
