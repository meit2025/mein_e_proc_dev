import{b as B,r as d,u as H,j as a}from"./app-DohxDsOy.js";import{a as M}from"./axiosInstance-BPNyJIv4.js";import{L as W}from"./Loading-oJ4njX-3.js";import{W as J}from"./WorkflowComponent-BdNetqd-.js";import{F as v}from"./formDropdown-BdyzYrAj.js";import{u as N}from"./getDropdown-sgOz-_K5.js";import{a as U}from"./index.esm-tr9gTnSu.js";import{B as z}from"./Button-DEERazSD.js";import"./app-DQK4SJPx.js";import"./index-DnYNoRv9.js";import"./createSvgIcon-BZb1F-bF.js";import"./DefaultPropsProvider-BFSlNfwc.js";import"./createLucideIcon-ByZOVbJH.js";import"./TextField-BnWQhMLu.js";import"./useSlot-Kz7R4VKU.js";import"./createSimplePaletteValueFilter-DEcbmRHG.js";import"./useControlled-I0rGZ4dn.js";import"./FormHelperText-BZE2hONb.js";const{Axios:_e,AxiosError:G,CanceledError:ve,isCancel:fe,CancelToken:ge,VERSION:he,all:ke,Cancel:we,isAxiosError:Ae,spread:be,toFormData:xe,AxiosHeaders:ye,HttpStatusCode:Ce,formToJSON:Fe,getAdapter:je,mergeConfig:Ne}=B,Se=({isDisabled:K})=>{const{getValues:f,watch:c,setValue:g}=U(),[S,r]=d.useState(!1),[R,h]=d.useState(!1),[l,D]=d.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),{dataDropdown:E,getDropdown:T}=N(),{dataDropdown:P,getDropdown:I}=N(),{showToast:o}=H(),L=c("document_type"),q=c("metode_approval"),V=async()=>{var s,k,w,A,b,x,y;try{const e=f(),u=f("vendors").filter(t=>(t.winner||!1)===!0),n=u.length>0?u[0]:null;if(n==null){r(!1),o("Please Select Propose Vendor","error");return}const C=(n==null?void 0:n.units)||[],_=C.reduce((t,p)=>t+parseInt(p.total_amount),0);g("total_all_amount",_);const F=C.reduce((t,p)=>p.unit_price>t?parseInt(p.unit_price):t,0);if(g("amount_max",F),e.document_type===null||e.document_type===void 0){r(!1),o("Please input Document Type","error");return}if(e.purchasing_groups===null||e.purchasing_groups===void 0){r(!1),o("Please input purchasing group","error");return}if(c("total_all_amount")===null||c("total_all_amount")===void 0||_===0){r(!1),o("Please input Item","error");return}if(e.user_id===null||e.user_id===void 0){r(!1),o("Please input Item","error");return}if(e.document_type==="ZENT"){if(e.metode_approval===null||e.metode_approval===void 0){r(!1),o("Please select metode approval","error");return}if(e.metode_approval==="chooses_approval"&&(e.chooses_approval_id===null||e.chooses_approval_id===void 0)){r(!1),o("Please select chooses approval","error");return}}const m=await M.get("/check-approval",{params:{document_type_id:e.document_type,purchasing_group_id:e.purchasing_groups,value:e.document_type==="ZENT"?F:_,user_id:e.user_id,currency_from:e.currency_from,type:"PR",metode_approval:e.metode_approval,chooses_approval_id:e.chooses_approval_id,tracking_approval_id:e.tracking_approval_id}});if(m.data.status_code===200){const t=(k=(s=m.data)==null?void 0:s.data)==null?void 0:k.approval_route.map(i=>{var j;return((j=i.user.divisions)==null?void 0:j.name)||null}),p=(A=(w=m.data)==null?void 0:w.data)==null?void 0:A.approval_route.map(i=>i.user.name),Z=(((x=(b=m.data)==null?void 0:b.data)==null?void 0:x.approval_route)??[]).map(i=>({status:"",name:i.user.name,dateApproved:""}));D({approvalRequest:t,approvalFrom:p,acknowledgeFrom:[],approvalFromStatusRoute:Z}),h(!0)}r(!1)}catch(e){if(r(!1),h(!1),e instanceof G&&e.response){const u=((y=e.response.data)==null?void 0:y.message)||"An unexpected error occurred";o(u,"error")}else e instanceof Error?o(e.message,"error"):o("An unexpected error occurred","error")}},O=s=>{I("",{name:"master_tracking_numbers.name",id:"master_tracking_numbers.id",tabel:"approval_tracking_number_choose_routes",join:"master_tracking_numbers,master_tracking_numbers.id,=,approval_tracking_number_choose_routes.master_tracking_number_id",where:{key:"approval_tracking_number_choose_id",parameter:s}})};return d.useEffect(()=>{T("",{name:"name",id:"id",tabel:"approval_tracking_number_chooses"})},[]),a.jsx(a.Fragment,{children:a.jsxs("div",{className:"h-full min-w-full p-4 card card-grid",children:[a.jsx(W,{isLoading:S}),a.jsxs("div",{className:"card-body",children:[a.jsx("div",{className:"flex justify-start mt-4 mb-2",children:a.jsx(z,{onClick:async()=>await V(),variant:"contained",color:"primary",type:"button",children:"Check Approval"})}),L==="ZENT"&&a.jsxs(a.Fragment,{children:[a.jsx(v,{options:[{label:"Approval",value:"approval"},{label:"Chooses Approval Tracking Number",value:"chooses_approval"},{label:"Automatic Approval Tracking Number",value:"automatic_approval_by_purchasing_group"}],fieldLabel:"Metode Approval",fieldName:"metode_approval",disabled:!1,style:{width:"58.5rem"},placeholder:"Metode Approval",classNames:"mt-2"}),q==="chooses_approval"&&a.jsxs(a.Fragment,{children:[a.jsx(v,{options:E,fieldLabel:"Chooses approval",fieldName:"chooses_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2",onChangeOutside:s=>{O(s)}}),a.jsx(v,{options:P,fieldLabel:"Tracking Approval",fieldName:"tracking_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2"})]})]}),R&&a.jsx(J,{workflowApproval:{approvalRequest:l.approvalRequest,approvalFrom:l.approvalFrom,acknowledgeFrom:l.acknowledgeFrom},workflowApprovalStep:l.approvalFromStatusRoute,workflowApprovalDiagram:l.approvalFrom})]})]})})};export{Se as default};
