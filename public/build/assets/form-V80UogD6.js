import{r as b,u as Z,j as e}from"./app-BElkig-3.js";import{d as k,F as n,a as d,b as o,c as m}from"./form-DU8ss6jn.js";import{z as t,t as H}from"./index-CqRBBjc-.js";import{B as Y}from"./button-CexFy9Y_.js";import{u as z,b as K}from"./index.esm-CBvJTA0l.js";import{S as Q}from"./scroll-area-8MmLzEVd.js";import{S as x,a as j,b as g,c as _,d as c}from"./select-BuMtJL1F.js";import{I as f}from"./input-tH3gPTwJ.js";import{a as w}from"./axiosInstance-DP6zz2HS.js";import{b as W}from"./api-B_24iBZb.js";import{M as $}from"./MultiSelect-zIN1yRu4.js";import{F as h}from"./utils-DHx0K78X.js";import{F as C}from"./formDropdown-BE2Y6uaO.js";import{u as N}from"./getDropdown-BmDjg_Y1.js";import"./app-DQK4SJPx.js";import"./index-mWsvJ49m.js";import"./index-C-b9c1Jm.js";import"./index-DnmAPew9.js";import"./index-Bb4qSo10.js";import"./createLucideIcon-CPbrMqZ8.js";import"./index-Btrh1C5V.js";import"./index-wcTMMk7r.js";import"./index-BlaxWtyO.js";import"./index-BdQq_4o_.js";import"./index-GWgtFAhV.js";import"./index-3bYP5hA5.js";import"./Combination-B_g8EshB.js";import"./index-CQz8pbpm.js";import"./index-CTKA5NjY.js";import"./index-Byl2VRZi.js";import"./checkbox-BYiphlMo.js";import"./TextField-yFG0aQGe.js";import"./createSvgIcon-4vDh34ea.js";import"./DefaultPropsProvider-D171MXIb.js";import"./useSlot-BrvIZeVv.js";import"./createSimplePaletteValueFilter-L91nqBgw.js";import"./useControlled-BrH2dMSL.js";import"./FormHelperText-BOjpmjWp.js";var J=(i=>(i[i.create=0]="create",i[i.edit=1]="edit",i[i.update=2]="update",i))(J||{});function Le({onSuccess:i,type:u=h.create,detailUrl:q,id:P,listCurrency:S,listAllowanceCategory:M,listGrade:V,createUrl:F,editUrl:I}){const G=t.object({code:t.string().min(1,"Code is required"),name:t.string().min(1,"Name is required"),type:t.string().min(1,"Type is required"),material_number:t.string().min(1,"Material number required"),material_group:t.string().min(1,"Material Group required"),currency_id:t.string().min(1,"Currency is required"),allowance_category_id:t.string().min(1,"Allowance Category is required"),request_value:t.string().min(1,"Required"),grade_all_price:t.string().optional(),grade_option:t.string().min(1,"Grade must be selected"),grades:t.array(t.object({grade:t.string(),id:t.number(),plafon:t.string()}))}).superRefine((a,r)=>{a.grade_option==="grade"&&(a.grades.length===0?r.addIssue({code:t.ZodIssueCode.custom,path:["grades"],message:'At least one grade is required when grade_option is "grade".'}):a.grades.forEach((l,p)=>{(!l.grade||l.grade.trim()==="")&&r.addIssue({code:t.ZodIssueCode.custom,path:["grades",p,"grade"],message:"Grade is required."}),u==h.create&&(!l.plafon||l.plafon.trim()==="")&&r.addIssue({code:t.ZodIssueCode.custom,path:["grades",p,"plafon"],message:"Balance is required."})}))});b.useState([]),b.useState("");const A={code:"",name:"",type:"",currency_id:"",allowance_category_id:"",request_value:"unlimited",grade_option:"all",grade_all_price:"0",grades:[]},s=z({resolver:H(G),defaultValues:A}),{dataDropdown:D,getDropdown:R}=N(),{dataDropdown:E,getDropdown:y}=N();async function L(){try{const a=await w.get(q??""),r=a.data.data.allowance;y("",{name:"material_description",id:"material_number",tabel:"master_materials",attribut:r.material_group,isMapping:!0,where:{key:"material_group",parameter:r.material_group}});const l=a.data.data.grades;console.log(l),s.reset({code:r.code,name:r.name,type:r.type,material_number:r.material_number,material_group:r.material_group,currency_id:r.currency_id,allowance_category_id:r.allowance_category_id,grade_option:r.grade_option,grade_all_price:r.grade_all_price,grades:l}),s.setValue("request_value",r.request_value)}catch{}}const{fields:O}=K({control:s.control,name:"grades"}),{showToast:v}=Z(),B=async a=>{try{const r=W(a.code);let l=await w.get(r);if(u===h.create){if(l.data.msg=="already"){v("Code allowance already used","error");return}const p=await w.post(F??"",a)}else if(u===h.edit){const p=await w.put(I??"",a)}v("success","success"),i==null||i(!0)}catch(r){r.response&&v(r.response.data.message,"error")}};b.useEffect(()=>{(u===h.detail||u===h.edit)&&L(),R("",{name:"material_group_desc",id:"material_group",tabel:"material_groups",idType:"string",isMapping:!0})},[u]);const T=async a=>{y("",{name:"material_description",id:"material_number",tabel:"master_materials",attribut:a,isMapping:!0,hiddenZero:!0,where:{key:"material_group",parameter:a}})};return e.jsx(Q,{className:"h-[600px] w-full",children:e.jsx(k,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(B),children:[e.jsxs("table",{className:"text-xs mt-4 table font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(n,{control:s.control,name:"code",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(f,{type:"text",readOnly:u===h.edit,placeholder:"Insert code",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value),className:"w-11/12"})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Name"}),e.jsx("td",{children:e.jsx(n,{control:s.control,name:"name",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(f,{type:"text",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value),className:"w-11/12"})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type"}),e.jsx("td",{children:e.jsx(n,{control:s.control,name:"type",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(x,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(g,{placeholder:"Select type"})}),e.jsxs(_,{children:[e.jsx(c,{value:"daily",children:"DAILY"},"DAILY"),e.jsx(c,{value:"total",children:"Total"},"TOTAL")]})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Group"}),e.jsx("td",{children:e.jsx(C,{fieldLabel:"",options:D,fieldName:"material_group",isRequired:!0,disabled:!1,placeholder:"Select Material Group",classNames:"mt-2 w-11/12",onChangeOutside:async(a,r)=>{await T(a)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Number"}),e.jsx("td",{children:e.jsx(C,{fieldLabel:"",options:E,fieldName:"material_number",isRequired:!1,disabled:!1,placeholder:"Material number",classNames:"mt-2 w-11/12"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Currency"}),e.jsx("td",{children:e.jsx(n,{control:s.control,name:"currency_id",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(x,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(g,{placeholder:"Select Currency"})}),e.jsx(_,{children:S.map(r=>e.jsxs(c,{value:r.code,children:[r.name," ",r.code]},r.code))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Allowance Category"}),e.jsx("td",{children:e.jsx(n,{control:s.control,name:"allowance_category_id",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(x,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(g,{placeholder:"Select Allowance Category"})}),e.jsx(_,{children:M.map(r=>e.jsx(c,{value:r.id.toString(),children:r.name},r.id))})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsxs("td",{className:"gap-4",children:[e.jsx(n,{control:s.control,name:"grade_option",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(x,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(j,{className:"w-[200px] mb-3",children:e.jsx(g,{placeholder:"Select Request Value"})}),e.jsxs(_,{children:[e.jsx(c,{value:"all",children:"All"},"all"),e.jsx(c,{value:"grade",children:"grade"},"grade")]})]})}),e.jsx(m,{})]})}),s.getValues("grade_option")==="all"?e.jsx("div",{children:e.jsx(n,{control:s.control,name:"grade_all_price",render:({field:a})=>e.jsx(d,{children:e.jsx(o,{children:e.jsx(f,{...a,className:"w-11/12"})})})})}):e.jsx("div",{children:e.jsx($,{label:"grade",id:"id",options:V,value:s.getValues("grades").map(a=>a.id),isHidden:"hidden",onSelect:a=>{const r=s.getValues("grades");s.setValue("grades",a.map(l=>{const p=r.find(U=>U.id===l.id);return{id:l.id,grade:l.grade,plafon:p?p.plafon:""}}))}})}),s.getValues("grade_option")==="grade"?e.jsx("div",{className:"mt-4",children:e.jsx("table",{children:O.map((a,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Grade ",a.grade]}),e.jsx("td",{children:":"}),e.jsx("td",{children:e.jsx("div",{children:e.jsx(n,{control:s.control,name:`grades.${r}.plafon`,render:({field:l})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsx(f,{...l,className:"w-11/12"})}),e.jsx(m,{})]})})})})]},r))})}):null]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request Value"}),e.jsx("td",{children:e.jsx(n,{control:s.control,name:"request_value",render:({field:a})=>e.jsxs(d,{children:[e.jsx(o,{children:e.jsxs(x,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(g,{placeholder:"Select Request Value"})}),e.jsxs(_,{children:[e.jsx(c,{value:"unlimited",children:"Unlimited"},"unlimited"),e.jsx(c,{value:"up to max value",children:"Up to Max Value"},"up to max value"),e.jsx(c,{value:"fixed value",children:"Fixed Value"},"fixed value")]})]})}),e.jsx(m,{})]})})})]})]}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(Y,{type:"submit",children:"Save"})})]})})})}export{J as AllowanceType,Le as default};
