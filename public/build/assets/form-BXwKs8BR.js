import{r as C,u as q,j as e}from"./app-CJZqQ82i.js";import{d as J,F as o,a as i,b as n,c as m,e as F}from"./form-DukKFxJ6.js";import{z as s,t as K}from"./index-D4KcgaiK.js";import{B as Q}from"./button-Bat54kDi.js";import{u as X,b as Z}from"./index.esm-DqnfJiyN.js";import{S as ee}from"./scroll-area-DQQce1BT.js";import{S,a as I,b as M,c as V,d as p}from"./select-HDjJZTdr.js";import{I as u}from"./input-BZh8lZtj.js";import{a as f}from"./axiosInstance-BI02Hyns.js";import{F as h}from"./utils-D5HqyF9D.js";import{M as ae}from"./MultiSelect-D3HkoLyS.js";import{R as re,a as G}from"./radio-group-Dt2Q8Y-3.js";import{C as te}from"./api-BBkWHPRN.js";import{L as le}from"./Loading-Bp6zo0B7.js";import{F as _}from"./formDropdown-CQalYfic.js";import{u as R}from"./getDropdown-B43G8cI6.js";import{f as j}from"./rupiahCurrencyFormat-CP-6egij.js";import"./app-DQK4SJPx.js";import"./index-Cu0kE3YA.js";import"./index-BonP_6Lo.js";import"./index-Bb4qSo10.js";import"./index-BTPwzZHn.js";import"./index-Bvh0zi4I.js";import"./index-COWT4z8f.js";import"./index-BWDERLxW.js";import"./Combination-BMbBjtWH.js";import"./index-CKU5GWe1.js";import"./index-CBfTN1Kg.js";import"./index-D9aJ4uG5.js";import"./index-BBhl0mYa.js";import"./checkbox-Dgmqn-bn.js";import"./index-CGLhm4aY.js";import"./TextField-B0RpZte3.js";import"./createSvgIcon-DS_EE36X.js";import"./DefaultPropsProvider-p5gtanHx.js";import"./extends-CF3RwP-h.js";import"./useSlot-DiPdkj72.js";import"./createSimplePaletteValueFilter-BSvBJbeQ.js";import"./useControlled-BSjgerOj.js";import"./FormHelperText-DcA8acLs.js";function We({onSuccess:x,type:g=h.create,listGrades:E,editURL:L,updateURL:A,id:se}){const D=s.object({code:s.string(),name:s.string().min(1,"Name is required"),is_employee:s.boolean(),family_status:s.string().optional(),interval_claim_period:s.number().nullable(),limit:s.number(),material_group:s.number().refine(a=>a>0,{message:"Material Group must be chosen"}),material_number:s.number().refine(a=>a>0,{message:"Material Number must be chosen"}),grade_option:s.string().min(1,"Grade must be selected"),grade_all_price:s.string().optional(),grades:s.array(s.object({grade:s.string(),id:s.number(),plafon:s.string().min(1,"Balance required")}))}),[B,b]=C.useState(!1),{dataDropdown:T,getDropdown:k}=R(),{dataDropdown:O,getDropdown:v}=R(),y=365,P=[{label:"1 Year",value:y*1},{label:"2 Year",value:y*2}],Y={code:"",name:"",material_group:null,material_number:null,family_status:"",interval_claim_period:null,is_employee:!0,grade_option:"all",grade_all_price:"0",grades:[],limit:0},t=X({resolver:K(D),defaultValues:Y});async function z(){try{const r=(await f.get(L||"")).data.data;t.reset({code:r.code,name:r.name,limit:r.limit,is_employee:r.is_employee,family_status:r.family_status,interval_claim_period:r.interval_claim_period?parseInt(r.interval_claim_period):null,material_group:parseInt(r.material_group.id),material_number:parseInt(r.material_number),grade_option:r.grade_option,grade_all_price:r.grade_all_price,grades:r.grades}),N(r.material_group.material_group||"")}catch{}}const{fields:H}=Z({control:t.control,name:"grades"}),{showToast:w}=q(),U=async a=>{var r;b(!0);try{let l;g===h.edit?l=await f.put(A??"",a):l=await f.post(te??"",a),x&&x(!0),w((r=l==null?void 0:l.data)==null?void 0:r.message,"success")}catch(l){x&&x(!1),w(l==null?void 0:l.message,"error")}b(!1)},N=async a=>{a.length>0&&v(a,{name:"material_number",id:"id",tabel:"master_materials",where:{key:"material_group",parameter:a}})},W=async(a,r)=>{a.length>0&&v(a,{name:"material_number",id:"id",tabel:"master_materials",search:a,where:{key:"material_group",parameter:r}})};return C.useEffect(()=>{k("",{name:"material_group",id:"id",tabel:"material_groups"}),g===h.edit&&z()},[]),e.jsxs(ee,{className:"h-[600px] w-full",children:[e.jsx(le,{isLoading:B}),e.jsx(J,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(U),children:[e.jsxs("table",{className:"text-xs mt-4 table font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(o,{control:t.control,name:"code",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(u,{type:"text",placeholder:"Insert code",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value),disabled:g===h.edit})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Name"}),e.jsx("td",{children:e.jsx(o,{control:t.control,name:"name",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(u,{type:"text",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value)})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"For"}),e.jsx("td",{children:e.jsx(o,{control:t.control,name:"is_employee",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(S,{onValueChange:r=>a.onChange(r==="true"),value:a.value?"true":"false",children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-"})}),e.jsxs(V,{children:[e.jsx(p,{value:"true",children:"Employee"},"is_employee"),e.jsx(p,{value:"false",children:"Family"},"is_employee")]})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family Status"}),e.jsx("td",{children:e.jsx(o,{control:t.control,name:"family_status",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(S,{onValueChange:r=>a.onChange(r),value:a.value,disabled:t.getValues("is_employee")===!0,children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(M,{placeholder:"Select Family"})}),e.jsxs(V,{children:[e.jsx(p,{value:"husband",children:"Husband"}),e.jsx(p,{value:"wife",children:"Wife"}),e.jsx(p,{value:"child",children:"Child"})]})]})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Limit ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(o,{control:t.control,name:"limit",render:({field:a})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(u,{onChange:r=>a.onChange(parseInt(r.target.value.replace(/[^0-9]/g,""))),value:parseInt(a.value)})}),e.jsx(m,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"block",width:200,children:"Balance"}),e.jsxs("td",{children:[e.jsx(o,{control:t.control,name:"grade_option",render:({field:a})=>e.jsx(i,{children:e.jsx(n,{children:e.jsxs(re,{value:a.value,onValueChange:a.onChange,className:"flex flex space-x-1 mb-3",children:[e.jsxs(i,{className:"flex text-xs items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(G,{value:"all"})}),e.jsx(F,{className:"text-xs",children:"All"})]}),e.jsxs(i,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(G,{value:"grade"})}),e.jsx(F,{className:"text-xs",children:"Grade"})]})]})})})}),t.getValues("grade_option")==="all"?e.jsx("div",{children:e.jsx(o,{control:t.control,name:"grade_all_price",render:({field:a})=>e.jsx(i,{children:e.jsx(n,{children:e.jsx(u,{type:"text",placeholder:"0",onChange:r=>{const l=r.target.value.replace(/[^0-9]/g,""),d=j(l,!1);a.onChange(l),r.target.value=d},value:j(String(a.value),!1)})})})})}):e.jsx("div",{children:e.jsx(ae,{label:"grade",id:"id",options:E||[],value:t.getValues("grades").map(a=>a.id),onSelect:a=>{t.setValue("grades",a.map((r,l)=>{var d,c;return{id:r.id,grade:r.grade,plafon:((c=(d=t.getValues("grades"))==null?void 0:d[r])==null?void 0:c.plafon)||"0"}}))}})}),t.getValues("grade_option")==="grade"?e.jsx("div",{className:"mt-4",children:e.jsx("table",{children:H.map((a,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Balance Grade ",a.grade]}),e.jsx("td",{children:":"}),e.jsx("td",{children:e.jsx("div",{children:e.jsx(o,{control:t.control,name:`grades.${r}.plafon`,render:({field:l})=>e.jsxs(i,{children:[e.jsx(n,{children:e.jsx(u,{type:"text",placeholder:"0",onChange:d=>{const c=d.target.value.replace(/[^0-9]/g,""),$=j(c,!1);l.onChange(c),d.target.value=$},value:j(l.value,!1)})}),e.jsx(m,{})]})})})})]},a))})}):null]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Interval Claim Period"}),e.jsx("td",{children:e.jsx(_,{options:P,fieldName:"interval_claim_period",placeholder:"Select Interval",classNames:"mt-2 w-full",fieldLabel:""})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Group"}),e.jsx("td",{children:e.jsx(_,{options:T,fieldName:"material_group",isRequired:!0,disabled:!1,placeholder:"Material Group",classNames:"mt-2 w-full",onChangeOutside:async(a,r)=>{await N(r==null?void 0:r.label)},fieldLabel:""})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Number"}),e.jsx("td",{children:e.jsx(_,{fieldLabel:"",options:O,fieldName:"material_number",isRequired:!0,disabled:!1,placeholder:"Material Number",classNames:"mt-2 w-full",onChangeOutside:async a=>await W(a,String(t.getValues("material_group")))})})]})]}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(Q,{type:"submit",children:"Save"})})]})})]})}export{We as default};
