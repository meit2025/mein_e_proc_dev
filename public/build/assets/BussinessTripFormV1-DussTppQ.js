import{r as j,u as Ae,j as e,b as De}from"./app-Cryykuuk.js";/* empty css              */import{d as Te,F as v,a as y,b as N,c as A}from"./form-MOTFYxnl.js";import{u as Se,b as H,a as Ce,c as Z}from"./index.esm-C4uPTy3l.js";import{S as Fe,a as $e,b as Ee,c as Re,d as qe}from"./select-D1dFqb1S.js";import{S as ie}from"./separator-B4cTBbvy.js";import{T as ke}from"./textarea-CH9einf8.js";import{I as D}from"./input-Cy3Hanfc.js";import{T as Ve,a as Ye,b as Pe,c as Ie}from"./tabs-IEe1T-q6.js";import{z as i,t as Me}from"./index-DpeNSTHc.js";import{S as Be}from"./scroll-area-Cv_eIoE6.js";import{C as Oe,E as Le,G as Ge,b as Xe}from"./api-DtjMnnyq.js";import{BusinessTripType as z}from"./models-ChrOcFpa.js";import{a as oe}from"./axiosInstance-B2bBfAq6.js";import{h as q}from"./moment-C5S46NFB.js";import{F as Je}from"./formSwitchCustom-GIV-xbTw.js";import{B as K}from"./button-BJUuSuxH.js";import{d as ce}from"./index-CxYns1nG.js";import{W as Ue}from"./WorkflowComponent-BgCIsvYf.js";import{F as We}from"./formDropdown-8jVuOnnN.js";import{u as de}from"./getDropdown-BQsGf-3J.js";import{f as O}from"./rupiahCurrencyFormat-CP-6egij.js";import{B as ze}from"./Button-CITneTpC.js";import{C as He}from"./chevrons-up-down-CgsJI9GF.js";import"./app-DQK4SJPx.js";import"./index-CZvxyC9p.js";import"./utils-U6JX5Pki.js";import"./index-hrErPlFm.js";import"./index-BikWG909.js";import"./index-Bb4qSo10.js";import"./index-zpNrqseL.js";import"./index-Dhvlr9Gr.js";import"./index-CME9aWXe.js";import"./index-V3MioA8i.js";import"./Combination-CzeAfFxi.js";import"./index-IywIelQc.js";import"./index-Dhai8XVN.js";import"./index-NA8vqQL5.js";import"./CustomStatus-BphZEa27.js";import"./createLucideIcon-JHqb-2qI.js";import"./Switch-CdX2UutP.js";import"./createSimplePaletteValueFilter-C6c2OVnv.js";import"./DefaultPropsProvider-BntITcnX.js";import"./SwitchBase-CSUqA7e1.js";import"./FormHelperText-C-rWdEae.js";import"./useControlled-D-Z0w_AE.js";import"./createSvgIcon-B_9770j1.js";import"./TextField-DoIrE0Am.js";import"./useSlot-BuBReBQM.js";const Ze=1*1024*1024,Ke=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],as=({type:l,id:s})=>{var re;const c=i.object({request_no:i.string().nonempty("Request for required"),remark:i.string().nonempty("Remark is required"),attachment:i.array(i.instanceof(File).refine(a=>Ke.includes(a.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(a=>a.size<=Ze,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:i.number().int("Total Destinantion Required"),cash_advance:i.boolean().nullable().optional(),reference_number:i.string().nullable().optional(),total_cash_advance:i.string().nullable().optional(),destinations:i.array(i.object({destination:i.string().nonempty("Destinantion Required"),business_trip_start_date:i.date().optional(),business_trip_end_date:i.date().optional(),detail_attedances:i.array(i.object({date:i.string().optional(),shift_code:i.string().optional(),shift_start:i.string().optional(),shift_end:i.string().optional(),start_time:i.string().optional(),end_time:i.string().optional(),request_start_time:i.string().optional(),request_end_time:i.string().optional()})),allowances:i.array(i.object({name:i.string().optional(),code:i.string().optional(),default_price:i.string().optional(),type:i.string().optional(),currency:i.string().optional(),subtotal:i.number().optional(),detail:i.array(i.object({date:i.string().nullish(),request_price:i.number().optional()}))})),other:i.array(i.object({value:i.number().optional()}))}))}),n=Se({resolver:Me(c),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),S=(a,d)=>{var t;return a.type==="total"?parseFloat(((t=d==null?void 0:d[0])==null?void 0:t.request_price)||0):d==null?void 0:d.reduce((r,b)=>r+parseFloat(b.request_price||0),0)},g=()=>{const a=n.getValues("destinations");n.getValues("destinations.0.other");const d=a.reduce((r,b,$)=>{const Y=(b.allowances||[]).reduce((P,J,I)=>{const k=n.getValues(`destinations.${$}.allowances.${I}.detail`),W=S(J,k);return P+W},0);return r+Y},0);let t=0;try{t=a.reduce((r,b,$)=>{const Y=(b.other||[]).reduce((P,J,I)=>{const k=n.getValues(`destinations.${$}.other.${I}.value`);return P+(k===void 0?0:k)},0);return r+Y},0)}catch(r){console.log(r),t=0}return d+t},[x,o]=j.useState(!1),{showToast:f}=Ae(),_=async a=>{var d;try{if(l===z.create){const t=g(),r=new FormData;r.append("user_id",((d=h.request_for)==null?void 0:d.id.toString())??""),r.append("value",t.toString()),r.append("request_no",a.request_no??""),r.append("remark",a.remark??""),a.attachment.forEach((b,$)=>{b&&r.append(`attachment[${$}]`,b)}),r.append("total_destination",`${a.total_destination}`),a.destinations.forEach((b,$)=>{r.append(`destinations[${$}]`,JSON.stringify(b))}),await ce.Inertia.post(Oe,r,{headers:{"Content-Type":"multipart/form-data"}}),f("succesfully created data","success")}else{const t=new FormData;t.append("remark",a.remark??""),a.attachment.forEach((r,b)=>{r&&t.append(`attachment[${b}]`,r)}),te.forEach((r,b)=>{r&&t.append(`file_existing[${b}]`,JSON.stringify(r))}),await ce.Inertia.post(`${Le}/${s}`,t,{headers:{"Content-Type":"multipart/form-data"}}),f("succesfully updated data","success")}}catch(t){console.log(t)}},[h,m]=j.useState([]),[p,u]=j.useState([]),[w,V]=j.useState([]),[F,T]=j.useState(!1);async function R(a){n.setValue("request_no",a||"");const d=Ge(a);try{const t=await oe.get(d),r=t.data.data;console.log(r,"businessTripData"),T(r.cash_advance==1),n.setValue("remark",r.remarks||""),n.setValue("total_destination",r.total_destination||1),n.setValue("cash_advance",r.cash_advance==1),n.setValue("reference_number",r.reference_number),n.setValue("total_percent",r.total_percent),n.setValue("total_cash_advance",O(r.total_cash_advance,!1)),m(t.data.data),V(r.destinations),G(r.total_destination),Q(r.destinations)}catch(t){console.log(t)}}const[L,G]=j.useState(""),se=a=>{G(a)};function Q(a){const d=a.map(t=>({destination:t.destination||"",pajak:t.pajak||"",purchasing_group:t.purchasing_group||"",business_trip_start_date:new Date(t.business_trip_start_date),business_trip_end_date:new Date(t.business_trip_end_date),allowances:t.allowances||[],detail_attedances:t.detail_attedances||[],total_allowance:t.total_allowance||0,other:t.other||[]}));n.setValue("destinations",d)}const{fields:ee,append:C,remove:ae,update:pe}=H({control:n.control,name:"destinations"});j.useEffect(()=>{},[h,L]);const[rt,he]=j.useState(0),[me,ue]=j.useState(!1),[X,xe]=j.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),je=async()=>{var a,d,t,r,b,$,U,Y,P,J,I,k,W;try{const M=g();if(M===0){f("Please fill the balance","error");return}const B=await oe.get("/check-approval",{params:{value:M,user_id:((a=h.request_for)==null?void 0:a.id)??"",type:"TRIP_DECLARATION"}});if(B.data.status_code===200){const ve=(t=(d=B.data)==null?void 0:d.data)==null?void 0:t.approval.map(E=>(E==null?void 0:E.division_name)||null),ye=(b=(r=B.data)==null?void 0:r.data)==null?void 0:b.approval.map(E=>(E==null?void 0:E.name)||null),le=[];(U=($=B.data)==null?void 0:$.data)!=null&&U.hr&&le.push((J=(P=(Y=B.data)==null?void 0:Y.data)==null?void 0:P.hr)==null?void 0:J.name);const Ne=(((I=B.data.data)==null?void 0:I.approval)??[]).map(E=>({status:"",name:E.name,dateApproved:""}));xe({approvalRequest:ve,approvalFrom:ye,acknowledgeFrom:le,approvalFromStatusRoute:Ne}),ue(!0)}}catch(M){f((W=(k=M==null?void 0:M.response)==null?void 0:k.data)==null?void 0:W.message,"error")}},{dataDropdown:fe,getDropdown:ge}=de(),{dataDropdown:lt,getDropdown:_e}=de();j.useEffect(()=>{ge("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[n.watch("destinations")]);const[te,ne]=j.useState([]);async function we(){n.setValue("destinations",[]);const a=Xe(s),t=(await De.get(a)).data.data;await R(t.parent_id.toString()),ne(t.attachments)}j.useEffect(()=>{s&&l==z.clone&&(we(),_e("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[l]);const be=a=>{ne(d=>d.filter(t=>t.id!==a))};return e.jsx(Be,{className:"h-[600px] w-full ",children:e.jsx(Te,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(_),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:fe,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:a=>{R(a)}})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:h.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:h.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(re=h==null?void 0:h.cost_center)==null?void 0:re.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(v,{control:n.control,name:"remark",render:({field:a})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(ke,{placeholder:"Insert remark",...a,rows:4,className:"w-[300px]"})}),e.jsx(A,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(v,{control:n.control,name:"attachment",render:({field:a})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:d=>{const t=d.target.files;if(t){const r=Array.from(t);a.onChange(r)}else a.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((d,t)=>e.jsx("span",{children:d.message},t)):n.formState.errors.attachment.message})]})})})]}),te.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:te.map((a,d)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:a.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:a.file_name},d),e.jsx("button",{type:"button",onClick:()=>be(a.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(v,{control:n.control,name:"total_destination",render:({field:a})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsxs(Fe,{value:L,onValueChange:se,disabled:!0,children:[e.jsx($e,{className:"w-[200px] py-2",children:e.jsx(Ee,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Re,{children:Array.from({length:5},(d,t)=>e.jsxs(qe,{value:(t+1).toString(),children:[" ",t+1," "]},t))})]})}),e.jsx(A,{})]})})]})]})]}),e.jsx(ie,{className:"my-4"}),e.jsx(Qe,{updateDestination:pe,destinationField:ee,form:n,listAllowances:p,totalDestination:n.getValues("total_destination").toString(),setTotalAllowance:he,businessTripDetail:h,type:l,btEdit:z.edit,setIsCashAdvance:T,isCashAdvance:F,setOtherAllowance:o,otherAllowance:x}),e.jsx(ie,{className:"my-4"}),e.jsx(ze,{onClick:async()=>await je(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:me&&e.jsx(Ue,{workflowApproval:{approvalRequest:X.approvalRequest,approvalFrom:X.approvalFrom,acknowledgeFrom:X.acknowledgeFrom},workflowApprovalStep:X.approvalFromStatusRoute,workflowApprovalDiagram:X.approvalFrom})}),e.jsx(K,{type:"submit",children:"submit"})]})})})};function Qe({totalDestination:l,listAllowances:s,form:c,destinationField:n,updateDestination:S,setTotalAllowance:g,businessTripDetail:x,type:o,btEdit:f,setIsCashAdvance:_,isCashAdvance:h,setOtherAllowance:m,otherAllowance:p}){return e.jsxs(Ve,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ye,{className:"flex items-center justify-start space-x-4",children:n.map((u,w)=>e.jsxs(Pe,{value:`destination${w+1}`,children:["Destination ",w+1]}))}),n.map((u,w)=>e.jsx(et,{listAllowances:s,updateDestination:S,destination:u,form:c,index:w,setTotalAllowance:g,businessTripDetail:x,type:o,btEdit:z.edit,setIsCashAdvance:_,isCashAdvance:h,setOtherAllowance:m,otherAllowance:p}))]})}function et({form:l,index:s,destination:c,updateDestination:n,listAllowances:S,setTotalAllowance:g,businessTripDetail:x,type:o,btEdit:f,setIsCashAdvance:_,isCashAdvance:h,setOtherAllowance:m,otherAllowance:p}){const{fields:u,update:w,append:V,remove:F}=H({control:l.control,name:`destinations[${s}].detail_attedances`}),{fields:T,update:R,append:L,remove:G,replace:se}=H({control:l.control,name:`destinations[${s}].allowances`}),Q=C=>{_(C)};Ce(),Z({control:l.control,name:"total_percent"});const ee=x.total_cash_advance;return j.useEffect(()=>{},[ee]),e.jsxs(Ie,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:c.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:c==null?void 0:c.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:c==null?void 0:c.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:q(c.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:q(c.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(tt,{detailAttedanceFields:u,form:l,updateAttedanceFields:w,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(st,{allowanceField:T,destinationIndex:s,form:l,setOtherAllowance:m,otherAllowance:p})]},s),e.jsx(nt,{allowanceField:T,destinationIndex:s,form:l,setTotalAllowance:g}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Je,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:C=>Q(C.target.checked)})})]}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(v,{control:l.control,name:"reference_number",render:({field:C})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{value:C.value||"",onChange:ae=>C.onChange(ae.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(A,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(v,{control:l.control,name:"total_percent",render:({field:C})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{...C,value:C.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(A,{})]})}),e.jsx(v,{control:l.control,name:"total_cash_advance",render:({field:C})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{value:C.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(A,{})]})})]})]})]})]})]})}function tt({form:l,destinationIndex:s,detailAttedanceFields:c,updateAttedanceFields:n}){const S=l.watch(`destinations[${s}].detail_attedances`);return j.useEffect(()=>{},[S]),j.useEffect(()=>{},[c]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:S.map((g,x)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[q(g.date).format("DD/MM/YYYY"),e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.date`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:q(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsxs("td",{children:[g.shift_code,e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.shift_code`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:q(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsxs("td",{children:[g.shift_start,e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.shift_start`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:q(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsxs("td",{children:[g.shift_end,e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.shift_end`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:q(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(A,{})]})})]}),e.jsx("td",{children:e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.start_time`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})}),e.jsx("td",{children:e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.end_time`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})}),e.jsx("td",{children:e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.request_start_time`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})}),e.jsx("td",{children:e.jsx(v,{control:l.control,name:`destinations.${s}.detail_attedances.${x}.request_end_time`,render:({field:o})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(A,{})]})})})]},g.index))})]})})})]})}function st({form:l,destinationIndex:s,allowanceField:c,setOtherAllowance:n,otherAllowance:S}){const g=l.watch(`destinations[${s}].allowances`);j.useEffect(()=>{},[g]);const{fields:x,append:o,remove:f}=H({control:l.control,name:`destinations.${s}.other`}),_=Z({control:l.control,name:`destinations.${s}.other`}),h=()=>(_||[]).reduce((p,u)=>{const w=Number((u==null?void 0:u.value)||0);return p+w},0),m=()=>{o({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[g.map((p,u)=>e.jsx(at,{form:l,allowance:p,destinationIndex:s,allowanceIndex:u})),x.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(K,{type:"button",className:"text-xl",onClick:m,children:"+"})})}),x.map((p,u)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{control:l.control,name:`destinations.${s}.other[${u}].value`,render:({field:w})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{min:"0",value:w.value??"",onChange:V=>{const F=V.target.value;if(F===""){w.onChange(void 0);return}const T=Math.max(0,Number(F));w.onChange(T)}})}),e.jsx(A,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",O(h(),!1)]})})}),e.jsx("td",{children:e.jsx(K,{type:"button",className:"text-xs",onClick:()=>f(u),children:"X"})})]},u))]})}function at({form:l,allowance:s,destinationIndex:c,allowanceIndex:n}){const[S,g]=j.useState(!1);j.useState(0);const x=m=>{g(p=>!p)},o=Z({control:l.control,name:`destinations[${c}].allowances[${n}].detail[0].request_price`}),f=Z({control:l.control,name:`destinations[${c}].allowances[${n}].detail`}),_=()=>{if(s.type==="total")return parseFloat(o||0)*1;{let m=0;return f==null||f.forEach(p=>{const u=parseFloat(p.request_price||0);m+=u}),m}},h=(m,p)=>{const u=parseFloat(p),w=isNaN(u)?0:u,V=s.request_value;let F=!0;switch(V){case"unlimited":F=!0;break;case"fixed value":const T=s.subtotal;w!==T&&(alert(`Please enter the fixed value of IDR ${T}`),F=!1);break;case"up to max value":const R=s.subtotal;w>R&&(alert(`The value should not exceed IDR ${R}`),F=!1);break;default:F=!1}if(F){l.setValue(`destinations[${c}].allowances[${n}].detail[${m}].request_price`,w);const T=l.getValues(`destinations[${c}].allowances[${n}].detail`);console.log(T,"details");const R=T.reduce((L,G)=>L+(parseFloat(G.request_price)||0),0);l.setValue(`destinations[${c}].allowances[${n}].subtotal`,R)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{control:l.control,name:`destinations[${c}].allowances[${n}].detail[0].request_price`,render:({field:m})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{value:m.value,onChange:p=>h(0,p.target.value)})}),e.jsx(A,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",O(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",O(_(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>x(),children:e.jsxs(K,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),S&&e.jsx(e.Fragment,{children:s.detail.map((m,p)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:q(m.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(v,{control:l.control,name:`destinations[${c}].allowances[${n}].detail[${p}].request_price`,render:({field:u})=>e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(D,{value:u.value,onChange:w=>h(p,w.target.value)})}),e.jsx(A,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},m.id))})]})}function nt({allowanceField:l,destinationIndex:s,form:c,setTotalAllowance:n}){const[S,g]=j.useState(0),x=c.watch(`destinations[${s}].allowances`);j.useEffect(()=>{const f=x.reduce((_,h,m)=>{const p=c.getValues(`destinations.${s}.allowances.${m}.detail`);console.log(p,"okkkk");const u=o(h,p);return _+u},0);g(f)},[x,c.watch()]);const o=(f,_)=>{var h;return f.type==="total"?parseFloat(((h=_==null?void 0:_[0])==null?void 0:h.request_price)||0):_==null?void 0:_.reduce((m,p)=>m+parseFloat(p.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:x.map((f,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:f.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:O(f.subtotal)})]})]},f.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:O(S)})]})]})})]})})}export{at as AllowanceRowInput,Qe as BussinesTripDestination,et as BussinessDestinationForm,as as BussinessTripFormV1,st as DetailAllowance,tt as DetailAttedances,nt as ResultTotalItem};
