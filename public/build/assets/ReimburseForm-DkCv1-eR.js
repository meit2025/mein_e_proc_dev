import{j as e,r as D,u as rs,q as as}from"./app-C0UchQr_.js";import{B as ns}from"./button-CCmpp0yS.js";import{h as ve}from"./moment-C5S46NFB.js";import{z as u,t as os}from"./index-_lYrEpTU.js";import{f as O}from"./rupiahCurrencyFormat-CP-6egij.js";import{d as ls,F as N,a as C,b as S,c as F,f as is,e as cs}from"./form-hcpF59LQ.js";import{u as ms,b as ds}from"./index.esm-CwdCw-V2.js";import{T as Ne}from"./textarea-BUX77F0f.js";/* empty css                  */import{S as ps}from"./scroll-area-D1zombMo.js";import{a as A}from"./axiosInstance-DOTsRUNO.js";import{S as Ce}from"./separator-BiG_Wr3J.js";import{T as us,a as hs,b as fs,c as gs}from"./tabs-Dh_kreO8.js";import{S as H,a as W,b as Z,c as J,d as K}from"./select-DOWRuCyZ.js";import{F as re}from"./formDropdown-CbWquoMM.js";import{C as Se}from"./CustomDatePicker-yidD9NYv.js";import{I as Fe}from"./input-BVlm-UPJ.js";import{ReimburseFormType as x}from"./listModel-CspaQOH6.js";import{u as X}from"./getDropdown-cFkeO3FU.js";import{G as js,a as De,b as _s}from"./api-DXF7erOJ.js";import{L as xs}from"./LoadingSpin-DsgynIII.js";import{W as bs}from"./WorkflowComponent-CGnapEiE.js";import{C as ys}from"./CustomStatus-BYTQ8_Wz.js";import{F as Ie}from"./FormHelperText-DlO86QE6.js";import{B as ws}from"./Button-DlcF2rq1.js";import"./app-DQK4SJPx.js";import"./index-CXDI5ZaJ.js";import"./index-Bb4qSo10.js";import"./utils-kT9zlpd-.js";import"./createLucideIcon-fUKOfkhG.js";import"./index-Cov46mqo.js";import"./index-DQhm7OCB.js";import"./index-DHF-RoKV.js";import"./index-CrPdDVi2.js";import"./index-D_wboDug.js";import"./index-BdQq_4o_.js";import"./index-BdVLgmY_.js";import"./index-CPGejlad.js";import"./index-9ahHu47f.js";import"./index-CiggwX0z.js";import"./index-pzJWi7zz.js";import"./Combination-DWkbauYW.js";import"./index-9JetUbKx.js";import"./TextField-Bp3rLEgd.js";import"./createSvgIcon-pUx0BbfE.js";import"./DefaultPropsProvider-BVrDpAru.js";import"./useSlot-C6qBPGc4.js";import"./createSimplePaletteValueFilter-CZJjqmYG.js";import"./useControlled-KCHaxVNn.js";function vs({isLoading:ae=!1,children:ne}){return e.jsx("div",{className:"",children:ae?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(xs,{})})}):ne})}const yt=({onSuccess:ae,currencies:ne,taxDefaultValue:ue,uomDefaultValue:he,categories:Ns,users:Cs,edit_url:Ee,update_url:qe,store_url:Te,type:g,currentUser:R})=>{const[Re,ke]=D.useState("form1"),{showToast:B}=rs();as().props;const{dataDropdown:Le,getDropdown:fe}=X(js),{dataDropdown:$e,getDropdown:Ae}=X(),{dataDropdown:Be,getDropdown:Me}=X(),{dataDropdown:Ve,getDropdown:ge}=X("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:Pe,getDropdown:je}=X("api/master/cost-center/dropdown-list"),[G,_e]=D.useState([]),[Ge,oe]=D.useState([]),[I,Ye]=D.useState(!1),[xe,ze]=D.useState(!1),[Oe,Q]=D.useState(!1),[j,M]=D.useState([]),[Y,He]=D.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),We=1*1024*1024,Ze=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],Je=u.object({formCount:u.string().min(1,"total form must be have value"),remark_group:u.string().min(1,"header remark is required"),cost_center:u.string().min(1,"cost center required"),requester:u.string().min(1,"requester required"),value:u.number().optional(),user_id:u.string().optional(),forms:u.array(u.object({reimburseId:u.string().optional(),for:u.string().optional(),group:u.string().optional(),reimburse_type:u.string().min(1,"reimburse type is required"),short_text:u.string().min(1,"remarks is required"),balance:u.string(),remaining_balance_when_request:u.number(),currency:u.string().min(1,"currency required"),tax_on_sales:u.string().min(1,"tax required"),purchase_requisition_unit_of_measure:u.string().min(1,"uom required"),purchasing_group:u.string().min(1,"Purchasing Group required"),type:u.any(),item_delivery_data:u.date(),claim_date:u.date(),attachment:u.array(u.instanceof(File).refine(t=>Ze.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=We,{message:"File size must be less than 1MB"})).min(g===x.create?1:0,"Attachment is required")}))});D.useEffect(()=>{Me("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}}),Ae("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms",where:{key:"iso_code",parameter:"PCE"}}),ge("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),je("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),fe("",{name:"name",id:"nip",tabel:"users"}),a.getValues("requester")!==""&&U(0)},[]);const Ke={formCount:"1",remark_group:"",cost_center:"",requester:String(R==null?void 0:R.is_admin)==="1"?"":R==null?void 0:R.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ue,purchase_requisition_unit_of_measure:he,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},a=ms({resolver:os(Je),defaultValues:Ke}),{fields:le,update:b}=ds({control:a.control,name:"forms"});async function Xe(){a.setValue("forms",[]),Q(!0);try{const t=await A.get(Ee??""),s=t.data.data.group,n=t.data.data.forms;Ye(s.reimbursementStatus);const m=n.map(o=>({reimburseId:String(o.id),for:String(o.for),group:String(o.group),reimburse_type:o.reimburse_type.code,short_text:o.short_text,balance:g===x.edit?o.balance:"",currency:o.currency,tax_on_sales:String(o.tax_on_sales),purchase_requisition_unit_of_measure:String(o.purchase_requisition_unit_of_measure),purchasing_group:String(o.purchasing_group),type:o.type,item_delivery_data:new Date(o.item_delivery_data),claim_date:new Date(o.claim_date),attachment:[]}));a.setValue("formCount",n.length.toString()),a.setValue("remark_group",s.remark),a.setValue("cost_center",String(s.cost_center.id)),a.setValue("requester",s.requester);let d=0;for(const o of n)await U(d,{reimburse_type:o.reimburse_type.code}),await be(d,{type:o.type,reimburse_type:o.reimburse_type.code}),await ie(d,{reimburse_type:o.reimburse_type.code,for:o.reimburse_type.is_employee===1?null:o.for}),d++;a.setValue("forms",m),Q(!1)}catch{Q(!1)}}D.useEffect(()=>{(g===x.edit||g===x.clone)&&(Q(!0),Xe())},[g]);const Qe=async t=>{t.length>0&&fe("",{name:"name",id:"nip",tabel:"users"})},U=async(t,s=null)=>{const n=await A.get(De,{params:{user:a.getValues("requester"),hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});_e(m=>{const d=[...m];return d[t]=n.data.data,d})},Ue=async(t,s)=>{if(t&&t.length>0)try{const n=await A.get(De,{params:{search:t,user:a.getValues("requester")}});_e(m=>{const d=[...m];return d[s]=n.data.data,d})}catch(n){console.error("Error searching reimburse types:",n)}},be=async(t,s)=>{const n=await A.get(_s,{params:{user:a.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});oe(m=>{const d=[...m];return d[t]=n.data.data,d})},es=t=>{for(let s=0;s<le.length;s++)U(s);if(t==null)for(let s=0;s<le.length;s++)a.setValue(`forms.${s}.reimburse_type`,""),a.setValue(`forms.${s}.for`,"");M([]),oe([])};function ss(t){const s=[...a.getValues("forms")];for(let n=0;n<parseInt(t);n++)if(n+1>s.length){U(n);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ue,purchase_requisition_unit_of_measure:he,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}a.setValue("forms",s)}const ye=t=>{ke(t)},ts=async t=>{var n,m,d,o,h;if(j)for(let c=0;c<j.length;c++){if(t.forms.length==0||t.forms.length-1,((n=j[c])==null?void 0:n.type_limit)!=="Unlimited"&&parseInt((m=j[c])==null?void 0:m.limit)==0){B("Claim Limit for form "+(c+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[c].balance==""||parseInt(t.forms[c].balance)==0){B("Claim Balance for form "+(c+1)+" cannot be 0","error");return}if(parseInt(((d=j[c])==null?void 0:d.balance)??0)<parseInt(t.forms[c].balance??0)){B("Please check your balance input for forms "+(c+1)+"  is not must be above "+((o=j[c])==null?void 0:o.balance),"error");return}t.forms=t.forms.map((v,E)=>{var q;return{...v,claim_date:ve(v.claim_date).format("YYYY-MM-DD"),item_delivery_data:ve(v.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:parseInt(((q=j[E])==null?void 0:q.balance)??0)}})}const s=t.forms.reduce((c,v)=>c+parseInt(v.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let c;g===x.edit?c=await A.put(qe??"",t,{headers:{"Content-Type":"multipart/form-data"}}):c=await A.post(Te??"",t,{headers:{"Content-Type":"multipart/form-data"}}),B((h=c==null?void 0:c.data)==null?void 0:h.data,"success"),ae()}catch{}};async function ie(t,s=null){var d,o;const n=a.getValues(`forms.${t}`),m={user:a.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:n.reimburse_type,for:s!=null?s.for:n.for};try{const h=await A.get("reimburse/data-limit-and-balance",{params:m});M(c=>{const E=a.getValues("forms").filter((y,k)=>k!==t&&y.reimburse_type===n.reimburse_type),q=E.reduce((y,k)=>y+parseInt(k.balance)||0,0),$=[...c];return $[t]={...h.data.data,balance:h.data.data.balance-q,limit:h.data.data.type_limit=="Unlimited"?h.data.data.type_limit:Math.max(0,h.data.data.limit-E.length)},$})}catch(h){B((o=(d=h==null?void 0:h.response)==null?void 0:d.data)==null?void 0:o.message,"error")}}const we=async()=>{var t,s,n,m,d,o,h,c,v,E,q,$;try{const y=a.getValues("forms"),k=y.map((w,T)=>({index:T,value:w.balance?parseInt(w.balance):0}));if(k.some(w=>w.value===0)){const w=k.findIndex(T=>T.value===0);B(`Please fill the balance for form ${w+1}`,"error");return}const ee=y.reduce((w,T)=>w+(parseInt(T.balance)||0),0),L=await A.get("/check-approval",{params:{value:ee,requester:a.getValues("requester"),type:"REIM"}});if(L.data.status_code===200){const w=(s=(t=L.data)==null?void 0:t.data)==null?void 0:s.approval.map(p=>(p==null?void 0:p.division_name)||null),T=(m=(n=L.data)==null?void 0:n.data)==null?void 0:m.approval.map(p=>(p==null?void 0:p.name)||null),i=[];(o=(d=L.data)==null?void 0:d.data)!=null&&o.hr&&i.push((v=(c=(h=L.data)==null?void 0:h.data)==null?void 0:c.hr)==null?void 0:v.name);const r=(((E=L.data.data)==null?void 0:E.approval)??[]).map(p=>({status:"",name:p.name,dateApproved:""}));He({approvalRequest:w,approvalFrom:T,acknowledgeFrom:i,approvalFromStatusRoute:r}),ze(!0)}}catch(y){B(($=(q=y==null?void 0:y.response)==null?void 0:q.data)==null?void 0:$.message,"error")}};return D.useEffect(()=>{a.getValues("forms").reduce((n,m)=>n+parseInt(m.balance)||0,0)>0&&xe===!0&&we()},[a.watch("forms"),a.watch("requester")]),e.jsx(ps,{className:"h-[600px] w-full",children:e.jsx(vs,{isLoading:Oe,children:e.jsx(ls,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(ts),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:I&&e.jsx(ys,{name:I==null?void 0:I.name,className:I==null?void 0:I.classname,code:I==null?void 0:I.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:"remark_group",render:({field:t})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(Ne,{placeholder:"Insert remark",...t})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(re,{fieldLabel:"",options:Pe,fieldName:"cost_center",disabled:g===x.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onChangeOutside:async(t,s)=>{t.length>0&&t!==(s==null?void 0:s.value)&&je(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(re,{options:Le,fieldName:"requester",disabled:String(R==null?void 0:R.is_admin)==="0"||g===x.edit,placeholder:"Select Employee",onSearch:Qe,onChangeOutside:t=>es(t),classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(H,{disabled:g===x.edit,onValueChange:n=>{t.onChange(n),ss(n),ye(`form${parseInt(n)}`);const m=a.getValues("forms");if(m.length>parseInt(n)){const d=m.slice(0,parseInt(n));a.setValue("forms",d),M(o=>{let h=[...o];return h=h.slice(0,parseInt(n)),h})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(W,{className:"w-[200px]",children:e.jsx(Z,{placeholder:"Select number of forms"})}),e.jsx(J,{children:Array.from({length:3},(n,m)=>m+1).map(n=>e.jsx(K,{value:n.toString(),children:n},n))})]})}),e.jsx(F,{})]})}})})]})]})}),e.jsx(Ce,{className:"my-4"}),e.jsxs(us,{value:Re,onValueChange:ye,className:"w-full",children:[e.jsxs(hs,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((t,s)=>e.jsxs(fs,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),le.map((t,s)=>{var n,m,d,o,h,c,v,E,q,$,y,k,ce,ee,L,w,T;return e.jsxs(gs,{value:`form${s+1}`,children:[e.jsx(N,{control:a.control,name:`forms.${s}.reimburseId`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(Fe,{className:"sr-only",value:t.reimburseId,onChange:i.onChange})}),e.jsx(F,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(re,{options:G[s],fieldName:`forms.${s}.reimburse_type`,disabled:a.getValues("requester")==""||g===x.edit,placeholder:"Select Reimburse Type",onChangeOutside:(i,r)=>{const _=a.getValues("requester");if(i!==(r==null?void 0:r.value)&&_!==""&&Ue(i,s),r!=null&&r.value){let p=G[s].filter(f=>f.value==r.value)[0];b(s,{...t,reimburse_type:r==null?void 0:r.value,type:p.is_employee===1?"Employee":"Family"}),p.is_employee===1?ie(s,{reimburse_type:r==null?void 0:r.value,for:null}):(M(f=>{const l=[...f];return l[s]=[],l}),a.setValue(`forms.${s}.balance`,""),be(s,{type:"Family",reimburse_type:r==null?void 0:r.value}))}else{M(f=>{const l=[...f];return l[s]=[],l}),b(s,{...t,balance:""}),a.setValue(`forms.${s}.for`,""),oe(f=>{const l=[...f];return l[s]=[],l});const p=a.getValues("forms");p.forEach((f,l)=>{var z,me;if(l>s&&p[l].reimburse_type===t.reimburse_type){const se=((z=j[l])==null?void 0:z.balance)||0,de=((me=j[l])==null?void 0:me.limit)||0;M(P=>{var te;const V=[...P];return V[l]={...V[l],balance:se+parseInt(t.balance||"0")},((te=j[l])==null?void 0:te.type_limit)!=="Unlimited"&&(V[l]={...V[l],limit:de+1}),V}),a.setValue(`forms.${l}.balance`,"")}})}},classNames:"mt-2 w-full"}),((d=(m=(n=a.formState.errors)==null?void 0:n.forms)==null?void 0:m[s])==null?void 0:d.reimburse_type)&&e.jsx(Ie,{error:!0,children:(v=(c=(h=(o=a.formState.errors)==null?void 0:o.forms)==null?void 0:h[s])==null?void 0:c.reimburse_type)==null?void 0:v.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:`forms.${s}.for`,render:({field:i})=>{var r,_,p,f;return e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(H,{disabled:((p=(_=(r=G==null?void 0:G[s])==null?void 0:r.filter(l=>(l==null?void 0:l.value)==a.getValues(`forms.${s}.reimburse_type`)))==null?void 0:_[0])==null?void 0:p.is_employee)===1||g===x.edit,onValueChange:l=>{b(s,{...t,for:l}),ie(s,{reimburse_type:a.getValues(`forms.${s}.reimburse_type`),for:l})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(W,{className:"w-[200px]",children:e.jsx(Z,{placeholder:"-"})}),e.jsx(J,{children:(f=Ge[s])==null?void 0:f.map(l=>e.jsx(K,{value:l.value.toString(),children:l.label},l.value))})]})}),e.jsx(F,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(re,{fieldLabel:"",options:Ve,fieldName:`forms.${s}.purchasing_group`,disabled:g===x.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onChangeOutside:async(i,r)=>{i.length>0&&i!==(r==null?void 0:r.value)&&await ge(i,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:i}),r!=null&&r.value&&b(s,{...t,purchasing_group:r==null?void 0:r.value})}}),(($=(q=(E=a.formState.errors)==null?void 0:E.forms)==null?void 0:q[s])==null?void 0:$.purchasing_group)&&e.jsx(Ie,{error:!0,children:(ee=(ce=(k=(y=a.formState.errors)==null?void 0:y.forms)==null?void 0:k[s])==null?void 0:ce.purchasing_group)==null?void 0:ee.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:`forms.${s}.tax_on_sales`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(H,{disabled:!0,onValueChange:r=>{b(s,{...t,tax_on_sales:r})},defaultValue:t.tax_on_sales,children:[e.jsx(W,{className:"w-[200px]",children:e.jsx(Z,{placeholder:"-"})}),e.jsx(J,{children:(Be??[]).map((r,_)=>e.jsxs(K,{value:r.value.toString(),children:[r.description," - ",r.label]},r.value))})]})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(H,{disabled:!0,onValueChange:r=>{b(s,{...t,purchase_requisition_unit_of_measure:String(r)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(W,{className:"w-[200px]",children:e.jsx(Z,{placeholder:"-"})}),e.jsx(J,{children:($e??[]).map((r,_)=>e.jsx(K,{value:r.value.toString(),children:`${r.label} - ${r.iso_code}`},r.value))})]})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:`forms.${s}.short_text`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(Ne,{placeholder:"Insert remark",onChange:r=>{b(s,{...t,short_text:r.target.value})},defaultValue:t.short_text})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((L=j[s])==null?void 0:L.balance)&&O((w=j[s])==null?void 0:w.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(T=j[s])==null?void 0:T.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:`forms.${s}.item_delivery_data`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(Se,{disabled:g===x.edit,initialDate:i.value instanceof Date?i.value:new Date(i.value),onDateChange:r=>{i.onChange(r),b(s,{...t,item_delivery_data:r})}})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(N,{control:a.control,name:`forms.${s}.claim_date`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(Se,{disabled:g===x.edit,initialDate:i.value instanceof Date?i.value:new Date(i.value),onDateChange:r=>{i.onChange(r),b(s,{...t,claim_date:r})}})}),e.jsx(F,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(N,{control:a.control,name:`forms.${s}.currency`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(H,{disabled:g===x.edit,onValueChange:r=>{b(s,{...t,currency:r})},defaultValue:t.currency,children:[e.jsx(W,{className:"w-[200px]",children:e.jsx(Z,{placeholder:"-"})}),e.jsx(J,{children:ne.map(r=>e.jsxs(K,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(is,{className:"h-6"}),e.jsx(F,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(N,{control:a.control,name:`forms.${s}.balance`,render:({field:i})=>{var r;return e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(Fe,{type:"text",placeholder:"0",onChange:_=>{var se;const p=_.target.value.replace(/[^0-9]/g,""),f=O(p,!1),l=parseInt(p)||0,z=((se=j[s])==null?void 0:se.balance)||0;if(l>z){_.target.value=O(p.slice(0,-1),!1);return}b(s,{...t,balance:p}),_.target.value=f,a.getValues("forms").forEach((de,P)=>{if(P>s&&de.reimburse_type===t.reimburse_type){const V=z-l;M(te=>{const pe=[...te];return pe[P]={...pe[P],balance:V},pe}),b(P,{...t,balance:""})}})},defaultValue:O(t.balance,!1),value:O(t.balance,!1),disabled:typeof j[s]>"u"||((r=j[s])==null?void 0:r.length)===0||g===x.edit})}),e.jsx(F,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(N,{control:a.control,name:`forms.${s}.attachment`,render:({field:i})=>e.jsxs(C,{children:[e.jsx(cs,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(S,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:r=>{const _=r.target.files;if(_){const p=[...t.attachment],f=Array.from(_);p.push(...f),b(s,{...t,attachment:p})}}})}),e.jsx(F,{})]})}),e.jsx("div",{className:"mt-2",children:t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((i,r)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:i.name}),e.jsx("button",{type:"button",className:"text-red-500 ml-2",onClick:()=>{const _=t.attachment.filter((p,f)=>f!==r);b(s,{...t,attachment:_})},children:"Delete"})]},r))})})]})]})]})})})]},s)})]}),e.jsx(ws,{onClick:async()=>await we(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:xe&&e.jsx(bs,{workflowApproval:{approvalRequest:Y.approvalRequest,approvalFrom:Y.approvalFrom,acknowledgeFrom:Y.acknowledgeFrom},workflowApprovalStep:Y.approvalFromStatusRoute,workflowApprovalDiagram:Y.approvalFrom})}),e.jsx(Ce,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(ns,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{yt as ReimburseForm};
