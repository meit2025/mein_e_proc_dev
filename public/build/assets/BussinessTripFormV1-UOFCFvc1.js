import{j as e,r as y,u as fe,b as we}from"./app-BFbXf0za.js";import{F as ye,a as g,b as f,c as b,d as w,e as Se}from"./form-DuPubuvP.js";import{z as o,t as De}from"./index-D4dU1kGY.js";import{d as je}from"./index-C__yr5XL.js";import{B as he}from"./button-DJ2FB_HJ.js";import{T as Ce}from"./textarea-CLTLUVHS.js";import{a as Ne,C as Ae,u as Te,b as te,c as X}from"./index.esm-PyS34KgN.js";import{S as $e}from"./scroll-area-a_ztm0Ik.js";import{S as _e}from"./separator-BJoc4vwR.js";/* empty css              */import{T as Fe,a as Ye,b as Ee,c as qe}from"./tabs-D8_MXc3o.js";import{a as pe}from"./axiosInstance-DK0saYe0.js";import{C as ge}from"./CustomDatePicker-BAencvX7.js";import{W as Ie}from"./WorkflowComponent-ORJhWDWl.js";import{S as Ve}from"./Switch-BkltB0Cu.js";import{F as Pe}from"./FormHelperText-D1tQgT8a.js";import{I as Y}from"./input-BiEGP3lm.js";import{S as P,a as k,b as R,c as M,d as E}from"./select-CvRD4T1R.js";import{C as ke,E as Re,b as Me}from"./api-B9TTe-Ow.js";import{G as Be}from"./api-BEQetkWJ.js";import{h as $}from"./moment-C5S46NFB.js";import{BusinessTripType as ee}from"./models-nebbdlk2.js";import{b as Ge}from"./api-Cpn27s-b.js";import{B as Le}from"./Button-CvsOSP8M.js";import{C as Oe}from"./chevrons-up-down-DAPpoG_1.js";import"./app-HlhieNAw.js";import"./index-CYy6okM3.js";import"./utils-B-9VCCOn.js";import"./index-Dh4TgoSd.js";import"./index-VDLgRorV.js";import"./index-Bjq_6isw.js";import"./index-CalqEi3X.js";import"./index-CQeV4hNh.js";import"./index-BD-g5GYQ.js";import"./popover-CkX6UoVv.js";import"./Combination-BVLd1_-Y.js";import"./createLucideIcon-D1U7y8R8.js";import"./createSimplePaletteValueFilter-DwB9bBk7.js";import"./DefaultPropsProvider-K_Xig54L.js";import"./extends-CF3RwP-h.js";import"./SwitchBase-Bevr8nFC.js";import"./useControlled-BBIaUuou.js";import"./index-CNUnkR13.js";import"./CustomStatus-DkmhtSDe.js";const Xe=({fieldLabel:a,fieldName:t,isRequired:i=!1,disabled:j=!1,style:S,requiredMessage:x,classNames:m,defaultChecked:l=!1,note:h,onChanges:C})=>{var r;const{control:D,formState:{errors:_}}=Ne();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[a&&e.jsxs("label",{className:"form-label max-w-32",children:[a," ",e.jsxs("span",{className:"text-red-700",children:[" ",i?"*":""]})]}),e.jsx(Ae,{name:t,control:D,rules:{required:i?x??`${a} is required`:!1},render:({field:A})=>e.jsx("div",{style:S,className:m,children:e.jsx(Ve,{...A,checked:!!(A.value??l),onChange:L=>{A.onChange(L),C&&C(L)},disabled:j})})}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),_[t]&&e.jsx(Pe,{error:!0,children:String((r=_[t])==null?void 0:r.message)})]})]})};o.object({remark:o.string().min(1).max(50),reimburse_cost:o.number()});const ze=1*1024*1024,We=["image/jpeg","image/png","application/pdf"],zt=({users:a,listPurposeType:t,pajak:i,costcenter:j,purchasingGroup:S,type:x,id:m,isAdmin:l,idUser:h})=>{const C=o.object({purpose_type_id:o.string().min(1,"Purpose type required"),request_for:o.string().min(1,"Request is required"),cost_center_id:o.string().min(1,"Cost Center is required"),remark:o.string().min(1,"Remark is required"),attachment:o.array(o.instanceof(File).refine(n=>We.includes(n.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(n=>n.size<=ze,{message:"File size must be less than 1MB"})),total_destination:o.number().min(1,"Total Destinantion Required"),destinations:o.array(o.object({destination:o.string().min(1,"Destinantion is Required"),pajak_id:o.string().min(1,"Pajak is required"),purchasing_group_id:o.string().min(1,"Purchasing Group is required"),cash_advance:o.boolean().nullable().optional(),reference_number:o.string().nullable().optional(),total_percent:o.string().nullable().optional(),total_cash_advance:o.string().nullable().optional(),business_trip_start_date:o.date().optional(),business_trip_end_date:o.date().optional(),detail_attedances:o.array(o.object({date:o.date().optional(),shift_code:o.string().optional(),shift_start:o.string().optional(),shift_end:o.string().optional(),start_time:o.string().optional(),end_time:o.string().optional()})),allowances:o.array(o.object({name:o.string().optional(),code:o.string().optional(),default_price:o.number().optional(),type:o.string().optional(),subtotal:o.number().optional(),currency:o.string().optional(),detail:o.array(o.object({date:o.date().nullish(),request_price:o.any().optional()}))}))}))}),[D,_]=y.useState("1"),r=Te({resolver:De(C),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",business_trip_start_date:new Date,business_trip_end_date:new Date}]}});y.useEffect(()=>{console.log("Form Errors:",r.formState.errors)},[r.formState.errors]);async function A(){const n=Me(m);r.setValue("destinations",[]);try{const c=(await we.get(n)).data.data;console.log(c," Response Detailxxxx"),r.setValue("purpose_type_id",c.purpose_type_id.toString()),r.setValue("request_for",c.request_for.id.toString()),r.setValue("cost_center_id",c.cost_center_id.toString()),r.setValue("remark",c.remarks),r.setValue("total_destination",c.total_destination),console.log(c.destinations," data.destinations"),r.setValue("destinations",c.destinations.map(d=>({destination:d.destination,pajak_id:d.pajak_id,purchasing_group_id:d.purchasing_group_id,cash_advance:d.cash_advance==1,reference_number:d.reference_number,total_percent:d.total_percent,total_cash_advance:d.total_cash_advance,business_trip_start_date:new Date(d.business_trip_start_date),business_trip_end_date:new Date(d.business_trip_end_date),detail_attedances:d.detail_attedances.map(v=>({...v,date:new Date(v.date)})),allowances:d.allowances.map(v=>({...v,default_price:parseInt(v.default_price),subtotal:parseInt(v.subtotal),detail:v.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?new Date(T.date):null}))}))})))}catch{}}const[L,ue]=y.useState([]),[se,ae]=y.useState([]),[ne,re]=y.useState(l==="0"?h.toString():"");async function z(n){r.setValue("purpose_type_id",n||"");const s=l=="0"?h||"":ne||"",c=Be(n,s),d=Ge(n);try{const v=await pe.get(c),T=await pe.get(d);console.log(T.data.data," responseDestination"),ue(v.data.data),ae(T.data.data)}catch(v){console.log(v)}}const le=n=>{r.setValue("total_destination",parseInt(n,10)),_(n),W()},{showToast:B}=fe(),oe=async n=>{console.log(n," valuesss");try{const s=new FormData,c=de();s.append("user_id",n.request_for??""),s.append("value",c.toString()),s.append("purpose_type_id",n.purpose_type_id??""),s.append("request_for",n.request_for??""),s.append("cost_center_id",n.cost_center_id??""),s.append("remark",n.remark??""),n.attachment.forEach((d,v)=>{d&&s.append(`attachment[${v}]`,d)}),s.append("total_destination",`${n.total_destination}`),n.destinations.forEach((d,v)=>{const T={...d,business_trip_start_date:$(d.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:$(d.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:d.detail_attedances.map(q=>({...q,date:$(q.date).format("YYYY-MM-DD")})),allowances:d.allowances.map(q=>({...q,detail:q.detail.map(I=>({...I,date:(I==null?void 0:I.date)!=null?$(I.date).format("YYYY-MM-DD"):null}))}))};s.append(`destinations[${v}]`,JSON.stringify(T))}),x==ee.create?(await je.Inertia.post(ke,s,{headers:{"Content-Type":"multipart/form-data"}}),B("succesfully created data","success")):(await je.Inertia.post(`${Re}/${m}`,s,{headers:{"Content-Type":"multipart/form-data"}}),B("succesfully updated data","success"))}catch(s){console.log(s)}};function W(){const n=[],s=parseInt(D);for(let c=0;c<s;c++)n.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});r.setValue("destinations",n)}const{fields:U,append:u,remove:p,update:ie}=te({control:r.control,name:"destinations"});y.useEffect(()=>{m&&x==ee.edit&&A()},[]),y.useEffect(()=>{x==ee.create&&W()},[D,L,m,x,l,h]);const[ce,N]=y.useState(!1),[F,H]=y.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),J=(n,s)=>{var c;return n.type==="total"?parseFloat(((c=s==null?void 0:s[0])==null?void 0:c.request_price)||0):s==null?void 0:s.reduce((d,v)=>d+parseFloat(v.request_price||0),0)},de=()=>r.getValues("destinations").reduce((c,d,v)=>{const q=(d.allowances||[]).reduce((I,K,Z)=>{const Q=r.getValues(`destinations.${v}.allowances.${Z}.detail`),V=J(K,Q);return I+V},0);return c+q},0),xe=async()=>{var n,s,c,d,v,T,q,I,K,Z,Q;try{const V=de();if(V===0){B("Please fill the balance","error");return}const O=await pe.get("/check-approval",{params:{value:V,user_id:r.getValues("request_for"),type:"TRIP"}});if(O.data.status_code===200){const be=(s=(n=O.data)==null?void 0:n.data)==null?void 0:s.approval.map(G=>(G==null?void 0:G.division_name)||null),ve=(d=(c=O.data)==null?void 0:c.data)==null?void 0:d.approval.map(G=>(G==null?void 0:G.name)||null),me=[];(T=(v=O.data)==null?void 0:v.data)!=null&&T.hr&&me.push((K=(I=(q=O.data)==null?void 0:q.data)==null?void 0:I.hr)==null?void 0:K.name),H({approvalRequest:be,approvalFrom:ve,acknowledgeFrom:me}),N(!0)}}catch(V){B((Q=(Z=V==null?void 0:V.response)==null?void 0:Z.data)==null?void 0:Q.message,"error")}};return y.useEffect(()=>{de()>0&&xe()},[r.watch("destinations")]),e.jsx($e,{className:"h-[600px] w-full ",children:e.jsx(ye,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(oe),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(g,{control:r.control,name:"request_for",render:({field:n})=>(l==="0"&&!n.value&&n.onChange(h.toString()),e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{onValueChange:s=>{re(s),n.onChange(s)},value:n.value,disabled:l==="0",children:[e.jsx(k,{className:"w-[200px] py-2",children:e.jsx(R,{placeholder:"-- Select Business Purpose Type --"})}),e.jsx(M,{children:l==="1"?a.map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id)):a.filter(s=>s.id===h).map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(w,{})]}))})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:r.control,name:"purpose_type_id",render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{onValueChange:s=>z(s),value:n.value,children:[e.jsx(k,{className:"w-[200px]",children:e.jsx(R,{placeholder:"-- Select Bussiness Purpose Type --"})}),e.jsx(M,{children:t.map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:r.control,name:"cost_center_id",render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{onValueChange:s=>n.onChange(s),value:n.value,children:[e.jsx(k,{className:"w-[200px]",children:e.jsx(R,{placeholder:"-- Select Cost Center --"})}),e.jsx(M,{children:j.map(s=>e.jsx(E,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(g,{control:r.control,name:"remark",render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Ce,{placeholder:"Insert remark",...n,rows:4,className:"w-[300px]"})}),e.jsx(w,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(g,{control:r.control,name:"attachment",render:({field:n})=>e.jsxs(f,{children:[e.jsx(Se,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(b,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:s=>{const c=s.target.files;if(c){const d=Array.from(c);n.onChange(d)}else n.onChange([])}})}),r.formState.errors.attachment&&Array.isArray(r.formState.errors.attachment)?r.formState.errors.attachment.map((s,c)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:s.message},c)):null]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:r.control,name:"total_destination",render:({field:n})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{value:n.value.toString(),onValueChange:le,children:[e.jsx(k,{className:"w-[200px] py-2",children:e.jsx(R,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(M,{children:Array.from({length:5},(s,c)=>e.jsxs(E,{value:(c+1).toString(),children:[" ",c+1," "]},c))})]})}),e.jsx(w,{})]})})]})]})]}),e.jsx(_e,{className:"my-4"}),e.jsx(Ue,{updateDestination:ie,destinationField:U,listDestination:se,form:r,listAllowances:L,totalDestination:r.getValues("total_destination").toString(),pajak:i,purchasingGroup:S,typeEdit:x}),e.jsx(_e,{className:"my-4"}),e.jsx(Le,{onClick:async()=>await xe(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ce&&e.jsx(Ie,{workflowApproval:{approvalRequest:F.approvalRequest,approvalFrom:F.approvalFrom,acknowledgeFrom:F.acknowledgeFrom},workflowApprovalStep:F.approvalFrom,workflowApprovalDiagram:F.approvalFrom})}),e.jsx(he,{type:"submit",children:"submit"})]})})})};function Ue({totalDestination:a,listAllowances:t,destinationField:i,form:j,updateDestination:S,listDestination:x=[],pajak:m,purchasingGroup:l,typeEdit:h}){return y.useState(),y.useState(),y.useState(0),fe(),e.jsxs(Fe,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ye,{className:"flex items-center justify-start space-x-4",children:i.map((C,D)=>e.jsxs(Ee,{value:`destination${D+1}`,children:["Destination ",D+1]}))}),i.map((C,D)=>e.jsx(He,{listAllowances:t,updateDestination:S,destination:C,form:j,index:D,listDestination:x,pajak:m,purchasingGroup:l,typeEdit:h}))]})}function He({form:a,index:t,destination:i,updateDestination:j,listAllowances:S,listDestination:x,pajak:m,purchasingGroup:l,typeEdit:h}){const{fields:C,update:D,append:_,remove:r}=te({control:a.control,name:`destinations.${t}.detail_attedances`}),{fields:A,update:L,append:ue,remove:se,replace:ae}=te({control:a.control,name:`destinations.${t}.allowances`});function ne(){let u=$(i.business_trip_start_date).startOf("day");const p=$(i.business_trip_end_date).startOf("day");for(r(),se();u.isBefore(p)||u.isSame(p);){const N={date:u.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};_(N),u=u.add(1,"days")}function ie(N){let F=$(i.business_trip_start_date).startOf("day");const H=$(i.business_trip_end_date).startOf("day"),J=[];for(;F.isBefore(H)||F.isSame(H);)J.push({date:F.toDate(),request_price:N}),F=F.add(1,"days");return J}const ce=S.map(N=>({name:N.name,code:N.code,default_price:parseInt(N.grade_price),type:N.type,subtotal:parseInt(N.grade_price),currency:N.currency_id,request_value:N.request_value,detail:N.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(N.grade_price)}]:ie(N.grade_price)}));ae(ce)}const[re,z]=y.useState(!1),le=u=>{z(u)},B=X({control:a.control,name:`destinations.${t}.total_percent`}),[oe,W]=y.useState(0),U=oe;return y.useEffect(()=>{console.log(a.getValues("destinations")," edit destination"),h==ee.edit&&z(a.getValues(`destinations.${t}.cash_advance`));const p=parseFloat((B||"0").toString())/100*U;a.setValue(`destinations.${t}.total_cash_advance`,p.toFixed(0))},[B,U]),console.log(x,"listDestination 123"),e.jsxs(qe,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",i.destination]}),e.jsx("td",{children:e.jsx(g,{control:a.control,name:`destinations.${t}.destination`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{onValueChange:p=>{j(t,{...i,destination:p})},defaultValue:i.destination,children:[e.jsx(k,{className:"w-[200px]",children:e.jsx(R,{placeholder:"Destination"})}),e.jsx(M,{children:x.map(p=>e.jsx(E,{value:p.destination,className:"uppercase",children:p.destination}))})]})}),e.jsx(w,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:a.control,name:`destinations.${t}.pajak_id`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{onValueChange:p=>u.onChange(p),value:u.value,children:[e.jsx(k,{className:"w-[200px]",children:e.jsx(R,{placeholder:"-- Select Pajak --"})}),e.jsx(M,{children:m.map(p=>e.jsx(E,{value:p.id.toString(),children:p.mwszkz}))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:a.control,name:`destinations.${t}.purchasing_group_id`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{onValueChange:p=>u.onChange(p),value:u.value,children:[e.jsx(k,{className:"w-[200px]",children:e.jsx(R,{placeholder:"-- Select Purchasing Group --"})}),e.jsx(M,{children:l.map(p=>e.jsx(E,{value:p.id.toString(),children:p.purchasing_group}))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(g,{control:a.control,name:`destinations.${t}.business_trip_start_date`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(ge,{initialDate:i.business_trip_start_date,onDateChange:p=>{j(t,{...i,business_trip_start_date:p})}})}),e.jsx(w,{})]})}),e.jsx("span",{children:"To"}),e.jsx(g,{control:a.control,name:`destinations.${t}.business_trip_end_date`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(ge,{initialDate:i.business_trip_end_date,onDateChange:p=>{console.log("end date",p),j(t,{...i,business_trip_end_date:p})}})}),e.jsx(w,{})]})}),e.jsx(he,{type:"button",onClick:()=>ne(),children:"Get Detail"})]})]})]}),e.jsx(Ze,{detailAttedanceFields:C,form:a,updateAttedanceFields:D,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(Qe,{allowanceField:A,destinationIndex:t,form:a})]},t),e.jsx(Je,{allowanceField:A,destinationIndex:t,form:a,setTotalAllowance:W}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Xe,{fieldName:`destinations.${t}.cash_advance`,isRequired:!1,disabled:!1,onChanges:u=>le(u.target.checked)})})]}),re&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(g,{control:a.control,name:`destinations.${t}.reference_number`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{value:u.value||"",onChange:p=>u.onChange(p.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(w,{})]})}),e.jsx(g,{control:a.control,name:`destinations.${t}.total_percent`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(P,{value:u.value||void 0,onValueChange:p=>u.onChange(p),children:[e.jsx(k,{className:"w-[50%] mb-2",children:e.jsx(R,{placeholder:"-- Select Total Percent --"})}),e.jsxs(M,{children:[e.jsx(E,{value:"10",children:"10%"}),e.jsx(E,{value:"25",children:"25%"}),e.jsx(E,{value:"50",children:"50%"})]})]})}),e.jsx(w,{})]})}),e.jsx(g,{control:a.control,name:`destinations.${t}.total_cash_advance`,render:({field:u})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{value:u.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(w,{})]})})]})]})})]})]})}function Je({allowanceField:a,destinationIndex:t,form:i,setTotalAllowance:j}){const[S,x]=y.useState(0);y.useEffect(()=>{const l=a.reduce((h,C,D)=>{const _=i.getValues(`destinations.${t}.allowances.${D}.detail`),r=m(C,_);return h+r},0);x(l),j(l)},[a,i.watch()]);const m=(l,h)=>{var C;return l.type==="total"?parseFloat(((C=h==null?void 0:h[0])==null?void 0:C.request_price)||0):h==null?void 0:h.reduce((D,_)=>D+parseFloat(_.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:a.map((l,h)=>e.jsx(Ke,{allowance:l,destinationIndex:t,form:i,allowanceIndex:h}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:S})})]})]})})]})})}function Ke({allowance:a,destinationIndex:t,form:i,allowanceIndex:j}){const S=X({control:i.control,name:`destinations.${t}.allowances.${j}.detail.0.request_price`}),x=X({control:i.control,name:`destinations.${t}.allowances.${j}.detail`}),m=()=>{if(a.type==="total")return parseFloat(S||0)*1;{let l=0;return x==null||x.forEach(h=>{const C=parseFloat(h.request_price||0);l+=C}),l}};return e.jsxs("tr",{children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:m()})]})]},a.id)}function Ze({form:a,destinationIndex:t,detailAttedanceFields:i,updateAttedanceFields:j}){const S=a.watch(`destinations.${t}.detail_attedances`);return y.useEffect(()=>{},[S]),y.useEffect(()=>{},[i]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:i.map((x,m)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[$(x.date).format("DD/MM/YYYY"),e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.date`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.shift_code`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.shift_start`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.shift_end`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{defaultValue:$(l.value).format("YYYY-MM-DD"),onChange:l.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsx("td",{children:e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.start_time`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{defaultValue:l.value,onChange:l.onChange})}),e.jsx(w,{})]})})}),e.jsx("td",{children:e.jsx(g,{control:a.control,name:`destinations.${t}.detail_attedances.${m}.end_time`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{defaultValue:l.value,onChange:l.onChange})}),e.jsx(w,{})]})})})]},x.index))})]})})})]})}function Qe({form:a,destinationIndex:t,allowanceField:i}){return e.jsx("table",{className:"w-full allowance-table",children:i.map((j,S)=>e.jsx(et,{form:a,allowance:j,destinationIndex:t,allowanceIndex:S}))})}function et({form:a,allowance:t,destinationIndex:i,allowanceIndex:j}){const[S,x]=y.useState(!1),m=_=>{x(r=>!r)},l=X({control:a.control,name:`destinations.${i}.allowances.${j}.detail.0.request_price`}),h=X({control:a.control,name:`destinations.${i}.allowances.${j}.detail`}),C=()=>{if(t.type==="total")return parseFloat(l||0)*1;{let _=0;return h==null||h.forEach(r=>{const A=parseFloat(r.request_price||0);_+=A}),_}},D=_=>r=>{const A=parseFloat(r.target.value)||0;t.request_value==="unlimited"?_.onChange(r):t.request_value==="up to max value"?A<=t.subtotal?_.onChange(r):alert(`Value cannot exceed the subtotal of IDR ${t.subtotal}`):t.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{control:a.control,name:`destinations.${i}.allowances.${j}.detail.0.request_price`,render:({field:_})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{value:_.value,onChange:D(_)})}),e.jsx(w,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",C()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>m(),children:e.jsxs(he,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),S&&e.jsx(e.Fragment,{children:t.detail.map((_,r)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:$(_.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(g,{control:a.control,name:`destinations.${i}.allowances.${j}.detail.${r}.request_price`,render:({field:A})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{value:A.value,onChange:D(A)})}),e.jsx(w,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},_.id))})]})}function Wt({form:a,type:t,allowanceIndex:i,destinationIndex:j}){const{fields:S}=te({control:a.control,name:`destinations.${j}.allowances.${i}.detail`});return e.jsx(e.Fragment,{children:S.map((x,m)=>e.jsx(g,{control:a.control,name:`destinations.${j}.allowances.${m}.detail.${m}.request_price`,render:({field:l})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Y,{value:l.value,onChange:l.onChange})}),e.jsx(w,{})]})}))})}export{Wt as AllowanceInputForm,et as AllowanceRowInput,Ue as BussinesTripDestination,He as BussinessDestinationForm,zt as BussinessTripFormV1,Qe as DetailAllowance,Ze as DetailAttedances,Ke as ResultPerItem,Je as ResultTotalItem};
