import{j as e,r as x,u as Se,q as Ce}from"./app-BFbXf0za.js";import{B as De}from"./button-DJ2FB_HJ.js";import{z as l,t as Fe}from"./index-D4dU1kGY.js";import{F as Ne,a as i,b as d,c as m,d as h,f as qe}from"./form-DuPubuvP.js";import{u as Re,b as Te}from"./index.esm-PyS34KgN.js";import{T as J}from"./textarea-CLTLUVHS.js";/* empty css                  */import{S as ke}from"./scroll-area-a_ztm0Ik.js";import{a as S}from"./axiosInstance-DK0saYe0.js";import{S as K}from"./separator-BJoc4vwR.js";import{T as Ie,a as Ee,b as Ae,c as $e}from"./tabs-D8_MXc3o.js";import{S as f,a as _,b as y,c as b,d as g}from"./select-CvRD4T1R.js";import{C as I}from"./CustomDatePicker-BAencvX7.js";import{I as Q}from"./input-BiEGP3lm.js";import{F as Pe}from"./utils-B-9VCCOn.js";import{u as Ve}from"./getDropdown-vIdmSzoo.js";import{A as X}from"./AsyncDropdownComponent-CQDG1Jnz.js";import{G as Z,a as Be}from"./api-cOVJSxmC.js";import{L as Me}from"./LoadingSpin-Dw2oVQyU.js";import{W as Ge}from"./WorkflowComponent-ORJhWDWl.js";import{B as Le}from"./Button-CvsOSP8M.js";import"./app-HlhieNAw.js";import"./index-CYy6okM3.js";import"./index-Dh4TgoSd.js";import"./index-C__yr5XL.js";import"./index-VDLgRorV.js";import"./index-Bjq_6isw.js";import"./index-CalqEi3X.js";import"./index-CQeV4hNh.js";import"./index-BD-g5GYQ.js";import"./Combination-BVLd1_-Y.js";import"./index-CNUnkR13.js";import"./popover-CkX6UoVv.js";import"./createLucideIcon-D1U7y8R8.js";import"./extends-CF3RwP-h.js";import"./chevrons-up-down-DAPpoG_1.js";import"./DefaultPropsProvider-K_Xig54L.js";import"./createSimplePaletteValueFilter-DwB9bBk7.js";function ze({isLoading:q=!1,children:R}){return e.jsx("div",{className:"",children:q?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(Me,{})})}):R})}const Es=({onSuccess:q,purchasing_groups:R,currencies:U,categories:ee,periods:We,users:se,taxes:re,cost_center:te,edit_url:ae,update_url:Oe,store_url:ne,latestPeriod:He,type:E,currentUser:c})=>{const[oe,le]=x.useState("form1"),{showToast:w}=Se();Ce().props,x.useState(1),x.useState([]),x.useState([[]]);const[Ye,ie]=x.useState(),[Je,ce]=x.useState([]);x.useState([[]]);const{dataDropdown:de,getDropdown:me}=Ve(),[he,A]=x.useState([]);x.useState("");const[$,pe]=x.useState(!1),[xe,F]=x.useState(!1),[p,P]=x.useState(null),[C,ue]=x.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),je=l.object({formCount:l.string().min(1,"total form must be have value"),remark_group:l.string().optional(),cost_center:l.string().min(1,"cost center required"),requester:l.string().min(1,"requester required"),value:l.number().optional(),user_id:l.string().optional(),forms:l.array(l.object({id:l.string().optional(),for:l.string().optional(),group:l.string().optional(),reimburse_type:l.string().min(1,"reimburse type is required"),short_text:l.string().min(1,"remarks is required"),balance:l.string().min(1,"balance required"),currency:l.string().min(1,"currency required"),tax_on_sales:l.string().min(1,"tax required"),uom:l.string().min(1,"uom required"),purchasing_group:l.string().min(1,"Purchasing Group required"),period:l.string().min(1,"period required"),type:l.any(),item_delivery_data:l.date(),start_date:l.date(),end_date:l.date(),url:l.string().optional()}))}),n=Re({resolver:Fe(je),defaultValues:{formCount:"1",remark_group:"test",cost_center:"",requester:String(c==null?void 0:c.is_admin)==="1"?"":c==null?void 0:c.nip,forms:[{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"IDR",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date,url:""}]}}),{fields:V,update:j}=Te({control:n.control,name:"forms"});async function ge(){n.setValue("forms",[]),F(!0);try{const t=await S.get(ae??""),r=t.data.data.group,a=t.data.data.forms,s=a.map(o=>({id:String(o.id),for:o.form,group:String(o.group),reimburse_type:o.reimburse_type,short_text:o.short_text,balance:o.balance,currency:o.currency,tax_on_sales:String(o.tax_on_sales),uom:String(o.uom),purchasing_group:String(o.purchasing_group),period:o.period,type:o.type,item_delivery_data:new Date(o.item_delivery_data),start_date:new Date(o.start_date),end_date:new Date(o.end_date),url:Z(o.type)}));n.setValue("formCount",a.length.toString()),n.setValue("remark_group",r.remark_group),n.setValue("cost_center",String(r.cost_center)),n.setValue("requester",r.requester),n.setValue("forms",s),F(!1)}catch(t){console.log(t),F(!1)}}x.useEffect(()=>{E===Pe.edit&&(F(!0),ge())},[E]),x.useEffect(()=>{me("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms"})},[]);function fe(t){const r=[...n.getValues("forms")];for(let a=0;a<parseInt(t);a++)if(a+1>r.length){const s={id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",currency:"",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date,url:""};r.push(s)}n.setValue("forms",r)}const _e=async t=>{try{const a=(await S.get(`/family/show/${t}`)).data;ce(a),ie(t),n.setValue("requester",t)}catch(r){const s=r.response.data;w(s.message,"error")}},ye=t=>{le(t)};async function be(t,r){j(t,{...V[t],type:r,url:Z(r),reimburse_type:"",period:""}),P(null),A([])}async function we(t,r){try{const a=await S.get(Be,{params:{type:r,user:n.getValues("requester")}});A(a.data.data),B(t),console.log(a)}catch{}}const ve=async t=>{if(p){if(parseInt(p==null?void 0:p.limit)<t.forms.length){w("Limit has been reached","error");return}const a=t.forms.reduce((s,o)=>s+parseInt(o.balance),0);if(parseInt((p==null?void 0:p.balance)??0)<a){w("Please check your balance input in forms is not must be above "+(p==null?void 0:p.balance),"error");return}}const r=t.forms.reduce((a,s)=>a+parseInt(s.balance)||0,0);t.value=r,t.user_id=(t==null?void 0:t.requester)||"0";try{const a=await S.post(ne??"",t);console.log(t),w("succesfully created data","success"),q()}catch(a){console.log(a)}};async function B(t){var s,o;const r=n.getValues(`forms.${t}`);console.log(r);const a={user:c==null?void 0:c.nip,periode:r.period,reimbuse_type_id:r.reimburse_type};try{const u=await S.get("reimburse/data-limit-and-balance",{params:a});P(u.data.data)}catch(u){console.log(u),w((o=(s=u==null?void 0:u.response)==null?void 0:s.data)==null?void 0:o.message,"error")}}const M=async()=>{var t,r,a,s,o,u,G,L,z,W,O;try{const H=n.getValues("forms").reduce((T,k)=>T+parseInt(k.balance)||0,0);if(H===0){w("Please fill the balance","error");return}const D=await S.get("/check-approval",{params:{value:H,user_id:n.getValues("requester"),type:"REIM"}});if(D.data.status_code===200){const T=(r=(t=D.data)==null?void 0:t.data)==null?void 0:r.approval.map(v=>(v==null?void 0:v.division_name)||null),k=(s=(a=D.data)==null?void 0:a.data)==null?void 0:s.approval.map(v=>(v==null?void 0:v.name)||null),Y=[];(u=(o=D.data)==null?void 0:o.data)!=null&&u.hr&&Y.push((z=(L=(G=D.data)==null?void 0:G.data)==null?void 0:L.hr)==null?void 0:z.name),ue({approvalRequest:T,approvalFrom:k,acknowledgeFrom:Y}),pe(!0)}}catch(N){w((O=(W=N==null?void 0:N.response)==null?void 0:W.data)==null?void 0:O.message,"error")}};return x.useEffect(()=>{n.getValues("forms").reduce((a,s)=>a+parseInt(s.balance)||0,0)>0&&$===!0&&M()},[n.watch("forms"),n.watch("requester")]),e.jsx(ke,{className:"h-[600px] w-full",children:e.jsx(ze,{isLoading:xe,children:e.jsx(Ne,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(ve),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Request No."}),e.jsx("td",{children:(n==null?void 0:n.code)??"-"})]}),e.jsx("tr",{children:e.jsx("td",{width:200,children:"Request Status"})}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"remark_group",render:({field:t})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(J,{placeholder:"Insert remark",...t})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"cost_center",render:({field:t})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"-"})}),e.jsx(b,{children:te.map(r=>e.jsx(g,{value:r.id.toString(),children:r.cost_center},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"requester",render:({field:t})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:r=>_e(r),value:t.value,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"Requester"})}),e.jsx(b,{children:(c==null?void 0:c.is_admin)===1?e.jsx(e.Fragment,{children:se.map(r=>e.jsxs(g,{value:r.nip,children:[r.name," [",r.nip,"]"]},r.nip))}):e.jsx(e.Fragment,{children:e.jsxs(g,{value:c.nip,children:[c.name," [",c.nip,"]"]},c.nip)})})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:"formCount",render:({field:t})=>{var r;return e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:a=>{t.onChange(a),fe(a)},value:(r=t.value)==null?void 0:r.toString(),children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"Select number of forms"})}),e.jsx(b,{children:Array.from({length:20},(a,s)=>s+1).map(a=>e.jsx(g,{value:a.toString(),children:a},a))})]})}),e.jsx(h,{})]})}})})]})]})}),e.jsx(K,{className:"my-4"}),e.jsxs(Ie,{value:oe,onValueChange:ye,className:"w-full",children:[e.jsxs(Ee,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:n.watch("formCount")||1}).map((t,r)=>e.jsxs(Ae,{value:`form${r+1}`,children:["Form ",r+1]},r))]}),V.map((t,r)=>e.jsxs($e,{value:`form${r+1}`,children:[e.jsx(i,{control:n.control,name:`forms.${r}.id`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(Q,{className:"sr-only",value:a.value,onChange:a.onChange})}),e.jsx(h,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement "}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(i,{control:n.control,name:`forms.${r}.type`,render:({field:a})=>e.jsxs(f,{onValueChange:s=>be(r,s),defaultValue:t.type,children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Select type"})}),e.jsx(b,{children:ee.map(s=>e.jsx(g,{value:s,children:s},s))})]})}),e.jsx(i,{control:n.control,name:`forms.${r}.reimburse_type`,render:({field:a})=>e.jsx(X,{disabled:t.type==="",onSelectChange:s=>{j(r,{...t,reimburse_type:s}),we(r,s)},value:t.reimburse_type,placeholder:"Select Reimbuse Type",filter:["name"],id:"code",label:"name",defaultLabel:t.reimburse_type,url:t.url})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.purchasing_group`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:s=>{j(r,{...t,purchasing_group:String(s)})},defaultValue:t.purchasing_group,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"-"})}),e.jsx(b,{children:R.map(s=>e.jsxs(g,{value:s.id.toString(),children:[s.purchasing_group_desc," -"," ",s.purchasing_group]},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.period`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{disabled:t.reimburse_type==="",onValueChange:s=>{j(r,{...t,period:s}),B(r)},defaultValue:t.period,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"-"})}),e.jsx(b,{children:he.map(s=>e.jsxs(g,{value:s.code,children:[s.start," - ",s.end," (",s.code,")"]},s.code))})]})}),e.jsx(h,{})]})})})]}),t.type==="Family"?e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Family ",t.for]}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.for`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(X,{disabled:t.type==="",onSelectChange:s=>{j(r,{...t,for:String(s)})},value:t.for,placeholder:"Select Family",filter:["name"],id:"id",label:"name",url:"reimburse/get-data-family/"+c.id})}),e.jsx(h,{})]})})})]}):null,e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Tax"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.tax_on_sales`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:s=>{j(r,{...t,tax_on_sales:s})},defaultValue:t.tax_on_sales,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"-"})}),e.jsx(b,{children:re.map(s=>e.jsx(g,{value:s.id.toString(),children:s.mwszkz},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Uom"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.uom`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:s=>{j(r,{...t,uom:String(s)})},defaultValue:t.uom,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"-"})}),e.jsx(b,{children:(de??[]).map((s,o)=>e.jsx(g,{value:s.value.toString(),children:s.label},s.value))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.short_text`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(J,{placeholder:"Insert remark",onChange:s=>{j(r,{...t,short_text:s.target.value})},defaultValue:t.short_text})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Sisa Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:p==null?void 0:p.balance})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Sisa Limit"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:p==null?void 0:p.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.item_delivery_data`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(I,{initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(i,{control:n.control,name:`forms.${r}.start_date`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(I,{initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(h,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(i,{control:n.control,name:`forms.${r}.end_date`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(I,{initialDate:a.value instanceof Date?a.value:new Date(a.value),onDateChange:s=>a.onChange(s)})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(i,{control:n.control,name:`forms.${r}.currency`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsxs(f,{onValueChange:s=>{j(r,{...t,currency:s})},defaultValue:t.currency,children:[e.jsx(_,{className:"w-[200px]",children:e.jsx(y,{placeholder:"-"})}),e.jsx(b,{children:U.map(s=>e.jsxs(g,{value:s.code,children:[s.name," (",s.code,")"]},s.code))})]})}),e.jsx(qe,{className:"h-6"}),e.jsx(h,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(i,{control:n.control,name:`forms.${r}.balance`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(Q,{type:"number",placeholder:"0.0",onChange:s=>{j(r,{...t,balance:s.target.value})},defaultValue:t.balance})}),e.jsx(h,{})]})})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(i,{control:n.control,name:`forms.${r}.attachment`,render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:s=>{const o=s.target.files;if(o){const u=Array.from(o);a.onChange(u)}}})}),e.jsx(h,{})]})})})]})]})})})]},r))]}),e.jsx(Le,{onClick:async()=>await M(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:$&&e.jsx(Ge,{workflowApproval:{approvalRequest:C.approvalRequest,approvalFrom:C.approvalFrom,acknowledgeFrom:C.acknowledgeFrom},workflowApprovalStep:C.approvalFrom,workflowApprovalDiagram:C.approvalFrom})}),e.jsx(K,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(De,{type:"submit",className:"w-32",children:"Save"})})]})})})})};export{Es as ReimburseForm};
