import{j as e,r as C,u as ct,X as mt}from"./app-yk4TolFW.js";import{B as dt}from"./button-DJjPKxGZ.js";import{h as O}from"./moment-C5S46NFB.js";import{o as Te,a as xe,s as v,n as qe,d as Re,c as Ee,i as ut,t as pt}from"./types-Biatkeea.js";import{f as J}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ht,F,a as T,b as q,c as R,f as ft,e as gt}from"./form-D-fKjRfm.js";import{u as bt,b as _t}from"./index.esm-iIlQgfnc.js";import{T as ke}from"./textarea-Bbj0CUTb.js";/* empty css                  */import{S as jt}from"./scroll-area-KdOY2Hsh.js";import{a as V}from"./axiosInstance--Gjms_jg.js";import{S as Le}from"./separator-Cgz1T_Hf.js";import{T as xt,a as yt,b as wt,c as vt}from"./tabs-BNYpNeCx.js";import{S as X,a as K,b as Q,c as U,d as ee}from"./select-CwsyWRc2.js";import{F as de}from"./formDropdown-BOqAmQz6.js";import{C as Me}from"./CustomDatePicker-C75gpvAk.js";import{I as Ae}from"./input-Cie91djI.js";import{ReimburseFormType as x}from"./listModel-CrfCCmu-.js";import{u as te}from"./getDropdown-CE8UHC4b.js";import{G as Nt,a as Ie,b as Dt}from"./api-BeRu2Z8X.js";import{L as St}from"./LoadingSpin-BcZVB9gb.js";import{W as Ct}from"./WorkflowComponent-hO0nRyA8.js";import{C as Ft}from"./CustomStatus-NOOQPQ6m.js";import{F as Ye}from"./FormHelperText-TvmyG_0O.js";import{B as Tt}from"./Button-S83pXdlN.js";import"./app-DGQxOE2s.js";import"./index-CHC0_e2X.js";import"./index-6aUx9OoO.js";import"./utils-BBy2YAOx.js";import"./createLucideIcon-CudEwgrI.js";import"./index-Cw6lW0RD.js";import"./index-1R_6axEp.js";import"./index-gpc5fona.js";import"./index-B3qo8S3g.js";import"./index-Bw9n5GT3.js";import"./index-BdQq_4o_.js";import"./index-D11KuBP2.js";import"./index-C7yOUI1q.js";import"./index-DOOS4joP.js";import"./index-B5fg775Z.js";import"./index-DGqIR1J6.js";import"./index-Bxm6nvAI.js";import"./index-BezNGrO9.js";import"./TextField-ZLT7Tc_Y.js";import"./createSvgIcon-7FhrEpnN.js";import"./DefaultPropsProvider-CzXAOlY7.js";import"./useSlot-BMTPFaYf.js";import"./createSimplePaletteValueFilter-BGDZDoOH.js";import"./CircularProgress-UnFFGQ1I.js";import"./mergeSlotProps-VwfCB10q.js";function qt({isLoading:ue=!1,children:pe}){return e.jsx("div",{className:"",children:ue?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(St,{})})}):pe})}const Fs=({onSuccess:ue,currencies:pe,taxDefaultValue:ye,uomDefaultValue:we,edit_url:$e,update_url:Ve,store_url:Be,type:b,currentUser:A})=>{const[ve,Ne]=C.useState("form1"),{showToast:L}=ct(),{errors:Rt}=mt().props,{dataDropdown:se,getDropdown:ae}=te(Nt);te();const{dataDropdown:Pe,getDropdown:Ge}=te(),{dataDropdown:re,getDropdown:ne}=te("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:oe,getDropdown:le}=te("api/master/cost-center/dropdown-list"),[Y,he]=C.useState([]),[Oe,fe]=C.useState([]),[M,ze]=C.useState(!1),[De,He]=C.useState(!1),[We,ie]=C.useState(!1),[y,B]=C.useState([]),ge=C.useRef([]),[Ze,z]=C.useState([]),[H,Je]=C.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Xe=1*1024*1024,Ke=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],Qe=Te({formCount:v().min(1,"total form must be have value"),remark_group:v().min(1,"header remark is required"),cost_center:v().min(1,"cost center required"),requester:v().min(1,"requester required"),value:qe().optional(),user_id:v().optional(),forms:xe(Te({reimburseId:v().optional(),for:v().optional(),group:v().optional(),reimburse_type:v().min(1,"reimburse type is required"),short_text:v().min(1,"remarks is required"),balance:v(),remaining_balance_when_request:qe(),currency:v().min(1,"currency required"),tax_on_sales:v().min(1,"tax required"),purchase_requisition_unit_of_measure:v().min(1,"uom required"),purchasing_group:v().min(1,"Purchasing Group required"),type:Ee(),item_delivery_data:Re(),claim_date:Re(),attachment:xe(ut(File).refine(t=>Ke.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=Xe,{message:"File size must be less than 1MB"})).min(b===x.create?1:0,"Attachment is required"),savedAttachment:xe(Ee()).optional().nullable()}))});C.useEffect(()=>{(async()=>{var r,m;(b===x.edit||b===x.clone)&&(ie(!0),await Ue()),Ge("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=Number(ve.split("form")[1])-1;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(r=a.getValues("forms")[s])!=null&&r.purchasing_group?"id":"",value:((m=a.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:a.getValues("cost_center")?"id":"",value:a.getValues("cost_center")??""}}),ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:a.getValues("requester")?"nip":"",value:a.getValues("requester")??""}}),a.getValues("requester")!==""&&b===x.create&&W(0)})()},[b]);async function Ue(){a.setValue("forms",[]),ie(!0);try{const t=await V.get($e??""),s=t.data.data.group,r=t.data.data.forms;ze(s.reimbursementStatus),z(r.reduce((o,h)=>(o.push(String(h.id)),o),[]));const m=r.map(o=>({reimburseId:String(o.id),for:String(o.for),group:String(o.group),reimburse_type:o.reimburse_type.code,short_text:o.short_text,balance:o.balance,currency:o.currency,tax_on_sales:String(o.tax_on_sales),purchase_requisition_unit_of_measure:String(o.purchase_requisition_unit_of_measure),remaining_balance_when_request:Number(o.remaining_balance_when_request)??0,purchasing_group:String(o.purchasing_group),type:o.type,item_delivery_data:new Date(o.item_delivery_data),claim_date:new Date(o.claim_date),attachment:[],savedAttachment:o.reimburse_attachment}));ge.current=r.map((o,h)=>({id:String(o.id),reimburse_type:o.reimburse_type.code,balance:r.filter((n,g)=>g>=h&&n.for===o.for&&n.reimburse_type.code===o.reimburse_type.code).reduce((n,g)=>n+Number(g.balance)||0,0),limit:r.filter((n,g)=>g>=h&&n.for===o.for&&n.reimburse_type.code===o.reimburse_type.code).reduce((n,g)=>n+1||0,0),for:String(o.for)})),a.setValue("formCount",r.length.toString()),a.setValue("remark_group",s.remark),a.setValue("cost_center",String(s.cost_center.id)),a.setValue("requester",s.requester),a.setValue("forms",m);let d=0;for(const o of r)await W(d,{reimburse_type:o.reimburse_type.code}),await Se(d,{type:o.type,reimburse_type:o.reimburse_type.code}),await _e(d,{reimburse_type:o.reimburse_type.code,for:o.reimburse_type.is_employee===1?null:o.for},!0),d++;ie(!1)}catch{ie(!1)}}const et={formCount:"1",remark_group:"",cost_center:"",requester:String(A==null?void 0:A.is_admin)==="1"?"":A==null?void 0:A.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ye,purchase_requisition_unit_of_measure:we,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},a=bt({resolver:pt(Qe),defaultValues:et}),{fields:be,update:_}=_t({control:a.control,name:"forms"}),W=async(t,s=null)=>{const r=a.getValues("requester");if(r===null||r===""){he(d=>{const o=[...d];return o[t]=[],o});return}const m=await V.get(Ie,{params:{user:r,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});he(d=>{const o=[...d];return o[t]=m.data.data,o})},tt=async(t,s)=>{if(t&&t.length>0)try{const r=await V.get(Ie,{params:{search:t,user:a.getValues("requester")}});he(m=>{const d=[...m];return d[s]=r.data.data,d})}catch(r){console.error("Error searching reimburse types:",r)}},Se=async(t,s)=>{const r=await V.get(Dt,{params:{user:a.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});fe(m=>{const d=[...m];return d[t]=r.data.data,d})},st=t=>{for(let s=0;s<be.length;s++)W(s);if(t==null)for(let s=0;s<be.length;s++)a.setValue(`forms.${s}.reimburse_type`,""),a.setValue(`forms.${s}.for`,"");B([]),fe([])};function at(t){const s=[...a.getValues("forms")];for(let r=0;r<Number(t);r++)if(r+1>s.length){W(r);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ye,purchase_requisition_unit_of_measure:we,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}a.setValue("forms",s)}const rt=t=>{Ne(t)},nt=async t=>{var r,m,d,o,h;if(y)for(let n=0;n<y.length;n++){if(t.forms.length==0||t.forms.length-1,((r=y[n])==null?void 0:r.type_limit)!=="Unlimited"&&Number((m=y[n])==null?void 0:m.limit)==0){L("Claim Limit for form "+(n+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[n].balance==""||Number(t.forms[n].balance)==0){L("Claim Balance for form "+(n+1)+" cannot be 0","error");return}if(Number(((d=y[n])==null?void 0:d.balance)??0)<Number(t.forms[n].balance??0)){L("Please check your balance input for forms "+(n+1)+"  is not must be above "+((o=y[n])==null?void 0:o.balance),"error");return}t.forms=t.forms.map((g,E)=>{var k;return{...g,claim_date:O(g.claim_date).format("YYYY-MM-DD"),item_delivery_data:O(g.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:Number(((k=y[E])==null?void 0:k.balance)??0)}})}const s=t.forms.reduce((n,g)=>n+Number(g.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let n;b===x.edit||b===x.clone?n=await V.post(Ve??"",t,{headers:{"Content-Type":"multipart/form-data"}}):n=await V.post(Be??"",t,{headers:{"Content-Type":"multipart/form-data"}}),L((h=n==null?void 0:n.data)==null?void 0:h.data,"success"),ue()}catch{}};async function _e(t,s=null,r=!1){var o,h;const m=a.getValues(`forms.${t}`),d={user:a.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:m.reimburse_type,for:s!=null?s.for:m.for};try{const n=await V.get("reimburse/data-limit-and-balance",{params:d}),E=a.getValues("forms").filter((j,p)=>p!==t&&j.reimburse_type===m.reimburse_type&&j.for===m.for);let k=E.reduce((j,p)=>j+Number(p.balance)||0,0),I=0,N=0;if(b===x.clone)if(r){let j=ge.current.find(p=>m.reimburseId==p.id);I=k+Number(j.balance),N=E.length+Number(j.limit),z(p=>{const f=[...p];return f[t]=j.id,f})}else{let j=m.for===""?a.getValues("requester"):m.for,p=ge.current.find(f=>f.reimburse_type===m.reimburse_type&&f.for===j&&!Ze.includes(f.id));p!==void 0&&(I=Number(p.balance),N=Number(p.limit),z(f=>{const D=[...f];return D[t]=p.id,D}))}let P=n.data.data.balance-k+I,Z=Math.max(0,n.data.data.limit-E.length+N);B(j=>{const p=[...j];return p[t]={...n.data.data,balance:P,limit:n.data.data.type_limit=="Unlimited"?n.data.data.type_limit:Z},p})}catch(n){L((h=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:h.message,"error")}}const Ce=async()=>{var t,s,r,m,d,o,h,n,g,E,k,I;try{const N=a.getValues("forms"),P=N.map((f,D)=>({index:D,value:f.balance?Number(f.balance):0}));if(P.some(f=>f.value===0)){const f=P.findIndex(D=>D.value===0);L(`Please fill balance form ${f+1}`,"error");return}const j=N.reduce((f,D)=>f+(Number(D.balance)||0),0),p=await V.get("/check-approval",{params:{value:j,requester:a.getValues("requester"),type:"REIM"}});if(p.data.status_code===200){const f=(s=(t=p.data)==null?void 0:t.data)==null?void 0:s.approval.map(c=>(c==null?void 0:c.division_name)||null),D=(m=(r=p.data)==null?void 0:r.data)==null?void 0:m.approval.map(c=>(c==null?void 0:c.name)||null),i=[];(o=(d=p.data)==null?void 0:d.data)!=null&&o.hr&&i.push((g=(n=(h=p.data)==null?void 0:h.data)==null?void 0:n.hr)==null?void 0:g.name);const l=(((E=p.data.data)==null?void 0:E.approval)??[]).map(c=>({status:"",name:c.name,dateApproved:""}));Je({approvalRequest:f,approvalFrom:D,acknowledgeFrom:i,approvalFromStatusRoute:l}),He(!0)}}catch(N){L((I=(k=N==null?void 0:N.response)==null?void 0:k.data)==null?void 0:I.message,"error")}};C.useEffect(()=>{a.getValues("forms").reduce((r,m)=>r+Number(m.balance)||0,0)>0&&De===!0&&Ce()},[a.watch("forms"),a.watch("requester")]);const ot=t=>{const s=t;if(Object.keys(s).length>0){let r=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,d])=>{m==="forms"?d.forEach((o,h)=>{r+=`</br><strong>Form ${h+1}:</strong></br>`,Object.values(o).forEach(n=>{r+=`<li>${n.message}</li>`})}):r+=`<li>${d.message}</li>`}),r+="</ul>",L(e.jsx("div",{dangerouslySetInnerHTML:{__html:r}}),"error")}};return e.jsx(jt,{className:"h-[600px] w-full",children:e.jsx(qt,{isLoading:We,children:e.jsx(ht,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(nt,t=>{ot(t)}),children:[e.jsx("table",{className:"w-full mt-4 text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:M&&e.jsx(Ft,{name:M==null?void 0:M.name,className:M==null?void 0:M.classname,code:M==null?void 0:M.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:"remark_group",render:({field:t})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(ke,{placeholder:"Insert remark",...t})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{fieldLabel:"",options:oe,fieldName:"cost_center",disabled:b===x.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=oe==null?void 0:oe.some(r=>r.label===t);t.length>0&&!s?await le(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=a.getValues("cost_center");le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{options:se,fieldName:"requester",disabled:String(A==null?void 0:A.is_admin)==="0"||b===x.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const r=se==null?void 0:se.some(m=>m.label===t);t.length>0&&!r?ae(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!r&&ae("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>st(t),onFocus:()=>{const t=a.getValues("requester");ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(T,{children:[e.jsx(q,{children:e.jsxs(X,{disabled:b===x.edit,onValueChange:r=>{t.onChange(r),at(r);const m=a.getValues("forms");let d=Number(r);if(m.length>d){const o=m.slice(0,d);a.setValue("forms",o),B(h=>{let n=[...h];return n=n.slice(0,d),n}),Ne(`form${Math.max(1,d)}`),z(h=>{const n=[...h];return n[d]="",n})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"Select number of forms"})}),e.jsx(U,{children:Array.from({length:3},(r,m)=>m+1).map(r=>e.jsx(ee,{value:r.toString(),children:r},r))})]})}),e.jsx(R,{})]})}})})]})]})}),e.jsx(Le,{className:"my-4"}),e.jsxs(xt,{value:ve,onValueChange:rt,className:"w-full",children:[e.jsxs(yt,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((t,s)=>e.jsxs(wt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),be.map((t,s)=>{var r,m,d,o,h,n,g,E,k,I,N,P,Z,j,p,f,D;return e.jsxs(vt,{value:`form${s+1}`,children:[e.jsx(F,{control:a.control,name:`forms.${s}.reimburseId`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(Ae,{className:"sr-only",value:t.reimburseId,onChange:i.onChange})}),e.jsx(R,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{options:Y[s],fieldName:`forms.${s}.reimburse_type`,disabled:Y[s]===void 0||Y[s].length===0||b===x.edit,placeholder:"Select Reimburse Type",onSearch:async i=>{var u;((u=Y[s])==null?void 0:u.some(c=>c.label===i))||await tt(i,s)},onChangeOutside:async i=>{if(i){const l=Y[s].filter(u=>u.value==i)[0];_(s,{...t,reimburse_type:i,type:l.is_employee===1?"Employee":"Family"}),l.is_employee===1?_e(s,{reimburse_type:i,for:null}):(B(u=>{const c=[...u];return c[s]=[],c}),a.setValue(`forms.${s}.balance`,""),Se(s,{type:"Family",reimburse_type:i}))}else{B(u=>{const c=[...u];return c[s]=[],c}),_(s,{...t,balance:""}),z(u=>{const c=[...u];return c[s]="",c}),a.setValue(`forms.${s}.for`,""),fe(u=>{const c=[...u];return c[s]=[],c});const l=a.getValues("forms");l.forEach((u,c)=>{var S,w;if(c>s&&l[c].reimburse_type===t.reimburse_type){const ce=((S=y[c])==null?void 0:S.balance)||0,Fe=((w=y[c])==null?void 0:w.limit)||0;B(me=>{var G;const $=[...me];return $[c]={...$[c],balance:ce+Number(t.balance||"0")},((G=y[c])==null?void 0:G.type_limit)!=="Unlimited"&&($[c]={...$[c],limit:Fe+1}),$}),a.setValue(`forms.${c}.balance`,"")}})}},onFocus:()=>{W(s)},classNames:"mt-2 w-full"}),((d=(m=(r=a.formState.errors)==null?void 0:r.forms)==null?void 0:m[s])==null?void 0:d.reimburse_type)&&e.jsx(Ye,{error:!0,children:(g=(n=(h=(o=a.formState.errors)==null?void 0:o.forms)==null?void 0:h[s])==null?void 0:n.reimburse_type)==null?void 0:g.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:`forms.${s}.for`,render:({field:i})=>{var l,u,c,S;return e.jsxs(T,{children:[e.jsx(q,{children:e.jsxs(X,{disabled:((c=(u=(l=Y==null?void 0:Y[s])==null?void 0:l.filter(w=>(w==null?void 0:w.value)==a.getValues(`forms.${s}.reimburse_type`)))==null?void 0:u[0])==null?void 0:c.is_employee)===1||b===x.edit,onValueChange:w=>{_(s,{...t,for:w}),_e(s,{reimburse_type:a.getValues(`forms.${s}.reimburse_type`),for:w})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(S=Oe[s])==null?void 0:S.map(w=>e.jsx(ee,{value:w.value.toString(),children:w.label},w.value))})]})}),e.jsx(R,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{fieldLabel:"",options:re,fieldName:`forms.${s}.purchasing_group`,disabled:b===x.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:i=>{const l=re==null?void 0:re.some(u=>u.label===i);i.length>0&&!l?ne(i,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:i}):i.length==0&&!l&&ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:i=>{i&&_(s,{...t,purchasing_group:i})},onFocus:()=>{var l;const i=(l=a.getValues("forms")[s])==null?void 0:l.purchasing_group;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:i?"id":"",value:i??""}})}}),((I=(k=(E=a.formState.errors)==null?void 0:E.forms)==null?void 0:k[s])==null?void 0:I.purchasing_group)&&e.jsx(Ye,{error:!0,children:(j=(Z=(P=(N=a.formState.errors)==null?void 0:N.forms)==null?void 0:P[s])==null?void 0:Z.purchasing_group)==null?void 0:j.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:`forms.${s}.tax_on_sales`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsxs(X,{disabled:!0,onValueChange:l=>{_(s,{...t,tax_on_sales:l})},defaultValue:t.tax_on_sales,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(Pe??[]).map((l,u)=>e.jsxs(ee,{value:l.value.toString(),children:[l.description," - ",l.label]},l.value))})]})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsxs(X,{disabled:!0,onValueChange:l=>{_(s,{...t,purchase_requisition_unit_of_measure:String(l)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:e.jsx(ee,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:`forms.${s}.short_text`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(ke,{placeholder:"Insert remark",onChange:l=>{_(s,{...t,short_text:l.target.value})},defaultValue:t.short_text})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((p=y[s])==null?void 0:p.balance)&&J((f=y[s])==null?void 0:f.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(D=y[s])==null?void 0:D.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:`forms.${s}.item_delivery_data`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(Me,{disabled:b===x.edit,initialDate:i.value instanceof Date?i.value:new Date(i.value),minDate:new Date,onDateChange:l=>{O(l).format("YYYY-MM-DD")>=O(new Date).format("YYYY-MM-DD")?(i.onChange(l),_(s,{...t,item_delivery_data:l})):(i.onChange(i.value),_(s,{...t,item_delivery_data:i.value}),L("Receipt date cannot be less than today","error"))}})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(F,{control:a.control,name:`forms.${s}.claim_date`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(Me,{disabled:b===x.edit,initialDate:i.value instanceof Date?i.value:new Date(i.value),minDate:new Date,onDateChange:l=>{O(l).format("YYYY-MM-DD")>=O(new Date).format("YYYY-MM-DD")?(i.onChange(l),_(s,{...t,claim_date:l})):(i.onChange(i.value),_(s,{...t,claim_date:i.value}),L("Claim date cannot be less than today","error"))}})}),e.jsx(R,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid w-full grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(F,{control:a.control,name:`forms.${s}.currency`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(q,{children:e.jsxs(X,{disabled:b===x.edit,onValueChange:l=>{_(s,{...t,currency:l})},defaultValue:t.currency,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:pe.map(l=>e.jsxs(ee,{value:l.code,children:[l.name," (",l.code,")"]},l.code))})]})}),e.jsx(ft,{className:"h-6"}),e.jsx(R,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(F,{control:a.control,name:`forms.${s}.balance`,render:({field:i})=>{var l;return e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(Ae,{type:"text",placeholder:"0",onChange:u=>{var me;const c=u.target.value.replace(/[^0-9]/g,""),S=J(c,!1),w=Number(c)||0,ce=((me=y[s])==null?void 0:me.balance)||0;if(w>ce){u.target.value=J(c.slice(0,-1),!1);return}_(s,{...t,balance:c}),u.target.value=S,a.getValues("forms").forEach(($,G)=>{if(G>s&&$.reimburse_type===t.reimburse_type){const lt=ce-w;B(it=>{const je=[...it];return je[G]={...je[G],balance:lt},je}),_(G,{...$,balance:""})}})},defaultValue:J(t.balance,!1),value:J(t.balance,!1),disabled:typeof y[s]>"u"||((l=y[s])==null?void 0:l.length)===0||b===x.edit})}),e.jsx(R,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(F,{control:a.control,name:`forms.${s}.attachment`,render:({field:i})=>e.jsxs(T,{children:[e.jsx(gt,{className:"mb-1 text-xs text-gray-500 font-extralight",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(q,{children:e.jsx("input",{className:"flex w-full px-3 py-1 text-xs transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:l=>{const u=l.target.files;if(u){const c=[...t.attachment],S=Array.from(u);c.push(...S),_(s,{...t,attachment:c})}}})}),e.jsx(R,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((i,l)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:i.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const u=t.attachment.filter((c,S)=>S!==l);_(s,{...t,attachment:u})},children:"Delete"})]},l))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((i,l)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:i.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const u=t.savedAttachment.filter((c,S)=>S!==l);_(s,{...t,savedAttachment:u})},children:"Delete"})]},l))})})]})]})]})]})})})]},s)})]}),e.jsx(Tt,{onClick:async()=>await Ce(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:De&&e.jsx(Ct,{workflowApproval:{approvalRequest:H.approvalRequest,approvalFrom:H.approvalFrom,acknowledgeFrom:H.acknowledgeFrom},workflowApprovalStep:H.approvalFromStatusRoute,workflowApprovalDiagram:H.approvalFrom})}),e.jsx(Le,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(dt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{Fs as ReimburseForm};
