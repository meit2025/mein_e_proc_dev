import{j as e,r as F,u as tt,q as st}from"./app-DvH_oN7p.js";import{B as at}from"./button-DvFpfmXH.js";import{h as G}from"./moment-C5S46NFB.js";import{z as u,t as rt}from"./index-Bs78O-pg.js";import{f as H}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as nt,F as v,a as D,b as N,c as C,f as ot,e as lt}from"./form-BblcFq6J.js";import{u as it,b as ct}from"./index.esm-lHEEcPFm.js";import{T as we}from"./textarea-CU3kAg8Y.js";/* empty css                  */import{S as mt}from"./scroll-area-B0MvWMz4.js";import{a as $}from"./axiosInstance-D7NGgkea.js";import{S as ve}from"./separator-2v6YFyA8.js";import{T as dt,a as pt,b as ut,c as ht}from"./tabs-DoT54hB7.js";import{S as W,a as Z,b as J,c as K,d as X}from"./select-DJtaw40R.js";import{F as ae}from"./formDropdown-FtNm28vk.js";import{C as De}from"./CustomDatePicker-JqGDrFH6.js";import{I as Ne}from"./input-CIQcYD0J.js";import{ReimburseFormType as b}from"./listModel-p4jf__9l.js";import{u as Q}from"./getDropdown-CT7hCb7F.js";import{G as ft,a as Ce,b as gt}from"./api-DXF7erOJ.js";import{L as jt}from"./LoadingSpin-BMBEs94X.js";import{W as _t}from"./WorkflowComponent-BuVQK3zR.js";import{C as bt}from"./CustomStatus-FJbyKf4Y.js";import{F as Se}from"./FormHelperText-BEKw-vez.js";import{B as xt}from"./Button-BmgNQEke.js";import"./app-DQK4SJPx.js";import"./index-DvpZ-N7l.js";import"./index-Bb4qSo10.js";import"./utils-OM731f89.js";import"./createLucideIcon-CRW5Zcon.js";import"./index-uJLGxmcb.js";import"./index-C0ChJUFD.js";import"./index-BmwRwZco.js";import"./index-DvjFdTmj.js";import"./index-BSTbjvS0.js";import"./index-BdQq_4o_.js";import"./index-DpCk7ZV3.js";import"./index-DrUBLGXC.js";import"./index-CPdKi2eY.js";import"./index-DrmEky2B.js";import"./index-rVXDVI3y.js";import"./Combination-B8QBTiVt.js";import"./index-Cd7ZU4qi.js";import"./TextField-CNgnsvw3.js";import"./createSvgIcon-ESAqmyGL.js";import"./DefaultPropsProvider-DsUxqhs8.js";import"./useSlot-C98k6l4N.js";import"./createSimplePaletteValueFilter-CfVKrbD8.js";import"./useControlled-DZfyS_oL.js";function yt({isLoading:re=!1,children:ne}){return e.jsx("div",{className:"",children:re?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(jt,{})})}):ne})}const js=({onSuccess:re,currencies:ne,taxDefaultValue:pe,uomDefaultValue:ue,edit_url:Fe,update_url:Ie,store_url:Ee,type:f,currentUser:k})=>{const[qe,Te]=F.useState("form1"),{showToast:I}=tt();st().props;const{dataDropdown:Re,getDropdown:he}=Q(ft);Q();const{dataDropdown:ke,getDropdown:Le}=Q(),{dataDropdown:Me,getDropdown:fe}=Q("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:Ye,getDropdown:ge}=Q("api/master/cost-center/dropdown-list"),[V,oe]=F.useState([]),[$e,le]=F.useState([]),[E,Ae]=F.useState(!1),[je,Be]=F.useState(!1),[Pe,U]=F.useState(!1),[g,A]=F.useState([]),[O,Ve]=F.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ge=1*1024*1024,Oe=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],ze=u.object({formCount:u.string().min(1,"total form must be have value"),remark_group:u.string().min(1,"header remark is required"),cost_center:u.string().min(1,"cost center required"),requester:u.string().min(1,"requester required"),value:u.number().optional(),user_id:u.string().optional(),forms:u.array(u.object({reimburseId:u.string().optional(),for:u.string().optional(),group:u.string().optional(),reimburse_type:u.string().min(1,"reimburse type is required"),short_text:u.string().min(1,"remarks is required"),balance:u.string(),remaining_balance_when_request:u.number(),currency:u.string().min(1,"currency required"),tax_on_sales:u.string().min(1,"tax required"),purchase_requisition_unit_of_measure:u.string().min(1,"uom required"),purchasing_group:u.string().min(1,"Purchasing Group required"),type:u.any(),item_delivery_data:u.date(),claim_date:u.date(),attachment:u.array(u.instanceof(File).refine(s=>Oe.includes(s.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(s=>s.size<=Ge,{message:"File size must be less than 1MB"})).min(f===b.create?1:0,"Attachment is required")}))});F.useEffect(()=>{Le("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}}),fe("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),ge("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),he("",{name:"name",id:"nip",tabel:"users"}),a.getValues("requester")!==""&&z(0)},[]);const He={formCount:"1",remark_group:"",cost_center:"",requester:String(k==null?void 0:k.is_admin)==="1"?"":k==null?void 0:k.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:pe,purchase_requisition_unit_of_measure:ue,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},a=it({resolver:rt(ze),defaultValues:He}),{fields:ie,update:j}=ct({control:a.control,name:"forms"});async function We(){a.setValue("forms",[]),U(!0);try{const s=await $.get(Fe??""),t=s.data.data.group,r=s.data.data.forms;Ae(t.reimbursementStatus);const d=r.map(i=>({reimburseId:String(i.id),for:String(i.for),group:String(i.group),reimburse_type:i.reimburse_type.code,short_text:i.short_text,balance:f===b.edit?i.balance:"",currency:i.currency,tax_on_sales:String(i.tax_on_sales),purchase_requisition_unit_of_measure:String(i.purchase_requisition_unit_of_measure),purchasing_group:String(i.purchasing_group),type:i.type,item_delivery_data:new Date(i.item_delivery_data),claim_date:new Date(i.claim_date),attachment:[]}));a.setValue("formCount",r.length.toString()),a.setValue("remark_group",t.remark),a.setValue("cost_center",String(t.cost_center.id)),a.setValue("requester",t.requester);let c=0;for(const i of r)await z(c,{reimburse_type:i.reimburse_type.code}),await _e(c,{type:i.type,reimburse_type:i.reimburse_type.code}),await ce(c,{reimburse_type:i.reimburse_type.code,for:i.reimburse_type.is_employee===1?null:i.for}),c++;a.setValue("forms",d),U(!1)}catch{U(!1)}}F.useEffect(()=>{(f===b.edit||f===b.clone)&&(U(!0),We())},[f]);const z=async(s,t=null)=>{const r=a.getValues("requester");if(r===null||r===""){oe(c=>{const i=[...c];return i[s]=[],i});return}const d=await $.get(Ce,{params:{user:r,hasValue:t!=null?t.reimburse_type:null},headers:{"Content-Type":"application/json"}});oe(c=>{const i=[...c];return i[s]=d.data.data,i})},Ze=async(s,t)=>{if(s&&s.length>0)try{const r=await $.get(Ce,{params:{search:s,user:a.getValues("requester")}});oe(d=>{const c=[...d];return c[t]=r.data.data,c})}catch(r){console.error("Error searching reimburse types:",r)}},_e=async(s,t)=>{const r=await $.get(gt,{params:{user:a.getValues("requester"),familyRelationship:t.type=="Family"?"0":"1",reimburseType:t.reimburse_type},headers:{"Content-Type":"application/json"}});le(d=>{const c=[...d];return c[s]=r.data.data,c})},Je=s=>{for(let t=0;t<ie.length;t++)z(t);if(s==null)for(let t=0;t<ie.length;t++)a.setValue(`forms.${t}.reimburse_type`,""),a.setValue(`forms.${t}.for`,"");A([]),le([])};function Ke(s){const t=[...a.getValues("forms")];for(let r=0;r<parseInt(s);r++)if(r+1>t.length){z(r);const d={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:pe,purchase_requisition_unit_of_measure:ue,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};t.push(d)}a.setValue("forms",t)}const be=s=>{Te(s)},Xe=async s=>{var r,d,c,i,h;if(g)for(let m=0;m<g.length;m++){if(s.forms.length==0||s.forms.length-1,((r=g[m])==null?void 0:r.type_limit)!=="Unlimited"&&parseInt((d=g[m])==null?void 0:d.limit)==0){I("Claim Limit for form "+(m+1)+" is Empty, Please Contact the Admin","error");return}if(s.forms[m].balance==""||parseInt(s.forms[m].balance)==0){I("Claim Balance for form "+(m+1)+" cannot be 0","error");return}if(parseInt(((c=g[m])==null?void 0:c.balance)??0)<parseInt(s.forms[m].balance??0)){I("Please check your balance input for forms "+(m+1)+"  is not must be above "+((i=g[m])==null?void 0:i.balance),"error");return}s.forms=s.forms.map((w,q)=>{var T;return{...w,claim_date:G(w.claim_date).format("YYYY-MM-DD"),item_delivery_data:G(w.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:parseInt(((T=g[q])==null?void 0:T.balance)??0)}})}const t=s.forms.reduce((m,w)=>m+parseInt(w.balance)||0,0);s.value=t,s.user_id=(s==null?void 0:s.requester)||"0";try{let m;f===b.edit?m=await $.put(Ie??"",s,{headers:{"Content-Type":"multipart/form-data"}}):m=await $.post(Ee??"",s,{headers:{"Content-Type":"multipart/form-data"}}),I((h=m==null?void 0:m.data)==null?void 0:h.data,"success"),re()}catch{}};async function ce(s,t=null){var c,i;const r=a.getValues(`forms.${s}`),d={user:a.getValues("requester"),reimbuse_type:t!=null?t.reimburse_type:r.reimburse_type,for:t!=null?t.for:r.for};try{const h=await $.get("reimburse/data-limit-and-balance",{params:d});A(m=>{const q=a.getValues("forms").filter((x,L)=>L!==s&&x.reimburse_type===r.reimburse_type),T=q.reduce((x,L)=>x+parseInt(L.balance)||0,0),Y=[...m];return Y[s]={...h.data.data,balance:h.data.data.balance-T,limit:h.data.data.type_limit=="Unlimited"?h.data.data.type_limit:Math.max(0,h.data.data.limit-q.length)},Y})}catch(h){I((i=(c=h==null?void 0:h.response)==null?void 0:c.data)==null?void 0:i.message,"error")}}const xe=async()=>{var s,t,r,d,c,i,h,m,w,q,T,Y;try{const x=a.getValues("forms"),L=x.map((y,R)=>({index:R,value:y.balance?parseInt(y.balance):0}));if(L.some(y=>y.value===0)){const y=L.findIndex(R=>R.value===0);I(`Please fill the balance for form ${y+1}`,"error");return}const ee=x.reduce((y,R)=>y+(parseInt(R.balance)||0),0),M=await $.get("/check-approval",{params:{value:ee,requester:a.getValues("requester"),type:"REIM"}});if(M.data.status_code===200){const y=(t=(s=M.data)==null?void 0:s.data)==null?void 0:t.approval.map(l=>(l==null?void 0:l.division_name)||null),R=(d=(r=M.data)==null?void 0:r.data)==null?void 0:d.approval.map(l=>(l==null?void 0:l.name)||null),o=[];(i=(c=M.data)==null?void 0:c.data)!=null&&i.hr&&o.push((w=(m=(h=M.data)==null?void 0:h.data)==null?void 0:m.hr)==null?void 0:w.name);const n=(((q=M.data.data)==null?void 0:q.approval)??[]).map(l=>({status:"",name:l.name,dateApproved:""}));Ve({approvalRequest:y,approvalFrom:R,acknowledgeFrom:o,approvalFromStatusRoute:n}),Be(!0)}}catch(x){I((Y=(T=x==null?void 0:x.response)==null?void 0:T.data)==null?void 0:Y.message,"error")}};F.useEffect(()=>{a.getValues("forms").reduce((r,d)=>r+parseInt(d.balance)||0,0)>0&&je===!0&&xe()},[a.watch("forms"),a.watch("requester")]);const Qe=s=>{const t=s;if(Object.keys(t).length>0){let r=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>       
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(t).forEach(([d,c])=>{d==="forms"?c.forEach((i,h)=>{r+=`</br><strong>Form ${h+1}:</strong></br>`,Object.values(i).forEach(m=>{r+=`<li>${m.message}</li>`})}):r+=`<li>${c.message}</li>`}),r+="</ul>",I(e.jsx("div",{dangerouslySetInnerHTML:{__html:r}}),"error")}};return e.jsx(mt,{className:"h-[600px] w-full",children:e.jsx(yt,{isLoading:Pe,children:e.jsx(nt,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(Xe,s=>{Qe(s)}),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:E&&e.jsx(bt,{name:E==null?void 0:E.name,className:E==null?void 0:E.classname,code:E==null?void 0:E.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:"remark_group",render:({field:s})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(we,{placeholder:"Insert remark",...s})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(ae,{fieldLabel:"",options:Ye,fieldName:"cost_center",disabled:f===b.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async s=>{s.length>0&&await ge(s,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(ae,{options:Re,fieldName:"requester",disabled:String(k==null?void 0:k.is_admin)==="0"||f===b.edit,placeholder:"Select Employee",onSearch:async s=>{s.length>0&&await he(s,{name:"name",id:"nip",tabel:"users"})},onChangeOutside:s=>Je(s),classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:"formCount",render:({field:s})=>{var t;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:f===b.edit,onValueChange:r=>{s.onChange(r),Ke(r),be(`form${parseInt(r)}`);const d=a.getValues("forms");if(d.length>parseInt(r)){const c=d.slice(0,parseInt(r));a.setValue("forms",c),A(i=>{let h=[...i];return h=h.slice(0,parseInt(r)),h})}},value:(t=s.value)==null?void 0:t.toString(),children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"Select number of forms"})}),e.jsx(K,{children:Array.from({length:3},(r,d)=>d+1).map(r=>e.jsx(X,{value:r.toString(),children:r},r))})]})}),e.jsx(C,{})]})}})})]})]})}),e.jsx(ve,{className:"my-4"}),e.jsxs(dt,{value:qe,onValueChange:be,className:"w-full",children:[e.jsxs(pt,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((s,t)=>e.jsxs(ut,{value:`form${t+1}`,children:["Form ",t+1]},t))]}),ie.map((s,t)=>{var r,d,c,i,h,m,w,q,T,Y,x,L,me,ee,M,y,R;return e.jsxs(ht,{value:`form${t+1}`,children:[e.jsx(v,{control:a.control,name:`forms.${t}.reimburseId`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ne,{className:"sr-only",value:s.reimburseId,onChange:o.onChange})}),e.jsx(C,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(ae,{options:V[t],fieldName:`forms.${t}.reimburse_type`,disabled:a.getValues("requester")==""||f===b.edit,placeholder:"Select Reimburse Type",onSearch:async o=>{var p;((p=V[t])==null?void 0:p.some(l=>l.label===o))||await Ze(o,t)},onChangeOutside:async o=>{if(o){let n=V[t].filter(p=>p.value==o)[0];j(t,{...s,reimburse_type:o,type:n.is_employee===1?"Employee":"Family"}),n.is_employee===1?ce(t,{reimburse_type:o,for:null}):(A(p=>{const l=[...p];return l[t]=[],l}),a.setValue(`forms.${t}.balance`,""),_e(t,{type:"Family",reimburse_type:o}))}else{A(p=>{const l=[...p];return l[t]=[],l}),j(t,{...s,balance:""}),a.setValue(`forms.${t}.for`,""),le(p=>{const l=[...p];return l[t]=[],l});const n=a.getValues("forms");n.forEach((p,l)=>{var S,_;if(l>t&&n[l].reimburse_type===s.reimburse_type){const te=((S=g[l])==null?void 0:S.balance)||0,ye=((_=g[l])==null?void 0:_.limit)||0;A(se=>{var P;const B=[...se];return B[l]={...B[l],balance:te+parseInt(s.balance||"0")},((P=g[l])==null?void 0:P.type_limit)!=="Unlimited"&&(B[l]={...B[l],limit:ye+1}),B}),a.setValue(`forms.${l}.balance`,"")}})}},onFocus:()=>{z(t)},classNames:"mt-2 w-full"}),((c=(d=(r=a.formState.errors)==null?void 0:r.forms)==null?void 0:d[t])==null?void 0:c.reimburse_type)&&e.jsx(Se,{error:!0,children:(w=(m=(h=(i=a.formState.errors)==null?void 0:i.forms)==null?void 0:h[t])==null?void 0:m.reimburse_type)==null?void 0:w.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${t}.for`,render:({field:o})=>{var n,p,l,S;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:((l=(p=(n=V==null?void 0:V[t])==null?void 0:n.filter(_=>(_==null?void 0:_.value)==a.getValues(`forms.${t}.reimburse_type`)))==null?void 0:p[0])==null?void 0:l.is_employee)===1||f===b.edit,onValueChange:_=>{j(t,{...s,for:_}),ce(t,{reimburse_type:a.getValues(`forms.${t}.reimburse_type`),for:_})},defaultValue:s==null?void 0:s.for,value:s.for,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(S=$e[t])==null?void 0:S.map(_=>e.jsx(X,{value:_.value.toString(),children:_.label},_.value))})]})}),e.jsx(C,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(ae,{fieldLabel:"",options:Me,fieldName:`forms.${t}.purchasing_group`,disabled:f===b.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:async o=>{o.length>0&&await fe(o,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:async o=>{o&&j(t,{...s,purchasing_group:o})}}),((Y=(T=(q=a.formState.errors)==null?void 0:q.forms)==null?void 0:T[t])==null?void 0:Y.purchasing_group)&&e.jsx(Se,{error:!0,children:(ee=(me=(L=(x=a.formState.errors)==null?void 0:x.forms)==null?void 0:L[t])==null?void 0:me.purchasing_group)==null?void 0:ee.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${t}.tax_on_sales`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:!0,onValueChange:n=>{j(t,{...s,tax_on_sales:n})},defaultValue:s.tax_on_sales,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(ke??[]).map((n,p)=>e.jsxs(X,{value:n.value.toString(),children:[n.description," - ",n.label]},n.value))})]})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${t}.purchase_requisition_unit_of_measure`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:!0,onValueChange:n=>{j(t,{...s,purchase_requisition_unit_of_measure:String(n)})},defaultValue:s.purchase_requisition_unit_of_measure,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:e.jsx(X,{value:"2",children:"Piecec - PC"},"2")})]})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${t}.short_text`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(we,{placeholder:"Insert remark",onChange:n=>{j(t,{...s,short_text:n.target.value})},defaultValue:s.short_text})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((M=g[t])==null?void 0:M.balance)&&H((y=g[t])==null?void 0:y.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(R=g[t])==null?void 0:R.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${t}.item_delivery_data`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(De,{disabled:f===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:n=>{G(n).format("YYYY-MM-DD")>=G(new Date).format("YYYY-MM-DD")?(o.onChange(n),j(t,{...s,item_delivery_data:n})):(o.onChange(o.value),j(t,{...s,item_delivery_data:o.value}),I("Receipt date cannot be less than today","error"))}})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(v,{control:a.control,name:`forms.${t}.claim_date`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(De,{disabled:f===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:n=>{G(n).format("YYYY-MM-DD")>=G(new Date).format("YYYY-MM-DD")?(o.onChange(n),j(t,{...s,claim_date:n})):(o.onChange(o.value),j(t,{...s,claim_date:o.value}),I("Claim date cannot be less than today","error"))}})}),e.jsx(C,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(v,{control:a.control,name:`forms.${t}.currency`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(N,{children:e.jsxs(W,{disabled:f===b.edit,onValueChange:n=>{j(t,{...s,currency:n})},defaultValue:s.currency,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:ne.map(n=>e.jsxs(X,{value:n.code,children:[n.name," (",n.code,")"]},n.code))})]})}),e.jsx(ot,{className:"h-6"}),e.jsx(C,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(v,{control:a.control,name:`forms.${t}.balance`,render:({field:o})=>{var n;return e.jsxs(D,{children:[e.jsx(N,{children:e.jsx(Ne,{type:"text",placeholder:"0",onChange:p=>{var se;const l=p.target.value.replace(/[^0-9]/g,""),S=H(l,!1),_=parseInt(l)||0,te=((se=g[t])==null?void 0:se.balance)||0;if(_>te){p.target.value=H(l.slice(0,-1),!1);return}j(t,{...s,balance:l}),p.target.value=S,a.getValues("forms").forEach((B,P)=>{if(P>t&&B.reimburse_type===s.reimburse_type){const Ue=te-_;A(et=>{const de=[...et];return de[P]={...de[P],balance:Ue},de}),j(P,{...s,balance:""})}})},defaultValue:H(s.balance,!1),value:H(s.balance,!1),disabled:typeof g[t]>"u"||((n=g[t])==null?void 0:n.length)===0||f===b.edit})}),e.jsx(C,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(v,{control:a.control,name:`forms.${t}.attachment`,render:({field:o})=>e.jsxs(D,{children:[e.jsx(lt,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(N,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:n=>{const p=n.target.files;if(p){const l=[...s.attachment],S=Array.from(p);l.push(...S),j(t,{...s,attachment:l})}}})}),e.jsx(C,{})]})}),e.jsx("div",{className:"mt-2",children:s.attachment&&s.attachment.length>0&&e.jsx("ul",{children:s.attachment.map((o,n)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsx("button",{type:"button",className:"text-red-500 ml-2",onClick:()=>{const p=s.attachment.filter((l,S)=>S!==n);j(t,{...s,attachment:p})},children:"Delete"})]},n))})})]})]})]})})})]},t)})]}),e.jsx(xt,{onClick:async()=>await xe(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:je&&e.jsx(_t,{workflowApproval:{approvalRequest:O.approvalRequest,approvalFrom:O.approvalFrom,acknowledgeFrom:O.acknowledgeFrom},workflowApprovalStep:O.approvalFromStatusRoute,workflowApprovalDiagram:O.approvalFrom})}),e.jsx(ve,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(at,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{js as ReimburseForm};
