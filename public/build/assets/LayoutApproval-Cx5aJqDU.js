import{q as g,r as t,j as e}from"./app-DvyzzxSE.js";import{F as R}from"./FormMapping-C9j5iCIr.js";import{u as q}from"./index.esm-C3NAE18-.js";import{a as F}from"./axiosInstance-7TOQb8kx.js";import{L as I}from"./page-DLUHrefR.js";import{L as M}from"./Loading-CS3ZVHOX.js";import{F as k}from"./formTextArea-D4NNHcec.js";import{D as B}from"./detailApproval-CTNIO1do.js";import{B as h}from"./Button-JuUrmme_.js";import{M as E}from"./TextField-ChRCuYiI.js";import{B as N}from"./Box-DfGe-I-z.js";const D={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",pt:2,px:4,pb:3},W=({id:i,children:j,type:p,status_id:d})=>{g();const{auth:r}=g().props,a=q({mode:"onChange",reValidateMode:"onChange"}),[b,c]=t.useState(!1),[y,L]=t.useState(!1),[V,m]=t.useState(!1),u=t.useCallback(async()=>{var l,v;c(!0);try{const n=(await F.get("/api/approval/route/getApproval?id="+i+"&type="+p)).data;a.reset(n.data.data);const _=(n.data??[]).map(s=>{var x;return((x=s.user.divisions)==null?void 0:x.name)||null}),w=(n.data??[]).map(s=>s.user.name),o=(n.data??[]).find(s=>s.is_status===!1);console.log(d,"status_id"),console.log(o==null?void 0:o.user_id,"firstFalseStatus?.user_id"),console.log((l=r==null?void 0:r.user)==null?void 0:l.id,"auth?.user?.id"),d!==4&&(o==null?void 0:o.user_id)===((v=r==null?void 0:r.user)==null?void 0:v.id)&&L(!0),a.setValue("approvalRequest",_),a.setValue("approvalFrom",w),a.setValue("approvalId",o==null?void 0:o.id),a.setValue("function_name",p.toLowerCase()),a.setValue("id",i)}catch{c(!1)}finally{c(!1)}},[a,i,p,d]);t.useEffect(()=>{u()},[u]);const C=()=>{m(!1),a.setValue("note",""),a.setValue("id_approval",""),a.setValue("status",""),a.setValue("type","")},f=l=>{m(!0),a.setValue("status",l)};return e.jsxs(e.Fragment,{children:[e.jsx(M,{isLoading:b}),e.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[y&&e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx(h,{variant:"contained",onClick:()=>f("Approved"),color:"primary",type:"button",children:"Approval"}),e.jsx(h,{onClick:()=>f("Rejected"),style:{marginLeft:"1rem"},variant:"contained",color:"error",type:"button",children:"Rejectd"})]})}),j,e.jsx(B,{methods:a}),e.jsx(E,{open:V,onClose:C,"aria-labelledby":"parent-modal-title","aria-describedby":"parent-modal-description",children:e.jsx(N,{sx:{...D,width:900},children:e.jsx(R,{isCustom:!0,formCustom:e.jsx(e.Fragment,{children:e.jsx(k,{fieldLabel:"note",fieldName:"note",isRequired:!0,requiredMessage:"",rows:20,style:{width:"100%"}})}),methods:a,url:"api/approval/approval_or_rejceted",redirectUrl:I})})})]})]})};export{W as L};
