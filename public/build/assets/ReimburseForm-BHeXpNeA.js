import{j as e,r as T,u as mt,X as ut}from"./app-Bycr8tKQ.js";import{B as dt}from"./button-hBtzT_BA.js";import{h as z}from"./moment-C5S46NFB.js";import{o as Re,a as ye,s as D,n as Ee,d as ke,c as Le,i as pt,t as ht}from"./types-BcsJ16vQ.js";import{f as X}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ft,F as R,a as E,b as k,c as L,I as Ae,f as gt,e as bt}from"./form-XnnTtyJM.js";import{u as _t,b as jt}from"./index.esm-DDhve534.js";import{T as Me}from"./textarea-DCGFwSPd.js";import{S as xt}from"./scroll-area-dbc4mhuR.js";import{a as Y}from"./axiosInstance-Co6017u2.js";import{S as Ve}from"./separator-Dx90MVoF.js";import{T as yt,a as wt,b as vt,c as Nt}from"./tabs-Dx6-0lEt.js";import{S as K,a as Q,b as U,c as ee,d as te}from"./select-BvVdWvE1.js";import{F as pe}from"./formDropdown-B6kQC8ud.js";import{C as Ie}from"./CustomDatePicker-Nd56hNU5.js";import{ReimburseFormType as j}from"./listModel-DlMzFRKj.js";import{u as se}from"./getDropdown-BRkyOdLH.js";import{G as Dt,a as $e,b as St}from"./api-BeRu2Z8X.js";import{L as Ft}from"./LoadingSpin-ChgwmI93.js";import{W as Ct}from"./WorkflowComponent-Bgg9m4CC.js";import{C as Tt}from"./CustomStatus-Dnm66Y7E.js";import{F as Be}from"./FormHelperText-CsdYez0q.js";import{B as qt}from"./Button-BXFfk-1G.js";import"./app-ffJwujpg.js";import"./index-CMf0X1kI.js";import"./index-DIbprYit.js";import"./utils-cye-aCGy.js";import"./createLucideIcon-1jYmlixx.js";import"./index-DM1k6IFn.js";import"./index-Bw2ZQJPq.js";import"./index-DpGeXYgZ.js";import"./index-BQqfm-GV.js";import"./index-DnWljKzJ.js";import"./index-BdQq_4o_.js";import"./index-Bc8xMsYM.js";import"./index-DmwskSXs.js";import"./index-BibyoJ1E.js";import"./index-gWzA4C8x.js";import"./index-DGn5Gsnk.js";import"./index-Dk2XxZVI.js";import"./index-CdDFQX5J.js";import"./TextField-CJtJGqLF.js";import"./createSvgIcon-CLx8jr4o.js";import"./DefaultPropsProvider-CZm9WMlE.js";import"./useSlot-Be6huamE.js";import"./createSimplePaletteValueFilter-WeojvOLK.js";import"./CircularProgress-h6EvkZOf.js";import"./mergeSlotProps-BihR6Tl2.js";function Rt({isLoading:H=!1,children:he}){return e.jsx("div",{className:"",children:H?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(Ft,{})})}):he})}const qs=({onSuccess:H,currencies:he,taxDefaultValue:we,uomDefaultValue:ve,edit_url:Ye,update_url:Pe,store_url:Oe,type:_,currentUser:V})=>{const[Ne,De]=T.useState("form1"),{showToast:A}=mt(),{errors:Et}=ut().props,{dataDropdown:ae,getDropdown:re}=se(Dt);se();const{dataDropdown:Ge,getDropdown:ze}=se(),{dataDropdown:ne,getDropdown:le}=se("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:oe,getDropdown:ie}=se("api/master/cost-center/dropdown-list"),[B,fe]=T.useState([]),[He,ge]=T.useState([]),[ce,We]=T.useState(null),[Se,Ze]=T.useState(!1),[Je,me]=T.useState(!1),[v,P]=T.useState([]),[kt,O]=T.useState([]),[Lt,At]=T.useState([]),be=T.useRef([]),W=T.useRef([]),[Z,Xe]=T.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ke=1*1024*1024,Qe=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],Ue=Re({formCount:D().min(1,"total form must be have value"),remark_group:D().min(1,"header remark is required"),cost_center:D().min(1,"cost center required"),requester:D().min(1,"requester required"),value:Ee().optional(),user_id:D().optional(),forms:ye(Re({reimburseId:D().optional(),for:D().optional(),group:D().optional(),reimburse_type:D().min(1,"reimburse type is required"),short_text:D().min(1,"remarks is required"),balance:D(),remaining_balance_when_request:Ee(),currency:D().min(1,"currency required"),tax_on_sales:D().min(1,"tax required"),purchase_requisition_unit_of_measure:D().min(1,"uom required"),purchasing_group:D().min(1,"Purchasing Group required"),type:Le(),item_delivery_data:ke(),claim_date:ke(),attachment:ye(pt(File).refine(s=>Qe.includes(s.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(s=>s.size<=Ke,{message:"File size must be less than 1MB"})).min(_===j.create?1:0,"Attachment is required"),savedAttachment:ye(Le()).optional().nullable()}))});T.useEffect(()=>{(async()=>{var n,m;(_===j.edit||_===j.clone)&&(me(!0),await et()),ze("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const t=Number(Ne.split("form")[1])-1;le("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(n=r.getValues("forms")[t])!=null&&n.purchasing_group?"id":"",value:((m=r.getValues("forms")[t])==null?void 0:m.purchasing_group)??""}}),ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),re("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&_===j.create&&J(0)})()},[_]);async function et(){var s,t;r.setValue("forms",[]),me(!0);try{const m=(await Y.get(Ye??"")).data.data,c=m.forms??[],d=m.group;We(d.reimbursementStatus),O(c.map(i=>String(i.id)));const g=c.map((i,f)=>{const{id:b,for:p,group:q,reimburse_type:y,short_text:S,balance:I,currency:$,tax_on_sales:F,purchase_requisition_unit_of_measure:w,remaining_balance_when_request:C,purchasing_group:l,type:a,item_delivery_data:o,claim_date:u,reimburse_attachment:h}=i,N=c.slice(f).filter(M=>M.for===p&&M.reimburse_type.code===y.code);be.current.push({id:String(b),reimburse_type:y.code,balance:N.reduce((M,ue)=>M+Number(ue.balance||0),0),limit:N.reduce(M=>M+1||0,0),for:String(p)});const G=W.current.findIndex(M=>M.reimburse_type===y.code&&M.for===String(p));return G!==-1?W.current[G].totalBalance=Number(W.current[G].totalBalance)+Number(I||0):W.current.push({reimburse_type:y.code,totalBalance:Number(I||0),for:String(p)}),{reimburseId:String(b),for:String(p),group:String(q),reimburse_type:y.code,short_text:S,balance:I,currency:$,tax_on_sales:String(F),purchase_requisition_unit_of_measure:String(w),remaining_balance_when_request:Number(C)||0,purchasing_group:String(l),type:a,item_delivery_data:new Date(o),claim_date:new Date(u),attachment:[],savedAttachment:h}});r.setValue("formCount",c.length.toString()),r.setValue("remark_group",d.remark),r.setValue("cost_center",String(d.cost_center.id)),r.setValue("requester",d.requester),r.setValue("forms",g);for(let i=0;i<c.length;i++){const f=c[i];await J(i,{reimburse_type:f.reimburse_type.code}),await Fe(i,{type:f.type,reimburse_type:f.reimburse_type.code}),await je(i,{reimburse_type:f.reimburse_type.code,for:f.reimburse_type.is_employee===1?null:f.for},!0)}me(!1)}catch(n){const m=n;me(!1),A((t=(s=m==null?void 0:m.response)==null?void 0:s.data)==null?void 0:t.message,"error")}}const tt={formCount:"1",remark_group:"",cost_center:"",requester:String(V==null?void 0:V.is_admin)==="1"?"":V==null?void 0:V.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:we,purchase_requisition_unit_of_measure:ve,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=_t({resolver:ht(Ue),defaultValues:tt}),{fields:_e,update:x}=jt({control:r.control,name:"forms"}),J=async(s,t=null)=>{const n=r.getValues("requester");if(n===null||n===""){fe(c=>{const d=[...c];return d[s]=[],d});return}const m=await Y.get($e,{params:{user:n,hasValue:t!=null?t.reimburse_type:null},headers:{"Content-Type":"application/json"}});fe(c=>{const d=[...c];return d[s]=m.data.data,d})},st=async(s,t)=>{if(s&&s.length>0)try{const n=await Y.get($e,{params:{search:s,user:r.getValues("requester")}});fe(m=>{const c=[...m];return c[t]=n.data.data,c})}catch(n){console.error("Error searching reimburse types:",n)}},Fe=async(s,t)=>{const n=await Y.get(St,{params:{user:r.getValues("requester"),familyRelationship:t.type=="Family"?"0":"1",reimburseType:t.reimburse_type},headers:{"Content-Type":"application/json"}});ge(m=>{const c=[...m];return c[s]=n.data.data,c})},at=s=>{for(let t=0;t<_e.length;t++)J(t);if(s==null)for(let t=0;t<_e.length;t++)r.setValue(`forms.${t}.reimburse_type`,""),r.setValue(`forms.${t}.for`,"");P([]),ge([])},Ce=(s,t)=>{const n=r.getValues("forms");n.forEach((m,c)=>{var d,g;if(c>s&&n[c].reimburse_type===t.reimburse_type){const i=((d=v[c])==null?void 0:d.balance)||0,f=((g=v[c])==null?void 0:g.limit)||0;P(b=>{var q;const p=[...b];return p[c]={...p[c],balance:i+Number(t.balance||"0")},((q=v[c])==null?void 0:q.type_limit)!=="Unlimited"&&(p[c]={...p[c],limit:f+1}),p}),r.setValue(`forms.${c}.balance`,"")}})};function rt(s){const t=[...r.getValues("forms")];for(let n=0;n<Number(s);n++)if(n+1>t.length){J(n);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:we,purchase_requisition_unit_of_measure:ve,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};t.push(m)}r.setValue("forms",t)}const nt=s=>{De(s)},lt=async s=>{var n,m,c,d,g;if(v)for(let i=0;i<v.length;i++){if(s.forms.length==0||s.forms.length-1,((n=v[i])==null?void 0:n.type_limit)!=="Unlimited"&&Number((m=v[i])==null?void 0:m.limit)==0){A("Claim Limit for form "+(i+1)+" is Empty, Please Contact the Admin","error");return}if(s.forms[i].balance==""||Number(s.forms[i].balance)==0){A("Claim Balance for form "+(i+1)+" cannot be 0","error");return}if(Number(((c=v[i])==null?void 0:c.balance)??0)<Number(s.forms[i].balance??0)){A("Please check your balance input for forms "+(i+1)+"  is not must be above "+((d=v[i])==null?void 0:d.balance),"error");return}s.forms=s.forms.map((f,b)=>{var p;return{...f,claim_date:z(f.claim_date).toDate(),item_delivery_data:z(f.item_delivery_data).toDate(),remaining_balance_when_request:Number(((p=v[b])==null?void 0:p.balance)??0)}})}const t=s.forms.reduce((i,f)=>i+Number(f.balance)||0,0);s.value=t,s.user_id=(s==null?void 0:s.requester)||"0";try{let i;_===j.edit||_===j.clone?i=await Y.post(Pe??"",s,{headers:{"Content-Type":"multipart/form-data"}}):i=await Y.post(Oe??"",s,{headers:{"Content-Type":"multipart/form-data"}}),A((g=i==null?void 0:i.data)==null?void 0:g.data,"success"),H==null||H()}catch{}};async function je(s,t=null,n=!1){var g,i,f;const m=r.getValues(`forms.${s}`);let c=!m.for||m.for===""?r.getValues("requester")||"":m.for;const d={user:r.getValues("requester"),reimbuse_type:t!=null?t.reimburse_type:m.reimburse_type,for:t!=null?t.for:c};try{const b=await Y.get("reimburse/data-limit-and-balance",{params:d}),p=r.getValues("forms");let q=0,y=0,S=b.data.data.balance,I=b.data.data.limit,$=(a=!1)=>p.filter((o,u)=>{let h=!o.for||o.for===""?r.getValues("requester")||"":o.for;return o.reimburse_type===m.reimburse_type&&h===c&&(_===j.clone&&n&&!a?!0:u!==s)}),F=$(!0).length,w=$().reduce((a,o)=>a+Number(o.balance||0),0);if(_===j.clone){let a=((g=W.current.find(o=>o.reimburse_type===m.reimburse_type&&o.for===c))==null?void 0:g.totalBalance)??0;if(S+=a,n){let o=be.current.find(u=>m.reimburseId==u.id);o&&(q=Number(o.balance),y=F+Number(o.limit),O(u=>{const h=[...u];return h[s]=o.id,h}))}else{let o=be.current.find(u=>u.reimburse_type===m.reimburse_type&&u.for===c);o!==void 0&&(y=Number(o.limit),O(u=>{const h=[...u];return h[s]=o.id,h}))}}let C=S-w+q,l=Math.max(0,I-F+y);P(a=>{const o=[...a];return o[s]={...b.data.data,balance:C,limit:b.data.data.type_limit==="Unlimited"?b.data.data.type_limit:l},o})}catch(b){const p=b;A((f=(i=p==null?void 0:p.response)==null?void 0:i.data)==null?void 0:f.message,"error")}}const Te=async()=>{var s,t,n,m,c,d,g,i,f,b,p,q;try{const y=r.getValues("forms"),S=y.map((w,C)=>({index:C,value:w.balance?Number(w.balance):0}));if(S.some(w=>w.value===0)){const w=S.findIndex(C=>C.value===0);A(`Please fill balance form ${w+1}`,"error");return}const $=y.reduce((w,C)=>w+(Number(C.balance)||0),0),F=await Y.get("/check-approval",{params:{value:$,requester:r.getValues("requester"),type:"REIM"}});if(F.data.status_code===200){const w=(t=(s=F.data)==null?void 0:s.data)==null?void 0:t.approval.map(u=>(u==null?void 0:u.division_name)||null),C=(m=(n=F.data)==null?void 0:n.data)==null?void 0:m.approval.map(u=>(u==null?void 0:u.name)||null),l=[];(d=(c=F.data)==null?void 0:c.data)!=null&&d.hr&&l.push((f=(i=(g=F.data)==null?void 0:g.data)==null?void 0:i.hr)==null?void 0:f.name);const a=(((b=F.data.data)==null?void 0:b.approval)??[]).map(u=>({status:"",name:u.name,dateApproved:""}));Xe({approvalRequest:w,approvalFrom:C,acknowledgeFrom:l,approvalFromStatusRoute:a}),Ze(!0)}}catch(y){const S=y;A((q=(p=S==null?void 0:S.response)==null?void 0:p.data)==null?void 0:q.message,"error")}};T.useEffect(()=>{r.getValues("forms").reduce((n,m)=>n+Number(m.balance)||0,0)>0&&Se===!0&&Te()},[r.watch("forms"),r.watch("requester")]);const ot=s=>{const t=s;if(Object.keys(t).length>0){let n=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(t).forEach(([m,c])=>{m==="forms"?c.forEach((d,g)=>{n+=`</br><strong>Form ${g+1}:</strong></br>`,Object.values(d).forEach(i=>{n+=`<li>${i.message}</li>`})}):n+=`<li>${c.message}</li>`}),n+="</ul>",A(e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),"error")}};return e.jsx(xt,{className:"h-[600px] w-full",children:e.jsx(Rt,{isLoading:Je,children:e.jsx(ft,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(lt,s=>{ot(s)}),children:[e.jsx("table",{className:"w-full mt-4 text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:ce&&e.jsx(Tt,{name:ce.name,className:ce.classname,code:ce.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:"remark_group",render:({field:s})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsx(Me,{placeholder:"Insert remark",...s})}),e.jsx(L,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(pe,{fieldLabel:"",options:oe,fieldName:"cost_center",disabled:_===j.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async s=>{const t=oe==null?void 0:oe.some(n=>n.label===s);s.length>0&&!t?await ie(s,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:s}):s.length==0&&!t&&ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const s=r.getValues("cost_center");ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:s?"id":"",value:s??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(pe,{options:ae,fieldName:"requester",disabled:String(V==null?void 0:V.is_admin)==="0"||_===j.edit,placeholder:"Select Employee",onSearch:(s,t)=>{const n=ae==null?void 0:ae.some(m=>m.label===s);s.length>0&&!n?re(s,{name:"name",id:"nip",tabel:"users",search:s}):s.length==0&&!n&&re("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:s=>at(s),onFocus:()=>{const s=r.getValues("requester");re("",{name:"name",id:"nip",tabel:"users",hasValue:{key:s?"nip":"",value:s??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:"formCount",render:({field:s})=>{var t;return e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(K,{disabled:_===j.edit,onValueChange:n=>{s.onChange(n),rt(n);const m=r.getValues("forms");let c=Number(n);if(m.length>c){const d=m.slice(0,c);r.setValue("forms",d),P(g=>{let i=[...g];return i=i.slice(0,c),i}),De(`form${Math.max(1,c)}`),O(g=>{const i=[...g];return i[c]="",i})}},value:(t=s.value)==null?void 0:t.toString(),children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"Select number of forms"})}),e.jsx(ee,{children:Array.from({length:3},(n,m)=>m+1).map(n=>e.jsx(te,{value:n.toString(),children:n},n))})]})}),e.jsx(L,{})]})}})})]})]})}),e.jsx(Ve,{className:"my-4"}),e.jsxs(yt,{value:Ne,onValueChange:nt,className:"w-full",children:[e.jsxs(wt,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:Number(r.watch("formCount"))||1}).map((s,t)=>e.jsxs(vt,{value:`form${t+1}`,children:["Form ",t+1]},t))]}),_e.map((s,t)=>{var n,m,c,d,g,i,f,b,p,q,y,S,I,$,F,w,C;return e.jsxs(Nt,{value:`form${t+1}`,children:[e.jsx(R,{control:r.control,name:`forms.${t}.reimburseId`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsx(Ae,{className:"sr-only",value:s.reimburseId,onChange:l.onChange})}),e.jsx(L,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(pe,{options:B[t],fieldName:`forms.${t}.reimburse_type`,disabled:B[t]===void 0||B[t].length===0||_===j.edit,placeholder:"Select Reimburse Type",onSearch:async l=>{var o;((o=B[t])==null?void 0:o.some(u=>u.label===l))||await st(l,t)},onChangeOutside:async l=>{if(l){const a=B[t].filter(u=>u.value==l)[0];x(t,{...s,reimburse_type:l,type:a.is_employee===1?"Employee":"Family",balance:""}),a.is_employee===1?je(t,{reimburse_type:l,for:null}):(P(u=>{const h=[...u];return h[t]=[],h}),r.setValue(`forms.${t}.balance`,""),r.setValue(`forms.${t}.for`,""),Fe(t,{type:"Family",reimburse_type:l}));const o=r.getValues(`forms.${t}.reimburse_type`);l!==o&&(O(u=>{const h=[...u];return h[t]="",h}),Ce(t,s))}else P(a=>{const o=[...a];return o[t]=[],o}),x(t,{...s,reimburse_type:"",type:"",balance:""}),O(a=>{const o=[...a];return o[t]="",o}),r.setValue(`forms.${t}.for`,""),ge(a=>{const o=[...a];return o[t]=[],o}),Ce(t,s)},onFocus:()=>{J(t)},classNames:"mt-2 w-full"}),((c=(m=(n=r.formState.errors)==null?void 0:n.forms)==null?void 0:m[t])==null?void 0:c.reimburse_type)&&e.jsx(Be,{error:!0,children:(f=(i=(g=(d=r.formState.errors)==null?void 0:d.forms)==null?void 0:g[t])==null?void 0:i.reimburse_type)==null?void 0:f.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${t}.for`,render:({field:l})=>{var a,o,u,h;return e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(K,{disabled:((u=(o=(a=B==null?void 0:B[t])==null?void 0:a.filter(N=>(N==null?void 0:N.value)==r.getValues(`forms.${t}.reimburse_type`)))==null?void 0:o[0])==null?void 0:u.is_employee)===1||_===j.edit,onValueChange:N=>{x(t,{...s,for:N}),je(t,{reimburse_type:r.getValues(`forms.${t}.reimburse_type`),for:N})},defaultValue:s==null?void 0:s.for,value:s.for,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:(h=He[t])==null?void 0:h.map(N=>e.jsx(te,{value:N.value.toString(),children:N.label},N.value))})]})}),e.jsx(L,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(pe,{fieldLabel:"",options:ne,fieldName:`forms.${t}.purchasing_group`,disabled:_===j.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:l=>{const a=ne==null?void 0:ne.some(o=>o.label===l);l.length>0&&!a?le(l,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:l}):l.length==0&&!a&&le("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:l=>{l&&x(t,{...s,purchasing_group:l})},onFocus:()=>{var a;const l=(a=r.getValues("forms")[t])==null?void 0:a.purchasing_group;le("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:l?"id":"",value:l??""}})}}),((q=(p=(b=r.formState.errors)==null?void 0:b.forms)==null?void 0:p[t])==null?void 0:q.purchasing_group)&&e.jsx(Be,{error:!0,children:($=(I=(S=(y=r.formState.errors)==null?void 0:y.forms)==null?void 0:S[t])==null?void 0:I.purchasing_group)==null?void 0:$.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${t}.tax_on_sales`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(K,{disabled:!0,onValueChange:a=>{x(t,{...s,tax_on_sales:a})},defaultValue:s.tax_on_sales,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:(Ge??[]).map((a,o)=>e.jsxs(te,{value:a.value.toString(),children:[a.description," - ",a.label]},a.value))})]})}),e.jsx(L,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${t}.purchase_requisition_unit_of_measure`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(K,{disabled:!0,onValueChange:a=>{x(t,{...s,purchase_requisition_unit_of_measure:String(a)})},defaultValue:s.purchase_requisition_unit_of_measure,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:e.jsx(te,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(L,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${t}.short_text`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsx(Me,{placeholder:"Insert remark",onChange:a=>{x(t,{...s,short_text:a.target.value})},defaultValue:s.short_text})}),e.jsx(L,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((F=v[t])==null?void 0:F.balance)&&X((w=v[t])==null?void 0:w.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(C=v[t])==null?void 0:C.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${t}.item_delivery_data`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsx(Ie,{disabled:_===j.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:a=>{z(a).format("YYYY-MM-DD")>=z(new Date).format("YYYY-MM-DD")?(l.onChange(a),x(t,{...s,item_delivery_data:a})):(l.onChange(l.value),x(t,{...s,item_delivery_data:l.value}),A("Receipt date cannot be less than today","error"))}})}),e.jsx(L,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${t}.claim_date`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsx(Ie,{disabled:_===j.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:a=>{z(a).format("YYYY-MM-DD")>=z(new Date).format("YYYY-MM-DD")?(l.onChange(a),x(t,{...s,claim_date:a})):(l.onChange(l.value),x(t,{...s,claim_date:l.value}),A("Claim date cannot be less than today","error"))}})}),e.jsx(L,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid w-full grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(R,{control:r.control,name:`forms.${t}.currency`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(k,{children:e.jsxs(K,{disabled:_===j.edit,onValueChange:a=>{x(t,{...s,currency:a})},defaultValue:s.currency,children:[e.jsx(Q,{className:"w-[200px]",children:e.jsx(U,{placeholder:"-"})}),e.jsx(ee,{children:he.map(a=>e.jsxs(te,{value:a.code,children:[a.name," (",a.code,")"]},a.code))})]})}),e.jsx(gt,{className:"h-6"}),e.jsx(L,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(R,{control:r.control,name:`forms.${t}.balance`,render:({field:l})=>{var a;return e.jsxs(E,{children:[e.jsx(k,{children:e.jsx(Ae,{type:"text",placeholder:"0",onChange:o=>{var ue;const u=o.target.value.replace(/[^0-9]/g,""),h=X(u,!1),N=Number(u)||0,G=((ue=v[t])==null?void 0:ue.balance)||0;if(N>G){o.target.value=X(u.slice(0,-1),!1);return}x(t,{...s,balance:u}),o.target.value=h,r.getValues("forms").forEach((qe,de)=>{if(de>t&&qe.reimburse_type===s.reimburse_type){const it=G-N;P(ct=>{const xe=[...ct];return xe[de]={...xe[de],balance:it},xe}),x(de,{...qe,balance:""})}})},defaultValue:X(s.balance,!1),value:X(s.balance,!1),disabled:typeof v[t]>"u"||((a=v[t])==null?void 0:a.length)===0||_===j.edit})}),e.jsx(L,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(R,{control:r.control,name:`forms.${t}.attachment`,render:({field:l})=>e.jsxs(E,{children:[e.jsx(bt,{className:"mb-1 text-xs text-gray-500 font-extralight",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(k,{children:e.jsx("input",{className:"flex w-full px-3 py-1 text-xs transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:a=>{const o=a.target.files;if(o){const u=[...s.attachment],h=Array.from(o);u.push(...h),x(t,{...s,attachment:u})}}})}),e.jsx(L,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[s.attachment&&s.attachment.length>0&&e.jsx("ul",{children:s.attachment.map((l,a)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:l.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const o=s.attachment.filter((u,h)=>h!==a);x(t,{...s,attachment:o})},children:"Delete"})]},a))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:s.savedAttachment&&s.savedAttachment.length>0&&e.jsx("ul",{children:s.savedAttachment.map((l,a)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:l.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const o=s.savedAttachment.filter((u,h)=>h!==a);x(t,{...s,savedAttachment:o})},children:"Delete"})]},a))})})]})]})]})]})})})]},t)})]}),e.jsx(qt,{onClick:async()=>await Te(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Se&&e.jsx(Ct,{workflowApproval:{approvalRequest:Z.approvalRequest,approvalFrom:Z.approvalFrom,acknowledgeFrom:Z.acknowledgeFrom},workflowApprovalStep:Z.approvalFromStatusRoute,workflowApprovalDiagram:Z.approvalFrom})}),e.jsx(Ve,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(dt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{qs as ReimburseForm};
