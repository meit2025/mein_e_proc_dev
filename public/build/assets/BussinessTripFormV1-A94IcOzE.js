import{r as g,u as Ae,j as e,b as De}from"./app-8nahd-A9.js";/* empty css              */import{d as Te,F as b,a as w,b as N,c as y}from"./form-CDoyko7Z.js";import{u as Se,b as Z,a as Ce,c as K}from"./index.esm-BS3im41X.js";import{S as Fe,a as $e,b as Ee,c as Re,d as qe}from"./select-IFpnaU8J.js";import{S as ie}from"./separator-C4Wbm0tC.js";import{T as ke}from"./textarea-DV5U70nh.js";import{I as D}from"./input-DkYM-WHN.js";import{T as Ve,a as Ye,b as Pe,c as Ie}from"./tabs-C-COXgp7.js";import{z as o,t as Me}from"./index-C3VIvdyo.js";import{S as Be}from"./scroll-area-CJnZxlmw.js";import{C as Oe,E as Le,G as Ge,b as Xe}from"./api-DtjMnnyq.js";import{BusinessTripType as H}from"./models-BNDw-483.js";import{a as oe}from"./axiosInstance-CrB0XC69.js";import{h as R}from"./moment-C5S46NFB.js";import{F as Je}from"./formSwitchCustom-DcUCHqZh.js";import{B as Q}from"./button-hGnXI8kH.js";import{d as ce}from"./index-BCe81Io-.js";import{W as Ue}from"./WorkflowComponent-BP9-VYgd.js";import{F as We}from"./formDropdown-BuOUiBet.js";import{u as de}from"./getDropdown-CwJkQ1nH.js";import{f as Y}from"./rupiahCurrencyFormat-CP-6egij.js";import{B as ze}from"./Button-B4mWnI9L.js";import{C as He}from"./chevrons-up-down-CEHSC1iE.js";import"./app-DQK4SJPx.js";import"./index-CtM9Ks6H.js";import"./utils-aaSTLp9F.js";import"./index-BtsXpp7k.js";import"./index-D9qd2mFM.js";import"./index-Bb4qSo10.js";import"./index-C5Dj8x-C.js";import"./index-Cd_IUgyT.js";import"./index-C9Mn9BjT.js";import"./index-BZSTd1uE.js";import"./Combination-DXRv4v73.js";import"./index-BaeEgRl7.js";import"./index-R7QpfXH5.js";import"./index-CJ2f1Q78.js";import"./CustomStatus-70m5l053.js";import"./createLucideIcon-P-wiMs9f.js";import"./Switch-B5uq5z37.js";import"./createSimplePaletteValueFilter-DcBpmCHr.js";import"./DefaultPropsProvider-3WGLUnav.js";import"./SwitchBase-CuiKqGSf.js";import"./FormHelperText-02yH-eGU.js";import"./useControlled-DW4cIljh.js";import"./createSvgIcon-HgCfs2Oj.js";import"./TextField-DcO0KIU4.js";import"./useSlot-DzmCO4Ej.js";const Ze=1*1024*1024,Ke=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],rs=({type:r,id:s})=>{var re;const d=o.object({request_no:o.string().nonempty("Request for required"),remark:o.string().nonempty("Remark is required"),attachment:o.array(o.instanceof(File).refine(a=>Ke.includes(a.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(a=>a.size<=Ze,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:o.number().int("Total Destinantion Required"),cash_advance:o.boolean().nullable().optional(),reference_number:o.string().nullable().optional(),total_cash_advance:o.string().nullable().optional(),destinations:o.array(o.object({destination:o.string().nonempty("Destinantion Required"),business_trip_start_date:o.date().optional(),business_trip_end_date:o.date().optional(),detail_attedances:o.array(o.object({date:o.string().optional(),shift_code:o.string().optional(),shift_start:o.string().optional(),shift_end:o.string().optional(),start_time:o.string().optional(),end_time:o.string().optional(),request_start_time:o.string().optional(),request_end_time:o.string().optional()})),allowances:o.array(o.object({name:o.string().optional(),code:o.string().optional(),default_price:o.string().optional(),type:o.string().optional(),currency:o.string().optional(),subtotal:o.number().optional(),detail:o.array(o.object({date:o.string().nullish(),request_price:o.number().optional()}))})),other:o.array(o.object({value:o.number().optional()}))}))}),n=Se({resolver:Me(d),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),S=(a,h)=>{var t;return a.type==="total"?parseFloat(((t=h==null?void 0:h[0])==null?void 0:t.request_price)||0):h==null?void 0:h.reduce((i,v)=>i+parseFloat(v.request_price||0),0)},_=()=>{const a=n.getValues("destinations");n.getValues("destinations.0.other");const h=a.reduce((i,v,$)=>{const P=(v.allowances||[]).reduce((I,J,M)=>{const V=n.getValues(`destinations.${$}.allowances.${M}.detail`),z=S(J,V);return I+z},0);return i+P},0);let t=0;try{t=a.reduce((i,v,$)=>{const P=(v.other||[]).reduce((I,J,M)=>{const V=n.getValues(`destinations.${$}.other.${M}.value`);return I+(V===void 0?0:V)},0);return i+P},0)}catch(i){console.log(i),t=0}return h+t},[u,c]=g.useState(!1),{showToast:A}=Ae(),[f,x]=g.useState(!1),m=async a=>{var h;try{if(x(!0),r===H.create){const t=_(),i=new FormData;i.append("user_id",((h=l.request_for)==null?void 0:h.id.toString())??""),i.append("value",t.toString()),i.append("request_no",a.request_no??""),i.append("remark",a.remark??""),a.attachment.forEach((v,$)=>{v&&i.append(`attachment[${$}]`,v)}),i.append("total_destination",`${a.total_destination}`),a.destinations.forEach((v,$)=>{i.append(`destinations[${$}]`,JSON.stringify(v))}),await ce.Inertia.post(Oe,i,{headers:{"Content-Type":"multipart/form-data"}}),A("succesfully created data","success")}else{const t=new FormData;t.append("remark",a.remark??""),a.attachment.forEach((i,v)=>{i&&t.append(`attachment[${v}]`,i)}),ae.forEach((i,v)=>{i&&t.append(`file_existing[${v}]`,JSON.stringify(i))}),await ce.Inertia.post(`${Le}/${s}`,t,{headers:{"Content-Type":"multipart/form-data"}}),A("succesfully updated data","success")}setTimeout(()=>{x(!1)},1e3)}catch(t){console.log(t)}},[l,p]=g.useState([]),[j,q]=g.useState([]),[F,C]=g.useState([]),[k,L]=g.useState(!1);async function G(a){n.setValue("request_no",a||"");const h=Ge(a);try{const t=await oe.get(h),i=t.data.data;L(i.cash_advance==1),n.setValue("remark",i.remarks||""),n.setValue("total_destination",i.total_destination||1),n.setValue("cash_advance",i.cash_advance==1),n.setValue("reference_number",i.reference_number),n.setValue("total_percent",i.total_percent),n.setValue("total_cash_advance",Y(i.total_cash_advance,!1)),p(t.data.data),C(i.destinations),U(i.total_destination),T(i.destinations)}catch(t){console.log(t)}}const[ee,U]=g.useState(""),te=a=>{U(a)};function T(a){const h=a.map(t=>({destination:t.destination||"",pajak:t.pajak||"",purchasing_group:t.purchasing_group||"",business_trip_start_date:new Date(t.business_trip_start_date),business_trip_end_date:new Date(t.business_trip_end_date),allowances:t.allowances||[],detail_attedances:t.detail_attedances||[],total_allowance:t.total_allowance||0,other:t.other||[]}));n.setValue("destinations",h)}const{fields:se,append:rt,remove:lt,update:pe}=Z({control:n.control,name:"destinations"});g.useEffect(()=>{},[l,ee]);const[it,he]=g.useState(0),[me,ue]=g.useState(!1),[X,xe]=g.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),je=async()=>{var a,h,t,i,v,$,W,P,I,J,M,V,z;try{const B=_();if(B===0){A("Please fill the balance","error");return}const O=await oe.get("/check-approval",{params:{value:B,user_id:((a=l.request_for)==null?void 0:a.id)??"",type:"TRIP_DECLARATION"}});if(O.data.status_code===200){const we=(t=(h=O.data)==null?void 0:h.data)==null?void 0:t.approval.map(E=>(E==null?void 0:E.division_name)||null),Ne=(v=(i=O.data)==null?void 0:i.data)==null?void 0:v.approval.map(E=>(E==null?void 0:E.name)||null),le=[];(W=($=O.data)==null?void 0:$.data)!=null&&W.hr&&le.push((J=(I=(P=O.data)==null?void 0:P.data)==null?void 0:I.hr)==null?void 0:J.name);const ye=(((M=O.data.data)==null?void 0:M.approval)??[]).map(E=>({status:"",name:E.name,dateApproved:""}));xe({approvalRequest:we,approvalFrom:Ne,acknowledgeFrom:le,approvalFromStatusRoute:ye}),ue(!0)}}catch(B){A((z=(V=B==null?void 0:B.response)==null?void 0:V.data)==null?void 0:z.message,"error")}},{dataDropdown:fe,getDropdown:ge}=de(),{dataDropdown:ot,getDropdown:_e}=de();g.useEffect(()=>{ge("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[n.watch("destinations")]);const[ae,ne]=g.useState([]);async function ve(){n.setValue("destinations",[]);const a=Xe(s),t=(await De.get(a)).data.data;await G(t.parent_id.toString()),ne(t.attachments)}g.useEffect(()=>{s&&r==H.clone&&(ve(),_e("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[r]);const be=a=>{ne(h=>h.filter(t=>t.id!==a))};return e.jsx(Be,{className:"h-[600px] w-full ",children:e.jsx(Te,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(m),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:fe,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:a=>{G(a)}})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:l.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:l.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(re=l==null?void 0:l.cost_center)==null?void 0:re.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(b,{control:n.control,name:"remark",render:({field:a})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(ke,{placeholder:"Insert remark",...a,rows:4,className:"w-[300px]"})}),e.jsx(y,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(b,{control:n.control,name:"attachment",render:({field:a})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:h=>{const t=h.target.files;if(t){const i=Array.from(t);a.onChange(i)}else a.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((h,t)=>e.jsx("span",{children:h.message},t)):n.formState.errors.attachment.message})]})})})]}),ae.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ae.map((a,h)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:a.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:a.file_name},h),e.jsx("button",{type:"button",onClick:()=>be(a.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(b,{control:n.control,name:"total_destination",render:({field:a})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsxs(Fe,{value:ee,onValueChange:te,disabled:!0,children:[e.jsx($e,{className:"w-[200px] py-2",children:e.jsx(Ee,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Re,{children:Array.from({length:5},(h,t)=>e.jsxs(qe,{value:(t+1).toString(),children:[" ",t+1," "]},t))})]})}),e.jsx(y,{})]})})]})]})]}),e.jsx(ie,{className:"my-4"}),e.jsx(Qe,{updateDestination:pe,destinationField:se,form:n,listAllowances:j,totalDestination:n.getValues("total_destination").toString(),setTotalAllowance:he,businessTripDetail:l,type:r,btEdit:H.edit,setIsCashAdvance:L,isCashAdvance:k,setOtherAllowance:c,otherAllowance:u}),e.jsx(ie,{className:"my-4"}),e.jsx(ze,{onClick:async()=>await je(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:me&&e.jsx(Ue,{workflowApproval:{approvalRequest:X.approvalRequest,approvalFrom:X.approvalFrom,acknowledgeFrom:X.acknowledgeFrom},workflowApprovalStep:X.approvalFromStatusRoute,workflowApprovalDiagram:X.approvalFrom})}),e.jsx(Q,{type:"submit",loading:f,children:"submit"})]})})})};function Qe({totalDestination:r,listAllowances:s,form:d,destinationField:n,updateDestination:S,setTotalAllowance:_,businessTripDetail:u,type:c,btEdit:A,setIsCashAdvance:f,isCashAdvance:x,setOtherAllowance:m,otherAllowance:l}){return e.jsxs(Ve,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ye,{className:"flex items-center justify-start space-x-4",children:n.map((p,j)=>e.jsxs(Pe,{value:`destination${j+1}`,children:["Destination ",j+1]}))}),n.map((p,j)=>e.jsx(et,{listAllowances:s,updateDestination:S,destination:p,form:d,index:j,setTotalAllowance:_,businessTripDetail:u,type:c,btEdit:H.edit,setIsCashAdvance:f,isCashAdvance:x,setOtherAllowance:m,otherAllowance:l}))]})}function et({form:r,index:s,destination:d,updateDestination:n,listAllowances:S,setTotalAllowance:_,businessTripDetail:u,type:c,btEdit:A,setIsCashAdvance:f,isCashAdvance:x,setOtherAllowance:m,otherAllowance:l}){const{fields:p,update:j,append:q,remove:F}=Z({control:r.control,name:`destinations[${s}].detail_attedances`}),{fields:C,update:k,append:L,remove:G,replace:ee}=Z({control:r.control,name:`destinations[${s}].allowances`}),U=T=>{f(T)};Ce(),K({control:r.control,name:"total_percent"});const te=u.total_cash_advance;return g.useEffect(()=>{},[te]),e.jsxs(Ie,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:d.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:d==null?void 0:d.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:d==null?void 0:d.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:R(d.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:R(d.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(tt,{detailAttedanceFields:p,form:r,updateAttedanceFields:j,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(st,{allowanceField:C,destinationIndex:s,form:r,setOtherAllowance:m,otherAllowance:l})]},s),e.jsx(nt,{allowanceField:C,destinationIndex:s,form:r,setTotalAllowance:_}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Je,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:T=>U(T.target.checked)})})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(b,{control:r.control,name:"reference_number",render:({field:T})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{value:T.value||"",onChange:se=>T.onChange(se.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(y,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(b,{control:r.control,name:"total_percent",render:({field:T})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{...T,value:T.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(y,{})]})}),e.jsx(b,{control:r.control,name:"total_cash_advance",render:({field:T})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{value:T.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(y,{})]})})]})]})]})]})]})}function tt({form:r,destinationIndex:s,detailAttedanceFields:d,updateAttedanceFields:n}){const S=r.watch(`destinations[${s}].detail_attedances`);return g.useEffect(()=>{},[S]),g.useEffect(()=>{},[d]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:S.map((_,u)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[R(_.date).format("DD/MM/YYYY"),e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.date`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:R(c.value).format("YYYY-MM-DD"),onChange:c.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsxs("td",{children:[_.shift_code,e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.shift_code`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:R(c.value).format("YYYY-MM-DD"),onChange:c.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsxs("td",{children:[_.shift_start,e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.shift_start`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:R(c.value).format("YYYY-MM-DD"),onChange:c.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsxs("td",{children:[_.shift_end,e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.shift_end`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:R(c.value).format("YYYY-MM-DD"),onChange:c.onChange,type:"hidden"})}),e.jsx(y,{})]})})]}),e.jsx("td",{children:e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.start_time`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:c.value,onChange:c.onChange})}),e.jsx(y,{})]})})}),e.jsx("td",{children:e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.end_time`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:c.value,onChange:c.onChange})}),e.jsx(y,{})]})})}),e.jsx("td",{children:e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.request_start_time`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:c.value,onChange:c.onChange})}),e.jsx(y,{})]})})}),e.jsx("td",{children:e.jsx(b,{control:r.control,name:`destinations.${s}.detail_attedances.${u}.request_end_time`,render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{defaultValue:c.value,onChange:c.onChange})}),e.jsx(y,{})]})})})]},_.index))})]})})})]})}function st({form:r,destinationIndex:s,allowanceField:d,setOtherAllowance:n,otherAllowance:S}){const _=r.watch(`destinations[${s}].allowances`);g.useEffect(()=>{},[_]);const{fields:u,append:c,remove:A}=Z({control:r.control,name:`destinations.${s}.other`}),f=K({control:r.control,name:`destinations.${s}.other`}),x=()=>(f||[]).reduce((l,p)=>{const j=Number(p==null?void 0:p.value)||0;return isNaN(j)?l:l+j},0),m=()=>{c({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[_.map((l,p)=>e.jsx(at,{form:r,allowance:l,destinationIndex:s,allowanceIndex:p})),u.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(Q,{type:"button",className:"text-xl",onClick:m,children:"+"})})}),u.map((l,p)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{control:r.control,name:`destinations.${s}.other[${p}].value`,render:({field:j})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{min:"0",value:j.value??"",onChange:q=>{const F=q.target.value.trim();if(F===""){j.onChange(void 0);return}console.log(F,"value");const C=Number(F);!isNaN(C)&&C>=0&&j.onChange(C)}})}),e.jsx(y,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",Y(x(),!1)]})})}),e.jsx("td",{children:e.jsx(Q,{type:"button",className:"text-xs",onClick:()=>A(p),children:"X"})})]},p))]})}function at({form:r,allowance:s,destinationIndex:d,allowanceIndex:n}){const[S,_]=g.useState(!1);g.useState(0);const u=m=>{_(l=>!l)},c=K({control:r.control,name:`destinations[${d}].allowances[${n}].detail[0].request_price`}),A=K({control:r.control,name:`destinations[${d}].allowances[${n}].detail`}),f=()=>{if(s.type==="total")return parseFloat(c||0)*1;{let m=0;return A==null||A.forEach(l=>{const p=parseFloat(l.request_price||0);m+=p}),m}},x=(m,l)=>{const p=parseFloat(l),j=isNaN(p)?0:p,q=s.request_value;let F=!0;switch(q){case"unlimited":F=!0;break;case"fixed value":const C=s.default_price;j!==C&&(alert(`Please enter the fixed value of IDR ${C}`),F=!1);break;case"up to max value":const k=s.default_price;j>k&&(alert(`The value should not exceed IDR ${k}`),F=!1);break;default:F=!1}if(F){r.setValue(`destinations[${d}].allowances[${n}].detail[${m}].request_price`,j);const k=r.getValues(`destinations[${d}].allowances[${n}].detail`).reduce((L,G)=>L+(parseFloat(G.request_price)||0),0);r.setValue(`destinations[${d}].allowances[${n}].subtotal`,k)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{control:r.control,name:`destinations[${d}].allowances[${n}].detail[0].request_price`,render:({field:m})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{value:m.value,onChange:l=>x(0,l.target.value)})}),e.jsx(y,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",Y(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",Y(f(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>u(),children:e.jsxs(Q,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),S&&e.jsx(e.Fragment,{children:s.detail.map((m,l)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:R(m.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(b,{control:r.control,name:`destinations[${d}].allowances[${n}].detail[${l}].request_price`,render:({field:p})=>e.jsxs(w,{children:[e.jsx(N,{children:e.jsx(D,{value:p.value,onChange:j=>x(l,j.target.value)})}),e.jsx(y,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},m.id))})]})}function nt({allowanceField:r,destinationIndex:s,form:d,setTotalAllowance:n}){const[S,_]=g.useState(0),u=d.watch(`destinations.${s}.other`),c=d.watch(`destinations[${s}].allowances`);g.useEffect(()=>{const f=c.reduce((m,l,p)=>{const j=d.getValues(`destinations.${s}.allowances.${p}.detail`),q=A(l,j);return m+q},0),x=(u||[]).reduce((m,l)=>{const p=Number(l==null?void 0:l.value)||0;return m+p},0);console.log(u,"other"),_(f+x)},[c,d.watch()]);const A=(f,x)=>{var m;return f.type==="total"?parseFloat(((m=x==null?void 0:x[0])==null?void 0:m.request_price)||0):x==null?void 0:x.reduce((l,p)=>l+parseFloat(p.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsxs("tbody",{children:[c.map((f,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:f.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:Y(f.subtotal)})]})]},f.id)),u.length>0&&e.jsx(e.Fragment,{children:u.map((f,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:"Other Allowance"}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:f!=null&&f.value?Y(f.value):"0"})]})]},x))})]}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:Y(S)})]})]})})]})})}export{at as AllowanceRowInput,Qe as BussinesTripDestination,et as BussinessDestinationForm,rs as BussinessTripFormV1,st as DetailAllowance,tt as DetailAttedances,nt as ResultTotalItem};
