import{j as e,r as j,u as ge,b as Ee}from"./app-CW5Vjafz.js";import{F as Pe,a as _,b as f,c as g,d as w,e as Ve}from"./form-DNr-Xzli.js";import{z as o,t as qe}from"./index-BDilC-fl.js";import{d as me}from"./index-E7KBXpVs.js";import{B as oe}from"./button-u21x2gGS.js";import{T as ke}from"./textarea-CTxCObbZ.js";import{a as Ie,C as Re,u as Me,b as ne,c as Q}from"./index.esm-C-voK3pQ.js";import{S as Be}from"./scroll-area-OH-1RTsc.js";import{S as je}from"./separator-JwelSZcj.js";/* empty css              */import{T as Ge,a as Le,b as Oe,c as Xe}from"./tabs-MjomPeEM.js";import{a as K}from"./axiosInstance-DNepBn60.js";import{C as _e}from"./CustomDatePicker-7vl99viD.js";import{W as ze}from"./WorkflowComponent-BFmT9Q3k.js";import{S as Ue}from"./Switch-BqVt995g.js";import{F as We}from"./FormHelperText-BfbNPFYF.js";import{I as V}from"./input-GfoZK8Se.js";import{S as I,a as R,b as M,c as B,d as P}from"./select-V_YALxAf.js";import{C as He,E as Je,b as Ke}from"./api-B9TTe-Ow.js";import{G as Ze,a as Qe}from"./api-BEQetkWJ.js";import{h as F}from"./moment-C5S46NFB.js";import{BusinessTripType as Z}from"./models-C8DpbRZ4.js";import{b as fe}from"./api-Cpn27s-b.js";import{B as et}from"./Button-Qnk2p3fb.js";import{C as tt}from"./chevrons-up-down-Dhck91Sn.js";import"./index-DHs0rYFQ.js";import"./utils-vqPlOEeV.js";import"./index-DwevZg1a.js";import"./index-Bvxg179C.js";import"./index-BWbVQm43.js";import"./index-KDSzK3Cx.js";import"./index-BFKFkSa_.js";import"./index-wt5448KZ.js";import"./popover-p3iK27ul.js";import"./Combination-7Mxyrlsl.js";import"./createLucideIcon-C6QbRlk7.js";import"./createSvgIcon-D9qEiy8M.js";import"./DefaultPropsProvider-D49i8fq7.js";import"./createSimplePaletteValueFilter-CvpCobMd.js";import"./SwitchBase-CBD6bO0X.js";import"./useControlled-BLsRcCL3.js";import"./index-CKoV7kD3.js";import"./CustomStatus-DmOlwXHk.js";const st=({fieldLabel:l,fieldName:a,isRequired:i=!1,disabled:p=!1,style:y,requiredMessage:u,classNames:h,defaultChecked:r=!1,note:x,onChanges:N})=>{var n;const{control:S,formState:{errors:d}}=Ie();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[l&&e.jsxs("label",{className:"form-label max-w-32",children:[l," ",e.jsxs("span",{className:"text-red-700",children:[" ",i?"*":""]})]}),e.jsx(Re,{name:a,control:S,rules:{required:i?u??`${l} is required`:!1},render:({field:D})=>e.jsx("div",{style:y,className:h,children:e.jsx(Ue,{...D,checked:!!(D.value??r),onChange:Y=>{D.onChange(Y),N&&N(Y)},disabled:p})})}),e.jsx("span",{children:x})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),d[a]&&e.jsx(We,{error:!0,children:String((n=d[a])==null?void 0:n.message)})]})]})};o.object({remark:o.string().min(1).max(50),reimburse_cost:o.number()});const at=1*1024*1024,nt=["image/jpeg","image/png","application/pdf"],ns=({users:l,listPurposeType:a,pajak:i,costcenter:p,purchasingGroup:y,type:u,id:h,isAdmin:r,idUser:x})=>{const N=o.object({purpose_type_id:o.string().min(1,"Purpose type required"),request_for:o.string().min(1,"Request is required"),cost_center_id:o.string().min(1,"Cost Center is required"),remark:o.string().min(1,"Remark is required"),attachment:o.array(o.instanceof(File).refine(s=>nt.includes(s.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(s=>s.size<=at,{message:"File size must be less than 1MB"})),total_destination:o.number().min(1,"Total Destinantion Required"),cash_advance:o.boolean().nullable().optional(),reference_number:o.string().nullable().optional(),total_percent:o.string().nullable().optional(),total_cash_advance:o.string().nullable().optional(),destinations:o.array(o.object({destination:o.string().min(1,"Destinantion is Required"),pajak_id:o.string().min(1,"Pajak is required"),purchasing_group_id:o.string().min(1,"Purchasing Group is required"),business_trip_start_date:o.date().optional(),business_trip_end_date:o.date().optional(),detail_attedances:o.array(o.object({date:o.date().optional(),shift_code:o.string().optional(),shift_start:o.string().optional(),shift_end:o.string().optional(),start_time:o.string().optional(),end_time:o.string().optional()})),allowances:o.array(o.object({name:o.string().optional(),code:o.string().optional(),default_price:o.number().optional(),type:o.string().optional(),subtotal:o.number().optional(),currency:o.string().optional(),detail:o.array(o.object({date:o.date().nullish(),request_price:o.any().optional()}))}))}))}),[S,d]=j.useState("1"),n=Me({resolver:qe(N),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[D,Y]=j.useState([]);async function ee(){const s=Ke(h);n.setValue("destinations",[]);try{const c=(await Ee.get(s)).data.data,b=fe(c.purpose_type_id),$=await K.get(b);X($.data.data),Y(c.attachments),n.setValue("purpose_type_id",c.purpose_type_id.toString()),n.setValue("request_for",c.request_for.id.toString()),n.setValue("cost_center_id",c.cost_center_id.toString()),n.setValue("remark",c.remarks),n.setValue("total_destination",c.total_destination),n.setValue("cash_advance",c.cash_advance==1),n.setValue("reference_number",c.reference_number),n.setValue("total_percent",c.total_percent),n.setValue("total_cash_advance",c.total_cash_advance),n.setValue("destinations",c.destinations.map(C=>({destination:C.destination,pajak_id:C.pajak_id,purchasing_group_id:C.purchasing_group_id,business_trip_start_date:new Date(C.business_trip_start_date),business_trip_end_date:new Date(C.business_trip_end_date),detail_attedances:C.detail_attedances.map(v=>({...v,date:new Date(v.date)})),allowances:C.allowances.map(v=>({...v,default_price:parseInt(v.default_price),subtotal:parseInt(v.subtotal),detail:v.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?new Date(T.date):null}))}))})))}catch{}}const[z,U]=j.useState([]),[W,X]=j.useState([]),[E,m]=j.useState(""),[re,le]=j.useState(r==="0"?x.toString():"");async function A(s){n.setValue("purpose_type_id",s||"");const t=r=="0"?x||"":re||"",c=Ze(s,t),b=fe(s),$=Qe(s);try{const C=await K.get(c),v=await K.get(b),L=(await K.get($)).data.data.purpose.type;L=="international"&&q("1"),m(L),U(C.data.data),X(v.data.data)}catch(C){console.log(C)}}const q=s=>{n.setValue("total_destination",parseInt(s,10)),d(s),ce()},{showToast:G}=ge(),te=async s=>{try{const t=new FormData,c=ie();t.append("user_id",s.request_for??""),t.append("value",c.toString()),t.append("purpose_type_id",s.purpose_type_id??""),t.append("request_for",s.request_for??""),t.append("cost_center_id",s.cost_center_id??""),t.append("remark",s.remark??""),t.append("reference_number",`${s.reference_number}`),t.append("cash_advance",`${s.cash_advance}`),t.append("total_percent",`${s.total_percent}`),t.append("total_cash_advance",`${s.total_cash_advance}`),s.attachment.forEach((b,$)=>{b&&t.append(`attachment[${$}]`,b)}),t.append("total_destination",`${s.total_destination}`),s.destinations.forEach((b,$)=>{const C={...b,business_trip_start_date:F(b.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:F(b.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:b.detail_attedances.map(v=>({...v,date:F(v.date).format("YYYY-MM-DD")})),allowances:b.allowances.map(v=>({...v,detail:v.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?F(T.date).format("YYYY-MM-DD"):null}))}))};t.append(`destinations[${$}]`,JSON.stringify(C))}),u==Z.create?(await me.Inertia.post(He,t,{headers:{"Content-Type":"multipart/form-data"}}),G("succesfully created data","success")):(await me.Inertia.post(`${Je}/${h}`,t,{headers:{"Content-Type":"multipart/form-data"}}),G("succesfully updated data","success"))}catch(t){console.log(t)}};function ce(){const s=[],t=parseInt(S);for(let c=0;c<t;c++)s.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});n.setValue("destinations",s)}const{fields:be,append:ut,remove:ht,update:we}=ne({control:n.control,name:"destinations"});j.useEffect(()=>{console.log(Z.edit," business edit"),console.log(u," id type"),h&&u==Z.edit&&ee()},[]),j.useEffect(()=>{u==Z.create&&ce()},[S,z,h,u,r,x]);const[ve,ye]=j.useState(!1),[H,Se]=j.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),De=(s,t)=>{var c;return s.type==="total"?parseFloat(((c=t==null?void 0:t[0])==null?void 0:c.request_price)||0):t==null?void 0:t.reduce((b,$)=>b+parseFloat($.request_price||0),0)},ie=()=>n.getValues("destinations").reduce((c,b,$)=>{const v=(b.allowances||[]).reduce((T,L,se)=>{const ae=n.getValues(`destinations.${$}.allowances.${se}.detail`),k=De(L,ae);return T+k},0);return c+v},0),de=async()=>{var s,t,c,b,$,C,v,T,L,se,ae;try{const k=ie();if(k===0){G("Please fill the balance","error");return}const J=await K.get("/check-approval",{params:{value:k,user_id:n.getValues("request_for"),type:"TRIP"}});if(J.data.status_code===200){const Fe=(t=(s=J.data)==null?void 0:s.data)==null?void 0:t.approval.map(O=>(O==null?void 0:O.division_name)||null),Ye=(b=(c=J.data)==null?void 0:c.data)==null?void 0:b.approval.map(O=>(O==null?void 0:O.name)||null),xe=[];(C=($=J.data)==null?void 0:$.data)!=null&&C.hr&&xe.push((L=(T=(v=J.data)==null?void 0:v.data)==null?void 0:T.hr)==null?void 0:L.name),Se({approvalRequest:Fe,approvalFrom:Ye,acknowledgeFrom:xe}),ye(!0)}}catch(k){G((ae=(se=k==null?void 0:k.response)==null?void 0:se.data)==null?void 0:ae.message,"error")}};j.useEffect(()=>{ie()>0&&de()},[n.watch("destinations")]),j.useState([]);const Ce=s=>{Y(t=>t.filter(c=>c.id!==s))},[Te,pe]=j.useState(!1),Ne=s=>{pe(s)},ue=Q({control:n.control,name:"total_percent"}),[Ae,$e]=j.useState(0),he=Ae;return j.useEffect(()=>{u==Z.edit&&pe(n.getValues("cash_advance")??!1);const t=parseFloat((ue||"0").toString())/100*he;n.setValue("total_cash_advance",t.toFixed(0))},[ue,he]),e.jsx(Be,{className:"h-[600px] w-full ",children:e.jsx(Pe,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(te),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:"request_for",render:({field:s})=>(r==="0"&&!s.value&&s.onChange(x.toString()),e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:t=>{le(t),s.onChange(t)},value:s.value,disabled:r==="0",children:[e.jsx(R,{className:"w-[200px] py-2",children:e.jsx(M,{placeholder:"-- Select Business Purpose Type --"})}),e.jsx(B,{children:r==="1"?l.map(t=>e.jsx(P,{value:t.id.toString(),children:t.name},t.id)):l.filter(t=>t.id===x).map(t=>e.jsx(P,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(w,{})]}))})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:n.control,name:"purpose_type_id",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:t=>A(t),value:s.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Bussiness Purpose Type --"})}),e.jsx(B,{children:a.map(t=>e.jsx(P,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:n.control,name:"cost_center_id",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:t=>s.onChange(t),value:s.value,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Cost Center --"})}),e.jsx(B,{children:p.map(t=>e.jsx(P,{value:t.id.toString(),children:t.cost_center},t.id))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:"remark",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(ke,{placeholder:"Insert remark",...s,rows:4,className:"w-[300px]"})}),e.jsx(w,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:"attachment",render:({field:s})=>e.jsxs(f,{children:[e.jsx(Ve,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(g,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:t=>{const c=t.target.files;if(c){const b=Array.from(c);s.onChange(b)}else s.onChange([])}})}),n.formState.errors.attachment&&Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((t,c)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:t.message},c)):null]})})})]}),D.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),D.map((s,t)=>e.jsxs("td",{className:"flex flex-col pb-3",children:[e.jsx("a",{href:s.url,target:"_blank",className:"text-blue-500 inline-block",children:s.file_name},t),e.jsx("button",{type:"button",onClick:()=>Ce(s.id),className:"text-red-500 mt-2",children:"Delete"})]}))]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:n.control,name:"total_destination",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{value:s.value.toString(),onValueChange:q,disabled:E==="international",children:[e.jsx(R,{className:"w-[200px] py-2",children:e.jsx(M,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(B,{children:Array.from({length:5},(t,c)=>e.jsxs(P,{value:(c+1).toString(),children:[" ",c+1," "]},c))})]})}),e.jsx(w,{})]})})]})]})]}),e.jsx(je,{className:"my-4"}),e.jsx(rt,{updateDestination:we,destinationField:be,listDestination:W,form:n,listAllowances:z,totalDestination:n.getValues("total_destination").toString(),pajak:i,purchasingGroup:y,setTotalAllowance:$e}),e.jsx(je,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(st,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:s=>Ne(s.target.checked)})})]}),Te&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(_,{control:n.control,name:"reference_number",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{value:s.value||"",onChange:t=>s.onChange(t.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(w,{})]})}),e.jsx(_,{control:n.control,name:"total_percent",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{value:s.value||void 0,onValueChange:t=>s.onChange(t),children:[e.jsx(R,{className:"w-[50%] mb-2",children:e.jsx(M,{placeholder:"-- Select Total Percent --"})}),e.jsxs(B,{children:[e.jsx(P,{value:"10",children:"10%"}),e.jsx(P,{value:"25",children:"25%"}),e.jsx(P,{value:"50",children:"50%"})]})]})}),e.jsx(w,{})]})}),e.jsx(_,{control:n.control,name:"total_cash_advance",render:({field:s})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{value:s.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(w,{})]})})]})]})})]}),e.jsx(et,{onClick:async()=>await de(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ve&&e.jsx(ze,{workflowApproval:{approvalRequest:H.approvalRequest,approvalFrom:H.approvalFrom,acknowledgeFrom:H.acknowledgeFrom},workflowApprovalStep:H.approvalFrom,workflowApprovalDiagram:H.approvalFrom})}),e.jsx(oe,{type:"submit",children:"submit"})]})})})};function rt({totalDestination:l,listAllowances:a,destinationField:i,form:p,updateDestination:y,setTotalAllowance:u,listDestination:h=[],pajak:r,purchasingGroup:x,typeEdit:N}){return j.useState(),j.useState(),j.useState(0),ge(),e.jsxs(Ge,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Le,{className:"flex items-center justify-start space-x-4",children:i.map((S,d)=>e.jsxs(Oe,{value:`destination${d+1}`,children:["Destination ",d+1]}))}),i.map((S,d)=>e.jsx(lt,{listAllowances:a,updateDestination:y,destination:S,form:p,index:d,setTotalAllowance:u,listDestination:h,pajak:r,purchasingGroup:x,typeEdit:N}))]})}function lt({form:l,index:a,destination:i,updateDestination:p,listAllowances:y,setTotalAllowance:u,listDestination:h,pajak:r,purchasingGroup:x,typeEdit:N}){const{fields:S,update:d,append:n,remove:D}=ne({control:l.control,name:`destinations.${a}.detail_attedances`}),{fields:Y,update:ee,append:z,remove:U,replace:W}=ne({control:l.control,name:`destinations.${a}.allowances`});function X(){let E=F(i.business_trip_start_date).startOf("day");const m=F(i.business_trip_end_date).startOf("day");for(D(),U();E.isBefore(m)||E.isSame(m);){const A={date:E.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};n(A),E=E.add(1,"days")}function re(A){let q=F(i.business_trip_start_date).startOf("day");const G=F(i.business_trip_end_date).startOf("day"),te=[];for(;q.isBefore(G)||q.isSame(G);)te.push({date:q.toDate(),request_price:A}),q=q.add(1,"days");return te}const le=y.map(A=>({name:A.name,code:A.code,default_price:parseInt(A.grade_price),type:A.type,subtotal:parseInt(A.grade_price),currency:A.currency_id,request_value:A.request_value,detail:A.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(A.grade_price)}]:re(A.grade_price)}));W(le)}return e.jsxs(Xe,{value:`destination${a+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",i.destination]}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${a}.destination`,render:({field:E})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:m=>{p(a,{...i,destination:m})},defaultValue:i.destination,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"Destination"})}),e.jsx(B,{children:h.map(m=>e.jsx(P,{value:m.destination,className:"uppercase",children:m.destination}))})]})}),e.jsx(w,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:l.control,name:`destinations.${a}.pajak_id`,render:({field:E})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:m=>{p(a,{...i,pajak_id:m})},defaultValue:i.pajak_id,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Pajak --"})}),e.jsx(B,{children:r.map(m=>e.jsx(P,{value:m.id.toString(),children:m.mwszkz}))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:l.control,name:`destinations.${a}.purchasing_group_id`,render:({field:E})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(I,{onValueChange:m=>{p(a,{...i,purchasing_group_id:m})},defaultValue:i.purchasing_group_id,children:[e.jsx(R,{className:"w-[200px]",children:e.jsx(M,{placeholder:"-- Select Purchasing Group --"})}),e.jsx(B,{children:x.map(m=>e.jsx(P,{value:m.id.toString(),children:m.purchasing_group}))})]})}),e.jsx(w,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(_,{control:l.control,name:`destinations.${a}.business_trip_start_date`,render:({field:E})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(_e,{initialDate:i.business_trip_start_date,onDateChange:m=>{p(a,{...i,business_trip_start_date:m})}})}),e.jsx(w,{})]})}),e.jsx("span",{children:"To"}),e.jsx(_,{control:l.control,name:`destinations.${a}.business_trip_end_date`,render:({field:E})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(_e,{initialDate:i.business_trip_end_date,onDateChange:m=>{p(a,{...i,business_trip_end_date:m})}})}),e.jsx(w,{})]})}),e.jsx(oe,{type:"button",onClick:()=>X(),children:"Get Detail"})]})]})]}),e.jsx(ct,{detailAttedanceFields:S,form:l,updateAttedanceFields:d,destinationIndex:a}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(dt,{allowanceField:Y,destinationIndex:a,form:l})]},a),e.jsx(it,{allowanceField:Y,destinationIndex:a,form:l,setTotalAllowance:u})]})}function it({allowanceField:l,destinationIndex:a,form:i,setTotalAllowance:p}){const[y,u]=j.useState(0);j.useEffect(()=>{const r=l.reduce((S,d,n)=>{const D=i.getValues(`destinations.${a}.allowances.${n}.detail`),Y=h(d,D);return S+Y},0),N=i.getValues("destinations").reduce((S,d,n)=>{const Y=(d.allowances||[]).reduce((ee,z,U)=>{const W=i.getValues(`destinations.${n}.allowances.${U}.detail`),X=h(z,W);return ee+X},0);return S+Y},0);u(r),p(N)},[l,i.watch()]);const h=(r,x)=>{var N;return r.type==="total"?parseFloat(((N=x==null?void 0:x[0])==null?void 0:N.request_price)||0):x==null?void 0:x.reduce((S,d)=>S+parseFloat(d.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:l.map((r,x)=>e.jsx(ot,{allowance:r,destinationIndex:a,form:i,allowanceIndex:x}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:y})})]})]})})]})})}function ot({allowance:l,destinationIndex:a,form:i,allowanceIndex:p}){const y=Q({control:i.control,name:`destinations.${a}.allowances.${p}.detail.0.request_price`}),u=Q({control:i.control,name:`destinations.${a}.allowances.${p}.detail`}),h=()=>{if(l.type==="total")return parseFloat(y||0)*1;{let r=0;return u==null||u.forEach(x=>{const N=parseFloat(x.request_price||0);r+=N}),r}};return e.jsxs("tr",{children:[e.jsx("td",{children:l.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:h()})]})]},l.id)}function ct({form:l,destinationIndex:a,detailAttedanceFields:i,updateAttedanceFields:p}){const y=l.watch(`destinations.${a}.detail_attedances`);return j.useEffect(()=>{},[y]),j.useEffect(()=>{},[i]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:i.map((u,h)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[F(u.date).format("DD/MM/YYYY"),e.jsx(_,{control:l.control,name:`destinations.${a}.detail_attedances.${h}.date`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{defaultValue:F(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsxs("td",{children:[u.shift_code,e.jsx(_,{control:l.control,name:`destinations.${a}.detail_attedances.${h}.shift_code`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{defaultValue:F(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsxs("td",{children:[u.shift_start,e.jsx(_,{control:l.control,name:`destinations.${a}.detail_attedances.${h}.shift_start`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{defaultValue:F(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsxs("td",{children:[u.shift_end,e.jsx(_,{control:l.control,name:`destinations.${a}.detail_attedances.${h}.shift_end`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{defaultValue:F(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(w,{})]})})]}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${a}.detail_attedances.${h}.start_time`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(w,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:l.control,name:`destinations.${a}.detail_attedances.${h}.end_time`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(w,{})]})})})]},u.index))})]})})})]})}function dt({form:l,destinationIndex:a,allowanceField:i}){return e.jsx("table",{className:"w-full allowance-table",children:i.map((p,y)=>e.jsx(pt,{form:l,allowance:p,destinationIndex:a,allowanceIndex:y}))})}function pt({form:l,allowance:a,destinationIndex:i,allowanceIndex:p}){const[y,u]=j.useState(!1),h=d=>{u(n=>!n)},r=Q({control:l.control,name:`destinations.${i}.allowances.${p}.detail.0.request_price`}),x=Q({control:l.control,name:`destinations.${i}.allowances.${p}.detail`}),N=()=>{if(a.type==="total")return parseFloat(r||0)*1;{let d=0;return x==null||x.forEach(n=>{const D=parseFloat(n.request_price||0);d+=D}),d}},S=d=>n=>{const D=parseFloat(n.target.value)||0;a.request_value==="unlimited"?d.onChange(n):a.request_value==="up to max value"?D<=a.subtotal?d.onChange(n):alert(`Value cannot exceed the subtotal of IDR ${a.subtotal}`):a.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:a.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:a.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:a.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:l.control,name:`destinations.${i}.allowances.${p}.detail.0.request_price`,render:({field:d})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{value:d.value,onChange:S(d)})}),e.jsx(w,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",a.detail.length," Days * ",a.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",N()]})})}),a.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>h(),children:e.jsxs(oe,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},a.id),y&&e.jsx(e.Fragment,{children:a.detail.map((d,n)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:F(d.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(_,{control:l.control,name:`destinations.${i}.allowances.${p}.detail.${n}.request_price`,render:({field:D})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{value:D.value,onChange:S(D)})}),e.jsx(w,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},d.id))})]})}function rs({form:l,type:a,allowanceIndex:i,destinationIndex:p}){const{fields:y}=ne({control:l.control,name:`destinations.${p}.allowances.${i}.detail`});return e.jsx(e.Fragment,{children:y.map((u,h)=>e.jsx(_,{control:l.control,name:`destinations.${p}.allowances.${h}.detail.${h}.request_price`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(g,{children:e.jsx(V,{value:r.value,onChange:r.onChange})}),e.jsx(w,{})]})}))})}export{rs as AllowanceInputForm,pt as AllowanceRowInput,rt as BussinesTripDestination,lt as BussinessDestinationForm,ns as BussinessTripFormV1,dt as DetailAllowance,ct as DetailAttedances,ot as ResultPerItem,it as ResultTotalItem};
