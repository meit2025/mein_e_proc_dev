import{r as w,j as e}from"./app-0WUCDbCG.js";/* empty css              */import{F as G,a as p,b as u,c as g,d as f,e as U}from"./form-yRrNK-yL.js";import{u as W,b as q,a as H,c as R}from"./index.esm-C13e6e9t.js";import{S as B,a as P,b as O,c as L,d as X}from"./select-kcweRagK.js";import{S as J}from"./separator-D0EzebSG.js";import{T as K}from"./textarea-CZpxIW3H.js";import{I as N}from"./input-DKauqRkq.js";import{T as Q,a as Z,b as ee,c as te}from"./tabs-5G8f89aT.js";import{z as r,t as se}from"./index-BTBbYnJA.js";import{S as ne}from"./scroll-area-Vopxfx6P.js";import{C as ae,G as le}from"./api-BzUwn5yu.js";import{a as re}from"./axiosInstance-CHxE3a7S.js";import{h as C}from"./moment-C5S46NFB.js";import{B as V}from"./button-BtfyTBsg.js";import{d as ie}from"./index-DYMq9LWD.js";import{C as de}from"./chevrons-up-down-DD1Zxf4x.js";import"./app-HlhieNAw.js";import"./utils-D2P5ZKHk.js";import"./index-CR9qZQb0.js";import"./index-DKysNCr-.js";import"./index-Dna2b7C7.js";import"./Combination-CIrqP92_.js";import"./index-DDiwOb6N.js";import"./index-CIwjpfkA.js";import"./index-DW92nmC8.js";import"./index-DeU5KHFg.js";import"./createLucideIcon--rGO1IQI.js";const Xe=({listBusinessTrip:s})=>{var k,M,I;const t=r.object({request_no:r.string().min(1,"Request for required"),remark:r.string().min(1,"Remark is required"),attachment:r.instanceof(File).nullable().optional(),total_destination:r.number().min(1,"Total Destinantion Required"),destinations:r.array(r.object({destination:r.string().min(1,"Destinantion Required"),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.string().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional(),request_start_time:r.string().optional(),request_end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),type:r.string().optional(),subtotal:r.string().optional(),detail:r.array(r.object({date:r.string().nullish(),request_price:r.any().optional()}))})),other:r.any().optional()}))}),l=W({resolver:se(t),defaultValues:{request_no:"",remark:"",attachment:null,total_destination:1,destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[]}]}}),j=async c=>{console.log(c," data");try{const m=new FormData;m.append("request_no",c.request_no??""),m.append("remark",c.remark??""),m.append("attachment",c.attachment??""),m.append("total_destination",`${c.total_destination}`),c.destinations.forEach((o,v)=>{m.append(`destinations[${v}]`,JSON.stringify(o))}),await ie.Inertia.post(ae,m,{headers:{"Content-Type":"multipart/form-data"}}),pe("succesfully created data","success"),F==null||F(!0)}catch(m){const o=m;F==null||F(),console.log(o)}},[a,x]=w.useState([]),[d,n]=w.useState([]),[b,S]=w.useState([]);async function _(c){l.setValue("request_no",c||"");const m=le(c);try{const o=await re.get(m),v=o.data.data;l.setValue("remark",v.remarks||""),l.setValue("total_destination",v.total_destination||1),x(o.data.data),S(v.destinations),h(v.total_destination),D(v.destinations)}catch(o){console.log(o)}}const[i,h]=w.useState(""),y=c=>{h(c)};console.log(a,"businessTripDetail");function D(c){const m=c.map(o=>({destination:o.destination||"",business_trip_start_date:new Date(o.business_trip_start_date),business_trip_end_date:new Date(o.business_trip_end_date),allowances:o.allowances||[],detail_attedances:o.detail_attedances||[],allowances_result_item:o.allowancesResultItem||[]}));l.setValue("destinations",m)}const{fields:Y,append:A,remove:T,update:$}=q({control:l.control,name:"destinations"});w.useEffect(()=>{},[a,i]);const[z,E]=w.useState(0);return e.jsx(ne,{className:"h-[600px] w-full ",children:e.jsx(G,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(j),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(p,{control:l.control,name:"request_no",render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(B,{onValueChange:m=>_(m),value:c.value,children:[e.jsx(P,{className:"w-[200px] py-2",children:e.jsx(O,{placeholder:"-- Select One --"})}),e.jsx(L,{children:s.map(m=>e.jsx(X,{value:m.id.toString(),children:m.request_no}))})]})}),e.jsx(f,{})]})})})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:a.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:a.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:(k=a==null?void 0:a.pajak)==null?void 0:k.mwszkz})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(M=a==null?void 0:a.cost_center)==null?void 0:M.company_code})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:(I=a==null?void 0:a.purchasing_group)==null?void 0:I.purchasing_group})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(p,{control:l.control,name:"remark",render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(K,{placeholder:"Insert remark",...c,rows:4,className:"w-[300px]"})}),e.jsx(f,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(p,{control:l.control,name:"attachment",render:({field:c})=>e.jsxs(u,{children:[e.jsx(U,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(g,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:m=>{var v;const o=(v=m.target.files)==null?void 0:v[0];o?c.onChange(o):c.onChange(null)}})}),e.jsx(f,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"Not Availabe"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(p,{control:l.control,name:"total_destination",render:({field:c})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(B,{value:i,onValueChange:y,children:[e.jsx(P,{className:"w-[200px] py-2",children:e.jsx(O,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(L,{children:Array.from({length:5},(m,o)=>e.jsxs(X,{value:(o+1).toString(),children:[" ",o+1," "]}))})]})}),e.jsx(f,{})]})})]})]})]}),e.jsx(J,{className:"my-4"}),e.jsx(ce,{updateDestination:$,destinationField:Y,form:l,listAllowances:d,totalDestination:l.getValues("total_destination").toString(),setTotalAllowance:E,businessTripDetail:a}),e.jsx(V,{type:"submit",children:"submit"})]})})})};function ce({totalDestination:s,listAllowances:t,form:l,destinationField:j,updateDestination:a,setTotalAllowance:x,businessTripDetail:d}){return e.jsxs(Q,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Z,{className:"flex items-center justify-start space-x-4",children:j.map((n,b)=>e.jsxs(ee,{value:`destination${b+1}`,children:["Destination ",b+1]}))}),j.map((n,b)=>e.jsx(oe,{listAllowances:t,updateDestination:a,destination:n,form:l,index:b,setTotalAllowance:x,businessTripDetail:d}))]})}function oe({form:s,index:t,destination:l,updateDestination:j,listAllowances:a,setTotalAllowance:x,businessTripDetail:d}){const{fields:n,update:b,append:S,remove:_}=q({control:s.control,name:`destinations[${t}].detail_attedances`}),{fields:i,update:h,append:y,remove:D,replace:Y}=q({control:s.control,name:`destinations[${t}].allowances`});w.useState(!1);const{setValue:A}=H(),T=R({control:s.control,name:"total_percent"}),$=d.total_cash_advance;return w.useEffect(()=>{const E=parseFloat(T||0)/100*$;A("total_cash_advance",E.toFixed(2))},[T,$,A]),e.jsxs(te,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:l.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:C(l.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:C(l.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(he,{detailAttedanceFields:n,form:s,updateAttedanceFields:b,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(me,{allowanceField:i,destinationIndex:t,form:s})]},t),e.jsx(xe,{allowanceField:i,destinationIndex:t,form:s,setTotalAllowance:x}),e.jsx("table",{className:"w-full text-sm mt-10",children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[20%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[80%] flex",children:$})]})})]})}function xe({allowanceField:s,destinationIndex:t,form:l,setTotalAllowance:j}){const a=l.watch(`destinations[${t}].allowances`);return console.log(a),e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:s.map((x,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:x.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{})]})]},x.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{})]})]})})]})})}function he({form:s,destinationIndex:t,detailAttedanceFields:l,updateAttedanceFields:j}){const a=s.watch(`destinations[${t}].detail_attedances`);return w.useEffect(()=>{},[a]),w.useEffect(()=>{},[l]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:a.map((x,d)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[C(x.date).format("DD/MM/YYYY"),e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.date`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:C(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.shift_code`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:C(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.shift_start`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:C(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.shift_end`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:C(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(f,{})]})})]}),e.jsx("td",{children:e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.start_time`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.end_time`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.request_start_time`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(f,{})]})})}),e.jsx("td",{children:e.jsx(p,{control:s.control,name:`destinations.${t}.detail_attedances.${d}.request_end_time`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(f,{})]})})})]},x.index))})]})})})]})}function me({form:s,destinationIndex:t,allowanceField:l}){const j=s.watch(`destinations[${t}].allowances`);w.useEffect(()=>{},[j]);const[a,x]=w.useState([]),d=()=>{a.length===0&&x([...a,a.length])},n=R({control:s.control,name:a.map((_,i)=>`destinations.${t}.other[${i}]`)}),b=_=>{s.control.unregister(`destinations.${t}.other[${_}]`),x(i=>i.filter((h,y)=>y!==_))},S=()=>n.reduce((_,i)=>{const h=Number(i)||0;return _+h},0);return e.jsxs("table",{className:"w-full allowance-table",children:[j.map((_,i)=>e.jsx(je,{form:s,allowance:_,destinationIndex:t,allowanceIndex:i})),a.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(V,{type:"button",className:"text-xl",onClick:d,children:"+"})})}),a.map((_,i)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{control:s.control,name:`destinations.${t}.other[${i}]`,render:({field:h})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{value:h.value,onChange:y=>{h.onChange(y)}})}),e.jsx(f,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",S()]})})}),e.jsx("td",{children:e.jsx(V,{type:"button",className:"text-xs",onClick:()=>b(i),children:"X"})})]},i))]})}function je({form:s,allowance:t,destinationIndex:l,allowanceIndex:j}){const[a,x]=w.useState(!1);w.useState(0);const d=i=>{x(h=>!h)},n=R({control:s.control,name:`destinations[${l}].allowances[${j}].detail[0].request_price`}),b=R({control:s.control,name:`destinations[${l}].allowances[${j}].detail`}),S=()=>{if(t.type==="total")return parseFloat(n||0)*1;{let i=0;return b==null||b.forEach(h=>{const y=parseFloat(h.request_price||0);i+=y}),i}},_=(i,h)=>{const y=parseFloat(h),D=isNaN(y)?0:y,Y=t.request_value;let A=!0;switch(Y){case"unlimited":A=!0;break;case"fixed value":const T=t.subtotal;D!==T&&(alert(`Please enter the fixed value of IDR ${T}`),A=!1);break;case"up to max value":const $=t.subtotal;D>$&&(alert(`The value should not exceed IDR ${$}`),A=!1);break;default:A=!1}A&&s.setValue(`destinations[${l}].allowances[${j}].detail[${i}].request_price`,D)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{control:s.control,name:`destinations[${l}].allowances[${j}].detail[0].request_price`,render:({field:i})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{value:i.value,onChange:h=>_(0,h.target.value)})}),e.jsx(f,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",S()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(V,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),a&&e.jsx(e.Fragment,{children:t.detail.map((i,h)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:C(i.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(p,{control:s.control,name:`destinations[${l}].allowances[${j}].detail[${h}].request_price`,render:({field:y})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{value:y.value,onChange:D=>_(h,D.target.value)})}),e.jsx(f,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},i.id))})]})}function ze({form:s,type:t,allowanceIndex:l,destinationIndex:j}){const{fields:a}=q({control:s.control,name:`destinations.${j}.allowances.${l}.detail`});return e.jsx(e.Fragment,{children:a.map((x,d)=>e.jsx(p,{control:s.control,name:`destinations.${j}.allowances.${d}.detail.${d}.request_price`,render:({field:n})=>e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{value:n.value,onChange:n.onChange})}),e.jsx(f,{})]})}))})}function pe(s,t){throw new Error("Function not implemented.")}function F(s){throw new Error("Function not implemented.")}export{ze as AllowanceInputForm,je as AllowanceRowInput,ce as BussinesTripDestination,oe as BussinessDestinationForm,Xe as BussinessTripFormV1,me as DetailAllowance,he as DetailAttedances,xe as ResultTotalItem};
