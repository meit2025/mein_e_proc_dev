import{j as e,r as F,u as at,q as nt}from"./app-CZpdMGQc.js";import{B as ot}from"./button-C5HP0Cb2.js";import{h as O}from"./moment-C5S46NFB.js";import{z as p,t as lt}from"./index-BH9UljZq.js";import{f as Z}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as it,F as q,a as T,b as E,c as k,f as ct,e as mt}from"./form-C25xMPxf.js";import{u as dt,b as ut}from"./index.esm-or9iRz74.js";import{T as Ce}from"./textarea-CwUu7Oim.js";/* empty css                  */import{S as pt}from"./scroll-area-BsDvECze.js";import{a as $}from"./axiosInstance-DIFX6rqg.js";import{S as Fe}from"./separator-CBpumcE3.js";import{T as ht,a as ft,b as gt,c as bt}from"./tabs-DEW2mCrk.js";import{S as J,a as K,b as X,c as Q,d as U}from"./select-D2JuYkhe.js";import{F as me}from"./formDropdown-DnawfTgp.js";import{C as qe}from"./CustomDatePicker-jNLTWiBf.js";import{I as Te}from"./input-B0Fc9VEF.js";import{ReimburseFormType as x}from"./listModel-C9ygtBbC.js";import{u as ee}from"./getDropdown-DbvId_Um.js";import{G as _t,a as Ee,b as jt}from"./api-BeRu2Z8X.js";import{L as xt}from"./LoadingSpin-BXK2ZKDe.js";import{W as yt}from"./WorkflowComponent-D82c7uws.js";import{C as wt}from"./CustomStatus-BYH4PYqY.js";import{F as ke}from"./FormHelperText-BptIu8cK.js";import{B as vt}from"./Button-QjLdrlbp.js";import"./app-DQK4SJPx.js";import"./index-CCJUgOsa.js";import"./index-Bb4qSo10.js";import"./utils-BmbD66EB.js";import"./createLucideIcon-CC7s6r3w.js";import"./index-D3idG5IQ.js";import"./index-L6BJlucr.js";import"./index-CS5HcKhR.js";import"./index-CCxdHOmy.js";import"./index-DbZONCog.js";import"./index-BdQq_4o_.js";import"./index-VZn6deEc.js";import"./index-DIP3BPLn.js";import"./index-BC7Ab_rK.js";import"./index-DsdrfJn9.js";import"./index-C5vSvTtQ.js";import"./Combination-Bcr5hjT3.js";import"./index-Df1jM3Qk.js";import"./TextField-BazrbxMO.js";import"./createSvgIcon-Dg0YwIN7.js";import"./DefaultPropsProvider-L-ZGW19p.js";import"./useSlot-BuV7uSet.js";import"./createSimplePaletteValueFilter-ChM1yfBq.js";import"./useControlled-DeMYs52Q.js";function Nt({isLoading:de=!1,children:ue}){return e.jsx("div",{className:"",children:de?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(xt,{})})}):ue})}const xs=({onSuccess:de,currencies:ue,taxDefaultValue:xe,uomDefaultValue:ye,edit_url:Re,update_url:Le,store_url:Ae,type:_,currentUser:M})=>{const[we,Me]=F.useState("form1"),{showToast:L}=at();nt().props;const{dataDropdown:te,getDropdown:se}=ee(_t);ee();const{dataDropdown:Ie,getDropdown:Ye}=ee(),{dataDropdown:re,getDropdown:ae}=ee("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:ne,getDropdown:oe}=ee("api/master/cost-center/dropdown-list"),[Y,pe]=F.useState([]),[$e,he]=F.useState([]),[A,Ve]=F.useState(!1),[ve,Be]=F.useState(!1),[Pe,le]=F.useState(!1),[y,V]=F.useState([]),fe=F.useRef([]),[Ge,ge]=F.useState([]),[z,Oe]=F.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),ze=1*1024*1024,He=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],We=p.object({formCount:p.string().min(1,"total form must be have value"),remark_group:p.string().min(1,"header remark is required"),cost_center:p.string().min(1,"cost center required"),requester:p.string().min(1,"requester required"),value:p.number().optional(),user_id:p.string().optional(),forms:p.array(p.object({reimburseId:p.string().optional(),for:p.string().optional(),group:p.string().optional(),reimburse_type:p.string().min(1,"reimburse type is required"),short_text:p.string().min(1,"remarks is required"),balance:p.string(),remaining_balance_when_request:p.number(),currency:p.string().min(1,"currency required"),tax_on_sales:p.string().min(1,"tax required"),purchase_requisition_unit_of_measure:p.string().min(1,"uom required"),purchasing_group:p.string().min(1,"Purchasing Group required"),type:p.any(),item_delivery_data:p.date(),claim_date:p.date(),attachment:p.array(p.instanceof(File).refine(t=>He.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(t=>t.size<=ze,{message:"File size must be less than 1MB"})).min(_===x.create?1:0,"Attachment is required"),savedAttachment:p.array(p.any()).optional().nullable()}))});F.useEffect(()=>{(async()=>{var a,m;(_===x.edit||_===x.clone)&&(le(!0),await Ze()),Ye("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=Number(we.split("form")[1])-1;ae("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(a=r.getValues("forms")[s])!=null&&a.purchasing_group?"id":"",value:((m=r.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),oe("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),se("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&_===x.create&&H(0)})()},[_]);async function Ze(){r.setValue("forms",[]),le(!0);try{const t=await $.get(Re??""),s=t.data.data.group,a=t.data.data.forms;Ve(s.reimbursementStatus),ge(a.reduce((n,f)=>(n.push(String(f.id)),n),[]));const m=a.map(n=>({reimburseId:String(n.id),for:String(n.for),group:String(n.group),reimburse_type:n.reimburse_type.code,short_text:n.short_text,balance:n.balance,currency:n.currency,tax_on_sales:String(n.tax_on_sales),purchase_requisition_unit_of_measure:String(n.purchase_requisition_unit_of_measure),remaining_balance_when_request:Number(n.remaining_balance_when_request)??0,purchasing_group:String(n.purchasing_group),type:n.type,item_delivery_data:new Date(n.item_delivery_data),claim_date:new Date(n.claim_date),attachment:[],savedAttachment:n.reimburse_attachment}));fe.current=a.map((n,f)=>({id:String(n.id),reimburse_type:n.reimburse_type.code,balance:a.filter((i,g)=>g>=f&&i.for===n.for&&i.reimburse_type.code===n.reimburse_type.code).reduce((i,g)=>i+Number(g.balance)||0,0),limit:a.filter((i,g)=>g>=f&&i.for===n.for&&i.reimburse_type.code===n.reimburse_type.code).reduce((i,g)=>i+1||0,0),for:String(n.for)})),r.setValue("formCount",a.length.toString()),r.setValue("remark_group",s.remark),r.setValue("cost_center",String(s.cost_center.id)),r.setValue("requester",s.requester),r.setValue("forms",m);let u=0;for(const n of a)await H(u,{reimburse_type:n.reimburse_type.code}),await Ne(u,{type:n.type,reimburse_type:n.reimburse_type.code}),await _e(u,{reimburse_type:n.reimburse_type.code,for:n.reimburse_type.is_employee===1?null:n.for},!0),u++;le(!1)}catch{le(!1)}}const Je={formCount:"1",remark_group:"",cost_center:"",requester:String(M==null?void 0:M.is_admin)==="1"?"":M==null?void 0:M.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:xe,purchase_requisition_unit_of_measure:ye,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=dt({resolver:lt(We),defaultValues:Je}),{fields:be,update:j}=ut({control:r.control,name:"forms"}),H=async(t,s=null)=>{const a=r.getValues("requester");if(a===null||a===""){pe(u=>{const n=[...u];return n[t]=[],n});return}const m=await $.get(Ee,{params:{user:a,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});pe(u=>{const n=[...u];return n[t]=m.data.data,n})},Ke=async(t,s)=>{if(t&&t.length>0)try{const a=await $.get(Ee,{params:{search:t,user:r.getValues("requester")}});pe(m=>{const u=[...m];return u[s]=a.data.data,u})}catch(a){console.error("Error searching reimburse types:",a)}},Ne=async(t,s)=>{const a=await $.get(jt,{params:{user:r.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});he(m=>{const u=[...m];return u[t]=a.data.data,u})},Xe=t=>{for(let s=0;s<be.length;s++)H(s);if(t==null)for(let s=0;s<be.length;s++)r.setValue(`forms.${s}.reimburse_type`,""),r.setValue(`forms.${s}.for`,"");V([]),he([])};function Qe(t){const s=[...r.getValues("forms")];for(let a=0;a<Number(t);a++)if(a+1>s.length){H(a);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:xe,purchase_requisition_unit_of_measure:ye,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}r.setValue("forms",s)}const Ue=t=>{Me(t)},et=async t=>{var a,m,u,n,f;if(y)for(let i=0;i<y.length;i++){if(t.forms.length==0||t.forms.length-1,((a=y[i])==null?void 0:a.type_limit)!=="Unlimited"&&Number((m=y[i])==null?void 0:m.limit)==0){L("Claim Limit for form "+(i+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[i].balance==""||Number(t.forms[i].balance)==0){L("Claim Balance for form "+(i+1)+" cannot be 0","error");return}if(Number(((u=y[i])==null?void 0:u.balance)??0)<Number(t.forms[i].balance??0)){L("Please check your balance input for forms "+(i+1)+"  is not must be above "+((n=y[i])==null?void 0:n.balance),"error");return}t.forms=t.forms.map((g,C)=>{var R;return{...g,claim_date:O(g.claim_date).format("YYYY-MM-DD"),item_delivery_data:O(g.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:Number(((R=y[C])==null?void 0:R.balance)??0)}})}const s=t.forms.reduce((i,g)=>i+Number(g.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let i;_===x.edit||_===x.clone?i=await $.post(Le??"",t,{headers:{"Content-Type":"multipart/form-data"}}):i=await $.post(Ae??"",t,{headers:{"Content-Type":"multipart/form-data"}}),L((f=i==null?void 0:i.data)==null?void 0:f.data,"success"),de()}catch{}};async function _e(t,s=null,a=!1){var n,f;const m=r.getValues(`forms.${t}`),u={user:r.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:m.reimburse_type,for:s!=null?s.for:m.for};try{const i=await $.get("reimburse/data-limit-and-balance",{params:u}),C=r.getValues("forms").filter((w,h)=>h!==t&&w.reimburse_type===m.reimburse_type&&w.for===m.for);let R=C.reduce((w,h)=>w+Number(h.balance)||0,0),I=0,N=1;if(_===x.clone)if(a){let w=fe.current.find(h=>m.reimburseId==h.id);I=R+Number(w.balance),N=C.length+Number(w.limit)}else{let w=m.for===""?r.getValues("requester"):m.for,h=fe.current.find(b=>b.reimburse_type===m.reimburse_type&&b.for===w&&!Ge.includes(b.id));h!==void 0&&(I=Number(h.balance),N=C.length+Number(h.limit),ge(b=>{const D=[...b];return D[t]=h.id,D}))}let B=i.data.data.balance-R+I,W=Math.max(0,i.data.data.limit-C.length+N);V(w=>{const h=[...w];return h[t]={...i.data.data,balance:B,limit:i.data.data.type_limit=="Unlimited"?i.data.data.type_limit:W},h})}catch(i){L((f=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:f.message,"error")}}const De=async()=>{var t,s,a,m,u,n,f,i,g,C,R,I;try{const N=r.getValues("forms"),B=N.map((b,D)=>({index:D,value:b.balance?Number(b.balance):0}));if(B.some(b=>b.value===0)){const b=B.findIndex(D=>D.value===0);L(`Please fill balance form ${b+1}`,"error");return}const w=N.reduce((b,D)=>b+(Number(D.balance)||0),0),h=await $.get("/check-approval",{params:{value:w,requester:r.getValues("requester"),type:"REIM"}});if(h.data.status_code===200){const b=(s=(t=h.data)==null?void 0:t.data)==null?void 0:s.approval.map(c=>(c==null?void 0:c.division_name)||null),D=(m=(a=h.data)==null?void 0:a.data)==null?void 0:m.approval.map(c=>(c==null?void 0:c.name)||null),l=[];(n=(u=h.data)==null?void 0:u.data)!=null&&n.hr&&l.push((g=(i=(f=h.data)==null?void 0:f.data)==null?void 0:i.hr)==null?void 0:g.name);const o=(((C=h.data.data)==null?void 0:C.approval)??[]).map(c=>({status:"",name:c.name,dateApproved:""}));Oe({approvalRequest:b,approvalFrom:D,acknowledgeFrom:l,approvalFromStatusRoute:o}),Be(!0)}}catch(N){L((I=(R=N==null?void 0:N.response)==null?void 0:R.data)==null?void 0:I.message,"error")}};F.useEffect(()=>{r.getValues("forms").reduce((a,m)=>a+Number(m.balance)||0,0)>0&&ve===!0&&De()},[r.watch("forms"),r.watch("requester")]);const tt=t=>{const s=t;if(Object.keys(s).length>0){let a=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,u])=>{m==="forms"?u.forEach((n,f)=>{a+=`</br><strong>Form ${f+1}:</strong></br>`,Object.values(n).forEach(i=>{a+=`<li>${i.message}</li>`})}):a+=`<li>${u.message}</li>`}),a+="</ul>",L(e.jsx("div",{dangerouslySetInnerHTML:{__html:a}}),"error")}};return e.jsx(pt,{className:"h-[600px] w-full",children:e.jsx(Nt,{isLoading:Pe,children:e.jsx(it,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(et,t=>{tt(t)}),children:[e.jsx("table",{className:"w-full mt-4 text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:A&&e.jsx(wt,{name:A==null?void 0:A.name,className:A==null?void 0:A.classname,code:A==null?void 0:A.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:"remark_group",render:({field:t})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsx(Ce,{placeholder:"Insert remark",...t})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(me,{fieldLabel:"",options:ne,fieldName:"cost_center",disabled:_===x.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=ne==null?void 0:ne.some(a=>a.label===t);t.length>0&&!s?await oe(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&oe("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=r.getValues("cost_center");oe("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(me,{options:te,fieldName:"requester",disabled:String(M==null?void 0:M.is_admin)==="0"||_===x.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const a=te==null?void 0:te.some(m=>m.label===t);t.length>0&&!a?se(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!a&&se("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>Xe(t),onFocus:()=>{const t=r.getValues("requester");se("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(J,{disabled:_===x.edit,onValueChange:a=>{t.onChange(a),Qe(a);const m=r.getValues("forms");if(m.length>Number(a)){const u=m.slice(0,Number(a));r.setValue("forms",u),V(n=>{let f=[...n];return f=f.slice(0,Number(a)),f})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(X,{placeholder:"Select number of forms"})}),e.jsx(Q,{children:Array.from({length:3},(a,m)=>m+1).map(a=>e.jsx(U,{value:a.toString(),children:a},a))})]})}),e.jsx(k,{})]})}})})]})]})}),e.jsx(Fe,{className:"my-4"}),e.jsxs(ht,{value:we,onValueChange:Ue,className:"w-full",children:[e.jsxs(ft,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:r.watch("formCount")||1}).map((t,s)=>e.jsxs(gt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),be.map((t,s)=>{var a,m,u,n,f,i,g,C,R,I,N,B,W,w,h,b,D;return e.jsxs(bt,{value:`form${s+1}`,children:[e.jsx(q,{control:r.control,name:`forms.${s}.reimburseId`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsx(Te,{className:"sr-only",value:t.reimburseId,onChange:l.onChange})}),e.jsx(k,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(me,{options:Y[s],fieldName:`forms.${s}.reimburse_type`,disabled:Y[s]===void 0||Y[s].length===0||_===x.edit,placeholder:"Select Reimburse Type",onSearch:async l=>{var d;((d=Y[s])==null?void 0:d.some(c=>c.label===l))||await Ke(l,s)},onChangeOutside:async l=>{if(l){const o=Y[s].filter(d=>d.value==l)[0];j(s,{...t,reimburse_type:l,type:o.is_employee===1?"Employee":"Family"}),o.is_employee===1?_e(s,{reimburse_type:l,for:null}):(V(d=>{const c=[...d];return c[s]=[],c}),r.setValue(`forms.${s}.balance`,""),Ne(s,{type:"Family",reimburse_type:l}))}else{V(d=>{const c=[...d];return c[s]=[],c}),j(s,{...t,balance:""}),ge(d=>{const c=[...d];return c[s]="",c}),r.setValue(`forms.${s}.for`,""),he(d=>{const c=[...d];return c[s]=[],c});const o=r.getValues("forms");o.forEach((d,c)=>{var S,v;if(c>s&&o[c].reimburse_type===t.reimburse_type){const ie=((S=y[c])==null?void 0:S.balance)||0,Se=((v=y[c])==null?void 0:v.limit)||0;V(ce=>{var G;const P=[...ce];return P[c]={...P[c],balance:ie+Number(t.balance||"0")},((G=y[c])==null?void 0:G.type_limit)!=="Unlimited"&&(P[c]={...P[c],limit:Se+1}),P}),r.setValue(`forms.${c}.balance`,"")}})}},onFocus:()=>{H(s)},classNames:"mt-2 w-full"}),((u=(m=(a=r.formState.errors)==null?void 0:a.forms)==null?void 0:m[s])==null?void 0:u.reimburse_type)&&e.jsx(ke,{error:!0,children:(g=(i=(f=(n=r.formState.errors)==null?void 0:n.forms)==null?void 0:f[s])==null?void 0:i.reimburse_type)==null?void 0:g.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:`forms.${s}.for`,render:({field:l})=>{var o,d,c,S;return e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(J,{disabled:((c=(d=(o=Y==null?void 0:Y[s])==null?void 0:o.filter(v=>(v==null?void 0:v.value)==r.getValues(`forms.${s}.reimburse_type`)))==null?void 0:d[0])==null?void 0:c.is_employee)===1||_===x.edit,onValueChange:v=>{j(s,{...t,for:v}),_e(s,{reimburse_type:r.getValues(`forms.${s}.reimburse_type`),for:v})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(X,{placeholder:"-"})}),e.jsx(Q,{children:(S=$e[s])==null?void 0:S.map(v=>e.jsx(U,{value:v.value.toString(),children:v.label},v.value))})]})}),e.jsx(k,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(me,{fieldLabel:"",options:re,fieldName:`forms.${s}.purchasing_group`,disabled:_===x.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:l=>{const o=re==null?void 0:re.some(d=>d.label===l);l.length>0&&!o?ae(l,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:l}):l.length==0&&!o&&ae("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"})},onChangeOutside:l=>{l&&j(s,{...t,purchasing_group:l})},onFocus:()=>{var o;const l=(o=r.getValues("forms")[s])==null?void 0:o.purchasing_group;ae("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:l?"id":"",value:l??""}})}}),((I=(R=(C=r.formState.errors)==null?void 0:C.forms)==null?void 0:R[s])==null?void 0:I.purchasing_group)&&e.jsx(ke,{error:!0,children:(w=(W=(B=(N=r.formState.errors)==null?void 0:N.forms)==null?void 0:B[s])==null?void 0:W.purchasing_group)==null?void 0:w.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:`forms.${s}.tax_on_sales`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(J,{disabled:!0,onValueChange:o=>{j(s,{...t,tax_on_sales:o})},defaultValue:t.tax_on_sales,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(X,{placeholder:"-"})}),e.jsx(Q,{children:(Ie??[]).map((o,d)=>e.jsxs(U,{value:o.value.toString(),children:[o.description," - ",o.label]},o.value))})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(J,{disabled:!0,onValueChange:o=>{j(s,{...t,purchase_requisition_unit_of_measure:String(o)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(X,{placeholder:"-"})}),e.jsx(Q,{children:e.jsx(U,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:`forms.${s}.short_text`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsx(Ce,{placeholder:"Insert remark",onChange:o=>{j(s,{...t,short_text:o.target.value})},defaultValue:t.short_text})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((h=y[s])==null?void 0:h.balance)&&Z((b=y[s])==null?void 0:b.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(D=y[s])==null?void 0:D.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:`forms.${s}.item_delivery_data`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsx(qe,{disabled:_===x.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:o=>{O(o).format("YYYY-MM-DD")>=O(new Date).format("YYYY-MM-DD")?(l.onChange(o),j(s,{...t,item_delivery_data:o})):(l.onChange(l.value),j(s,{...t,item_delivery_data:l.value}),L("Receipt date cannot be less than today","error"))}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(q,{control:r.control,name:`forms.${s}.claim_date`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsx(qe,{disabled:_===x.edit,initialDate:l.value instanceof Date?l.value:new Date(l.value),minDate:new Date,onDateChange:o=>{O(o).format("YYYY-MM-DD")>=O(new Date).format("YYYY-MM-DD")?(l.onChange(o),j(s,{...t,claim_date:o})):(l.onChange(l.value),j(s,{...t,claim_date:l.value}),L("Claim date cannot be less than today","error"))}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid w-full grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(q,{control:r.control,name:`forms.${s}.currency`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(E,{children:e.jsxs(J,{disabled:_===x.edit,onValueChange:o=>{j(s,{...t,currency:o})},defaultValue:t.currency,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(X,{placeholder:"-"})}),e.jsx(Q,{children:ue.map(o=>e.jsxs(U,{value:o.code,children:[o.name," (",o.code,")"]},o.code))})]})}),e.jsx(ct,{className:"h-6"}),e.jsx(k,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(q,{control:r.control,name:`forms.${s}.balance`,render:({field:l})=>{var o;return e.jsxs(T,{children:[e.jsx(E,{children:e.jsx(Te,{type:"text",placeholder:"0",onChange:d=>{var ce;const c=d.target.value.replace(/[^0-9]/g,""),S=Z(c,!1),v=Number(c)||0,ie=((ce=y[s])==null?void 0:ce.balance)||0;if(v>ie){d.target.value=Z(c.slice(0,-1),!1);return}j(s,{...t,balance:c}),d.target.value=S,r.getValues("forms").forEach((P,G)=>{if(G>s&&P.reimburse_type===t.reimburse_type){const st=ie-v;V(rt=>{const je=[...rt];return je[G]={...je[G],balance:st},je}),j(G,{...t,balance:""})}})},defaultValue:Z(t.balance,!1),value:Z(t.balance,!1),disabled:typeof y[s]>"u"||((o=y[s])==null?void 0:o.length)===0||_===x.edit})}),e.jsx(k,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(q,{control:r.control,name:`forms.${s}.attachment`,render:({field:l})=>e.jsxs(T,{children:[e.jsx(mt,{className:"mb-1 text-xs text-gray-500 font-extralight",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(E,{children:e.jsx("input",{className:"flex w-full px-3 py-1 text-xs transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:o=>{const d=o.target.files;if(d){const c=[...t.attachment],S=Array.from(d);c.push(...S),j(s,{...t,attachment:c})}}})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((l,o)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:l.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const d=t.attachment.filter((c,S)=>S!==o);j(s,{...t,attachment:d})},children:"Delete"})]},o))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((l,o)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs",children:l.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const d=t.savedAttachment.filter((c,S)=>S!==o);j(s,{...t,savedAttachment:d})},children:"Delete"})]},o))})})]})]})]})]})})})]},s)})]}),e.jsx(vt,{onClick:async()=>await De(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ve&&e.jsx(yt,{workflowApproval:{approvalRequest:z.approvalRequest,approvalFrom:z.approvalFrom,acknowledgeFrom:z.acknowledgeFrom},workflowApprovalStep:z.approvalFromStatusRoute,workflowApprovalDiagram:z.approvalFrom})}),e.jsx(Fe,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(ot,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{xs as ReimburseForm};
