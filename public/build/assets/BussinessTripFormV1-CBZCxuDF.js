import{j as e,r as _,u as we,b as Te}from"./app-UdoGGUR1.js";import{F as Ae,a as g,b as f,c as b,d as v,e as $e}from"./form-CxFmDBOU.js";import{z as o,t as Fe}from"./index-Ckfv2rTV.js";import{d as _e}from"./index-Bjie55T7.js";import{B as ue}from"./button-1LMUYjo6.js";import{T as Ye}from"./textarea-Cveo9iOP.js";import{a as Ee,C as Pe,u as qe,b as re,c as H}from"./index.esm-BDVcGsgC.js";import{S as ke}from"./scroll-area-OS-4YwRk.js";import{S as ge}from"./separator-CYSQjZs7.js";/* empty css              */import{T as Ie,a as Ve,b as Re,c as Me}from"./tabs-CFyn542F.js";import{a as U}from"./axiosInstance-BV8LfGeA.js";import{C as fe}from"./CustomDatePicker-CGXbbl0I.js";import{W as Be}from"./WorkflowComponent--dIS3UbO.js";import{S as Ge}from"./Switch-Bp9XDvoK.js";import{F as Le}from"./FormHelperText-7kn1yex_.js";import{I as E}from"./input-Clh9elul.js";import{S as k,a as I,b as V,c as R,d as P}from"./select-D4rX9kxb.js";import{C as Oe,E as Xe,b as ze}from"./api-B9TTe-Ow.js";import{G as Ue,a as We}from"./api-BEQetkWJ.js";import{h as Y}from"./moment-C5S46NFB.js";import{BusinessTripType as W}from"./models-BlmWY7Mr.js";import{b as be}from"./api-Cpn27s-b.js";import{B as He}from"./Button-Ba0NK-dw.js";import{C as Je}from"./chevrons-up-down-CoT7T0zJ.js";import"./app-HlhieNAw.js";import"./index-LeMBDiSg.js";import"./utils-0rir2ZYB.js";import"./index-lmJCR34w.js";import"./index-DNIfY65f.js";import"./index-DO2VM5jS.js";import"./index-CwpS24zQ.js";import"./index-DsQKamrU.js";import"./index-DRK6SHZa.js";import"./popover-LjVrEtep.js";import"./Combination-C3eM8bVG.js";import"./createLucideIcon-CrsPIPWL.js";import"./createSimplePaletteValueFilter-CvLZz-rm.js";import"./DefaultPropsProvider-CJcmZRcr.js";import"./SwitchBase-DvJ6XryW.js";import"./useControlled-Wj3KaCek.js";import"./index-Cw873Uao.js";import"./CustomStatus-wt_10F7Q.js";const Ke=({fieldLabel:n,fieldName:t,isRequired:i=!1,disabled:u=!1,style:D,requiredMessage:x,classNames:m,defaultChecked:r=!1,note:p,onChanges:N})=>{var l;const{control:C,formState:{errors:j}}=Ee();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[n&&e.jsxs("label",{className:"form-label max-w-32",children:[n," ",e.jsxs("span",{className:"text-red-700",children:[" ",i?"*":""]})]}),e.jsx(Pe,{name:t,control:C,rules:{required:i?x??`${n} is required`:!1},render:({field:A})=>e.jsx("div",{style:D,className:m,children:e.jsx(Ge,{...A,checked:!!(A.value??r),onChange:G=>{A.onChange(G),N&&N(G)},disabled:u})})}),e.jsx("span",{children:p})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),j[t]&&e.jsx(Le,{error:!0,children:String((l=j[t])==null?void 0:l.message)})]})]})};o.object({remark:o.string().min(1).max(50),reimburse_cost:o.number()});const Ze=1*1024*1024,Qe=["image/jpeg","image/png","application/pdf"],Kt=({users:n,listPurposeType:t,pajak:i,costcenter:u,purchasingGroup:D,type:x,id:m,isAdmin:r,idUser:p})=>{const N=o.object({purpose_type_id:o.string().min(1,"Purpose type required"),request_for:o.string().min(1,"Request is required"),cost_center_id:o.string().min(1,"Cost Center is required"),remark:o.string().min(1,"Remark is required"),attachment:o.array(o.instanceof(File).refine(a=>Qe.includes(a.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(a=>a.size<=Ze,{message:"File size must be less than 1MB"})),total_destination:o.number().min(1,"Total Destinantion Required"),destinations:o.array(o.object({destination:o.string().min(1,"Destinantion is Required"),pajak_id:o.string().min(1,"Pajak is required"),purchasing_group_id:o.string().min(1,"Purchasing Group is required"),cash_advance:o.boolean().nullable().optional(),reference_number:o.string().nullable().optional(),total_percent:o.string().nullable().optional(),total_cash_advance:o.string().nullable().optional(),business_trip_start_date:o.date().optional(),business_trip_end_date:o.date().optional(),detail_attedances:o.array(o.object({date:o.date().optional(),shift_code:o.string().optional(),shift_start:o.string().optional(),shift_end:o.string().optional(),start_time:o.string().optional(),end_time:o.string().optional()})),allowances:o.array(o.object({name:o.string().optional(),code:o.string().optional(),default_price:o.number().optional(),type:o.string().optional(),subtotal:o.number().optional(),currency:o.string().optional(),detail:o.array(o.object({date:o.date().nullish(),request_price:o.any().optional()}))}))}))}),[C,j]=_.useState("1"),l=qe({resolver:Fe(N),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[A,G]=_.useState([]);async function xe(){const a=ze(m);l.setValue("destinations",[]);try{const c=(await Te.get(a)).data.data,w=be(c.purpose_type_id),F=await U.get(w);K(F.data.data),G(c.attachments),l.setValue("purpose_type_id",c.purpose_type_id.toString()),l.setValue("request_for",c.request_for.id.toString()),l.setValue("cost_center_id",c.cost_center_id.toString()),l.setValue("remark",c.remarks),l.setValue("total_destination",c.total_destination),l.setValue("destinations",c.destinations.map(y=>({destination:y.destination,pajak_id:y.pajak_id,purchasing_group_id:y.purchasing_group_id,cash_advance:y.cash_advance==1,reference_number:y.reference_number,total_percent:y.total_percent,total_cash_advance:y.total_cash_advance,business_trip_start_date:new Date(y.business_trip_start_date),business_trip_end_date:new Date(y.business_trip_end_date),detail_attedances:y.detail_attedances.map(S=>({...S,date:new Date(S.date)})),allowances:y.allowances.map(S=>({...S,default_price:parseInt(S.default_price),subtotal:parseInt(S.subtotal),detail:S.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?new Date(T.date):null}))}))})))}catch{}}const[J,le]=_.useState([]),[ie,K]=_.useState([]),[Z,oe]=_.useState(""),[Q,ce]=_.useState(r==="0"?p.toString():"");async function de(a){l.setValue("purpose_type_id",a||"");const s=r=="0"?p||"":Q||"",c=Ue(a,s),w=be(a),F=We(a);try{const y=await U.get(c),S=await U.get(w),M=(await U.get(F)).data.data.purpose.type;M=="international"&&O("1"),oe(M),le(y.data.data),K(S.data.data)}catch(y){console.log(y)}}const O=a=>{l.setValue("total_destination",parseInt(a,10)),j(a),ee()},{showToast:h}=we(),d=async a=>{try{const s=new FormData,c=he();s.append("user_id",a.request_for??""),s.append("value",c.toString()),s.append("purpose_type_id",a.purpose_type_id??""),s.append("request_for",a.request_for??""),s.append("cost_center_id",a.cost_center_id??""),s.append("remark",a.remark??""),a.attachment.forEach((w,F)=>{w&&s.append(`attachment[${F}]`,w)}),s.append("total_destination",`${a.total_destination}`),a.destinations.forEach((w,F)=>{const y={...w,business_trip_start_date:Y(w.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:Y(w.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:w.detail_attedances.map(S=>({...S,date:Y(S.date).format("YYYY-MM-DD")})),allowances:w.allowances.map(S=>({...S,detail:S.detail.map(T=>({...T,date:(T==null?void 0:T.date)!=null?Y(T.date).format("YYYY-MM-DD"):null}))}))};s.append(`destinations[${F}]`,JSON.stringify(y))}),x==W.create?(await _e.Inertia.post(Oe,s,{headers:{"Content-Type":"multipart/form-data"}}),h("succesfully created data","success")):(await _e.Inertia.post(`${Xe}/${m}`,s,{headers:{"Content-Type":"multipart/form-data"}}),h("succesfully updated data","success"))}catch(s){console.log(s)}};function ee(){const a=[],s=parseInt(C);for(let c=0;c<s;c++)a.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});l.setValue("destinations",a)}const{fields:pe,append:$,remove:L,update:te}=re({control:l.control,name:"destinations"});_.useEffect(()=>{console.log(W.edit," business edit"),console.log(x," id type"),m&&x==W.edit&&xe()},[]),_.useEffect(()=>{x==W.create&&ee()},[C,J,m,x,r,p]);const[se,ve]=_.useState(!1),[X,ye]=_.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),Se=(a,s)=>{var c;return a.type==="total"?parseFloat(((c=s==null?void 0:s[0])==null?void 0:c.request_price)||0):s==null?void 0:s.reduce((w,F)=>w+parseFloat(F.request_price||0),0)},he=()=>l.getValues("destinations").reduce((c,w,F)=>{const S=(w.allowances||[]).reduce((T,M,ae)=>{const ne=l.getValues(`destinations.${F}.allowances.${ae}.detail`),q=Se(M,ne);return T+q},0);return c+S},0),me=async()=>{var a,s,c,w,F,y,S,T,M,ae,ne;try{const q=he();if(q===0){h("Please fill the balance","error");return}const z=await U.get("/check-approval",{params:{value:q,user_id:l.getValues("request_for"),type:"TRIP"}});if(z.data.status_code===200){const Ce=(s=(a=z.data)==null?void 0:a.data)==null?void 0:s.approval.map(B=>(B==null?void 0:B.division_name)||null),Ne=(w=(c=z.data)==null?void 0:c.data)==null?void 0:w.approval.map(B=>(B==null?void 0:B.name)||null),je=[];(y=(F=z.data)==null?void 0:F.data)!=null&&y.hr&&je.push((M=(T=(S=z.data)==null?void 0:S.data)==null?void 0:T.hr)==null?void 0:M.name),ye({approvalRequest:Ce,approvalFrom:Ne,acknowledgeFrom:je}),ve(!0)}}catch(q){h((ne=(ae=q==null?void 0:q.response)==null?void 0:ae.data)==null?void 0:ne.message,"error")}};_.useEffect(()=>{he()>0&&me()},[l.watch("destinations")]),_.useState([]);const De=a=>{G(s=>s.filter(c=>c.id!==a))};return e.jsx(ke,{className:"h-[600px] w-full ",children:e.jsx(Ae,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(d),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(g,{control:l.control,name:"request_for",render:({field:a})=>(r==="0"&&!a.value&&a.onChange(p.toString()),e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:s=>{ce(s),a.onChange(s)},value:a.value,disabled:r==="0",children:[e.jsx(I,{className:"w-[200px] py-2",children:e.jsx(V,{placeholder:"-- Select Business Purpose Type --"})}),e.jsx(R,{children:r==="1"?n.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id)):n.filter(s=>s.id===p).map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(v,{})]}))})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:l.control,name:"purpose_type_id",render:({field:a})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:s=>de(s),value:a.value,children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(V,{placeholder:"-- Select Bussiness Purpose Type --"})}),e.jsx(R,{children:t.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:l.control,name:"cost_center_id",render:({field:a})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:s=>a.onChange(s),value:a.value,children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(V,{placeholder:"-- Select Cost Center --"})}),e.jsx(R,{children:u.map(s=>e.jsx(P,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(g,{control:l.control,name:"remark",render:({field:a})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(Ye,{placeholder:"Insert remark",...a,rows:4,className:"w-[300px]"})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(g,{control:l.control,name:"attachment",render:({field:a})=>e.jsxs(f,{children:[e.jsx($e,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(b,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:s=>{const c=s.target.files;if(c){const w=Array.from(c);a.onChange(w)}else a.onChange([])}})}),l.formState.errors.attachment&&Array.isArray(l.formState.errors.attachment)?l.formState.errors.attachment.map((s,c)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:s.message},c)):null]})})})]}),A.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),A.map((a,s)=>e.jsxs("td",{className:"flex flex-col pb-3",children:[e.jsx("a",{href:a.url,target:"_blank",className:"text-blue-500 inline-block",children:a.file_name},s),e.jsx("button",{type:"button",onClick:()=>De(a.id),className:"text-red-500 mt-2",children:"Delete"})]}))]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:l.control,name:"total_destination",render:({field:a})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{value:a.value.toString(),onValueChange:O,disabled:Z==="international",children:[e.jsx(I,{className:"w-[200px] py-2",children:e.jsx(V,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(R,{children:Array.from({length:5},(s,c)=>e.jsxs(P,{value:(c+1).toString(),children:[" ",c+1," "]},c))})]})}),e.jsx(v,{})]})})]})]})]}),e.jsx(ge,{className:"my-4"}),e.jsx(et,{updateDestination:te,destinationField:pe,listDestination:ie,form:l,listAllowances:J,totalDestination:l.getValues("total_destination").toString(),pajak:i,purchasingGroup:D,typeEdit:x}),e.jsx(ge,{className:"my-4"}),e.jsx(He,{onClick:async()=>await me(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:se&&e.jsx(Be,{workflowApproval:{approvalRequest:X.approvalRequest,approvalFrom:X.approvalFrom,acknowledgeFrom:X.acknowledgeFrom},workflowApprovalStep:X.approvalFrom,workflowApprovalDiagram:X.approvalFrom})}),e.jsx(ue,{type:"submit",children:"submit"})]})})})};function et({totalDestination:n,listAllowances:t,destinationField:i,form:u,updateDestination:D,listDestination:x=[],pajak:m,purchasingGroup:r,typeEdit:p}){return _.useState(),_.useState(),_.useState(0),we(),e.jsxs(Ie,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ve,{className:"flex items-center justify-start space-x-4",children:i.map((N,C)=>e.jsxs(Re,{value:`destination${C+1}`,children:["Destination ",C+1]}))}),i.map((N,C)=>e.jsx(tt,{listAllowances:t,updateDestination:D,destination:N,form:u,index:C,listDestination:x,pajak:m,purchasingGroup:r,typeEdit:p}))]})}function tt({form:n,index:t,destination:i,updateDestination:u,listAllowances:D,listDestination:x,pajak:m,purchasingGroup:r,typeEdit:p}){const{fields:N,update:C,append:j,remove:l}=re({control:n.control,name:`destinations.${t}.detail_attedances`}),{fields:A,update:G,append:xe,remove:J,replace:le}=re({control:n.control,name:`destinations.${t}.allowances`});function ie(){let h=Y(i.business_trip_start_date).startOf("day");const d=Y(i.business_trip_end_date).startOf("day");for(l(),J();h.isBefore(d)||h.isSame(d);){const $={date:h.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};j($),h=h.add(1,"days")}function ee($){let L=Y(i.business_trip_start_date).startOf("day");const te=Y(i.business_trip_end_date).startOf("day"),se=[];for(;L.isBefore(te)||L.isSame(te);)se.push({date:L.toDate(),request_price:$}),L=L.add(1,"days");return se}const pe=D.map($=>({name:$.name,code:$.code,default_price:parseInt($.grade_price),type:$.type,subtotal:parseInt($.grade_price),currency:$.currency_id,request_value:$.request_value,detail:$.type.toLowerCase()=="total"?[{date:null,request_price:parseInt($.grade_price)}]:ee($.grade_price)}));le(pe)}const[K,Z]=_.useState(!1),oe=h=>{Z(h)},Q=H({control:n.control,name:`destinations.${t}.total_percent`}),[ce,de]=_.useState(0),O=ce;return _.useEffect(()=>{p==W.edit&&Z(n.getValues(`destinations.${t}.cash_advance`));const d=parseFloat((Q||"0").toString())/100*O;n.setValue(`destinations.${t}.total_cash_advance`,d.toFixed(0))},[Q,O]),e.jsxs(Me,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",i.destination]}),e.jsx("td",{children:e.jsx(g,{control:n.control,name:`destinations.${t}.destination`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:d=>{u(t,{...i,destination:d})},defaultValue:i.destination,children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(V,{placeholder:"Destination"})}),e.jsx(R,{children:x.map(d=>e.jsx(P,{value:d.destination,className:"uppercase",children:d.destination}))})]})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:n.control,name:`destinations.${t}.pajak_id`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:d=>{u(t,{...i,pajak_id:d})},defaultValue:i.pajak_id,children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(V,{placeholder:"-- Select Pajak --"})}),e.jsx(R,{children:m.map(d=>e.jsx(P,{value:d.id.toString(),children:d.mwszkz}))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsxs("td",{children:[" ",e.jsx(g,{control:n.control,name:`destinations.${t}.purchasing_group_id`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{onValueChange:d=>{u(t,{...i,purchasing_group_id:d})},defaultValue:i.purchasing_group_id,children:[e.jsx(I,{className:"w-[200px]",children:e.jsx(V,{placeholder:"-- Select Purchasing Group --"})}),e.jsx(R,{children:r.map(d=>e.jsx(P,{value:d.id.toString(),children:d.purchasing_group}))})]})}),e.jsx(v,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(g,{control:n.control,name:`destinations.${t}.business_trip_start_date`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(fe,{initialDate:i.business_trip_start_date,onDateChange:d=>{u(t,{...i,business_trip_start_date:d})}})}),e.jsx(v,{})]})}),e.jsx("span",{children:"To"}),e.jsx(g,{control:n.control,name:`destinations.${t}.business_trip_end_date`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(fe,{initialDate:i.business_trip_end_date,onDateChange:d=>{u(t,{...i,business_trip_end_date:d})}})}),e.jsx(v,{})]})}),e.jsx(ue,{type:"button",onClick:()=>ie(),children:"Get Detail"})]})]})]}),e.jsx(nt,{detailAttedanceFields:N,form:n,updateAttedanceFields:C,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(rt,{allowanceField:A,destinationIndex:t,form:n})]},t),e.jsx(st,{allowanceField:A,destinationIndex:t,form:n,setTotalAllowance:de}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Ke,{fieldName:`destinations.${t}.cash_advance`,isRequired:!1,disabled:!1,onChanges:h=>oe(h.target.checked)})})]}),K&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(g,{control:n.control,name:`destinations.${t}.reference_number`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{value:h.value||"",onChange:d=>h.onChange(d.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(v,{})]})}),e.jsx(g,{control:n.control,name:`destinations.${t}.total_percent`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsxs(k,{value:h.value||void 0,onValueChange:d=>h.onChange(d),children:[e.jsx(I,{className:"w-[50%] mb-2",children:e.jsx(V,{placeholder:"-- Select Total Percent --"})}),e.jsxs(R,{children:[e.jsx(P,{value:"10",children:"10%"}),e.jsx(P,{value:"25",children:"25%"}),e.jsx(P,{value:"50",children:"50%"})]})]})}),e.jsx(v,{})]})}),e.jsx(g,{control:n.control,name:`destinations.${t}.total_cash_advance`,render:({field:h})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{value:h.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(v,{})]})})]})]})})]})]})}function st({allowanceField:n,destinationIndex:t,form:i,setTotalAllowance:u}){const[D,x]=_.useState(0);_.useEffect(()=>{const r=n.reduce((p,N,C)=>{const j=i.getValues(`destinations.${t}.allowances.${C}.detail`),l=m(N,j);return p+l},0);x(r),u(r)},[n,i.watch()]);const m=(r,p)=>{var N;return r.type==="total"?parseFloat(((N=p==null?void 0:p[0])==null?void 0:N.request_price)||0):p==null?void 0:p.reduce((C,j)=>C+parseFloat(j.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:n.map((r,p)=>e.jsx(at,{allowance:r,destinationIndex:t,form:i,allowanceIndex:p}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:D})})]})]})})]})})}function at({allowance:n,destinationIndex:t,form:i,allowanceIndex:u}){const D=H({control:i.control,name:`destinations.${t}.allowances.${u}.detail.0.request_price`}),x=H({control:i.control,name:`destinations.${t}.allowances.${u}.detail`}),m=()=>{if(n.type==="total")return parseFloat(D||0)*1;{let r=0;return x==null||x.forEach(p=>{const N=parseFloat(p.request_price||0);r+=N}),r}};return e.jsxs("tr",{children:[e.jsx("td",{children:n.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:m()})]})]},n.id)}function nt({form:n,destinationIndex:t,detailAttedanceFields:i,updateAttedanceFields:u}){const D=n.watch(`destinations.${t}.detail_attedances`);return _.useEffect(()=>{},[D]),_.useEffect(()=>{},[i]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:i.map((x,m)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[Y(x.date).format("DD/MM/YYYY"),e.jsx(g,{control:n.control,name:`destinations.${t}.detail_attedances.${m}.date`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{defaultValue:Y(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(g,{control:n.control,name:`destinations.${t}.detail_attedances.${m}.shift_code`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{defaultValue:Y(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(g,{control:n.control,name:`destinations.${t}.detail_attedances.${m}.shift_start`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{defaultValue:Y(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(g,{control:n.control,name:`destinations.${t}.detail_attedances.${m}.shift_end`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{defaultValue:Y(r.value).format("YYYY-MM-DD"),onChange:r.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsx("td",{children:e.jsx(g,{control:n.control,name:`destinations.${t}.detail_attedances.${m}.start_time`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(v,{})]})})}),e.jsx("td",{children:e.jsx(g,{control:n.control,name:`destinations.${t}.detail_attedances.${m}.end_time`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{defaultValue:r.value,onChange:r.onChange})}),e.jsx(v,{})]})})})]},x.index))})]})})})]})}function rt({form:n,destinationIndex:t,allowanceField:i}){return e.jsx("table",{className:"w-full allowance-table",children:i.map((u,D)=>e.jsx(lt,{form:n,allowance:u,destinationIndex:t,allowanceIndex:D}))})}function lt({form:n,allowance:t,destinationIndex:i,allowanceIndex:u}){const[D,x]=_.useState(!1),m=j=>{x(l=>!l)},r=H({control:n.control,name:`destinations.${i}.allowances.${u}.detail.0.request_price`}),p=H({control:n.control,name:`destinations.${i}.allowances.${u}.detail`}),N=()=>{if(t.type==="total")return parseFloat(r||0)*1;{let j=0;return p==null||p.forEach(l=>{const A=parseFloat(l.request_price||0);j+=A}),j}},C=j=>l=>{const A=parseFloat(l.target.value)||0;t.request_value==="unlimited"?j.onChange(l):t.request_value==="up to max value"?A<=t.subtotal?j.onChange(l):alert(`Value cannot exceed the subtotal of IDR ${t.subtotal}`):t.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{control:n.control,name:`destinations.${i}.allowances.${u}.detail.0.request_price`,render:({field:j})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{value:j.value,onChange:C(j)})}),e.jsx(v,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",N()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>m(),children:e.jsxs(ue,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),D&&e.jsx(e.Fragment,{children:t.detail.map((j,l)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:Y(j.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(g,{control:n.control,name:`destinations.${i}.allowances.${u}.detail.${l}.request_price`,render:({field:A})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{value:A.value,onChange:C(A)})}),e.jsx(v,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},j.id))})]})}function Zt({form:n,type:t,allowanceIndex:i,destinationIndex:u}){const{fields:D}=re({control:n.control,name:`destinations.${u}.allowances.${i}.detail`});return e.jsx(e.Fragment,{children:D.map((x,m)=>e.jsx(g,{control:n.control,name:`destinations.${u}.allowances.${m}.detail.${m}.request_price`,render:({field:r})=>e.jsxs(f,{children:[e.jsx(b,{children:e.jsx(E,{value:r.value,onChange:r.onChange})}),e.jsx(v,{})]})}))})}export{Zt as AllowanceInputForm,lt as AllowanceRowInput,et as BussinesTripDestination,tt as BussinessDestinationForm,Kt as BussinessTripFormV1,rt as DetailAllowance,nt as DetailAttedances,at as ResultPerItem,st as ResultTotalItem};
