import{j as e,r,u as $e,q as Me,a as N,b as Y}from"./app-Bvy8FZoY.js";import{a as O}from"./axiosInstance-J1tay7Yr.js";import{D as Fe,b as De,c as Be}from"./dialog-CmHiileQ.js";import{B as L}from"./button-CUKtuCjc.js";import{L as Ue}from"./LoadingSpin-jNRxrTG3.js";import{D as Ae,a as ze,b as Te,c as Oe,d as _,e as Z}from"./dropdown-menu-ByGK6pgr.js";import{D as _e}from"./index-BauVLrWr.js";import{c as te}from"./createLucideIcon-BsGGNKh-.js";import{B as A}from"./Box-ei5o_ZUi.js";import{T as Ie,a as ee}from"./Tabs-xRgAorYB.js";import{B as I}from"./Button-vO6FTumG.js";import{D as Le,G as Pe}from"./DataGrid-DovhPIzB.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=te("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=te("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ge=({open:v,onOpenChange:P,onDelete:S,onClose:C,children:a,className:B,isLoading:c,title:p,description:o,labelConfirmButton:$="Delete"})=>e.jsx(Fe,{open:v,onOpenChange:C,children:e.jsxs(De,{className:B||"md:max-w-[768px]",children:[o||"Are you sure delete this item?",e.jsxs(Be,{children:[C?e.jsx(L,{variant:"outline",onClick:C,children:"Close"}):null,S?e.jsx(e.Fragment,{children:c?e.jsx(Ue,{}):e.jsx(L,{type:"submit",onClick:S,children:$})}):null]})]})}),se=v=>({id:`simple-tab-${v}`,"aria-controls":`simple-tabpanel-${v}`}),as=({columns:v,buttonCustome:P,onExport:S,onExportXls:C,url:a,labelFilter:B="Search",onEdit:c,onDelete:p,onDetail:o,onCreate:$,onClone:U,onSendSap:z,defaultSearch:T,actionType:ae,buttonActionCustome:R,deleteConfirmationText:ie,titleConfirmationText:He,isHistory:ne=!1,isLoading:q=!1,isClone:re=!1,role:t,tabelFooter:le})=>{var W,X,E,J,K;const[oe,ce]=r.useState([]),[de,G]=r.useState(!1),[l,xe]=r.useState({page:0,pageSize:10}),[f,pe]=r.useState([]),[u,he]=r.useState({items:[]});r.useState(null);const[me,h]=r.useState(!1),[x,fe]=r.useState(0),[ue,ge]=r.useState(0),[g,je]=r.useState(""),[H,we]=r.useState(""),{showToast:k}=$e(),[j,b]=r.useState({isOpen:!1,labelConfirmButton:"Delete",message:"",onConfirm:async()=>{}}),{props:M}=Me();console.log("props",M.auth);const w=((W=M.auth)==null?void 0:W.permission)||[],F=r.useCallback(async(s,i,y,d,n,D)=>{G(!0);const be=d.length>0?d[0].field:"id",Ne=d.length>0?d[0].sort:"desc",Se=n.items.map(m=>`${m.field}=${m.operator},${m.value}`).join("&");try{const m=`${T||"?"}page=${s+1}&per_page=${i}&search=${y}&sort_by=${be}&sort_direction=${Ne}&approval=${D}&${Se}`;we(m);const Q=await O.get(`${a.url}${m}`);ce(Q.data.data.data),ge(Q.data.data.total)}catch(m){console.error("Error fetching data:",m)}finally{G(!1)}},[T,f,u,g,x,l]);r.useEffect(()=>{F(l.page,l.pageSize,g,f,u,x)},[F,u,l,g,f]);const V=async s=>{var i,y,d;h(!0);try{const n=await O.delete(`${a.deleteUrl}/${s}`);k(((i=n==null?void 0:n.data)==null?void 0:i.message)||"Record deleted successfully","success"),h(!1),b({...j,isOpen:!1}),p&&await p(s),F(l.page,l.pageSize,g,f,u,0)}catch(n){if(h(!1),Y.isAxiosError(n)){const D=((d=(y=n.response)==null?void 0:y.data)==null?void 0:d.message)||"Failed to delete record";k(D,"error")}else k("An unexpected error occurred","error");h(!1)}},ye=async s=>{var i,y,d;h(!0);try{const n=await O.post("api/approval/approval_or_rejceted",{id:s,type:a.cancelApproval,status:"Cancel",function_name:a.cancelApproval});k(((i=n==null?void 0:n.data)==null?void 0:i.message)||"cancel successfully","success"),h(!1),b({...j,isOpen:!1}),p&&await p(s),F(l.page,l.pageSize,g,f,u,0)}catch(n){if(h(!1),Y.isAxiosError(n)){const D=((d=(y=n.response)==null?void 0:y.data)==null?void 0:d.message)||"Failed to cancel record";k(D,"error")}else k("An unexpected error occurred","error");h(!1)}},ve=c||p||o||a.detailUrl||a.editUrl||a.deleteUrl||R?[{field:"actions",headerName:"Actions",width:250,renderCell:s=>e.jsx(e.Fragment,{children:ae==="dropdown"?e.jsxs(Ae,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(L,{variant:"ghost",className:"w-8 h-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"..."}),e.jsx(_e,{className:"w-4 h-4"})]})}),e.jsxs(Te,{align:"end",children:[e.jsx(Oe,{children:"Actions"}),(c||a.editUrl)&&x===0&&s.row.status_id==="6"&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.update)??""))&&e.jsx(_,{onClick:()=>c&&c(s.row.id),children:e.jsxs("span",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{children:"Edit"}),e.jsx(Re,{size:14})]})})}),e.jsx(Z,{}),(a.deleteUrl||p)&&x===0&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.delete)??""))&&e.jsx(_,{className:"bg-red-400 text-white hover:!bg-red-500 hover:!text-white transition-all duration-300",onClick:()=>b({isOpen:!0,labelConfirmButton:"Delete",message:ie??"Are you sure you want to delete this record?",onConfirm:async()=>{V(s.row.id)}}),children:e.jsxs("span",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("span",{children:"Delete"}),e.jsx(qe,{size:14})]})})}),e.jsx(Z,{}),(o||a.detailUrl)&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.detail)??""))&&e.jsx(_,{onClick:()=>{o&&o(s.row.id),a.detailUrl&&(window.location.href=`${a.detailUrl}/${s.row.id}`)},children:"View details"})})]})]}):e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[(o||a.detailUrl)&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.detail)??""))&&e.jsx(N,{href:a.detailUrl===""?"#":`${a.detailUrl}/${s.row.id}`,onClick:i=>{o&&(i.preventDefault(),o&&o(s.row.id))},alt:"detail",children:e.jsx("i",{className:"text-2xl ki-duotone ki-size text-info"})})}),(U||a.clone)&&e.jsx(e.Fragment,{children:(s.row.status_id=="6"||re)&&x===0&&e.jsx(N,{href:a.clone===""?"#":`${a.clone}/${s.row.id}`,onClick:i=>{U&&(i.preventDefault(),U&&U(s.row.id))},alt:"detail",children:e.jsx("i",{className:"text-2xl ki-filled ki-copy text-warning"})})}),(c||a.editUrl)&&x===0&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.update)??""))&&e.jsx(N,{href:a.editUrl===""?"#":`${a.editUrl}/${s.row.id}`,onClick:i=>{c&&(i.preventDefault(),c&&c(s.row.id))},alt:"edit",children:e.jsx("i",{className:"text-2xl ki-duotone ki-notepad-edit text-success"})})}),(a.deleteUrl||p)&&x===0&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.delete)??""))&&e.jsx(N,{href:"",onClick:i=>{i.preventDefault(),b({isOpen:!0,labelConfirmButton:"Delete",message:"Are you sure you want to delete this record?",onConfirm:async()=>{V(s.row.id)}})},alt:"delete",children:e.jsx("i",{className:"text-2xl ki-duotone ki-trash-square text-danger"})})}),a.cancelApproval&&(s.row.status_id===1||s.row.status_id===6)&&x===0?e.jsx(e.Fragment,{children:e.jsx(N,{href:"",onClick:i=>{i.preventDefault(),b({isOpen:!0,labelConfirmButton:"Cancel Approval",message:"Are you sure want to cancel this request?",onConfirm:async()=>{ye(s.row.id)}})},alt:"delete",children:e.jsx("i",{className:"text-2xl ki-filled ki-cross-square text-danger"})})}):e.jsx(e.Fragment,{}),R]})})}]:[],Ce=(s,i)=>{fe(i),F(l.page,l.pageSize,g,f,u,i)},ke=s=>e.jsxs(e.Fragment,{children:[le,e.jsx(Pe,{...s})]});return e.jsx(A,{children:e.jsx(A,{sx:{height:"45rem",width:"100%",overflowX:"auto"},children:e.jsxs(A,{sx:{width:"100%"},children:[ne&&((E=(X=M.auth)==null?void 0:X.user)==null?void 0:E.is_approval)&&e.jsx(A,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ie,{value:x,onChange:Ce,"aria-label":"dynamic tabs example",children:[e.jsx(ee,{label:"List",...se(0)},0),e.jsx(ee,{label:"Approval",...se(0)},1)]})}),e.jsx("div",{className:"mt-2 lg:col-span-2",children:e.jsx("div",{className:"grid",children:e.jsxs("div",{className:"h-full min-w-full card card-grid",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:e.jsxs("div",{className:"input input-sm max-w-48",children:[e.jsx("i",{className:"ki-filled ki-magnifier"}),e.jsx("input",{placeholder:B,type:"text",value:g,onChange:s=>je(s.target.value),style:{width:"100%",maxWidth:"200px",marginBottom:"10p"}})]})}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[($||a.addUrl)&&e.jsx(e.Fragment,{children:(!t||w.includes((t==null?void 0:t.create)??""))&&e.jsxs(N,{href:a.addUrl??"#",className:"btn btn-success",onClick:s=>{$&&(s.preventDefault(),$())},style:{marginRight:"10px",marginBottom:"10px"},children:[e.jsx("i",{className:"ki-filled ki-additem"}),"Add New"]})}),S&&e.jsx(I,{className:"btn",variant:"contained",onClick:()=>S(H),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Export TXT"}),M.auth.setting_export==((K=(J=M.auth)==null?void 0:J.user)==null?void 0:K.username)&&z&&e.jsx(I,{className:"btn",variant:"contained",onClick:()=>z&&z(),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Send TXT To Sap"}),C&&e.jsx(I,{className:"btn",variant:"contained",onClick:()=>C(H),color:"primary",disabled:q,startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:q?"Downloading...":"Export to Excel"}),P]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx(Ge,{isLoading:me,description:j.message,open:j.isOpen,labelConfirmButton:j.labelConfirmButton,onClose:()=>{b({...j,isOpen:!1})},onDelete:async()=>j.onConfirm()}),e.jsx("div",{"data-datatable":"true","data-datatable-page-size":l.pageSize,children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsx(Le,{rows:oe,columns:[...v,...ve],loading:de,paginationMode:"server",rowCount:ue,paginationModel:l,onPaginationModelChange:xe,pageSizeOptions:[10,20],sortingMode:"server",sortModel:f,onSortModelChange:s=>pe(s),filterMode:"server",filterModel:u,onFilterModelChange:s=>he(s),slots:{footer:ke}})})})]})]})})})]})})})};export{Ge as C,as as D};
