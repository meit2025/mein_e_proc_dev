import{r as c,u as Xe,j as e,b as ze}from"./app-CTEjkM9T.js";import{d as Je,F as w,a as y,b as S,c as v,e as We}from"./form-Bz4EEZIS.js";import{z as r,t as Ze}from"./index-CCz3hE3L.js";import{d as U}from"./index-DyT5y_in.js";import{B as He}from"./button-BUc3i3RM.js";import{T as Ke}from"./textarea-OX8whf_t.js";import{u as Qe,b as ae,c as Ue}from"./index.esm-Dg7NWkuJ.js";import{S as et}from"./scroll-area-DAcPLAMP.js";import{S as ee}from"./separator-DQxseeQl.js";/* empty css              */import{a as D}from"./axiosInstance-CfPkDIrb.js";import{W as tt}from"./WorkflowComponent-BHBActF_.js";import{F as at}from"./formSwitchCustom-B3jR25kI.js";import{I as B}from"./input-CjlgO8Pm.js";import{S as st,a as rt,b as nt,c as ot,d as it}from"./select-hjr8Yz_D.js";import{C as lt,a as ct,b as dt,c as pt}from"./api-CqjDNrFC.js";import{G as te,a as ut}from"./api-BEQetkWJ.js";import{h as I}from"./moment-C5S46NFB.js";import{BusinessTripType as j}from"./models-38kmLxDS.js";import{u as b}from"./getDropdown-BU22c9zx.js";import{F as Y}from"./formDropdown-BJkWFbYH.js";import{f as mt}from"./rupiahCurrencyFormat-CP-6egij.js";import{BussinesTripDestination as _t}from"./BussinesTripDestination-DYC8t1SM.js";import{B as ht}from"./Button-hcgRKCeG.js";import"./app-DQK4SJPx.js";import"./index-BbBrteZV.js";import"./utils-DjewYIwZ.js";import"./index-DdX9oUgp.js";import"./index-t-o5r8uw.js";import"./index-Bb4qSo10.js";import"./index-XaFoCoek.js";import"./index-CmGmCpkw.js";import"./createSvgIcon-C3eBrWbK.js";import"./DefaultPropsProvider-CKbXK8Dc.js";import"./createLucideIcon-6fUFtR7z.js";import"./Switch-BX3jYaHd.js";import"./createSimplePaletteValueFilter-DTGIBwWJ.js";import"./SwitchBase-NY3gXJth.js";import"./FormHelperText-pfFCFS0T.js";import"./useControlled-BXQ-5LV7.js";import"./index-X2ehrpBS.js";import"./index-vXXSdlNZ.js";import"./Combination-Cq-TvyKf.js";import"./index-GkTaVV3Q.js";import"./index-DLmlzjWp.js";import"./CustomStatus-DdmZYzHZ.js";import"./TextField-CVRKDIr5.js";import"./useSlot-CR-Oi6oH.js";import"./tabs-DiBgFNOr.js";import"./index-rL06bPGE.js";import"./BussinessDestinationForm-D4bt55oq.js";import"./CustomDatePicker-DsYIwucM.js";import"./DetailAttedances-BaJAH20C.js";import"./DetailAllowance-C1zh6Cab.js";import"./chevrons-up-down-BnfUvltV.js";import"./ResultTotalItem-Bpuu3Jd3.js";import"./checkbox-BRaDbRsv.js";r.object({remark:r.string().min(1).max(50),reimburse_cost:r.number()});const ft=1*1024*1024,gt=["heic","image/jpeg","image/jpg","image/png","image/heic","image/heif","application/pdf"],Ta=({users:A,listPurposeType:se,pajak:q,costcenter:k,purchasingGroup:R,type:h,id:f,isAdmin:u,idUser:m})=>{const re=r.object({purpose_type_id:r.string().min(1,"Purpose type required"),request_for:r.string().min(1,"Request is required"),cost_center_id:r.string().min(1,"Cost Center is required"),remark:r.string().min(1,"Remark is required"),attachment:r.array(r.instanceof(File).refine(t=>gt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(t=>t.size<=ft,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:r.number().min(1,"Total Destinantion Required"),cash_advance:r.boolean().nullable().optional(),total_percent:r.string().nullable().optional(),total_cash_advance:r.string().nullable().optional(),destinations:r.array(r.object({destination:r.string().min(1,"Destinantion is Required"),restricted_area:r.boolean().nullable().optional(),pajak_id:r.string().min(1,"Pajak is required"),purchasing_group_id:r.string().min(1,"Purchasing Group is required"),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.date().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),default_price:r.number().optional(),type:r.string().optional(),subtotal:r.number().optional(),currency:r.string().optional(),detail:r.array(r.object({date:r.date().nullish(),request_price:r.any().optional()}))}))}))}).superRefine(({cash_advance:t,total_percent:a},s)=>{if(t===!0)if(!a||a.trim()==="")s.addIssue({code:r.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent is required"});else{const o=Number(a);(isNaN(o)||o<1||o>100)&&s.addIssue({code:r.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent must be a number between 1 and 100"})}}),[M,ne]=c.useState("1"),n=Qe({resolver:Ze(re),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",restricted_area:!1,pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[V,$]=c.useState([]),[oe,ie]=c.useState(null),[G,L]=c.useState([]);async function le(){const t=dt(f);n.setValue("destinations",[]);try{const s=(await ze.get(t)).data.data;console.log(s,"data");const o=te(s.purpose_type_id,s.request_for.id),i=await D.get(o);L(i.data.data),O("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:s.purpose_type.type}}),ie(s.request_no),$(s.attachments),n.setValue("purpose_type_id",s.purpose_type_id.toString()),n.setValue("request_for",s.request_for.id.toString()),n.setValue("cost_center_id",s.cost_center.cost_center.toString()),n.setValue("remark",s.remarks),n.setValue("total_destination",s.total_destination),n.setValue("cash_advance",s.cash_advance==1),n.setValue("total_percent",s.total_percent),n.setValue("total_cash_advance",s.total_cash_advance),n.setValue("destinations",s.destinations.map(d=>({destination:d.destination,restricted_area:d.restricted_area==1,pajak_id:d.pajak.mwszkz,purchasing_group_id:d.purchasing_group.purchasing_group,business_trip_start_date:new Date(d.business_trip_start_date),business_trip_end_date:new Date(d.business_trip_end_date),detail_attedances:d.detail_attedances.map(l=>({...l,date:new Date(l.date)})),allowances:d.allowances.map(l=>({...l,default_price:parseInt(l.default_price),subtotal:parseInt(l.subtotal),detail:l.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?new Date(p.date):null}))}))})))}catch{}}const{dataDropdown:ce,getDropdown:O}=b(),[X,de]=c.useState(u==="0"?m==null?void 0:m.toString():""),[pe,ue]=c.useState([]);async function me(){const t=u=="0"?m||"":X||"",a=pt(t),s=await D.get(a);ue(s.data.data)}async function _e(t){n.setValue("purpose_type_id",t||"");const a=u=="0"?m||"":X||"",s=te(t,a),o=ut(t);try{const i=await D.get(s);console.log(i,"response");const d=await D.get(o);L(i.data.data),O("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:d.data.data.purpose.type}})}catch(i){console.log(i)}}const[he,z]=c.useState([]),fe=t=>{n.setValue("total_destination",parseInt(t,10)),ne(t),J(),z([])},{showToast:N}=Xe(),ge=async t=>{console.log(n.formState.errors.attachment),console.log(t," valuesss");try{const a=new FormData,s=W();a.append("user_id",t.request_for??""),a.append("value",s.toString()),a.append("purpose_type_id",t.purpose_type_id??""),a.append("request_for",t.request_for??""),a.append("cost_center_id",t.cost_center_id??""),a.append("remark",t.remark??""),a.append("cash_advance",`${t.cash_advance}`),a.append("total_percent",`${t.total_percent}`),a.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((o,i)=>{o&&a.append(`attachment[${i}]`,o)}),a.append("total_destination",`${t.total_destination}`),t.destinations.forEach((o,i)=>{const d={...o,business_trip_start_date:I(o.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:I(o.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:o.detail_attedances.map(l=>({...l,date:I(l.date).format("YYYY-MM-DD")})),allowances:o.allowances.map(l=>({...l,detail:l.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?I(p.date).format("YYYY-MM-DD"):null}))}))};a.append(`destinations[${i}]`,JSON.stringify(d))}),h==j.create?(await U.Inertia.post(lt,a,{headers:{"Content-Type":"multipart/form-data"}}),N("succesfully created data","success")):(V.forEach((o,i)=>{o&&a.append(`file_existing[${i}]`,JSON.stringify(o))}),await U.Inertia.post(`${ct}/${f}`,a,{headers:{"Content-Type":"multipart/form-data"}}),N("succesfully updated data","success"))}catch(a){console.log(a)}};function J(){const t=[],a=parseInt(M);for(let s=0;s<a;s++)t.push({destination:"",business_trip_start_date:"",business_trip_end_date:"",pajak_id:"",purchasing_group_id:"",restricted_area:!1,allowances:[],detail_attedances:[]});n.setValue("destinations",t)}const{fields:xe,append:xt,remove:jt,update:je}=ae({control:n.control,name:"destinations"}),[be,we]=c.useState(!1);c.useEffect(()=>{f&&h==j.clone&&(le(),we(!0))},[h]),c.useEffect(()=>{h==j.create&&J(),me()},[M,G,u,m]);const[ye,Se]=c.useState(!1),[T,Te]=c.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),De=(t,a)=>{var s;return t.type==="total"?parseFloat(((s=a==null?void 0:a[0])==null?void 0:s.request_price)||0):a==null?void 0:a.reduce((o,i)=>o+parseFloat(i.request_price||0),0)},W=()=>n.getValues("destinations").reduce((s,o,i)=>{const l=(o.allowances||[]).reduce((p,F,C)=>{const P=n.getValues(`destinations.${i}.allowances.${C}.detail`),E=De(F,P);return p+E},0);return s+l},0),ve=async()=>{var t,a,s,o,i,d,l,p,F,C,P,E;try{const g=W();if(g===0){N("Please fill the balance","error");return}const x=await D.get("/check-approval",{params:{value:g,user_id:n.getValues("request_for"),type:"TRIP"}});if(x.data.status_code===200){const Ge=(a=(t=x.data)==null?void 0:t.data)==null?void 0:a.approval.map(_=>(_==null?void 0:_.division_name)||null),Le=(o=(s=x.data)==null?void 0:s.data)==null?void 0:o.approval.map(_=>(_==null?void 0:_.name)||null),Q=[];(d=(i=x.data)==null?void 0:i.data)!=null&&d.hr&&Q.push((F=(p=(l=x.data)==null?void 0:l.data)==null?void 0:p.hr)==null?void 0:F.name);const Oe=(((C=x.data.data)==null?void 0:C.approval)??[]).map(_=>({status:"",name:_.name,dateApproved:""}));Te({approvalRequest:Ge,approvalFrom:Le,acknowledgeFrom:Q,approvalFromStatusRoute:Oe}),Se(!0)}}catch(g){N((E=(P=g==null?void 0:g.response)==null?void 0:P.data)==null?void 0:E.message,"error")}};c.useEffect(()=>{},[n.watch("destinations")]);const Ne=t=>{$(a=>a.filter(s=>s.id!==t))},[Fe,Z]=c.useState(!1),Ce=t=>{Z(t)},H=Ue({control:n.control,name:"total_percent"}),[Pe,Ee]=c.useState(0),K=Pe;c.useEffect(()=>{h==j.clone&&Z(n.getValues("cash_advance")??!1);const a=parseFloat((H||"0").toString())/100*K;n.setValue("total_cash_advance",mt(a.toFixed(0),!1))},[H,K]);const{dataDropdown:Ie,getDropdown:Ae}=b(),{dataDropdown:qe,getDropdown:ke}=b(),{dataDropdown:Re,getDropdown:Ve}=b(),{dataDropdown:Ye,getDropdown:Be}=b(),{dataDropdown:Me,getDropdown:$e}=b();return c.useEffect(()=>{Ae("",{name:"name",id:"id",tabel:"users",idType:"string"}),ke("",{name:"name",id:"id",tabel:"purpose_types",idType:"string",softDelete:!0}),Ve("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",idType:"string",isMapping:!0,hiddenZero:!0}),Be("",{name:"description",id:"mwszkz",tabel:"pajaks",idType:"string",isMapping:!0}),$e("",{name:"purchasing_group_desc",id:"purchasing_group",tabel:"purchasing_groups",idType:"string",isMapping:!0})},[]),c.useEffect(()=>{h!=j.clone&&u=="0"&&n.setValue("request_for",(m==null?void 0:m.toString())??"")},[]),e.jsx(et,{className:"h-[600px] w-full ",children:e.jsx(Je,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(ge),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),be&&e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"From Request No."}),e.jsx("td",{className:"text-sm",children:oe})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Request For ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(Y,{fieldLabel:"",options:Ie,fieldName:"request_for",isRequired:!0,disabled:u=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{de(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussiness Trip Purpose Type",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(Y,{fieldLabel:"",options:qe,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,a)=>{await _e(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(Y,{fieldLabel:"",options:Re,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Remark",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:"remark",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(Ke,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(w,{control:n.control,name:"attachment",render:({field:t})=>e.jsxs(y,{children:[e.jsx(We,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(S,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",multiple:!0,onChange:a=>{const s=a.target.files;if(s){const o=Array.from(s);t.onChange(o)}else t.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((a,s)=>e.jsx("span",{children:a.message},s)):n.formState.errors.attachment.message})]})})})]}),V.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:V.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:t.file_name},a),e.jsx("button",{type:"button",onClick:()=>Ne(t.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]},a))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Total Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[" ",e.jsx(w,{control:n.control,name:"total_destination",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsxs(st,{value:t.value.toString(),onValueChange:fe,disabled:!1,children:[e.jsx(rt,{className:"w-[200px] py-2",children:e.jsx(nt,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(ot,{children:Array.from({length:5},(a,s)=>e.jsxs(it,{value:(s+1).toString(),children:[" ",s+1," "]},s))})]})}),e.jsx(v,{})]})})]})]})]}),e.jsx(ee,{className:"my-4"}),e.jsx(_t,{updateDestination:je,destinationField:xe,form:n,listAllowances:G,totalDestination:n.getValues("total_destination").toString(),pajak:q,purchasingGroup:R,setTotalAllowance:Ee,dataTax:Ye,dataPurchasingGroup:Me,dataDestination:ce,type:h,btClone:j.clone,dateBusinessTripByUser:pe,setSelectedDates:z,selectedDates:he}),e.jsx(ee,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(at,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Ce(t.target.checked)})})]}),Fe&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(w,{control:n.control,name:"total_percent",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(B,{type:"number",...t,value:t.value||"",className:"w-[50%]",onChange:a=>{const s=a.target.value;if(!/^\d*$/.test(s))return;const o=parseInt(s,10);o>=1&&o<=100?t.onChange(o):s===""&&t.onChange("")}})}),e.jsx(v,{})]})}),e.jsx(w,{control:n.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(B,{value:t.value||"",readOnly:!0,className:"w-[50%] mt-3"})}),e.jsx(v,{})]})})]})]})})]}),e.jsx(ht,{onClick:async()=>await ve(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ye&&e.jsx(tt,{workflowApproval:{approvalRequest:T.approvalRequest,approvalFrom:T.approvalFrom,acknowledgeFrom:T.acknowledgeFrom},workflowApprovalStep:T.approvalFromStatusRoute,workflowApprovalDiagram:T.approvalFrom})}),e.jsx(He,{type:"submit",children:"submit"})]})})})};function Da({form:A,type:se,allowanceIndex:q,destinationIndex:k}){const{fields:R}=ae({control:A.control,name:`destinations.${k}.allowances.${q}.detail`});return e.jsx(e.Fragment,{children:R.map((h,f)=>e.jsx(w,{control:A.control,name:`destinations.${k}.allowances.${f}.detail.${f}.request_price`,render:({field:u})=>e.jsxs(y,{children:[e.jsx(S,{children:e.jsx(B,{value:u.value,onChange:u.onChange})}),e.jsx(v,{})]})}))})}export{Da as AllowanceInputForm,Ta as BussinessTripFormV1};
