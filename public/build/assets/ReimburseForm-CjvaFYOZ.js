import{j as e,r as q,u as mt,X as ut}from"./app-CY5FGUEF.js";import{B as dt}from"./button-D-KcdkQT.js";import{h as Te}from"./moment-C5S46NFB.js";import{o as Re,a as xe,s as S,n as Ae,d as Ee,c as ke,i as pt,t as ht}from"./types-M94Y9RgV.js";import{f as J}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ft,F as R,a as A,b as E,c as k,I as Le,f as gt,e as bt}from"./form-5-a0WC0j.js";import{u as _t,b as jt}from"./index.esm-DQcVHJlZ.js";import{T as Ve}from"./textarea-UVXYuOaW.js";import{S as xt}from"./scroll-area-CqA5soOY.js";import{a as P}from"./axiosInstance-BNXwJ2J2.js";import{S as Ie}from"./separator-ChJldGLL.js";import{T as yt,a as wt,b as vt,c as Nt}from"./tabs-BThyHjpZ.js";import{S as X,a as K,b as Q,c as U,d as ee}from"./select-_BFoWwqB.js";import{F as de}from"./formDropdown-29vvBH3u.js";import{C as $e}from"./CustomDatePicker-j0KQ_HiV.js";import{ReimburseFormType as j}from"./listModel-mY0zvQlC.js";import{u as te}from"./getDropdown-goHczU0X.js";import{G as St,a as Be,b as Dt}from"./api-BeRu2Z8X.js";import{L as Ft}from"./LoadingSpin-f5DGE8Pl.js";import{W as Ct}from"./WorkflowComponent-CKj3HVYN.js";import{C as qt}from"./CustomStatus-B-C0TC3U.js";import{F as Me}from"./FormHelperText-C1NttfvJ.js";import{B as Tt}from"./Button-BYQVi-Nn.js";import"./app-ffJwujpg.js";import"./index-Hf7w8J0a.js";import"./index-nXjKXXPX.js";import"./utils-5_Qf24t9.js";import"./createLucideIcon-Dco_HSJr.js";import"./index-VqFmAkWY.js";import"./index-DVqzlFix.js";import"./index-CfCOz5Xj.js";import"./index-DFqI8gtt.js";import"./index-BVQCnu9v.js";import"./index-BdQq_4o_.js";import"./index-D5c0oQo1.js";import"./index-t8ezeMXA.js";import"./index-Bo3esNLR.js";import"./index-DH_y4ES_.js";import"./index-DbJ9goEm.js";import"./index-B3Er5I3R.js";import"./index-CQ80S96o.js";import"./TextField-D-0XMS3Y.js";import"./createSvgIcon-BYUG5R4f.js";import"./DefaultPropsProvider-DcQ2K9so.js";import"./useSlot-DkmaCMtR.js";import"./createSimplePaletteValueFilter-DHv6GQPD.js";import"./CircularProgress-BPuKThUk.js";import"./mergeSlotProps-l8XKMll6.js";function Rt({isLoading:z=!1,children:pe}){return e.jsx("div",{className:"",children:z?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(Ft,{})})}):pe})}const Ts=({onSuccess:z,currencies:pe,taxDefaultValue:ye,uomDefaultValue:we,edit_url:Pe,update_url:Ye,store_url:Ge,type:b,currentUser:V})=>{const[ve,Ne]=q.useState("form1"),{showToast:I}=mt(),{errors:At}=ut().props,{dataDropdown:se,getDropdown:ae}=te(St);te();const{dataDropdown:Oe,getDropdown:ze}=te(),{dataDropdown:re,getDropdown:ne}=te("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:le,getDropdown:ie}=te("api/master/cost-center/dropdown-list"),[M,he]=q.useState([]),[He,fe]=q.useState([]),[oe,We]=q.useState(null),[Se,Ze]=q.useState(!1),[Je,ce]=q.useState(!1),[w,Y]=q.useState([]),[Et,G]=q.useState([]),[kt,Lt]=q.useState([]),ge=q.useRef([]),H=q.useRef([]),[W,Xe]=q.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ke=1*1024*1024,Qe=["image/jpeg","image/png","image/svg+xml","application/pdf","image/heic","image/heif"],Ue=Re({formCount:S().min(1,"total form must be have value"),remark_group:S().min(1,"header remark is required"),cost_center:S().min(1,"cost center required"),requester:S().min(1,"requester required"),value:Ae().optional(),user_id:S().optional(),forms:xe(Re({reimburseId:S().optional(),for:S().optional(),group:S().optional(),reimburse_type:S().min(1,"reimburse type is required"),short_text:S().min(1,"remarks is required"),balance:S(),remaining_balance_when_request:Ae(),currency:S().min(1,"currency required"),tax_on_sales:S().min(1,"tax required"),purchase_requisition_unit_of_measure:S().min(1,"uom required"),purchasing_group:S().min(1,"Purchasing Group required"),type:ke(),item_delivery_data:Ee({required_error:"Receipt date is required"}),claim_date:Ee().min(new Date(new Date().setHours(0,0,0,0)),"Claim date must be today or greater"),attachment:xe(pt(File).refine(t=>Qe.includes(t.type),{message:"File type must be JPG, JPEG, PNG, SVG, HEIC, or PDF"}).refine(t=>t.size<=Ke,{message:"File size must be less than 1MB"})),savedAttachment:xe(ke()).optional().nullable()}).refine(t=>{const s=b===j.clone,n=b===j.create,m=Array.isArray(t.savedAttachment)&&t.savedAttachment.length>0,i=Array.isArray(t.attachment)&&t.attachment.length>0;return!(n&&!i||s&&!m&&!i)},{message:"Attachment is required",path:["attachment"]}))});q.useEffect(()=>{(async()=>{var n,m;(b===j.edit||b===j.clone)&&(ce(!0),await et()),ze("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=Number(ve.split("form")[1])-1;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(n=r.getValues("forms")[s])!=null&&n.purchasing_group?"id":"",value:((m=r.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&b===j.create&&Z(0)})()},[b]);async function et(){var t,s;r.setValue("forms",[]),ce(!0);try{const m=(await P.get(Pe??"")).data.data,i=m.forms??[],d=m.group;We(d.reimbursementStatus),G(i.map(o=>String(o.id)));const g=i.map((o,f)=>{const{id:_,for:p,group:T,reimburse_type:x,short_text:D,balance:$,currency:B,tax_on_sales:F,purchase_requisition_unit_of_measure:y,remaining_balance_when_request:C,purchasing_group:c,type:a,item_delivery_data:l,claim_date:u,reimburse_attachment:h}=o,v=i.slice(f).filter(L=>L.for===p&&L.reimburse_type.code===x.code);ge.current.push({id:String(_),reimburse_type:x.code,balance:v.reduce((L,me)=>L+Number(me.balance||0),0),limit:v.reduce(L=>L+1||0,0),for:String(p)});const O=H.current.findIndex(L=>L.reimburse_type===x.code&&L.for===String(p));return O!==-1?H.current[O].totalBalance=Number(H.current[O].totalBalance)+Number($||0):H.current.push({reimburse_type:x.code,totalBalance:Number($||0),for:String(p)}),{reimburseId:String(_),for:String(p),group:String(T),reimburse_type:x.code,short_text:D,balance:$,currency:B,tax_on_sales:String(F),purchase_requisition_unit_of_measure:String(y),remaining_balance_when_request:Number(C)||0,purchasing_group:String(c),type:a,item_delivery_data:new Date(l),claim_date:new Date(u),attachment:[],savedAttachment:h}});r.setValue("formCount",i.length.toString()),r.setValue("remark_group",d.remark),r.setValue("cost_center",String(d.cost_center.id)),r.setValue("requester",d.requester),r.setValue("forms",g);for(let o=0;o<i.length;o++){const f=i[o];await Z(o,{reimburse_type:f.reimburse_type.code}),await De(o,{type:f.type,reimburse_type:f.reimburse_type.code}),await _e(o,{reimburse_type:f.reimburse_type.code,for:f.reimburse_type.is_employee===1?null:f.for},!0)}ce(!1)}catch(n){const m=n;ce(!1),I((s=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:s.message,"error")}}const tt={formCount:"1",remark_group:"",cost_center:"",requester:String(V==null?void 0:V.is_admin)==="1"?"":V==null?void 0:V.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ye,purchase_requisition_unit_of_measure:we,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=_t({resolver:ht(Ue),defaultValues:tt}),{fields:be,update:N}=jt({control:r.control,name:"forms"}),Z=async(t,s=null)=>{const n=r.getValues("requester");if(n===null||n===""){he(i=>{const d=[...i];return d[t]=[],d});return}const m=await P.get(Be,{params:{user:n,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});he(i=>{const d=[...i];return d[t]=m.data.data,d})},st=async(t,s)=>{if(t&&t.length>0)try{const n=await P.get(Be,{params:{search:t,user:r.getValues("requester")}});he(m=>{const i=[...m];return i[s]=n.data.data,i})}catch(n){console.error("Error searching reimburse types:",n)}},De=async(t,s)=>{const n=await P.get(Dt,{params:{user:r.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});fe(m=>{const i=[...m];return i[t]=n.data.data,i})},at=t=>{for(let s=0;s<be.length;s++)Z(s);if(t==null)for(let s=0;s<be.length;s++)r.setValue(`forms.${s}.reimburse_type`,""),r.setValue(`forms.${s}.for`,"");Y([]),fe([])},Fe=(t,s)=>{const n=r.getValues("forms");n.forEach((m,i)=>{var d,g;if(i>t&&n[i].reimburse_type===s.reimburse_type){const o=((d=w[i])==null?void 0:d.balance)||0,f=((g=w[i])==null?void 0:g.limit)||0;Y(_=>{var T;const p=[..._];return p[i]={...p[i],balance:o+Number(s.balance||"0")},((T=w[i])==null?void 0:T.type_limit)!=="Unlimited"&&(p[i]={...p[i],limit:f+1}),p}),r.setValue(`forms.${i}.balance`,"")}})};function rt(t){const s=[...r.getValues("forms")];for(let n=0;n<Number(t);n++)if(n+1>s.length){Z(n);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:ye,purchase_requisition_unit_of_measure:we,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}r.setValue("forms",s)}const nt=t=>{Ne(t)},lt=async t=>{var n,m,i,d,g;if(w)for(let o=0;o<w.length;o++){if(t.forms.length==0||t.forms.length-1,((n=w[o])==null?void 0:n.type_limit)!=="Unlimited"&&Number((m=w[o])==null?void 0:m.limit)==0){I("Claim Limit for form "+(o+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[o].balance==""||Number(t.forms[o].balance)==0){I("Claim Balance for form "+(o+1)+" cannot be 0","error");return}if(Number(((i=w[o])==null?void 0:i.balance)??0)<Number(t.forms[o].balance??0)){I("Please check your balance input for forms "+(o+1)+"  is not must be above "+((d=w[o])==null?void 0:d.balance),"error");return}t.forms=t.forms.map((f,_)=>{var p;return{...f,claim_date:Te(f.claim_date).format("YYYY-MM-DD"),item_delivery_data:Te(f.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:Number(((p=w[_])==null?void 0:p.balance)??0)}})}const s=t.forms.reduce((o,f)=>o+Number(f.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let o;b===j.edit||b===j.clone?o=await P.post(Ye??"",t,{headers:{"Content-Type":"multipart/form-data"}}):o=await P.post(Ge??"",t,{headers:{"Content-Type":"multipart/form-data"}}),I((g=o==null?void 0:o.data)==null?void 0:g.data,"success"),z==null||z()}catch{}};async function _e(t,s=null,n=!1){var g,o,f;const m=r.getValues(`forms.${t}`);let i=!m.for||m.for===""?r.getValues("requester")||"":m.for;const d={user:r.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:m.reimburse_type,for:s!=null?s.for:i};try{const _=await P.get("reimburse/data-limit-and-balance",{params:d}),p=r.getValues("forms");let T=0,x=0,D=_.data.data.balance,$=_.data.data.limit,B=(a=!1)=>p.filter((l,u)=>{let h=!l.for||l.for===""?r.getValues("requester")||"":l.for;return l.reimburse_type===m.reimburse_type&&h===i&&(b===j.clone&&n&&!a?!0:u!==t)}),F=B(!0).length,y=B().reduce((a,l)=>a+Number(l.balance||0),0);if(b===j.clone){let a=((g=H.current.find(l=>l.reimburse_type===m.reimburse_type&&l.for===i))==null?void 0:g.totalBalance)??0;if(D+=a,n){let l=ge.current.find(u=>m.reimburseId==u.id);l&&(T=Number(l.balance),x=F+Number(l.limit),G(u=>{const h=[...u];return h[t]=l.id,h}))}else{let l=ge.current.find(u=>u.reimburse_type===m.reimburse_type&&u.for===i);l!==void 0&&(x=Number(l.limit),G(u=>{const h=[...u];return h[t]=l.id,h}))}}let C=D-y+T,c=Math.max(0,$-F+x);Y(a=>{const l=[...a];return l[t]={..._.data.data,balance:C,limit:_.data.data.type_limit==="Unlimited"?_.data.data.type_limit:c},l})}catch(_){const p=_;I((f=(o=p==null?void 0:p.response)==null?void 0:o.data)==null?void 0:f.message,"error")}}const Ce=async()=>{var t,s,n,m,i,d,g,o,f,_,p,T;try{const x=r.getValues("forms"),D=x.map((y,C)=>({index:C,value:y.balance?Number(y.balance):0}));if(D.some(y=>y.value===0)){const y=D.findIndex(C=>C.value===0);I(`Please fill balance form ${y+1}`,"error");return}const B=x.reduce((y,C)=>y+(Number(C.balance)||0),0),F=await P.get("/check-approval",{params:{value:B,requester:r.getValues("requester"),type:"REIM"}});if(F.data.status_code===200){const y=(s=(t=F.data)==null?void 0:t.data)==null?void 0:s.approval.map(u=>(u==null?void 0:u.division_name)||null),C=(m=(n=F.data)==null?void 0:n.data)==null?void 0:m.approval.map(u=>(u==null?void 0:u.name)||null),c=[];(d=(i=F.data)==null?void 0:i.data)!=null&&d.hr&&c.push((f=(o=(g=F.data)==null?void 0:g.data)==null?void 0:o.hr)==null?void 0:f.name);const a=(((_=F.data.data)==null?void 0:_.approval)??[]).map(u=>({status:"",name:u.name,dateApproved:""}));Xe({approvalRequest:y,approvalFrom:C,acknowledgeFrom:c,approvalFromStatusRoute:a}),Ze(!0)}}catch(x){const D=x;I((T=(p=D==null?void 0:D.response)==null?void 0:p.data)==null?void 0:T.message,"error")}};q.useEffect(()=>{r.getValues("forms").reduce((n,m)=>n+Number(m.balance)||0,0)>0&&Se===!0&&Ce()},[r.watch("forms"),r.watch("requester")]);const it=t=>{const s=t;if(Object.keys(s).length>0){let n=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,i])=>{m==="forms"?i.forEach((d,g)=>{n+=`</br><strong>Form ${g+1}:</strong></br>`,Object.values(d).forEach(o=>{n+=`<li>${o.message}</li>`})}):n+=`<li>${i.message}</li>`}),n+="</ul>",I(e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),"error")}};return e.jsx(xt,{className:"h-[600px] w-full",children:e.jsx(Rt,{isLoading:Je,children:e.jsx(ft,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(lt,t=>{it(t)}),children:[e.jsx("table",{className:"mt-4 w-full text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:oe&&e.jsx(qt,{name:oe.name,className:oe.classname,code:oe.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:"remark_group",render:({field:t})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Ve,{placeholder:"Insert remark",...t})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{fieldLabel:"",options:le,fieldName:"cost_center",disabled:b===j.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=le==null?void 0:le.some(n=>n.label===t);t.length>0&&!s?await ie(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=r.getValues("cost_center");ie("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{options:se,fieldName:"requester",disabled:String(V==null?void 0:V.is_admin)==="0"||b===j.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const n=se==null?void 0:se.some(m=>m.label===t);t.length>0&&!n?ae(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!n&&ae("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>at(t),onFocus:()=>{const t=r.getValues("requester");ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:b===j.edit,onValueChange:n=>{t.onChange(n),rt(n);const m=r.getValues("forms");let i=Number(n);if(m.length>i){const d=m.slice(0,i);r.setValue("forms",d),Y(g=>{let o=[...g];return o=o.slice(0,i),o}),Ne(`form${Math.max(1,i)}`),G(g=>{const o=[...g];return o[i]="",o})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"Select number of forms"})}),e.jsx(U,{children:Array.from({length:3},(n,m)=>m+1).map(n=>e.jsx(ee,{value:n.toString(),children:n},n))})]})}),e.jsx(k,{})]})}})})]})]})}),e.jsx(Ie,{className:"my-4"}),e.jsxs(yt,{value:ve,onValueChange:nt,className:"w-full",children:[e.jsxs(wt,{className:"flex justify-start items-center space-x-4",children:[" ",Array.from({length:Number(r.watch("formCount"))||1}).map((t,s)=>e.jsxs(vt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),be.map((t,s)=>{var n,m,i,d,g,o,f,_,p,T,x,D,$,B,F,y,C;return e.jsxs(Nt,{value:`form${s+1}`,children:[e.jsx(R,{control:r.control,name:`forms.${s}.reimburseId`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Le,{className:"sr-only",value:t.reimburseId,onChange:c.onChange})}),e.jsx(k,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{options:M[s],fieldName:`forms.${s}.reimburse_type`,disabled:M[s]===void 0||M[s].length===0||b===j.edit,placeholder:"Select Reimburse Type",onSearch:async c=>{var l;((l=M[s])==null?void 0:l.some(u=>u.label===c))||await st(c,s)},onChangeOutside:async c=>{if(c){const a=M[s].filter(u=>u.value==c)[0];N(s,{...t,reimburse_type:c,type:a.is_employee===1?"Employee":"Family",balance:""}),a.is_employee===1?_e(s,{reimburse_type:c,for:null}):(Y(u=>{const h=[...u];return h[s]=[],h}),r.setValue(`forms.${s}.balance`,""),r.setValue(`forms.${s}.for`,""),De(s,{type:"Family",reimburse_type:c}));const l=r.getValues(`forms.${s}.reimburse_type`);c!==l&&(G(u=>{const h=[...u];return h[s]="",h}),Fe(s,t))}else Y(a=>{const l=[...a];return l[s]=[],l}),N(s,{...t,reimburse_type:"",type:"",balance:""}),G(a=>{const l=[...a];return l[s]="",l}),r.setValue(`forms.${s}.for`,""),fe(a=>{const l=[...a];return l[s]=[],l}),Fe(s,t)},onFocus:()=>{Z(s)},classNames:"mt-2 w-full"}),((i=(m=(n=r.formState.errors)==null?void 0:n.forms)==null?void 0:m[s])==null?void 0:i.reimburse_type)&&e.jsx(Me,{error:!0,children:(f=(o=(g=(d=r.formState.errors)==null?void 0:d.forms)==null?void 0:g[s])==null?void 0:o.reimburse_type)==null?void 0:f.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${s}.for`,render:({field:c})=>{var a,l,u,h;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:((u=(l=(a=M==null?void 0:M[s])==null?void 0:a.filter(v=>(v==null?void 0:v.value)==r.getValues(`forms.${s}.reimburse_type`)))==null?void 0:l[0])==null?void 0:u.is_employee)===1||b===j.edit,onValueChange:v=>{N(s,{...t,for:v}),_e(s,{reimburse_type:r.getValues(`forms.${s}.reimburse_type`),for:v})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(h=He[s])==null?void 0:h.map(v=>e.jsx(ee,{value:v.value.toString(),children:v.label},v.value))})]})}),e.jsx(k,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{fieldLabel:"",options:re,fieldName:`forms.${s}.purchasing_group`,disabled:b===j.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:async c=>{const a=re==null?void 0:re.some(l=>l.label===c);return c.length>0&&!a?await ne(c,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:c}):c.length==0&&!a&&await ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),[]},onChangeOutside:c=>{c&&N(s,{...t,purchasing_group:c})},onFocus:()=>{var a;const c=(a=r.getValues("forms")[s])==null?void 0:a.purchasing_group;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:c?"id":"",value:c??""}})}}),((T=(p=(_=r.formState.errors)==null?void 0:_.forms)==null?void 0:p[s])==null?void 0:T.purchasing_group)&&e.jsx(Me,{error:!0,children:(B=($=(D=(x=r.formState.errors)==null?void 0:x.forms)==null?void 0:D[s])==null?void 0:$.purchasing_group)==null?void 0:B.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${s}.tax_on_sales`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:!0,onValueChange:a=>{N(s,{...t,tax_on_sales:a})},defaultValue:t.tax_on_sales,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(Oe??[]).map((a,l)=>e.jsxs(ee,{value:a.value.toString(),children:[a.description," - ",a.label]},a.value))})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:!0,onValueChange:a=>{N(s,{...t,purchase_requisition_unit_of_measure:String(a)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:e.jsx(ee,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${s}.short_text`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Ve,{placeholder:"Insert remark",onChange:a=>{N(s,{...t,short_text:a.target.value})},defaultValue:t.short_text})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((F=w[s])==null?void 0:F.balance)&&J((y=w[s])==null?void 0:y.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(C=w[s])==null?void 0:C.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${s}.item_delivery_data`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx($e,{disabled:b===j.edit,initialDate:c.value instanceof Date?c.value:new Date(c.value),onDateChange:a=>{c.onChange(a),N(s,{...t,item_delivery_data:a})}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(R,{control:r.control,name:`forms.${s}.claim_date`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx($e,{disabled:b===j.edit,initialDate:c.value instanceof Date?c.value:new Date(c.value),disabledDays:[{before:new Date}],onDateChange:a=>{c.onChange(a),N(s,{...t,claim_date:a})}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid grid-cols-7 gap-x-4 w-full",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(R,{control:r.control,name:`forms.${s}.currency`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(X,{disabled:b===j.edit,onValueChange:a=>{N(s,{...t,currency:a})},defaultValue:t.currency,children:[e.jsx(K,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:pe.map(a=>e.jsxs(ee,{value:a.code,children:[a.name," (",a.code,")"]},a.code))})]})}),e.jsx(gt,{className:"h-6"}),e.jsx(k,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(R,{control:r.control,name:`forms.${s}.balance`,render:({field:c})=>{var a;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Le,{type:"text",placeholder:"0",onChange:l=>{var me;const u=l.target.value.replace(/[^0-9]/g,""),h=J(u,!1),v=Number(u)||0,O=((me=w[s])==null?void 0:me.balance)||0;if(v>O){l.target.value=J(u.slice(0,-1),!1);return}N(s,{...t,balance:u}),l.target.value=h,r.getValues("forms").forEach((qe,ue)=>{if(ue>s&&qe.reimburse_type===t.reimburse_type){const ot=O-v;Y(ct=>{const je=[...ct];return je[ue]={...je[ue],balance:ot},je}),N(ue,{...qe,balance:""})}})},defaultValue:J(t.balance,!1),value:J(t.balance,!1),disabled:typeof w[s]>"u"||((a=w[s])==null?void 0:a.length)===0||b===j.edit})}),e.jsx(k,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(R,{control:r.control,name:`forms.${s}.attachment`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(bt,{className:"mb-1 text-xs font-extralight text-gray-500",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(E,{children:e.jsx("input",{className:"flex px-3 py-1 w-full h-9 text-xs bg-transparent rounded-md border shadow-sm transition-colors border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:a=>{const l=a.target.files;if(l){const u=[...t.attachment],h=Array.from(l);u.push(...h),N(s,{...t,attachment:u})}}})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((c,a)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:c.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const l=t.attachment.filter((u,h)=>h!==a);N(s,{...t,attachment:l})},children:"Delete"})]},a))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((c,a)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:c.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const l=t.savedAttachment.filter((u,h)=>h!==a);N(s,{...t,savedAttachment:l})},children:"Delete"})]},a))})})]})]})]})]})})})]},s)})]}),e.jsx(Tt,{onClick:async()=>await Ce(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Se&&e.jsx(Ct,{workflowApproval:{approvalRequest:W.approvalRequest,approvalFrom:W.approvalFrom,acknowledgeFrom:W.acknowledgeFrom},workflowApprovalStep:W.approvalFromStatusRoute,workflowApprovalDiagram:W.approvalFrom})}),e.jsx(Ie,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(dt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{Ts as ReimburseForm};
