import{r as d,u as Ze,j as e,b as He}from"./app-wlSHIb_E.js";import{d as Ke,F as S,a as T,b as D,c as P,e as Ue}from"./form-DeYsMDL1.js";import{z as s,t as Qe}from"./index-BRMEvI6m.js";import{d as ne}from"./index-840isExB.js";import{B as et}from"./button-BG_igVCr.js";import{T as tt}from"./textarea-Bj6YOAfU.js";import{u as at,b as le,c as st}from"./index.esm-HHx1czAs.js";import{S as rt}from"./scroll-area-B-G5-S_E.js";import{S as oe}from"./separator-Bcu_6C8M.js";/* empty css              */import{a as C}from"./axiosInstance-BTW9VV81.js";import{W as nt}from"./WorkflowComponent-DG95FJEm.js";import{F as ot}from"./formSwitchCustom-BanCfe6w.js";import{I as L}from"./input-4r9FkGdw.js";import{S as it,a as lt,b as ct,c as dt,d as pt}from"./select-D6yHKpey.js";import{a as ut,C as mt,b as _t,c as ht,d as ft}from"./api-C1Ya95ai.js";import{G as ie,a as gt}from"./api-BG2DVmVj.js";import{h as A}from"./moment-C5S46NFB.js";import{BusinessTripType as w}from"./models-O11mdGAo.js";import{u as y}from"./getDropdown-DKeFPkN2.js";import{F as G}from"./formDropdown-DxYlFcS4.js";import{f as xt}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{BussinesTripDestination as jt}from"./BussinesTripDestination-BdA5nY-o.js";import{B as bt}from"./Button-QIZEJNjA.js";import"./app-DQK4SJPx.js";import"./index-BChdf78I.js";import"./utils-DRASTpdU.js";import"./index-JS2_TWzO.js";import"./index-hhp1xoPr.js";import"./index-Bb4qSo10.js";import"./createLucideIcon-DgPooR_V.js";import"./index-5GMMpWXr.js";import"./index-yfNBk7L_.js";import"./index-DNDwt071.js";import"./index-BdQq_4o_.js";import"./createSvgIcon-Bola7c5D.js";import"./DefaultPropsProvider-DODuLDnH.js";import"./Switch-BHuM5Kkf.js";import"./createSimplePaletteValueFilter-Ln_iJLmC.js";import"./SwitchBase-BC-Mgp5P.js";import"./FormHelperText-DXuK7Kn3.js";import"./useControlled-DtDT1GsD.js";import"./index-BjiUBjt5.js";import"./index-Bw7n-fZI.js";import"./Combination-DARmsn93.js";import"./index-gadb_U6j.js";import"./index-DwRjoxB8.js";import"./CustomStatus-7ru4Pkgy.js";import"./TextField-gQyOCt70.js";import"./useSlot-DBDiJELM.js";import"./tabs-BIPg-I5E.js";import"./index-C_DW2YfR.js";import"./BussinessDestinationForm-DqgdUzGU.js";import"./CustomDatePicker-uEOxlLkL.js";import"./DetailAttedances-D1gadd6q.js";import"./DetailAllowance-BlPmj3tF.js";import"./chevrons-up-down-Bj_wdpuB.js";import"./ResultTotalItem-CXYTq_1P.js";import"./checkbox-DLH_KxlG.js";s.object({remark:s.string().min(1).max(50),reimburse_cost:s.number()});const wt=1*1024*1024,yt=["heic","image/jpeg","image/jpg","image/png","image/heic","image/heif","application/pdf"],Ea=({users:V,listPurposeType:ce,pajak:R,costcenter:Y,purchasingGroup:B,type:g,id:x,isAdmin:_,idUser:h})=>{const de=s.object({purpose_type_id:s.string().min(1,"Purpose type required"),request_for:s.string().min(1,"Request is required"),cost_center_id:s.string().min(1,"Cost Center is required"),remark:s.string().min(1,"Remark is required"),attachment:s.array(s.instanceof(File).refine(t=>yt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(t=>t.size<=wt,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:s.number().min(1,"Total Destinantion Required"),cash_advance:s.boolean().nullable().optional(),total_percent:s.number().nullable().optional(),total_cash_advance:s.string().nullable().optional(),destinations:s.array(s.object({destination:s.string().min(1,"Destinantion is Required"),restricted_area:s.boolean().nullable().optional(),pajak_id:s.string().min(1,"Pajak is required"),purchasing_group_id:s.string().min(1,"Purchasing Group is required"),business_trip_start_date:s.date().optional(),business_trip_end_date:s.date().optional(),detail_attedances:s.array(s.object({date:s.date().optional(),shift_code:s.string().optional(),shift_start:s.string().optional(),shift_end:s.string().optional(),start_time:s.string().optional(),end_time:s.string().optional(),start_date:s.date().optional(),end_date:s.date().optional()})),allowances:s.array(s.object({name:s.string().optional(),code:s.string().optional(),default_price:s.number().optional(),type:s.string().optional(),subtotal:s.number().optional(),currency:s.string().optional(),detail:s.array(s.object({date:s.date().nullish(),request_price:s.any().optional()}))})).min(1,"Allowances tidak boleh kosong")}))}).superRefine(({cash_advance:t,total_percent:n},a)=>{if(t===!0)if(!n||n.toString().trim()==="")a.addIssue({code:s.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent is required"});else{const l=Number(n);(isNaN(l)||l<1||l>100)&&a.addIssue({code:s.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent must be a number between 1 and 100"})}}),[v,O]=d.useState("1"),r=at({resolver:Qe(de),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,total_percent:0,total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",restricted_area:!1,pajak_id:"V0",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[$,X]=d.useState([]),[pe,ue]=d.useState(null),[z,J]=d.useState([]);async function me(){const t=ft(x);r.setValue("destinations",[]);try{const a=(await He.get(t)).data.data;console.log(a,"data");const l=ie(a.purpose_type_id,a.request_for.id),o=await C.get(l);J(o.data.data),W("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.purpose_type.type}}),ue(a.request_no),X(a.attachments),r.setValue("purpose_type_id",a.purpose_type_id.toString()),r.setValue("request_for",a.request_for.id.toString()),r.setValue("cost_center_id",a.cost_center.cost_center.toString()),r.setValue("remark",a.remarks),r.setValue("total_destination",a.total_destination),r.setValue("cash_advance",a.cash_advance==1),r.setValue("total_percent",a.total_percent),r.setValue("total_cash_advance",a.total_cash_advance),r.setValue("destinations",a.destinations.map(i=>({destination:i.destination,restricted_area:i.restricted_area==1,pajak_id:i.pajak.mwszkz,purchasing_group_id:i.purchasing_group.purchasing_group,business_trip_start_date:new Date(i.business_trip_start_date),business_trip_end_date:new Date(i.business_trip_end_date),detail_attedances:i.detail_attedances.map(c=>({...c,date:new Date(c.date),start_date:new Date(c.start_date),end_date:new Date(c.end_date)})),allowances:i.allowances.map(c=>({...c,default_price:parseInt(c.default_price),subtotal:parseInt(c.subtotal),detail:c.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?new Date(p.date):null}))}))})))}catch{}}const{dataDropdown:_e,getDropdown:W}=y(),[Z,he]=d.useState(_==="0"?h==null?void 0:h.toString():""),[fe,ge]=d.useState([]);async function xe(){const t=_=="0"?h||0:Z||0,n=ht(t),a=await C.get(n);ge(a.data.data)}async function je(t){r.setValue("purpose_type_id",t||"");const n=_=="0"?h||"":Z||"",a=ie(t,n),l=gt(t);try{const o=await C.get(a),i=await C.get(l);J(o.data.data),W("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:i.data.data.purpose.type}})}catch(o){console.log(o)}}const[be,H]=d.useState([]),we=t=>{r.setValue("total_destination",parseInt(t,10)),O(t),U(),H([])},[ye,M]=d.useState("destination1");d.useEffect(()=>{parseInt(v,10)<1?O("1"):M(`destination${v}`)},[v]);const{showToast:N}=Ze(),[Se,K]=d.useState(!1),Te=async t=>{var l;if(!await r.trigger()){const o=r.formState.errors;for(let i=0;i<Q.length;i++)if((l=o==null?void 0:o.destinations)!=null&&l[i]){M(`destination${i+1}`);break}return}const a=ee();if(a===0){N("Please add at least one destination","error");return}try{K(!0);const o=new FormData;o.append("user_id",t.request_for??""),o.append("value",a.toString()),o.append("purpose_type_id",t.purpose_type_id??""),o.append("request_for",t.request_for??""),o.append("cost_center_id",t.cost_center_id??""),o.append("remark",t.remark??""),o.append("cash_advance",`${t.cash_advance}`),o.append("total_percent",`${t.total_percent}`),o.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((i,c)=>{i&&o.append(`attachment[${c}]`,i)}),o.append("total_destination",`${t.total_destination}`),t.destinations.forEach((i,c)=>{const p={...i,business_trip_start_date:A(i.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:A(i.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:i.detail_attedances.map(u=>({...u,date:A(u.date).format("YYYY-MM-DD")})),allowances:i.allowances.map(u=>({...u,detail:u.detail.map(m=>({...m,date:(m==null?void 0:m.date)!=null?A(m.date).format("YYYY-MM-DD"):null}))}))};o.append(`destinations[${c}]`,JSON.stringify(p))}),g==w.create?(await ne.Inertia.post(mt,o,{headers:{"Content-Type":"multipart/form-data"}}),N("succesfully created data","success")):($.forEach((i,c)=>{i&&o.append(`file_existing[${c}]`,JSON.stringify(i))}),await ne.Inertia.post(`${_t}/${x}`,o,{headers:{"Content-Type":"multipart/form-data"}}),N("succesfully updated data","success")),setTimeout(()=>{K(!1)},1e3)}catch(o){console.log(o)}};function U(){const t=[],n=parseInt(v);for(let a=0;a<n;a++)t.push({destination:"",business_trip_start_date:"",business_trip_end_date:"",pajak_id:"V0",purchasing_group_id:"",restricted_area:!1,allowances:[],detail_attedances:[]});r.setValue("destinations",t)}const{fields:Q,append:St,remove:Tt,update:De}=le({control:r.control,name:"destinations"}),[ve,Ne]=d.useState(!1);d.useEffect(()=>{g==w.create&&U(),xe()},[v,z,_,h]);const[Fe,Ce]=d.useState(!1),[F,Pe]=d.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Ee=(t,n)=>{var a;return t.type==="total"?parseFloat(((a=n==null?void 0:n[0])==null?void 0:a.request_price)||0):n==null?void 0:n.reduce((l,o)=>l+parseFloat(o.request_price||0),0)},ee=()=>r.getValues("destinations").reduce((a,l,o)=>{const c=(l.allowances||[]).reduce((p,u,m)=>{const k=r.getValues(`destinations.${o}.allowances.${m}.detail`),q=Ee(u,k);return p+q},0);return a+c},0),Ie=async()=>{var t,n,a,l,o,i,c,p,u,m,k,q;try{const j=ee();if(j===0){N("Please fill the balance","error");return}const b=await C.get("/check-approval",{params:{value:j,user_id:r.getValues("request_for"),type:"TRIP"}});if(b.data.status_code===200){const ze=(n=(t=b.data)==null?void 0:t.data)==null?void 0:n.approval.map(f=>(f==null?void 0:f.division_name)||null),Je=(l=(a=b.data)==null?void 0:a.data)==null?void 0:l.approval.map(f=>(f==null?void 0:f.name)||null),re=[];(i=(o=b.data)==null?void 0:o.data)!=null&&i.hr&&re.push((u=(p=(c=b.data)==null?void 0:c.data)==null?void 0:p.hr)==null?void 0:u.name);const We=(((m=b.data.data)==null?void 0:m.approval)??[]).map(f=>({status:"",name:f.name,dateApproved:""}));Pe({approvalRequest:ze,approvalFrom:Je,acknowledgeFrom:re,approvalFromStatusRoute:We}),Ce(!0)}}catch(j){N((q=(k=j==null?void 0:j.response)==null?void 0:k.data)==null?void 0:q.message,"error")}};d.useEffect(()=>{},[r.watch("destinations")]);const ke=t=>{X(n=>n.filter(a=>a.id!==t))},[qe,te]=d.useState(!1),Ae=t=>{te(t)},ae=st({control:r.control,name:"total_percent"}),[Ve,Re]=d.useState(0),se=Ve;d.useEffect(()=>{g==w.clone&&te(r.getValues("cash_advance")??!1);const n=parseFloat((ae||"0").toString())/100*se;r.setValue("total_cash_advance",xt(n.toFixed(0),!1))},[ae,se]);const{dataDropdown:E,getDropdown:I}=y(ut),{dataDropdown:Ye,getDropdown:Be}=y(),{dataDropdown:$e,getDropdown:Me}=y(),{dataDropdown:Ge,getDropdown:Le}=y(),{dataDropdown:Oe,getDropdown:Xe}=y();return d.useEffect(()=>{(async()=>{x&&g==w.clone&&(await me(),Ne(!0)),console.log(r.getValues("request_for")),I("",{name:"name",id:"id",tabel:"users",hasValue:{key:r.getValues("request_for")?"id":"",value:r.getValues("request_for")??""},idType:"string"}),Be("",{name:"name",id:"id",tabel:"purpose_types",idType:"string",softDelete:!0}),Me("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",idType:"string",isMapping:!0,hiddenZero:!0}),Le("",{name:"description",id:"mwszkz",tabel:"pajaks",idType:"string",isMapping:!0}),Xe("",{name:"purchasing_group_desc",id:"purchasing_group",tabel:"purchasing_groups",idType:"string",isMapping:!0})})()},[g]),d.useEffect(()=>{g!=w.clone&&_=="0"&&r.setValue("request_for",(h==null?void 0:h.toString())??"")},[]),e.jsx(rt,{className:"h-[600px] w-full ",children:e.jsx(Ke,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Te),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),ve&&e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"From Request No."}),e.jsx("td",{className:"text-sm",children:pe})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Request For ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(G,{fieldLabel:"",options:E,fieldName:"request_for",isRequired:!0,disabled:_=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onSearch:(t,n)=>{const a=E==null?void 0:E.some(l=>l.label===t);t.length>0&&!a?I(t,{name:"name",id:"id",tabel:"users",search:t,idType:"string"}):t.length==0&&!a&&I("",{name:"name",id:"id",tabel:"users",idType:"string"})},onChangeOutside:t=>he(t),onFocus:()=>{let t=r.getValues("request_for");I("",{name:"name",id:"id",tabel:"users",hasValue:{key:t?"id":"",value:t??""},idType:"string"})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussiness Trip Purpose Type",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(G,{fieldLabel:"",options:Ye,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,n)=>{await je(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(G,{fieldLabel:"",options:$e,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Remark",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(S,{control:r.control,name:"remark",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(tt,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(P,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(S,{control:r.control,name:"attachment",render:({field:t})=>e.jsxs(T,{children:[e.jsx(Ue,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(D,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",multiple:!0,onChange:n=>{const a=n.target.files;if(a){const l=Array.from(a);t.onChange(l)}else t.onChange([])}})}),r.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(r.formState.errors.attachment)?r.formState.errors.attachment.map((n,a)=>e.jsx("span",{children:n.message},a)):r.formState.errors.attachment.message})]})})})]}),$.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:$.map((t,n)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:t.file_name},n),e.jsx("button",{type:"button",onClick:()=>ke(t.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]},n))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Total Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[" ",e.jsx(S,{control:r.control,name:"total_destination",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsxs(it,{value:t.value.toString(),onValueChange:we,disabled:!1,children:[e.jsx(lt,{className:"w-[200px] py-2",children:e.jsx(ct,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(dt,{children:Array.from({length:5},(n,a)=>e.jsxs(pt,{value:(a+1).toString(),children:[" ",a+1," "]},a))})]})}),e.jsx(P,{})]})})]})]})]}),e.jsx(oe,{className:"my-4"}),e.jsx(jt,{updateDestination:De,destinationField:Q,form:r,listAllowances:z,totalDestination:r.getValues("total_destination").toString(),pajak:R,purchasingGroup:B,setTotalAllowance:Re,dataTax:Ge,dataPurchasingGroup:Oe,dataDestination:_e,type:g,btClone:w.clone,dateBusinessTripByUser:fe,setSelectedDates:H,selectedDates:be,setActiveTab:M,activeTab:ye}),e.jsx(oe,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(ot,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Ae(t.target.checked)})})]}),qe&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(S,{control:r.control,name:"total_percent",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(L,{type:"number",...t,value:t.value||"",className:"w-[50%]",onChange:n=>{const a=n.target.value;if(!/^\d*$/.test(a))return;const l=parseInt(a,10);l>=1&&l<=100?t.onChange(l):a===""&&t.onChange("")}})}),e.jsx(P,{})]})}),e.jsx(S,{control:r.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(L,{value:t.value||"",readOnly:!0,className:"w-[50%] mt-3"})}),e.jsx(P,{})]})})]})]})})]}),e.jsx(bt,{onClick:async()=>await Ie(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Fe&&e.jsx(nt,{workflowApproval:{approvalRequest:F.approvalRequest,approvalFrom:F.approvalFrom,acknowledgeFrom:F.acknowledgeFrom},workflowApprovalStep:F.approvalFromStatusRoute,workflowApprovalDiagram:F.approvalFrom})}),e.jsx(et,{type:"submit",loading:Se,children:"submit"})]})})})};function Ia({form:V,type:ce,allowanceIndex:R,destinationIndex:Y}){const{fields:B}=le({control:V.control,name:`destinations.${Y}.allowances.${R}.detail`});return e.jsx(e.Fragment,{children:B.map((g,x)=>e.jsx(S,{control:V.control,name:`destinations.${Y}.allowances.${x}.detail.${x}.request_price`,render:({field:_})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(L,{value:_.value,onChange:_.onChange})}),e.jsx(P,{})]})}))})}export{Ia as AllowanceInputForm,Ea as BussinessTripFormV1};
