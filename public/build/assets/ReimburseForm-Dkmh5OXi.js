import{r as _,u as oe,q as le,j as e}from"./app-Ccg0rK5P.js";import{B as ce}from"./button-CrWHOi-a.js";import{z as l,t as ie}from"./index-BHqF9g1S.js";import{F as de,a as c,b as i,c as d,d as h}from"./form-CP_tihsD.js";import{u as he}from"./index.esm-sWff9vC1.js";import{T as $}from"./textarea-DbLKYSCF.js";/* empty css                  */import{S as me}from"./scroll-area-D0YvIFHn.js";import{a as y}from"./axiosInstance-NzqJUoCL.js";import{S as F}from"./separator-BjmnlXj9.js";import{T as xe,a as je,b as ue,c as pe}from"./tabs-CqIomsA-.js";import{S as x,a as j,b as u,c as p,d as g}from"./select-CDdJaQ7n.js";import{C as S}from"./CustomDatePicker-CzBJ1BrY.js";import{I as q}from"./input-Bmzg1aDV.js";import{F as ge}from"./utils-BxH0655H.js";import{u as fe}from"./getDropdown-BhJOeKT9.js";import"./app-HlhieNAw.js";import"./index-cUwhs4EX.js";import"./index-BTbjKoTW.js";import"./index-C48WW_ql.js";import"./index-gJHXcEkY.js";import"./index-DZoyLqkb.js";import"./index-BZSNuBM1.js";import"./index-BVi_cE7c.js";import"./Combination-BzC-iJQT.js";import"./index-Hc4OiIvN.js";import"./createLucideIcon-DsqrfOyV.js";const We=({onSuccess:_e,purchasing_groups:R,currencies:T,categories:k,periods:E,users:A,taxes:I,cost_center:B,edit_url:L,update_url:ye,store_url:z,type:P})=>{const[U,G]=_.useState("form1"),{showToast:w}=oe();le().props;const[we,M]=_.useState(1),[D,O]=_.useState([]),[v,H]=_.useState([[]]),[ve,J]=_.useState(),[K,Q]=_.useState([]),[C,W]=_.useState([[]]),{dataDropdown:X,getDropdown:Y}=fe(),Z=l.object({formCount:l.string().min(1,"total form must be have value"),remark_group:l.string().optional(),cost_center:l.string().min(1,"cost center required"),requester:l.string().min(1,"requester required"),forms:l.array(l.object({id:l.string().optional(),for:l.string().optional(),group:l.string().optional(),reimburse_type:l.string().min(1,"reimburse type required"),short_text:l.string().optional(),balance:l.string().optional(),currency:l.string().optional(),tax_on_sales:l.string().optional(),uom:l.string().optional(),purchasing_group:l.string().optional(),period:l.string().optional(),type:l.string().optional(),item_delivery_data:l.date(),start_date:l.date(),end_date:l.date()}))}),a=he({resolver:ie(Z),defaultValues:{formCount:"1",remark_group:"test",cost_center:"test",requester:"",forms:Array.from({length:1}).map(()=>({id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:0,currency:"IDR",tax_on_sales:"",uom:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date}))}}),ee=o=>{M(o);const r=a.getValues("forms"),n=Array.from({length:o}).map((m,t)=>r[t]||{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:0,currency:"IDR",tax_on_sales:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date});a.setValue("forms",n),a.setValue("formCount",o.toString())};async function re(){try{const r=(await y.get(L)).data.data[0];a.setValue("remark_group",r.remark),a.setValue("cost_center",r.cost_center),a.setValue("requester",r.users.nip),a.setValue("formCount",r.reimburses.length.toString()),a.setValue("forms",r.reimburses.map(n=>({id:n.id,for:n.for,group:n.group,reimburse_type:n.reimburse_type,short_text:n.short_text,balance:Number(n.balance),currency:n.currency,tax_on_sales:n.tax_on_sales,purchasing_group:n.purchasing_group,period:n.period,type:n.type,item_delivery_data:new Date(n.item_delivery_data),start_date:new Date(n.start_date),end_date:new Date(n.end_date)}))),r.reimburses.forEach((n,m)=>{N(m,n.reimburse_type)})}catch(o){w(o,"error")}}_.useEffect(()=>{P===ge.edit&&re()}),_.useEffect(()=>{Y("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms"})},[]);const se=async o=>{try{const n=(await y.get(`/family/show/${o}`)).data;Q(n),J(o),a.setValue("requester",o)}catch(r){const m=r.response.data;w(m.message,"error")}},te=o=>{G(o)};async function N(o,r){try{const m=(await y.get(`reimburse/type/${r}`??"")).data.data;H(t=>{const s=[...t];return s[o]=m,s}),W(t=>{const s=[...t];return s[o]=r==="Family",s}),a.setValue(`forms.${o}.type`,r)}catch(n){const t=n.response.data;w(t.message,"error")}}const ae=async(o,r,n,m,t)=>{const f=(await y.post("/reimburse/is_required",{user:r,is_employee:n,type:m,period:t})).data.data;O(b=>{const V=[...b];return V[o]={plafon:f==null?void 0:f.plafon,limit:f==null?void 0:f.limit},V}),a.setValue(`forms.${o}.for`,r)},ne=async o=>{try{const r=await y.post(z??"",o);console.log(o),w("succesfully created data","success")}catch(r){console.log(r)}};return e.jsx(me,{className:"h-[600px] w-full",children:e.jsx(de,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(ne),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsx("tr",{children:e.jsx("td",{width:200,children:"Reimburse Request No."})}),e.jsx("tr",{children:e.jsx("td",{width:200,children:"Request Status"})}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"remark_group",render:({field:o})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx($,{placeholder:"Insert remark",...o})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"cost_center",render:({field:o})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:r=>o.onChange(r),value:o.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:B.map(r=>e.jsx(g,{value:r.id.toString(),children:r.cost_center},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"requester",render:({field:o})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:r=>se(r),value:o.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"Requester"})}),e.jsx(p,{children:A.map(r=>e.jsxs(g,{value:r.nip,children:[r.name," [",r.nip,"]"]},r.nip))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:"formCount",render:({field:o})=>{var r;return e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:n=>ee(n),value:(r=o.value)==null?void 0:r.toString(),children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"Select number of forms"})}),e.jsx(p,{children:Array.from({length:20},(n,m)=>m+1).map(n=>e.jsx(g,{value:n.toString(),children:n},n))})]})}),e.jsx(h,{})]})}})})]})]})}),e.jsx(F,{className:"my-4"}),e.jsxs(xe,{value:U,onValueChange:te,className:"w-full",children:[e.jsxs(je,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((o,r)=>e.jsxs(ue,{value:`form${r+1}`,children:["Form ",r+1]},r))]}),Array.from({length:a.watch("formCount")||1}).map((o,r)=>{var n,m;return e.jsxs(pe,{value:`form${r+1}`,children:[e.jsx(c,{control:a.control,name:`forms.${r}.id`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(q,{className:"sr-only",value:t.value,onChange:t.onChange})}),e.jsx(h,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:a.control,name:`forms.${r}.type`,render:({field:t})=>e.jsxs(x,{onValueChange:s=>N(r,s),value:t.value,children:[e.jsx(j,{children:e.jsx(u,{placeholder:"Select type"})}),e.jsx(p,{children:k.map(s=>e.jsx(g,{value:s,children:s},s))})]})}),e.jsx(c,{control:a.control,name:`forms.${r}.reimburse_type`,render:({field:t})=>e.jsxs(x,{disabled:!v[r]||v[r].length===0,onValueChange:s=>a.setValue(`forms.${r}.reimburse_type`,s),value:t.value,children:[e.jsx(j,{children:e.jsx(u,{placeholder:"Select detail"})}),e.jsx(p,{children:v[r]&&v[r].map(s=>e.jsx(g,{value:s.code,children:s.name},s.code))})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.purchasing_group`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:s=>t.onChange(s),value:t.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:R.map(s=>e.jsxs(g,{value:s.id.toString(),children:[s.purchasing_group_desc," - ",s.purchasing_group]},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.period`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:s=>t.onChange(s),value:t.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:E.map(s=>e.jsxs(g,{value:s.code,children:[s.start," - ",s.end," (",s.code,")"]},s.code))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.for`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{disabled:!C[r]||C[r].length===0,onValueChange:s=>ae(r,s,!C[r],a.getValues(`forms.${r}.reimburse_type`),a.getValues(`forms.${r}.period`)),value:t.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:K.map(s=>e.jsx(g,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Tax"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.tax_on_sales`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:s=>t.onChange(s),value:t.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:I.map(s=>e.jsx(g,{value:s.id.toString(),children:s.mwszkz},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Uom"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.uom`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:s=>t.onChange(s),value:t.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:(X??[]).map((s,f)=>e.jsx(g,{value:s.value.toString(),children:s.label},s.value))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.short_text`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx($,{placeholder:"Insert remark",...t})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsx("td",{children:(n=D[r])==null?void 0:n.plafon})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Limit per claim"}),e.jsx("td",{children:(m=D[r])==null?void 0:m.limit})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.item_delivery_data`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(S,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:s=>t.onChange(s)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(c,{control:a.control,name:`forms.${r}.start_date`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(S,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:s=>t.onChange(s)})}),e.jsx(h,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(c,{control:a.control,name:`forms.${r}.end_date`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(S,{initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:s=>t.onChange(s)})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:a.control,name:`forms.${r}.currency`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(x,{onValueChange:s=>t.onChange(s),value:t.value,children:[e.jsx(j,{className:"w-[200px]",children:e.jsx(u,{placeholder:"-"})}),e.jsx(p,{children:T.map(s=>e.jsxs(g,{value:s.code,children:[s.name," (",s.code,")"]},s.code))})]})}),e.jsx(h,{})]})}),e.jsx(c,{control:a.control,name:`forms.${r}.balance`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx(q,{type:"number",placeholder:"0.0",...t,onChange:s=>t.onChange(Number(s.target.value)),value:t.value||0})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(c,{control:a.control,name:`forms.${r}.attachment`,render:({field:t})=>e.jsxs(i,{children:[e.jsx(d,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:s=>{const f=s.target.files;if(f){const b=Array.from(f);t.onChange(b)}}})}),e.jsx(h,{})]})})})]})]})})})]},r)})]}),e.jsx(F,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(ce,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{We as ReimburseForm};
