import{r as d,j as e,u as Y}from"./app-BOjS1G36.js";import{F as H,a as o,b as t,c as n,d as h,e as v}from"./form-VFcjn9mT.js";import{z as l,t as K}from"./index-DlH4TA2o.js";import{B}from"./button-sww3pA8a.js";import{u as $,b as J}from"./index.esm-AGEark6h.js";import{S as Q}from"./scroll-area-CEElgfio.js";import{S as E,a as D,b as P,c as U,d as V}from"./select-DkZsoCPt.js";import{I}from"./input-yuHJshSP.js";import{a as w}from"./axiosInstance-CKW7bq9X.js";import{R as O,a as C}from"./radio-group-DMUJrEOT.js";import{M as W}from"./MultiSelect-XiTGckHM.js";import{a as X}from"./api-BySVmGlY.js";import{c as Z,F as f}from"./utils-j_8TWWs2.js";import{C as k,a as ee,b as re,c as ae,d as se,e as te,f as ne}from"./command-DmyA7Ta6.js";import{P as le,a as ie,b as oe}from"./popover-uMUdzIFz.js";import{L as ce}from"./LoadingSpin-BLmpoIxT.js";import{C as de}from"./chevrons-up-down-DXUffNXs.js";import"./app-HlhieNAw.js";import"./index-BkduZ3lj.js";import"./index-DWOikKGh.js";import"./index-CQ6TIfMB.js";import"./index-DFBaxLEB.js";import"./Combination-DaDr2YXt.js";import"./index-ltEgiJBu.js";import"./index-CAO7WugR.js";import"./index-CVi0g3Js.js";import"./index-DQAIzLvg.js";import"./index-BGJg-jco.js";import"./checkbox-DTAd1d1o.js";import"./createLucideIcon-CuLsWuTU.js";import"./dialog-C4hCgPoi.js";function z({url:i,filter:c,id:u,label:F,value:j,onSelectChange:q,defaultLabel:p,disabled:T,placeholder:S="Search items ..."}){var a;const[g,L]=d.useState(!1),[m,M]=d.useState([]),[A,N]=d.useState(!1),[s,b]=d.useState("");let y;async function _(){const r={filter:c,search:s};N(!0);try{let x=await w.get(i,{params:r});N(!1),M(x.data.data)}catch(x){console.log(x)}}function G(r){r.key==="Enter"&&(clearTimeout(y),_())}d.useEffect(()=>(y=setTimeout(()=>{s&&_()},500),()=>clearTimeout(y)),[s]);function R(r){q(r),L(!1)}return d.useEffect(()=>{g?_():b("")},[g]),e.jsxs(le,{open:g,onOpenChange:L,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(B,{variant:"outline",disabled:T,role:"combobox","aria-expanded":g,className:"w-[200px] text-xs justify-between",children:[e.jsx(de,{className:"opacity-50"}),p&&m.length===0?p:null,j&&m.length>0?(a=m.find(r=>String(r[u])===String(j)))==null?void 0:a[F]:"",j===""&&(p===""||p===null)?S:""]})}),e.jsx(oe,{className:"w-[200px] p-0",children:e.jsxs(k,{shouldFilter:!1,children:[e.jsx(ee,{onKeyDown:G,onValueChange:r=>b(r),placeholder:S}),e.jsx(re,{className:"z-30",children:A?e.jsx("div",{className:"py-10 flex items-center justify-center h-64 w-full",children:e.jsx(ce,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ae,{children:["No Item found. ",m.length]}),m.length>0?e.jsx(se,{className:"z-30",children:m.map(r=>e.jsxs(te,{className:"z-30",value:r[u],onSelect:x=>{R(r[u])},children:[r[F],e.jsx(ne,{className:Z("ml-auto",j===r[u]?"opacity-100":"opacity-0")})]},r[u]))}):null]})})]})})]})}var me=(i=>(i[i.create=0]="create",i[i.edit=1]="edit",i[i.update=2]="update",i))(me||{});function Ye({onSuccess:i,type:c=f.create,detailUrl:u,id:F,listCurrency:j,listAllowanceCategory:q,listGrade:p,createUrl:T,editUrl:S}){const g=l.object({code:l.string().min(1,"Code is required"),name:l.string().min(1,"Name is required"),type:l.string().min(1,"Type is required"),material_number:l.string().min(1,"Material number required"),material_group:l.string().min(1,"Material Group required"),currency_id:l.string().min(1,"Currency is required"),allowance_category_id:l.string().min(1,"Allowance Category is required"),request_value:l.string().min(1,"Required"),grade_option:l.string().min(1,"Grade must be selected"),grade_all_price:l.string().optional(),grades:l.array(l.object({grade:l.string(),id:l.number(),plafon:l.string()}))}),[L,m]=d.useState([]),[M,A]=d.useState(""),N={code:"",name:"",type:"",currency_id:"",allowance_category_id:"",request_value:"unlimited",grade_option:"all",grade_all_price:"0",grades:[]},s=$({resolver:K(g),defaultValues:N});async function b(){try{const a=await w.get(u??""),r=a.data.data.allowance;R(r.material_group);const x=a.data.data.grades;s.reset({code:r.code,name:r.name,type:r.type,material_number:r.material_group,material_group:r.material_group,currency_id:r.currency_id,allowance_category_id:r.allowance_category_id,request_value:r.request_value,grade_option:r.grade_option,grade_all_price:r.grade_all_price,grades:x})}catch{}}const{fields:y}=J({control:s.control,name:"grades"});console.log("type",c);const{showToast:_}=Y(),G=async a=>{try{if(console.log(a),c===f.create){const r=await w.post(T??"",a)}else if(c===f.edit){const r=await w.put(S??"",a)}_("success","success"),i==null||i(!0)}catch(r){r.response&&_(r.response.data.message,"error")}};async function R(a){try{const r=await w.get(X(a));s.setValue("material_group",a),m(r.data.data)}catch(r){console.log(r)}}return d.useEffect(()=>{(c===f.detail||c===f.edit)&&b()},[c]),e.jsx(Q,{className:"h-[600px] w-full",children:e.jsx(H,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(G),children:[e.jsxs("table",{className:"text-xs mt-4 table font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"code",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(I,{type:"text",readOnly:c===f.edit,placeholder:"Insert code",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Name"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"name",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(I,{type:"text",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"type",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(E,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(D,{className:"w-[200px]",children:e.jsx(P,{placeholder:"Select type"})}),e.jsxs(U,{children:[e.jsx(V,{value:"daily",children:"DAILY"},"DAILY"),e.jsx(V,{value:"total",children:"Total"},"TOTAL")]})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Group"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"material_group",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(z,{onSelectChange:r=>{a.onChange(r),A("api/master/master-material/get-dropdown-master-material-number/by-material-group/"+r),s.setValue("material_number","")},value:a.value,placeholder:"Select material group",filter:["material_group"],id:"material_group",label:"material_group",url:"api/master/master-material/get-dropdown-master-material-group"})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Material Number ",s.getValues("material_number")]}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"material_number",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(z,{onSelectChange:r=>{a.onChange(r)},value:a.value,filter:["material_number"],id:"material_number",label:"material_number",url:M})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Currency"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"currency_id",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(E,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(D,{className:"w-[200px]",children:e.jsx(P,{placeholder:"Select Currency"})}),e.jsx(U,{children:j.map(r=>e.jsxs(V,{value:r.code,children:[r.name," ",r.code]},r.code))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Allowance Category"}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"allowance_category_id",render:({field:a})=>e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(E,{onValueChange:r=>a.onChange(r),value:a.value,children:[e.jsx(D,{className:"w-[200px]",children:e.jsx(P,{placeholder:"Select Allowance Category"})}),e.jsx(U,{children:q.map(r=>e.jsx(V,{value:r.id.toString(),children:r.name},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Grade"}),e.jsxs("td",{children:[e.jsx(o,{control:s.control,name:"grade_option",render:({field:a})=>e.jsx(t,{children:e.jsx(n,{children:e.jsxs(O,{onValueChange:a.onChange,defaultValue:a.value,className:"flex flex space-x-1",children:[e.jsxs(t,{className:"flex text-xs items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(C,{value:"all"})}),e.jsx(v,{className:"text-xs",children:"All"})]}),e.jsxs(t,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(C,{value:"grade"})}),e.jsx(v,{className:"text-xs",children:"Grade"})]})]})})})}),s.getValues("grade_option")==="all"?e.jsx("div",{children:e.jsx(o,{control:s.control,name:"grade_all_price",render:({field:a})=>e.jsx(t,{children:e.jsx(n,{children:e.jsx(I,{...a})})})})}):e.jsx("div",{children:e.jsx(W,{label:"grade",id:"id",options:p,value:s.getValues("grades").map(a=>a.id),onSelect:a=>{s.setValue("grades",a.map(r=>({id:r.id,grade:r.grade,plafon:""})))}})}),s.getValues("grade_option")==="grade"?e.jsx("div",{className:"mt-4",children:e.jsx("table",{children:y.map((a,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Grade ",a.grade]}),e.jsx("td",{children:":"}),e.jsx("td",{children:e.jsx("div",{children:e.jsx(o,{control:s.control,name:`grades.${r}.plafon`,render:({field:x})=>e.jsx(t,{children:e.jsx(n,{children:e.jsx(I,{...x})})})})})})]},a))})}):null]})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Request Value ",s.getValues("request_value")]}),e.jsx("td",{children:e.jsx(o,{control:s.control,name:"request_value",render:({field:a})=>e.jsx(t,{children:e.jsx(n,{children:e.jsxs(O,{onValueChange:a.onChange,defaultValue:a.value,className:"flex flex space-x-1",children:[e.jsxs(t,{className:"flex text-xs items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(C,{value:"unlimited"})}),e.jsx(v,{className:"text-xs",children:"Unlimited"})]}),e.jsxs(t,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(C,{value:"up to max value"})}),e.jsx(v,{className:"text-xs",children:"Up To Max Value"})]}),e.jsxs(t,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(n,{children:e.jsx(C,{value:"fixed value"})}),e.jsx(v,{className:"text-xs",children:"Fixed Value"})]})]})})})})})]})]}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(B,{type:"submit",children:"Save"})})]})})})}export{me as AllowanceType,Ye as default};
