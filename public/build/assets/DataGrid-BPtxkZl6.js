import{j as e,r,u as we,q as ye,a as F,b as G}from"./app-BIQWs0tC.js";import{a as A}from"./axiosInstance-DJ6m79NN.js";import{D as ve,b as Ce,c as ke}from"./dialog-CRjugmPE.js";import{B as z}from"./button-DQGcOJFv.js";import{L as be}from"./LoadingSpin-BgJsiZCW.js";import{D as Se,a as Ne,b as $e,c as Me,d as D,e as E}from"./dropdown-menu-DuwWICbf.js";import{D as Fe}from"./index-r__z5hpL.js";import{c as Q}from"./createLucideIcon-X-uHaetc.js";import{B}from"./Box-DbxZZIAi.js";import{T as Ue,a as X}from"./Tabs-B9S-MKZU.js";import{B as J}from"./Button-HxabPRrW.js";import{D as Be}from"./DataGrid-BVdhr_WF.js";const Ae=({open:u,onOpenChange:O,onDelete:b,onClose:j,children:t,className:U,isLoading:c,title:x,description:l,labelConfirmButton:S="Delete"})=>e.jsx(ve,{open:u,onOpenChange:j,children:e.jsxs(Ce,{className:U||"md:max-w-[768px]",children:[l||"Are you sure delete this item?",e.jsxs(ke,{children:[j?e.jsx(z,{variant:"outline",onClick:j,children:"Close"}):null,b?e.jsx(e.Fragment,{children:c?e.jsx(be,{}):e.jsx(z,{type:"submit",onClick:b,children:S})}):null]})]})});/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Q("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=Q("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),K=u=>({id:`simple-tab-${u}`,"aria-controls":`simple-tabpanel-${u}`}),Je=({columns:u,buttonCustome:O,onExport:b,onExportXls:j,url:t,labelFilter:U="Search",onEdit:c,onDelete:x,onDetail:l,onCreate:S,onClone:Oe,defaultSearch:T,actionType:Y,buttonActionCustome:L,deleteConfirmationText:Z,titleConfirmationText:Te,isHistory:ee=!1,role:s})=>{var q,H,V;const[se,ae]=r.useState([]),[te,I]=r.useState(!1),[o,ie]=r.useState({page:0,pageSize:10}),[w,ne]=r.useState([]),[y,re]=r.useState({items:[]});r.useState(null);const[le,p]=r.useState(!1),[v,oe]=r.useState(0),[ce,de]=r.useState(0),[C,xe]=r.useState(""),[P,pe]=r.useState(""),{showToast:k}=we(),[m,N]=r.useState({isOpen:!1,labelConfirmButton:"Delete",message:"",onConfirm:async()=>{}}),{props:_}=ye(),f=((q=_.auth)==null?void 0:q.permission)||[],$=r.useCallback(async(a,i,g,d,n,M)=>{I(!0);const ge=d.length>0?d[0].field:"id",ue=d.length>0?d[0].sort:"desc",je=n.items.map(h=>`${h.field}=${h.operator},${h.value}`).join("&");try{const h=`${T||"?"}page=${a+1}&per_page=${i}&search=${g}&sort_by=${ge}&sort_direction=${ue}&approval=${M}&${je}`;pe(h);const W=await A.get(`${t.url}${h}`);ae(W.data.data.data),de(W.data.data.total)}catch(h){console.error("Error fetching data:",h)}finally{I(!1)}},[t]);r.useEffect(()=>{$(o.page,o.pageSize,C,w,y,0)},[$,y,o,C,w]);const R=async a=>{var i,g,d;p(!0);try{const n=await A.delete(`${t.deleteUrl}/${a}`);k(((i=n==null?void 0:n.data)==null?void 0:i.message)||"Record deleted successfully","success"),p(!1),N({...m,isOpen:!1}),x&&await x(a),$(o.page,o.pageSize,C,w,y,0)}catch(n){if(p(!1),G.isAxiosError(n)){const M=((d=(g=n.response)==null?void 0:g.data)==null?void 0:d.message)||"Failed to delete record";k(M,"error")}else k("An unexpected error occurred","error");p(!1)}},he=async a=>{var i,g,d;p(!0);try{const n=await A.post("api/approval/approval_or_rejceted",{id:a,type:t.cancelApproval,status:"Cancel",function_name:t.cancelApproval});k(((i=n==null?void 0:n.data)==null?void 0:i.message)||"cancel successfully","success"),p(!1),N({...m,isOpen:!1}),x&&await x(a),$(o.page,o.pageSize,C,w,y,0)}catch(n){if(p(!1),G.isAxiosError(n)){const M=((d=(g=n.response)==null?void 0:g.data)==null?void 0:d.message)||"Failed to cancel record";k(M,"error")}else k("An unexpected error occurred","error");p(!1)}},me=c||x||l||t.detailUrl||t.editUrl||t.deleteUrl||L?[{field:"actions",headerName:"Actions",width:250,renderCell:a=>e.jsx(e.Fragment,{children:Y==="dropdown"?e.jsxs(Se,{children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(z,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"..."}),e.jsx(Fe,{className:"h-4 w-4"})]})}),e.jsxs($e,{align:"end",children:[e.jsx(Me,{children:"Actions"}),(c||t.editUrl)&&v===0&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.update)??""))&&e.jsx(D,{onClick:()=>c&&c(a.row.id),children:e.jsxs("span",{className:"flex items-center text-sm space-x-2",children:[e.jsx("span",{children:"Edit"}),e.jsx(De,{size:14})]})})}),e.jsx(E,{}),(t.deleteUrl||x)&&v===0&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.delete)??""))&&e.jsx(D,{className:"bg-red-400 text-white hover:!bg-red-500 hover:!text-white transition-all duration-300",onClick:()=>N({isOpen:!0,labelConfirmButton:"Delete",message:Z??"Are you sure you want to delete this record?",onConfirm:async()=>{R(a.row.id)}}),children:e.jsxs("span",{className:"flex items-center  text-sm space-x-2",children:[e.jsx("span",{children:"Delete"}),e.jsx(ze,{size:14})]})})}),e.jsx(E,{}),(l||t.detailUrl)&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.detail)??""))&&e.jsx(D,{onClick:()=>{l&&l(a.row.id),t.detailUrl&&(window.location.href=`${t.detailUrl}/${a.row.id}`)},children:"View details"})})]})]}):e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[(l||t.detailUrl)&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.detail)??""))&&e.jsx(F,{href:t.detailUrl===""?"#":`${t.detailUrl}/${a.row.id}`,onClick:i=>{l&&(i.preventDefault(),l&&l(a.row.id))},alt:"detail",children:e.jsx("i",{className:" ki-duotone ki-size text-info text-2xl"})})}),(c||t.editUrl)&&v===0&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.update)??""))&&e.jsx(F,{href:t.editUrl===""?"#":`${t.editUrl}/${a.row.id}`,onClick:i=>{c&&(i.preventDefault(),c&&c(a.row.id))},alt:"edit",children:e.jsx("i",{className:" ki-duotone ki-notepad-edit text-success text-2xl"})})}),(t.deleteUrl||x)&&v===0&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.delete)??""))&&e.jsx(F,{href:"",onClick:()=>R(a.row.id),alt:"delete",children:e.jsx("i",{className:" ki-duotone ki-trash-square text-danger text-2xl"})})}),t.cancelApproval&&a.row.status_id===1&&v===0?e.jsx(e.Fragment,{children:e.jsx(F,{href:"",onClick:i=>{i.preventDefault(),N({isOpen:!0,labelConfirmButton:"Cancel Approval",message:"Are you sure you want to cancel this record?",onConfirm:async()=>{he(a.row.id)}})},alt:"delete",children:e.jsx("i",{className:"ki-filled ki-cross-square text-danger text-2xl"})})}):e.jsx(e.Fragment,{}),L]})})}]:[],fe=(a,i)=>{oe(i),$(o.page,o.pageSize,C,w,y,i)};return e.jsx(B,{children:e.jsx(B,{sx:{height:"45rem",width:"100%",overflowX:"auto"},children:e.jsxs(B,{sx:{width:"100%"},children:[ee&&((V=(H=_.auth)==null?void 0:H.user)==null?void 0:V.is_approval)&&e.jsx(B,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ue,{value:v,onChange:fe,"aria-label":"dynamic tabs example",children:[e.jsx(X,{label:"List",...K(0)},0),e.jsx(X,{label:"Approval",...K(0)},1)]})}),e.jsx("div",{className:"lg:col-span-2 mt-2",children:e.jsx("div",{className:"grid",children:e.jsxs("div",{className:"card card-grid h-full min-w-full",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:e.jsxs("div",{className:"input input-sm max-w-48",children:[e.jsx("i",{className:"ki-filled ki-magnifier"}),e.jsx("input",{placeholder:U,type:"text",value:C,onChange:a=>xe(a.target.value),style:{width:"100%",maxWidth:"200px",marginBottom:"10p"}})]})}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[(S||t.addUrl)&&e.jsx(e.Fragment,{children:(!s||f.includes((s==null?void 0:s.create)??""))&&e.jsxs(F,{href:t.addUrl??"#",className:"btn btn-success",onClick:a=>{S&&(a.preventDefault(),S())},style:{marginRight:"10px",marginBottom:"10px"},children:[e.jsx("i",{className:"ki-filled ki-additem"}),"Add New"]})}),b&&e.jsx(J,{className:"btn",variant:"contained",onClick:()=>b(P),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Export TXT"}),j&&e.jsx(J,{className:"btn",variant:"contained",onClick:()=>j(P),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Export Excel"}),O]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx(Ae,{isLoading:le,description:m.message,open:m.isOpen,labelConfirmButton:m.labelConfirmButton,onClose:()=>{N({...m,isOpen:!1})},onDelete:async()=>m.onConfirm()}),e.jsx("div",{"data-datatable":"true","data-datatable-page-size":o.pageSize,children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsx(Be,{rows:se,columns:[...u,...me],loading:te,paginationMode:"server",rowCount:ce,paginationModel:o,onPaginationModelChange:ie,pageSizeOptions:[10,20],sortingMode:"server",sortModel:w,onSortModelChange:a=>ne(a),filterMode:"server",filterModel:y,onFilterModelChange:a=>re(a)})})})]})]})})})]})})})};export{Ae as C,Je as D};
