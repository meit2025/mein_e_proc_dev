import{r as u,u as se,q as re,a as D,j as e}from"./app-U_zegbVk.js";import{B as te}from"./button-DVWIOsCA.js";import{d as q}from"./index-DxKYafUq.js";import{z as d,t as ae,I as R}from"./index-B87xc01V.js";import{F as ne,a as h,b as m,d as j,e as p}from"./form-B67I_hmP.js";import{u as le}from"./index.esm-BF15fj1a.js";import{T}from"./textarea-D5orNOsm.js";/* empty css                  */import{S as oe}from"./scroll-area-DnPyJsOu.js";import{S as E}from"./separator-B4vNH8vX.js";import{T as ce,a as de,b as ie,c as he}from"./tabs-DHm6bo6f.js";import{S as g,a as y,b as C,c as w,d as _}from"./select-ZQy3W_aL.js";import{C as $}from"./CustomDatePicker-6XkDR5QK.js";/* empty css            */import"./index-DSmXPPbl.js";import"./index-DcKm3NKX.js";import"./index-D_LzPJKc.js";import"./Combination-BjAAdGYH.js";import"./react-icons.esm-D5ML2yFn.js";import"./index-CvczAvbe.js";import"./createLucideIcon-C_UAJc2f.js";const Te=({reimbursement:o,reimburses:I,currencies:A,types:B,periods:O,users:L,csrf_token:N})=>{const[P,K]=u.useState("form1"),{showToast:F}=se();re().props;const[me,M]=u.useState(1);u.useState(I);const[v,X]=u.useState([]),[S,z]=u.useState([[]]),[V,G]=u.useState([]),[b,H]=u.useState([[]]),J=d.object({remark_group:d.string().nonempty("Remark is required"),requester:d.string().nonempty("Requester is required"),forms:d.array(d.object({id:d.string(),type:d.string().nonempty("Type is required"),reimburse_type:d.string().nonempty("Type is required"),period:d.string().nonempty("Period is required"),for:d.string(),remark:d.string().nonempty("Remark is required"),balance:d.number().min(1,"Balance must be at least 1"),receipt_date:d.date(),start_date:d.date(),end_date:d.date(),currency:d.string().nonempty("Currency is required"),attachment:d.array(d.instanceof(File)).optional()})),formCount:d.string().nonempty("Currency is required")}),n=le({resolver:ae(J),defaultValues:{formCount:"1",remark_group:"",requester:"",forms:Array.from({length:1}).map(()=>({id:"",type:"",reimburse_type:"",remark:"",period:"",balance:0,for:"",receipt_date:new Date,start_date:new Date,end_date:new Date,currency:"IDR",attachment:null}))}});u.useEffect(()=>{o&&(n.setValue("remark_group",o.remark),n.setValue("requester",o.users.nip),n.setValue("formCount",o.reimburses.length.toString()),n.setValue("forms",o.reimburses.map(a=>({id:a.id,type:a.type,remark:a.remark,balance:Number(a.balance),currency:a.currency,period:a.period,receipt_date:new Date(a.receipt_date),start_date:new Date(a.start_date),end_date:new Date(a.end_date),attachment:a.attachment||null}))),o.reimburses.forEach((a,s)=>{k(s,a.type)}))},[o]);async function Q(a){try{const l=(await D.get(`/family/show/${a}`)).data;G(l),n.setValue("requester",a)}catch(s){const c=s.response.data;F(c.message,c.status)}}const U=a=>{M(a);const s=n.getValues("forms"),l=Array.from({length:a}).map((c,i)=>s[i]||{id:"",type:"",reimburse_type:"",remark:"",period:"",balance:0,receipt_date:new Date,start_date:new Date,end_date:new Date,currency:"IDR"});n.setValue("forms",l),n.setValue("formCount",a.toString())},W=a=>{K(a)};async function k(a,s){try{const c=(await D.get(`/reimburse/type/${s}`)).data;z(i=>{const x=[...i];return x[a]=c.data,x}),H(i=>{const x=[...i];return x[a]=s==="Family",x}),n.setValue(`forms.${a}.type`,s)}catch(l){const i=l.response.data;F(i.message,i.status)}}async function Y(a,s,l,c,i){const t=(await D.post("/reimburse/is_required",{user:s,is_employee:l,type:c,period:i})).data.data;X(r=>{const f=[...r];return f[a]={plafon:t==null?void 0:t.plafon,limit:t==null?void 0:t.limit},f}),n.setValue(`forms.${a}.for`,s)}const Z=async a=>{const s=new FormData;s.append("remark_group",a.remark_group),s.append("requester",a.requester),a.forms.forEach((l,c)=>{s.append(`forms[${c}][id]`,l.id),s.append(`forms[${c}][type]`,l.type),s.append(`forms[${c}][remark]`,l.remark),s.append(`forms[${c}][balance]`,l.balance.toString()),s.append(`forms[${c}][period]`,l.period),s.append(`forms[${c}][currency]`,l.currency),s.append(`forms[${c}][receipt_date]`,l.receipt_date.toISOString()),s.append(`forms[${c}][start_date]`,l.start_date.toISOString()),s.append(`forms[${c}][end_date]`,l.end_date.toISOString()),l.attachment.forEach(i=>{s.append(`forms[${c}][attachments][]`,i)})}),o?q.Inertia.put(`/reimburse/${o.id}`,a,{headers:{"X-CSRF-TOKEN":N}}):await q.Inertia.post("/reimburse",s,{headers:{"X-CSRF-TOKEN":N,"Content-Type":"multipart/form-data"}})};return e.jsx(oe,{className:"h-[600px] w-full",children:e.jsx(ne,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(Z),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Request No."}),e.jsx("td",{children:(o==null?void 0:o.request_number)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request Status"}),e.jsx("td",{children:(o==null?void 0:o.status)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:"remark_group",render:({field:a})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx(T,{disabled:o!==null,placeholder:"Insert remark",...a})}),e.jsx(p,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:"requester",render:({field:a})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{disabled:o!==null,onValueChange:s=>Q(s),value:a.value,children:[e.jsx(y,{className:"w-[200px]",children:e.jsx(C,{placeholder:"Requester"})}),e.jsx(w,{children:L.map(s=>e.jsxs(_,{value:s.nip,children:[s.name," [",s.nip,"]"]},s.id))})]})}),e.jsx(p,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:"formCount",render:({field:a})=>{var s;return e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{disabled:o!==null,onValueChange:l=>U(l),value:(s=a.value)==null?void 0:s.toString(),children:[e.jsx(y,{className:"w-[200px]",children:e.jsx(C,{placeholder:"Select number of forms"})}),e.jsx(w,{children:Array.from({length:20},(l,c)=>c+1).map(l=>e.jsx(_,{value:l.toString(),children:l},l))})]})}),e.jsx(p,{})]})}})})]})]})}),e.jsx(E,{className:"my-4"}),e.jsxs(ce,{value:P,onValueChange:W,className:"w-full",children:[e.jsxs(de,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:n.watch("formCount")||1}).map((a,s)=>e.jsxs(ie,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),Array.from({length:n.watch("formCount")||1}).map((a,s)=>{var l,c,i,x;return e.jsxs(he,{value:`form${s+1}`,children:[e.jsx(h,{control:n.control,name:`forms.${s}.id`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx(R,{className:"sr-only",value:t.value,onChange:t.onChange})}),e.jsx(p,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(h,{control:n.control,name:`forms.${s}.type`,render:({field:t})=>e.jsxs(g,{disabled:o!==null,onValueChange:r=>k(s,r),value:t.value,children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Select type"})}),e.jsx(w,{children:B.map(r=>e.jsx(_,{value:r,children:r},r))})]})}),e.jsx(h,{control:n.control,name:`forms.${s}.reimburse_type`,render:({field:t})=>e.jsxs(g,{disabled:!S[s]||S[s].length===0,onValueChange:r=>n.setValue(`forms.${s}.reimburse_type`,r),value:t.value,children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Select detail"})}),e.jsx(w,{children:S[s]&&S[s].map(r=>e.jsx(_,{value:r.code,children:r.name},r.code))})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Group"}),e.jsx("td",{children:(l=S[s])==null?void 0:l.material_group}),e.jsx("span",{className:"mx-2",children:"Number"}),e.jsx("td",{children:(c=S[s])==null?void 0:c.material_number})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:`forms.${s}.period`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{disabled:o!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(y,{className:"w-[200px]",children:e.jsx(C,{placeholder:"-"})}),e.jsx(w,{children:O.map(r=>e.jsxs(_,{value:r.code,children:[r.start," - ",r.end," (",r.code,")"]},r.code))})]})}),e.jsx(p,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:`forms.${s}.for`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{disabled:!b[s]||b[s].length===0,onValueChange:r=>Y(s,r,!b[s],n.getValues(`forms.${s}.reimburse_type`),n.getValues(`forms.${s}.period`)),value:t.value,children:[e.jsx(y,{className:"w-[200px]",children:e.jsx(C,{placeholder:"-"})}),e.jsx(w,{children:V&&V.map(r=>e.jsxs(_,{value:r.id,children:[r.name," (",r.status,")"]},r.id))})]})}),e.jsx(p,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:`forms.${s}.remark`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx(T,{placeholder:"Insert remark",...t})}),e.jsx(p,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsx("td",{children:(i=v[s])==null?void 0:i.plafon})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Limit per claim"}),e.jsx("td",{children:(x=v[s])==null?void 0:x.limit})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:`forms.${s}.receipt_date`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx($,{disabled:o!==null,initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(p,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(h,{control:n.control,name:`forms.${s}.start_date`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx($,{disabled:o!==null,initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(p,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(h,{control:n.control,name:`forms.${s}.end_date`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx($,{disabled:o!==null,initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(p,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(h,{control:n.control,name:`forms.${s}.currency`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{disabled:o!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(y,{className:"w-[200px]",children:e.jsx(C,{placeholder:"-"})}),e.jsx(w,{children:A.map(r=>e.jsxs(_,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(p,{})]})}),e.jsx(h,{control:n.control,name:`forms.${s}.balance`,render:({field:t})=>{var r;return e.jsxs(m,{children:[e.jsx(j,{children:e.jsx(R,{disabled:o!==null,type:"number",placeholder:"0.0",max:(r=v[s])==null?void 0:r.plafon,...t,onChange:f=>t.onChange(Number(f.target.value)),value:t.value||0})}),e.jsx(p,{})]})}})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(h,{control:n.control,name:`forms.${s}.attachment`,render:({field:t})=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:r=>{const f=r.target.files;if(f){const ee=Array.from(f);t.onChange(ee)}}})}),e.jsx(p,{})]})})})]})]})})})]},s)})]}),e.jsx(E,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(te,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{Te as ReimburseForm};
