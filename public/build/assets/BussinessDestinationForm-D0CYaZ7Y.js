import{u as X,r as Z,j as e}from"./app-B6mX289p.js";/* empty css              */import{F as w,a as g,b as y,c as k}from"./form-C_6WXns3.js";import{c as ee}from"./tabs-DgWaj-Lo.js";import{b as $}from"./index.esm-DFF6wkEY.js";import{B as te}from"./button-CVC6n6BU.js";import{C as se}from"./checkbox-2br7z2v5.js";import{C as T}from"./CustomDatePicker-me7_O1tK.js";import{DetailAllowance as re}from"./DetailAllowance-D7YwcH1u.js";import{DetailAttedances as ae}from"./DetailAttedances-BzNm8Q3I.js";import{F as v}from"./formDropdown-Mr4BOcnD.js";import{ResultTotalItem as oe}from"./ResultTotalItem-C4ikDQVa.js";import{h as u}from"./moment-C5S46NFB.js";import{u as ie}from"./getDropdown-DqqIdocs.js";import"./app-ffJwujpg.js";import"./utils-Bqp0N6xH.js";import"./index-CwNzPgeq.js";import"./index-CSb0PMJc.js";import"./index-WiUM8iqI.js";import"./index-BYynZNOQ.js";import"./index-wXDnj49i.js";import"./index-2yFY-QvG.js";import"./index-DuLO1No7.js";import"./index-q2C1652S.js";import"./index-C42S_gGN.js";import"./index-Ckk1ujfm.js";import"./createLucideIcon-BSSYJmNL.js";import"./index-CP-v4vq5.js";import"./index-DfKi0Rnb.js";import"./index-DziQPXOu.js";import"./rupiahCurrencyFormat-D0mkqwcl.js";import"./chevrons-up-down-wPK-17da.js";import"./select-DEaYg_Mb.js";import"./index-BdQq_4o_.js";import"./TextField-PUQBNOwG.js";import"./createSvgIcon-DmYpHUQR.js";import"./DefaultPropsProvider-het2hsiR.js";import"./useSlot-D-LoQ1ir.js";import"./createSimplePaletteValueFilter-CxkDmgqu.js";import"./CircularProgress-DB2mA4FB.js";import"./FormHelperText-DqYHdCa9.js";import"./mergeSlotProps-Edkec8ME.js";import"./axiosInstance-DD8iEQY9.js";import"./index-B4jUsV-j.js";function Ze({key:q,form:d,index:r,destination:a,updateDestination:n,listAllowances:B,setTotalAllowance:G,pajak:le,purchasingGroup:ne,dataTax:L,dataPurchasingGroup:P,dataDestination:p,type:A,btClone:C,setSelectedDates:h,selectedDates:F,dateBusinessTripByUser:f}){const{fields:V,update:M,append:H,remove:Y}=$({control:d.control,name:`destinations.${r}.detail_attedances`}),{fields:N,remove:z,replace:J}=$({control:d.control,name:`destinations.${r}.allowances`}),{showToast:j}=X(),{dataDropdown:S,getDropdown:b}=ie();function K(){let t=u(a.business_trip_start_date).startOf("day");const s=u(a.business_trip_end_date).startOf("day");if(!a.business_trip_start_date||!a.business_trip_end_date||!t.isValid()||!s.isValid()){j("Please Pick The Date","error");return}if(Y(),z(),t.isAfter(s)){j("Start date must be before end date","error");return}let l=!1;for(const i in f){const c=u(f[i].from).startOf("day"),m=u(f[i].to).startOf("day");if(t.isBetween(c,m,null,"[)")||s.isBetween(c,m,null,"(]")||t.isBefore(c)&&s.isAfter(m)){l=!0;break}}if(l){j("Your Selected Range is Unavailable. Please Select Other Days","error");return}for(;t.isBefore(s)||t.isSame(s);){const i={date:t.toDate(),shift_code:"REGULERSHIFT",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00",start_date:t.toDate(),end_date:t.toDate()};H(i),t=t.add(1,"days")}function o(i){let c=u(a.business_trip_start_date).startOf("day");const m=u(a.business_trip_end_date).startOf("day"),I=[];for(;c.isBefore(m)||c.isSame(m);)I.push({date:c.toDate(),request_price:i}),c=c.add(1,"days");return I}const W=B.map(i=>({name:i.name,code:i.code,default_price:parseInt(i.grade_price),type:i.type,subtotal:parseInt(i.grade_price),currency:i.currency_id,request_value:i.request_value,detail:i.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(i.grade_price)}]:o(i.grade_price)}));J(W)}const R=(t,s)=>{n(s,{...a,business_trip_start_date:t}),h(l=>{const o=[...l];return o[s]={...o[s],from:t},o})},O=(t,s)=>{n(s,{...a,business_trip_end_date:t}),h(l=>{const o=[...l];return o[s]={...o[s],to:t},o})},[D,_]=Z.useState(),x={};D&&(x.selected=D);const E=(t,s)=>{s==="start"&&(n(t,{...a,business_trip_start_date:null}),h(l=>{const o=[...l];return o[t]={...o[t],from:void 0},o})),s==="end"&&(n(t,{...a,business_trip_end_date:null}),h(l=>{const o=[...l];return o[t]={...o[t],to:void 0},o})),_(void 0)},Q=e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>E(r,"start"),children:"Reset"})}),U=e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>E(r,"end"),children:"Reset"})});return e.jsxs(ee,{value:`destination${r+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{fieldLabel:"",options:p,fieldName:`destinations.${r}.destination`,isRequired:!0,disabled:!1,placeholder:"Select Destination",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,destination:t})},onSearch:async t=>{const s=p==null?void 0:p.some(l=>l.label===t);t.length>0&&!s?await b(t,{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type},search:t}):t.length==0&&!s&&await b("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type}}),p=S},onFocus:async()=>{const t=d.getValues("cost_center");await b("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type},hasValue:{key:t?"id":"",value:t??""}}),p=S}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsxs("td",{className:"flex gap-2",children:[e.jsx(w,{control:d.control,name:`destinations.${r}.restricted_area`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(se,{checked:a.restricted_area,onCheckedChange:s=>{n(r,{...a,restricted_area:s})}})}),e.jsx(k,{})]})}),"Restricted Area"]})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Tax",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{fieldLabel:"",options:L,fieldName:`destinations.${r}.pajak_id`,isRequired:!0,disabled:!1,placeholder:"Select Tax",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,pajak_id:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(v,{fieldLabel:"",options:P,fieldName:`destinations.${r}.purchasing_group_id`,isRequired:!0,disabled:!1,placeholder:"Select Purchasing Group",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,purchasing_group_id:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussines Trip Date",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{className:"flex items-center space-x-2",children:[e.jsx(w,{control:d.control,name:`destinations.${r}.business_trip_start_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(T,{initialDate:a.business_trip_start_date,modifiers:x,onDayClick:(s,l)=>{l.selected?(R(void 0,r),_(void 0),n(r,{...a,business_trip_start_date:void 0,business_trip_end_date:void 0})):(R(s,r),_(s),n(r,{...a,business_trip_start_date:s,business_trip_end_date:s}))},disabledDays:F,footer:Q})}),e.jsx(k,{})]})}),e.jsx("span",{children:"To"}),e.jsx(w,{control:d.control,name:`destinations.${r}.business_trip_end_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(y,{children:e.jsx(T,{initialDate:a.business_trip_end_date,modifiers:x,onDayClick:(s,l)=>{l.selected?(O(void 0,r),_(void 0),n(r,{...a,business_trip_end_date:void 0})):(O(s,r),_(s),n(r,{...a,business_trip_end_date:s}))},disabled:!1,disabledDays:F,footer:U})}),e.jsx(k,{})]})}),e.jsx(te,{type:"button",onClick:()=>K(),children:"Get Detail"})]})]})]}),e.jsx(ae,{detailAttedanceFields:V,form:d,updateAttedanceFields:M,destinationIndex:r,type:A,btClone:C}),e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(re,{allowanceField:N,destinationIndex:r,form:d,type:A,btClone:C})]},r),e.jsx(oe,{allowanceField:N,destinationIndex:r,form:d,setTotalAllowance:G})]},q)}export{Ze as BussinessDestinationForm};
