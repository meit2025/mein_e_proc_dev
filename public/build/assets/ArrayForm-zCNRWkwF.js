import{u as fe,r as M,j as t,b as ge,a as I}from"./app-CffU0m6i.js";import{F as m}from"./formDropdown-C3QyGsbf.js";import{F as q}from"./formInput-BpVze8IK.js";import{u}from"./getDropdown-CjZfoMSE.js";import{a as be,c as j}from"./index.esm-LUhYKMl9.js";import{F as xe}from"./formSwitch-kOdQhoLU.js";import{F as ye}from"./formTextArea-BADIWbrT.js";import{columnsItem as we}from"./listModel-BQKMojNP.js";import{a as V}from"./axiosInstance-B3_uQaC6.js";import{f as L}from"./rupiahCurrencyFormat-C2HfaEL7.js";import{B as F}from"./Button-BgJXO81C.js";import{B as k}from"./Box-ZMt50Uh8.js";import{T as S}from"./Typography-Drm-eYSU.js";import{D as ve}from"./DataGrid-C8Trfmky.js";import"./app-DQK4SJPx.js";import"./TextField-B20VPiA4.js";import"./createSvgIcon-bHUpaZEi.js";import"./DefaultPropsProvider-DuGLjDIr.js";import"./useSlot-D0nmLljl.js";import"./createSimplePaletteValueFilter-Bxjz9LEw.js";import"./useControlled-DET2VCvi.js";import"./FormHelperText-DGLluwv8.js";import"./Switch-CA1wzOXQ.js";import"./SwitchBase-D1XMnsas.js";import"./CustomStatus-BmHH-Gtw.js";import"./utils-DSKfjTuU.js";import"./createLucideIcon-BXO1LiBS.js";import"./page-DB73t_G4.js";import"./moment-C5S46NFB.js";import"./index-CZj2B8EX.js";import"./index-CGK36Zxy.js";import"./ListItemText-iu40IZKx.js";import"./FormControlLabel-DrLo3g6O.js";import"./KeyboardArrowRight-GNNGP_ro.js";const st=({dataIndex:o,subAsset:E,FetchDataValue:Z,disable:i})=>{const{getValues:d,setValue:r,watch:h}=be(),{dataDropdown:U,getDropdown:G}=u(),{dataDropdown:O,getDropdown:P}=u(),{dataDropdown:B,getDropdown:W}=u(),{dataDropdown:Q,getDropdown:z}=u(),{dataDropdown:K,getDropdown:X}=u(),{dataDropdown:Y,getDropdown:H}=u(),{dataDropdown:J,getDropdown:ee}=u(),{dataDropdown:te,getDropdown:re}=u(),{dataDropdown:se,getDropdown:ne}=u(),{showToast:oe}=fe(),D=h(`vendors[${o}].units`),f=j({name:"item_account_assignment_categories"}),$=j({name:"document_type"}),ie=j({name:"item_material_group"}),ae=j({name:"currency_from"});M.useEffect(()=>{P("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",hiddenZero:!0,isMapping:!0}),G("",{name:"name_one",id:"id",tabel:"master_business_partners",hiddenZero:!0,isMapping:!0}),z("",{name:"material_group_desc",id:"material_group",tabel:"material_groups",hiddenZero:!0,isMapping:!0}),H("",{name:"description",id:"mwszkz",tabel:"pajaks",hiddenZero:!0,isMapping:!0}),ee("",{name:"unit_of_measurement_text",id:"commercial",tabel:"uoms",hiddenZero:!0,isMapping:!0}),re("",{name:"desc",id:"order_number",tabel:"master_orders",hiddenZero:!0,isMapping:!0}),ne("",{name:"desc",id:"asset",tabel:"master_assets",where:{groupBy:"asset,desc"},hiddenZero:!0,isMapping:!0}),y(ie)},[]),M.useEffect(()=>{W("",{name:"description",id:"account",tabel:"account_assignment_categories",attribut:$,hiddenZero:!0,isMapping:!0})},[$]);const y=async e=>{X("",{name:"material_description",id:"material_number",tabel:"master_materials",attribut:e,isMapping:!0,hiddenZero:!0,where:{key:"material_group",parameter:e}})},me=async()=>{var e,n;try{const s=d(),a=s.item_id!==void 0&&s.item_id!==null&&s.item_id!==""?s.item_id:`random-generated-id-${Math.random().toString(36).substr(2,9)}`;let c=0;s.is_conversion_currency&&(c=(await V.post("/currency-conversion",{from:s.currency_from,to:s.currency_to,amount:parseInt(s.item_qty)*parseInt(s.item_unit_price)},{headers:{"Content-Type":"application/json"}})).data.data);const _={id:a,qty:s.item_qty,unit_price:s.item_unit_price,total_amount:s.item_qty*s.item_unit_price,account_assignment_categories:s.item_account_assignment_categories,cost_center:s.item_cost_center,material_group:s.item_material_group,material_number:s.item_material_number,uom:s.item_uom,tax:s.item_tax,short_text:s.item_short_text,order_number:s.item_order_number,asset_number:s.item_asset_number,sub_asset_number:s.item_sub_asset_number,total_amount_conversion:c},w=d(`vendors[${o}].units`)||[];let g=[];s.action==="edit"?g=w.map((l,N)=>l.id===s.indexEdit?_:l):g=[...w,_],r(`vendors[${o}].units`,g),r("indexEdit",0),r("item_id",null);const p=d("vendors").filter(l=>(l.winner||!1)===!0),v=p.length>0?p[0]:null;if(v!==null){const l=v.units||[],N=l.reduce((A,C)=>A+parseInt(C.total_amount),0);r("total_all_amount",N);const b=l.reduce((A,C)=>C.unit_price>A?parseInt(C.unit_price):A,0);r("amount_max",b);const x=parseInt(h("cash_advance_purchases.dp"))/100*parseInt(N);r("cash_advance_purchases.nominal",x)}R()}catch(s){ge.isAxiosError(s)&&((n=(e=s.response)==null?void 0:e.data)!=null&&n.message)&&oe(s.response.data.message,"error")}},R=()=>{r("indexEdit",""),r("action","create"),r("item_account_assignment_categories",""),r("item_asset_number",""),r("item_cost_center",""),r("item_id",""),r("item_is_cashAdvance",""),r("item_material_group","NTSVC"),r("item_material_number",""),r("item_order_number",""),r("item_qty",""),r("item_short_text",""),r("item_sub_asset_number",""),r("item_tax","V0"),r("item_unit_price",""),r("item_uom","AU"),y("NTSVC")},ce=async(e,n)=>{const s=e.id||`random-generated-id-${Math.random().toString(36).substr(2,9)}`;await y(e.material_group),r("indexEdit",s),r("action","edit"),r("item_account_assignment_categories",e.account_assignment_categories??""),r("item_asset_number",e.asset_number??""),r("item_cost_center",e.cost_center??""),r("item_id",s),r("item_material_group",e.material_group??""),r("item_material_number",e.material_number??""),r("item_order_number",e.order_number??""),r("item_qty",e.qty??"0"),r("item_short_text",e.short_text??""),r("item_sub_asset_number",e.sub_asset_number??""),r("item_tax",e.tax??""),r("item_unit_price",e.unit_price??"0"),r("item_uom",e.uom??"")},le=async(e,n)=>{const s=`random-generated-id-${Math.random().toString(36).substr(2,9)}`;await y(e.material_group),r(": currency_total,",e.uom??"");const a={id:s,qty:e.qty??"0",unit_price:e.unit_price??"0",total_amount:parseInt(e.qty)*parseInt(e.unit_price),account_assignment_categories:e.account_assignment_categories,cost_center:e.cost_center??"",material_group:e.material_group??"",material_number:e.material_number??"",uom:e.uom??"",tax:e.tax??"",short_text:e.short_text??"",order_number:e.order_number??"",asset_number:e.asset_number??"",sub_asset_number:e.sub_asset_number??"",total_amount_conversion:e.total_amount_conversion??""},_=[...d(`vendors[${o}].units`)||[],a];r(`vendors[${o}].units`,_);const w=d("vendors").filter(p=>(p.winner||!1)===!0),g=w.length>0?w[0]:null;if(g!==null){const p=g.units||[],v=p.reduce((b,x)=>b+parseInt(x.total_amount),0);r("total_all_amount",v);const l=p.reduce((b,x)=>x.unit_price>b?parseInt(x.unit_price):b,0);r("amount_max",l);const N=parseInt(h("cash_advance_purchases.dp"))/100*parseInt(v);r("cash_advance_purchases.nominal",N)}R()},de=(e,n)=>{const a=(d(`vendors[${o}].units`)||[]).filter((c,_)=>c.id!==e.id);r(`vendors[${o}].units`,a)},T=j({name:"total_vendor"}),ue=T>0?T:1,_e=e=>{const n=d(`vendors[${o}].units`)||[];r(`vendors[${e}].units`,n)};M.useEffect(()=>{(async()=>{const n=d(),s=d(`vendors[${o}].units`)||[];if(!n.is_conversion_currency)return;const a=await Promise.all(s.map(async c=>{try{const _=await V.post("/currency-conversion",{from:n.currency_from,to:n.currency_to,amount:parseInt(c.qty)*parseInt(c.unit_price)},{headers:{"Content-Type":"application/json"}});return{...c,total_amount_conversion:_.data.data}}catch{return{...c,total_amount_conversion:0}}}));r(`vendors[${o}].units`,a)})()},[ae]);const pe=[{field:"actions",headerName:"Actions",width:150,renderCell:e=>t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[t.jsx(I,{type:"button",onClick:n=>{n.preventDefault(),le(e.row)},href:"#",children:t.jsx("i",{className:"ki-filled ki-copy text-warning text-2xl"})}),t.jsx(I,{type:"button",onClick:n=>{n.preventDefault(),ce(e.row)},href:"#",children:t.jsx("i",{className:" ki-duotone ki-notepad-edit text-success text-2xl"})}),t.jsx(I,{type:"button",onClick:n=>{n.preventDefault(),de(e.row)},href:"#",children:t.jsx("i",{className:" ki-duotone ki-trash-square text-danger text-2xl"})})]})}],he=()=>{const e=D.reduce((s,a)=>parseInt(s)+parseInt(a.total_amount),0),n=D.reduce((s,a)=>parseInt(s)+parseInt(a.total_amount_conversion),0);return t.jsxs(k,{sx:{display:"flex",justifyContent:"flex-end",padding:"10px",background:"#f5f5f5"},children:[t.jsxs(S,{sx:{marginRight:"20px",fontWeight:"bold"},children:["Total Amount: ",L(e,!1)]}),t.jsxs(S,{sx:{fontWeight:"bold"},children:["Total Amount Conversion: ",L(n,!1)]})]})};return t.jsxs("div",{children:[t.jsx(m,{options:[{label:"Existing",value:"existing"},{label:"New",value:"new"}],fieldLabel:"Select Type Vendor",fieldName:`vendors[${o}].type_vendor`,isRequired:!0,style:{width:"56.5rem"},placeholder:"Select Vendor",classNames:"mt-2",disabled:i}),h(`vendors[${o}].type_vendor`)==="existing"&&t.jsxs(t.Fragment,{children:[t.jsx(m,{options:U,fieldLabel:"Select Vendor",fieldName:`vendors[${o}].vendor`,isRequired:!0,style:{width:"56.5rem"},placeholder:"Select Vendor",classNames:"mt-2",disabled:i}),t.jsx(xe,{fieldLabel:"Propose Vendor",fieldName:`vendors[${o}].winner`,isRequired:!1,disabled:i})]}),h(`vendors[${o}].winner`)&&t.jsx(q,{fieldLabel:"Number Quotation",fieldName:`vendors[${o}].quotation`,isRequired:!1,type:"text",placeholder:"Number Quotation",disabled:i}),h(`vendors[${o}].type_vendor`)==="new"&&t.jsx(t.Fragment,{children:t.jsx(q,{fieldLabel:"Vendor Name",fieldName:`vendors[${o}].vendor_name_text`,isRequired:!1,type:"text",placeholder:"Enter your vendor",disabled:i})}),!i&&t.jsxs("div",{className:"card mt-2",children:[t.jsx("div",{className:"card-header",children:t.jsx("p",{children:"item"})}),t.jsxs("div",{className:"card-body",style:{padding:"1rem"},children:[t.jsx(q,{fieldLabel:"Qty",fieldName:"item_qty",isRequired:!1,type:"number",placeholder:"Enter your qty",disabled:i}),t.jsx(q,{removeDecimal:!0,nameDecimal:"currency_from",fieldLabel:"Unit Price",fieldName:"item_unit_price",isRequired:!1,disabled:i,type:"number",placeholder:"Unit Price"}),t.jsx(m,{options:B,fieldLabel:"Account Assignment",fieldName:"item_account_assignment_categories",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Account Assignment",classNames:"mt-2"}),(f==="K"||f==="V"||f==="W"||f==="Y")&&t.jsx(m,{options:O,fieldLabel:"Cost Center",fieldName:"item_cost_center",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Cost Center",classNames:"mt-2"}),t.jsx(m,{options:Q,fieldLabel:"Material Group",fieldName:"item_material_group",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Material Group",classNames:"mt-2",onChangeOutside:async(e,n)=>{await y(e)}}),t.jsx(m,{options:K,fieldLabel:"Material Number",fieldName:"item_material_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Material Number",classNames:"mt-2"}),t.jsx(m,{options:J,fieldLabel:"Uom",fieldName:"item_uom",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Purchase requisition unit of measure",classNames:"mt-2"}),t.jsx(m,{options:Y,fieldLabel:"Tax On Sales",fieldName:"item_tax",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Tax on sales",classNames:"mt-2"}),t.jsx(ye,{fieldLabel:"Short Text",fieldName:"item_short_text",isRequired:!1,disabled:i,maxLength:40,classNames:"mt-4",style:{width:"56.5rem"}}),f==="F"&&t.jsx(m,{options:te,fieldLabel:"Order Number",fieldName:"item_order_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Order Number",classNames:"mt-2"}),f==="A"&&t.jsxs(t.Fragment,{children:[t.jsx(m,{options:se,fieldLabel:"Main Asset Number",fieldName:"item_asset_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Main Asset",classNames:"mt-2",onChangeOutside:(e,n)=>{Z(e,o)}}),t.jsx(m,{options:E[o],fieldLabel:"Sub Asset",fieldName:"item_sub_asset_number",isRequired:!1,disabled:i,style:{width:"56.5rem"},placeholder:"Sub Asset Number",classNames:"mt-2"})]})]}),t.jsx("div",{className:"card-footer",children:t.jsx(F,{type:"button",variant:"contained",className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition-all",onClick:async()=>await me(),children:"Add Item"})})]}),t.jsx(k,{sx:{width:"100%",overflowX:"auto",marginTop:"1rem"},children:t.jsx("div",{className:"lg:col-span-2",children:t.jsx("div",{className:"grid",children:t.jsx("div",{className:"card card-grid h-full min-w-full",children:t.jsx("div",{className:"card-body",children:t.jsx("div",{"data-datatable":"true",children:t.jsx("div",{className:"scrollable-x-auto",children:t.jsx(ve,{columns:[...i?[]:pe,...we],rows:D,hideFooterPagination:!0,slots:{footer:he}})})})})})})})}),Array.from({length:ue},(e,n)=>t.jsx(t.Fragment,{children:n!==o&&t.jsxs(F,{type:"button",variant:"contained",style:{marginTop:"1rem",marginRight:"1rem"},className:"bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition-all",onClick:async()=>await _e(n),children:["Copy To Vendor ",n+1]},n)}))]})};export{st as default};
