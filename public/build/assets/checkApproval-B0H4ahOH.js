import{b as R,r as p,u as D,j as o}from"./app-x0vqMIUy.js";import{a as T}from"./axiosInstance-DC2Ozgr1.js";import{L as P}from"./Loading-DlVyZE9I.js";import{W as V}from"./WorkflowComponent-CAuPIhV8.js";import{F as A}from"./formDropdown-DQgp11yx.js";import{u as L}from"./getDropdown-Bnr_Y7vi.js";import{a as q}from"./index.esm-DNaWWHYD.js";import{B as I}from"./Button-TKStrXK8.js";import"./app-DQK4SJPx.js";import"./index-BEjVfUnM.js";import"./createSvgIcon-y6GdGt9h.js";import"./DefaultPropsProvider-CFJ5AoEg.js";import"./createLucideIcon-CCl6qnvb.js";import"./TextField-55ypvXce.js";import"./useSlot-CSQgVcbI.js";import"./createSimplePaletteValueFilter-D1BCRzmc.js";import"./useControlled-7j6xlwzB.js";import"./FormHelperText-CwM95F_e.js";const{Axios:pe,AxiosError:O,CanceledError:ne,isCancel:ie,CancelToken:ce,VERSION:de,all:me,Cancel:ue,isAxiosError:ve,spread:fe,toFormData:_e,AxiosHeaders:he,HttpStatusCode:ge,formToJSON:we,getAdapter:xe,mergeConfig:Ae}=R,ye=({isDisabled:B})=>{const{getValues:d,watch:m,setValue:y}=q(),[b,r]=p.useState(!1),[k,u]=p.useState(!1),[t,F]=p.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),{dataDropdown:C,getDropdown:j}=L(),{showToast:a}=D(),N=m("document_type"),S=m("metode_approval"),E=async()=>{var v,f,_,h,g;try{const e=d(),l=d("vendors").filter(s=>(s.winner||!1)===!0),w=((l.length>0?l[0]:null).units||[]).reduce((s,i)=>s+i.total_amount,0);if(y("total_all_amount",w),console.log(e),e.document_type===null||e.document_type===void 0){r(!1),a("Please input Document Type","error");return}if(e.purchasing_groups===null||e.purchasing_groups===void 0){r(!1),a("Please input purchasing group","error");return}if(e.total_all_amount===null||e.total_all_amount===void 0){r(!1),a("Please input Item","error");return}if(e.user_id===null||e.user_id===void 0){r(!1),a("Please input Item","error");return}if(e.document_type==="ZENT"){if(e.metode_approval===null||e.metode_approval===void 0){r(!1),a("Please select metode approval","error");return}if(e.metode_approval==="chooses_approval"&&(e.chooses_approval_id===null||e.chooses_approval_id===void 0)){r(!1),a("Please select chooses approval","error");return}}const n=await T.get("/check-approval",{params:{document_type_id:e.document_type,purchasing_group_id:e.purchasing_groups,value:w,user_id:e.user_id,type:"PR",metode_approval:e.metode_approval,chooses_approval_id:e.chooses_approval_id}});if(n.data.status_code===200){const s=(f=(v=n.data)==null?void 0:v.data)==null?void 0:f.approval_route.map(c=>{var x;return((x=c.user.divisions)==null?void 0:x.name)||null}),i=(h=(_=n.data)==null?void 0:_.data)==null?void 0:h.approval_route.map(c=>c.user.name);F({approvalRequest:s,approvalFrom:i,acknowledgeFrom:[]}),u(!0)}r(!1)}catch(e){if(r(!1),u(!1),e instanceof O&&e.response){const l=((g=e.response.data)==null?void 0:g.message)||"An unexpected error occurred";a(l,"error")}else e instanceof Error?a(e.message,"error"):a("An unexpected error occurred","error")}};return p.useEffect(()=>{j("",{name:"name",id:"id",tabel:"approval_tracking_number_chooses"})},[]),o.jsx(o.Fragment,{children:o.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[o.jsx(P,{isLoading:b}),o.jsxs("div",{className:"card-body",children:[o.jsx("div",{className:"flex justify-start mt-4 mb-2",children:o.jsx(I,{onClick:async()=>await E(),variant:"contained",color:"primary",type:"button",children:"Check Approval"})}),N==="ZENT"&&o.jsxs(o.Fragment,{children:[o.jsx(A,{options:[{label:"Approval",value:"approval"},{label:"Chooses Approval Tracking Number",value:"chooses_approval"},{label:"Automatic Approval Tracking Number",value:"automatic_approval_by_purchasing_group"}],fieldLabel:"Metode Approval",fieldName:"metode_approval",disabled:!1,style:{width:"58.5rem"},placeholder:"Metode Approval",classNames:"mt-2"}),S==="chooses_approval"&&o.jsx(A,{options:C,fieldLabel:"Select Chooses approval",fieldName:"chooses_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2"})]}),k&&o.jsx(V,{workflowApproval:{approvalRequest:t.approvalRequest,approvalFrom:t.approvalFrom,acknowledgeFrom:t.acknowledgeFrom},workflowApprovalStep:t.approvalFrom,workflowApprovalDiagram:t.approvalFrom})]})]})})};export{ye as default};
