import{r as A,u as Ne,j as e,b as De}from"./app-ppmMUqLP.js";/* empty css              */import{d as Ce,F as j,a as g,b as f,c as _}from"./form-Czgi3VQv.js";import{u as $e,b as Z,a as Se,c as K}from"./index.esm-Cwp7HKJi.js";import{S as Ye,a as Te,b as Fe,c as Ee,d as Re}from"./select-CKft8IQE.js";import{S as ie}from"./separator-Dqrl0rpL.js";import{T as qe}from"./textarea-jpJKnMgB.js";import{I as b}from"./input-CbCSXa46.js";import{T as Ve,a as ke,b as Me,c as Pe}from"./tabs-DpWANDvM.js";import{z as o,t as Be}from"./index-iVsofuJ9.js";import{S as Oe}from"./scroll-area-DV8RvvNJ.js";import{C as Ie,E as Le,G as Ge,b as Xe}from"./api-DtjMnnyq.js";import{BusinessTripType as H}from"./models-CLqogyH0.js";import{a as oe}from"./axiosInstance-CITDIyYi.js";import{h as D}from"./moment-C5S46NFB.js";import{F as Je}from"./formSwitchCustom-3P_X4GWP.js";import{B as Q}from"./button-BpYsiQ8I.js";import{d as ce}from"./index-B-DeLGpP.js";import{W as Ue}from"./WorkflowComponent-DdZ0_AF3.js";import{F as We}from"./formDropdown-DbnI2jbc.js";import{u as de}from"./getDropdown-_O_TPl6Q.js";import{f as k}from"./rupiahCurrencyFormat-C2HfaEL7.js";import{B as ze}from"./Button-C8mn0xxQ.js";import{C as He}from"./chevrons-up-down-D43kE0Ep.js";import"./app-DQK4SJPx.js";import"./index-BiTpgr04.js";import"./utils-BSZL2nIn.js";import"./index-1e7Olv4z.js";import"./index-B21d8tpm.js";import"./index-Bb4qSo10.js";import"./index-BY9GO0sl.js";import"./index-BkPpOwii.js";import"./index-BdQq_4o_.js";import"./index-BYwpm4U-.js";import"./index-D7UlLIHB.js";import"./Combination-BS87b4Zi.js";import"./index-VzXSAffm.js";import"./index-Cqrr8SZk.js";import"./index-CvypUIa0.js";import"./index-BxEGMoQ8.js";import"./CustomStatus-vj9ze0x2.js";import"./createLucideIcon-Ce07Hcys.js";import"./Switch-SlMfhsgr.js";import"./createSimplePaletteValueFilter-C6ORa_ti.js";import"./DefaultPropsProvider-BcPRQSVK.js";import"./SwitchBase-C4b3O6V6.js";import"./FormHelperText-B_iiumwN.js";import"./useControlled-B7gJ4mjq.js";import"./createSvgIcon-pMsCVQBD.js";import"./TextField-DBswz7O_.js";import"./useSlot-NXZZubkE.js";const Ze=1*1024*1024,Ke=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],is=({type:a,id:s})=>{var re;const h=o.object({request_no:o.string().nonempty("Request for required"),remark:o.string().nonempty("Remark is required"),attachment:o.array(o.instanceof(File).refine(i=>Ke.includes(i.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(i=>i.size<=Ze,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:o.number().int("Total Destinantion Required"),cash_advance:o.boolean().nullable().optional(),reference_number:o.string().nullable().optional(),total_percent:o.number().nullable().optional(),total_cash_advance:o.string().nullable().optional(),destinations:o.array(o.object({destination:o.string().nonempty("Destinantion Required"),business_trip_start_date:o.date().optional(),business_trip_end_date:o.date().optional(),detail_attedances:o.array(o.object({date:o.string().optional(),shift_code:o.string().optional(),shift_start:o.string().optional(),shift_end:o.string().optional(),start_time:o.string().optional(),end_time:o.string().optional(),start_date:o.string().optional(),end_date:o.string().optional(),request_start_time:o.string().optional(),request_end_time:o.string().optional()})),allowances:o.array(o.object({name:o.string().optional(),code:o.string().optional(),default_price:o.string().optional(),type:o.string().optional(),currency:o.string().optional(),subtotal:o.number().optional(),detail:o.array(o.object({date:o.string().nullish(),request_price:o.number().optional()}))})),other:o.array(o.object({value:o.number().optional()}))}))}),c=$e({resolver:Be(h),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),$=(i,p)=>{var n;return i.type==="total"?parseFloat(((n=p==null?void 0:p[0])==null?void 0:n.request_price)||0):p==null?void 0:p.reduce((l,N)=>l+parseFloat(N.request_price||0),0)},u=()=>{const i=c.getValues("destinations");c.getValues("destinations.0.other");const p=i.reduce((l,N,F)=>{const M=(N.allowances||[]).reduce((P,J,B)=>{const V=c.getValues(`destinations.${F}.allowances.${B}.detail`),z=$(J,V);return P+z},0);return l+M},0);let n=0;try{n=i.reduce((l,N,F)=>{const M=(N.other||[]).reduce((P,J,B)=>{const V=c.getValues(`destinations.${F}.other.${B}.value`);return P+(V===void 0?0:V)},0);return l+M},0)}catch(l){console.log(l),n=0}return p+n},[d,t]=A.useState(!1),{showToast:C}=Ne(),[w,v]=A.useState(!1),x=async i=>{var p;try{if(v(!0),a===H.create){const n=u(),l=new FormData;l.append("user_id",((p=r==null?void 0:r.request_for)==null?void 0:p.id.toString())??""),l.append("value",n.toString()),l.append("request_no",i.request_no??""),l.append("remark",i.remark??""),i.attachment.forEach((N,F)=>{N&&l.append(`attachment[${F}]`,N)}),l.append("total_destination",`${i.total_destination}`),i.destinations.forEach((N,F)=>{l.append(`destinations[${F}]`,JSON.stringify(N))}),await ce.Inertia.post(Ie,l,{headers:{"Content-Type":"multipart/form-data"}}),C("succesfully created data","success")}else{const n=new FormData;n.append("remark",i.remark??""),i.attachment.forEach((l,N)=>{l&&n.append(`attachment[${N}]`,l)}),ae.forEach((l,N)=>{l&&n.append(`file_existing[${N}]`,JSON.stringify(l))}),await ce.Inertia.post(`${Le}/${s}`,n,{headers:{"Content-Type":"multipart/form-data"}}),C("succesfully updated data","success")}setTimeout(()=>{v(!1)},1e3)}catch(n){console.log(n)}},[r,m]=A.useState(null),[y,R]=A.useState([]),[T,Y]=A.useState([]),[q,L]=A.useState(!1);async function G(i){c.setValue("request_no",i||"");const p=Ge(i);try{const n=await oe.get(p),l=n.data.data;L(l.cash_advance==1),c.setValue("remark",l.remarks||""),c.setValue("total_destination",l.total_destination||1),c.setValue("cash_advance",l.cash_advance==1),c.setValue("reference_number",l.reference_number),c.setValue("total_percent",l.total_percent),c.setValue("total_cash_advance",(l==null?void 0:l.total_cash_advance)!=null?k(l.total_cash_advance,!1):"0"),m(n.data.data),Y(l.destinations),U(l.total_destination),S(l.destinations)}catch(n){console.log(n)}}const[ee,U]=A.useState(""),te=i=>{U(i)};function S(i){const p=i.map(n=>({destination:n.destination||"",pajak:n.pajak||"",purchasing_group:n.purchasing_group||"",business_trip_start_date:new Date(n.business_trip_start_date),business_trip_end_date:new Date(n.business_trip_end_date),allowances:n.allowances||[],detail_attedances:n.detail_attedances||[],total_allowance:n.total_allowance||0,other:n.other||[]}));c.setValue("destinations",p)}const{fields:se,append:rt,remove:lt,update:he}=Z({control:c.control,name:"destinations"});A.useEffect(()=>{},[r,ee]);const[it,me]=A.useState(0),[pe,xe]=A.useState(!1),[X,ue]=A.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),je=async()=>{var i,p,n,l,N,F,W,M,P,J,B,V,z;try{const O=u();if(O===0){C("Please fill the balance","error");return}const I=await oe.get("/check-approval",{params:{value:O,user_id:((i=r==null?void 0:r.request_for)==null?void 0:i.id)??"",type:"TRIP_DECLARATION"}});if(I.data.status_code===200){const we=(n=(p=I.data)==null?void 0:p.data)==null?void 0:n.approval.map(E=>(E==null?void 0:E.division_name)||null),be=(N=(l=I.data)==null?void 0:l.data)==null?void 0:N.approval.map(E=>(E==null?void 0:E.name)||null),le=[];(W=(F=I.data)==null?void 0:F.data)!=null&&W.hr&&le.push((J=(P=(M=I.data)==null?void 0:M.data)==null?void 0:P.hr)==null?void 0:J.name);const Ae=(((B=I.data.data)==null?void 0:B.approval)??[]).map(E=>({status:"",name:E.name,dateApproved:""}));ue({approvalRequest:we,approvalFrom:be,acknowledgeFrom:le,approvalFromStatusRoute:Ae}),xe(!0)}}catch(O){C((z=(V=O==null?void 0:O.response)==null?void 0:V.data)==null?void 0:z.message,"error")}},{dataDropdown:ge,getDropdown:fe}=de(),{dataDropdown:ot,getDropdown:_e}=de();A.useEffect(()=>{fe("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[c.watch("destinations")]);const[ae,ne]=A.useState([]);async function ve(){c.setValue("destinations",[]);const i=Xe(s),n=(await De.get(i)).data.data;await G(n.parent_id.toString()),ne(n.attachments)}A.useEffect(()=>{s&&a==H.clone&&(ve(),_e("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[a]);const ye=i=>{ne(p=>p.filter(n=>n.id!==i))};return e.jsx(Oe,{className:"h-[600px] w-full ",children:e.jsx(Ce,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(x),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:ge,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:i=>{G(i)}})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:r.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:r.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(re=r==null?void 0:r.cost_center)==null?void 0:re.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(j,{control:c.control,name:"remark",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(qe,{placeholder:"Insert remark",...i,rows:4,className:"w-[300px]"})}),e.jsx(_,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(j,{control:c.control,name:"attachment",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:p=>{const n=p.target.files;if(n){const l=Array.from(n);i.onChange(l)}else i.onChange([])}})}),c.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(c.formState.errors.attachment)?c.formState.errors.attachment.map((p,n)=>e.jsx("span",{children:p.message},n)):c.formState.errors.attachment.message})]})})})]}),ae.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ae.map((i,p)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:i.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:i.file_name},p),e.jsx("button",{type:"button",onClick:()=>ye(i.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(j,{control:c.control,name:"total_destination",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(Ye,{value:ee,onValueChange:te,disabled:!0,children:[e.jsx(Te,{className:"w-[200px] py-2",children:e.jsx(Fe,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Ee,{children:Array.from({length:5},(p,n)=>e.jsxs(Re,{value:(n+1).toString(),children:[" ",n+1," "]},n))})]})}),e.jsx(_,{})]})})]})]})]}),e.jsx(ie,{className:"my-4"}),e.jsx(Qe,{updateDestination:he,destinationField:se,form:c,listAllowances:y,totalDestination:c.getValues("total_destination").toString(),setTotalAllowance:me,businessTripDetail:r,type:a,btEdit:H.edit,setIsCashAdvance:L,isCashAdvance:q,setOtherAllowance:t,otherAllowance:d}),e.jsx(ie,{className:"my-4"}),e.jsx(ze,{onClick:async()=>await je(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:pe&&e.jsx(Ue,{workflowApproval:{approvalRequest:X.approvalRequest,approvalFrom:X.approvalFrom,acknowledgeFrom:X.acknowledgeFrom},workflowApprovalStep:X.approvalFromStatusRoute,workflowApprovalDiagram:X.approvalFrom})}),e.jsx(Q,{type:"submit",loading:w,children:"submit"})]})})})};function Qe({totalDestination:a,listAllowances:s,form:h,destinationField:c,updateDestination:$,setTotalAllowance:u,businessTripDetail:d,type:t,btEdit:C,setIsCashAdvance:w,isCashAdvance:v,setOtherAllowance:x,otherAllowance:r}){return e.jsxs(Ve,{defaultValue:"destination1",className:"w-full",children:[e.jsx(ke,{className:"flex items-center justify-start space-x-4",children:c.map((m,y)=>e.jsxs(Me,{value:`destination${y+1}`,children:["Destination ",y+1]}))}),c.map((m,y)=>e.jsx(et,{listAllowances:s,updateDestination:$,destination:m,form:h,index:y,setTotalAllowance:u,businessTripDetail:d,type:t,btEdit:H.edit,setIsCashAdvance:w,isCashAdvance:v,setOtherAllowance:x,otherAllowance:r}))]})}function et({form:a,index:s,destination:h,updateDestination:c,listAllowances:$,setTotalAllowance:u,businessTripDetail:d,type:t,btEdit:C,setIsCashAdvance:w,isCashAdvance:v,setOtherAllowance:x,otherAllowance:r}){const{fields:m,update:y,append:R,remove:T}=Z({control:a.control,name:`destinations[${s}].detail_attedances`}),{fields:Y,update:q,append:L,remove:G,replace:ee}=Z({control:a.control,name:`destinations[${s}].allowances`}),U=S=>{w(S)};Se(),K({control:a.control,name:"total_percent"});const te=d==null?void 0:d.total_cash_advance;return A.useEffect(()=>{},[te]),e.jsxs(Pe,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:h.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:h==null?void 0:h.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:h==null?void 0:h.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:D(h.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:D(h.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(tt,{detailAttedanceFields:m,form:a,updateAttedanceFields:y,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(st,{allowanceField:Y,destinationIndex:s,form:a,setOtherAllowance:x,otherAllowance:r})]},s),e.jsx(nt,{allowanceField:Y,destinationIndex:s,form:a,setTotalAllowance:u}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Je,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:S=>U(S.target.checked)})})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(j,{control:a.control,name:"reference_number",render:({field:S})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:S.value||"",onChange:se=>S.onChange(se.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(_,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(j,{control:a.control,name:"total_percent",render:({field:S})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{...S,value:S.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(_,{})]})}),e.jsx(j,{control:a.control,name:"total_cash_advance",render:({field:S})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:S.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(_,{})]})})]})]})]})]})]})}function tt({form:a,destinationIndex:s,detailAttedanceFields:h,updateAttedanceFields:c}){const $=a.watch(`destinations[${s}].detail_attedances`);return A.useEffect(()=>{},[$]),A.useEffect(()=>{},[h]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Request: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"})]}),e.jsx("tbody",{children:$.map((u,d)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[D(u.date).format("DD/MM/YYYY"),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[u.shift_code,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_code`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[u.shift_start,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_start`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[u.shift_end,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_end`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_start_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_start_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_end_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_end_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(_,{})]})})]})]},u.index))})]})})}),e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Declaration: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:$.map((u,d)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[D(u.date).format("DD/MM/YYYY"),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[u.shift_code,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_code`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[u.shift_start,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_start`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[u.shift_end,e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_end`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.start_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.start_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.end_date`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:D(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(j,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.end_time`,render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(_,{})]})})]})]},u.index))})]})})})]})}function st({form:a,destinationIndex:s,allowanceField:h,setOtherAllowance:c,otherAllowance:$}){const u=a.watch(`destinations[${s}].allowances`);A.useEffect(()=>{},[u]);const{fields:d,append:t,remove:C}=Z({control:a.control,name:`destinations.${s}.other`}),w=K({control:a.control,name:`destinations.${s}.other`}),v=()=>(w||[]).reduce((r,m)=>{const y=Number(m==null?void 0:m.value)||0;return isNaN(y)?r:r+y},0),x=()=>{t({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[u.map((r,m)=>e.jsx(at,{form:a,allowance:r,destinationIndex:s,allowanceIndex:m})),d.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(Q,{type:"button",className:"text-xl",onClick:x,children:"+"})})}),d.map((r,m)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:a.control,name:`destinations.${s}.other[${m}].value`,render:({field:y})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{min:"0",value:y.value??"",onChange:R=>{const T=R.target.value.trim();if(T===""){y.onChange(void 0);return}console.log(T,"value");const Y=Number(T);!isNaN(Y)&&Y>=0&&y.onChange(Y)}})}),e.jsx(_,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",k(v(),!1)]})})}),e.jsx("td",{children:e.jsx(Q,{type:"button",className:"text-xs",onClick:()=>C(m),children:"X"})})]},m))]})}function at({form:a,allowance:s,destinationIndex:h,allowanceIndex:c}){const[$,u]=A.useState(!1);A.useState(0);const d=x=>{u(r=>!r)},t=K({control:a.control,name:`destinations[${h}].allowances[${c}].detail[0].request_price`}),C=K({control:a.control,name:`destinations[${h}].allowances[${c}].detail`}),w=()=>{if(s.type==="total")return parseFloat(t||0)*1;{let x=0;return C==null||C.forEach(r=>{const m=parseFloat(r.request_price||0);x+=m}),x}},v=(x,r)=>{const m=parseFloat(r),y=isNaN(m)?0:m,R=s.request_value;let T=!0;switch(R){case"unlimited":T=!0;break;case"fixed value":const Y=s.default_price;y!==Y&&(alert(`Please enter the fixed value of IDR ${Y}`),T=!1);break;case"up to max value":const q=s.default_price;y>q&&(alert(`The value should not exceed IDR ${q}`),T=!1);break;default:T=!1}if(T){a.setValue(`destinations[${h}].allowances[${c}].detail[${x}].request_price`,y);const q=a.getValues(`destinations[${h}].allowances[${c}].detail`).reduce((L,G)=>L+(parseFloat(G.request_price)||0),0);a.setValue(`destinations[${h}].allowances[${c}].subtotal`,q)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{control:a.control,name:`destinations[${h}].allowances[${c}].detail[0].request_price`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:x.value,onChange:r=>v(0,r.target.value)})}),e.jsx(_,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",k(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",k(w(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(Q,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),$&&e.jsx(e.Fragment,{children:s.detail.map((x,r)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:D(x.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(j,{control:a.control,name:`destinations[${h}].allowances[${c}].detail[${r}].request_price`,render:({field:m})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(b,{value:m.value,onChange:y=>v(r,y.target.value)})}),e.jsx(_,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},x.id))})]})}function nt({allowanceField:a,destinationIndex:s,form:h,setTotalAllowance:c}){const[$,u]=A.useState(0),d=h.watch(`destinations.${s}.other`),t=h.watch(`destinations[${s}].allowances`);A.useEffect(()=>{const w=t.reduce((x,r,m)=>{const y=h.getValues(`destinations.${s}.allowances.${m}.detail`),R=C(r,y);return x+R},0),v=(d||[]).reduce((x,r)=>{const m=Number(r==null?void 0:r.value)||0;return x+m},0);u(w+v)},[t,h.watch()]);const C=(w,v)=>{var x;return w.type==="total"?parseFloat(((x=v==null?void 0:v[0])==null?void 0:x.request_price)||0):v==null?void 0:v.reduce((r,m)=>r+parseFloat(m.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsxs("tbody",{children:[t.map((w,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:w.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:k(w.subtotal)})]})]},w.id)),d.length>0&&e.jsx(e.Fragment,{children:d.map((w,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:"Other Allowance"}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:w!=null&&w.value?k(w.value):"0"})]})]},v))})]}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:k($)})]})]})})]})})}export{at as AllowanceRowInput,Qe as BussinesTripDestination,et as BussinessDestinationForm,is as BussinessTripFormV1,st as DetailAllowance,tt as DetailAttedances,nt as ResultTotalItem};
