import{j as e,r as S,u as ee,b as te}from"./app-CqaVc6eH.js";import{F as se,a as _,b as g,c as f,d as b,e as ae}from"./form-C6_RqwcF.js";import{z as r,t as ne}from"./index-CBkdOARf.js";import{d as re}from"./index-CoClpz9y.js";import{B as K}from"./button-DfiJaJzR.js";import{a as le,C as ie,u as oe,b as O,c as P}from"./index.esm-BG20dXo7.js";import{T as ce}from"./textarea-9SL0_Y3I.js";/* empty css              */import{S as de}from"./scroll-area-CASzgjvn.js";import{S as he}from"./separator-DiWlKJ-N.js";import{T as xe,a as pe,b as ue,c as je}from"./tabs-CS7aXKSy.js";import{h as D}from"./moment-C5S46NFB.js";import{S as T,a as Y,b as F,c as q,d as $}from"./select-Cz-VYKPJ.js";import{C as Q}from"./CustomDatePicker-CoQTuXNy.js";import{I as A}from"./input-D5_iTgRg.js";import{G as me}from"./api-BEQetkWJ.js";import{a as _e}from"./axiosInstance-p08jlujy.js";import{BusinessTripType as Z}from"./models-Xng8HkV1.js";import{C as ge,b as fe}from"./api-_vMQwfXl.js";import{S as be}from"./Switch-PRmD30JV.js";import{F as we}from"./FormHelperText-BzmV34TZ.js";import{C as ve}from"./chevrons-up-down-Dld8AeNg.js";import"./app-HlhieNAw.js";import"./utils-CQkU4qpa.js";import"./index-CLOZ5W2q.js";import"./index-BGudfqBT.js";import"./index-wENWiudt.js";import"./index-Aco9FWaT.js";import"./index-Bjk8s13m.js";import"./index-Cmc_CjIB.js";import"./Combination-C-v-eXK3.js";import"./index-BxkLS5Dz.js";import"./popover-Da4Gc1oo.js";import"./createLucideIcon-BlVOpTzH.js";import"./createSimplePaletteValueFilter-DQHU5mqH.js";import"./extends-CF3RwP-h.js";import"./SwitchBase-OiYytJfp.js";const ye=({fieldLabel:a,fieldName:t,isRequired:l=!1,disabled:p=!1,style:v,requiredMessage:m,classNames:u,defaultChecked:n=!1,note:d,onChanges:w})=>{var y;const{control:N,formState:{errors:j}}=le();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[a&&e.jsxs("label",{className:"form-label max-w-32",children:[a," ",e.jsxs("span",{className:"text-red-700",children:[" ",l?"*":""]})]}),e.jsx(ie,{name:t,control:N,rules:{required:l?m??`${a} is required`:!1},render:({field:o})=>e.jsx("div",{style:v,className:u,children:e.jsx(be,{...o,checked:!!(o.value??n),onChange:V=>{o.onChange(V),w&&w(V)},disabled:p})})}),e.jsx("span",{children:d})]}),e.jsxs("div",{className:"flex items-baseline flex-wrap lg:flex-nowrap gap-2.5",children:[e.jsx("label",{className:"form-label max-w-32",children:""}),j[t]&&e.jsx(we,{error:!0,children:String((y=j[t])==null?void 0:y.message)})]})]})};r.object({remark:r.string().min(1).max(50),reimburse_cost:r.number()});const ut=({users:a,listPurposeType:t,pajak:l,costcenter:p,purchasingGroup:v,type:m,id:u,role:n,idUser:d,listDestination:w=[]})=>{const N=r.object({purpose_type_id:r.string().min(1,"Purpose type required"),request_for:r.string().min(1,"Request is required"),cost_center_id:r.string().min(1,"Cost Center is required"),remark:r.string().min(1,"Remark is required"),attachment:r.instanceof(File).nullable().optional(),total_destination:r.number().min(1,"Total Destinantion Required"),destinations:r.array(r.object({destination:r.string().min(1,"Destinantion is Required"),pajak_id:r.string().min(1,"Pajak is required"),purchasing_group_id:r.string().min(1,"Purchasing Group is required"),cash_advance:r.boolean().nullable().optional(),reference_number:r.string().nullable().optional(),total_percent:r.string().nullable().optional(),total_cash_advance:r.string().nullable().optional(),business_trip_start_date:r.date().optional(),business_trip_end_date:r.date().optional(),detail_attedances:r.array(r.object({date:r.date().optional(),shift_code:r.string().optional(),shift_start:r.string().optional(),shift_end:r.string().optional(),start_time:r.string().optional(),end_time:r.string().optional()})),allowances:r.array(r.object({name:r.string().optional(),code:r.string().optional(),default_price:r.number().optional(),type:r.string().optional(),subtotal:r.number().optional(),currency:r.string().optional(),detail:r.array(r.object({date:r.date().nullish(),request_price:r.any().optional()}))}))}))}),[j,y]=S.useState("1");console.log("list destiantion",w);const o=oe({resolver:ne(N),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:null,total_destination:1,destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",business_trip_start_date:new Date,business_trip_end_date:new Date}]}});async function V(){const i=fe(u);o.setValue("destinations",[]);try{const c=(await te.get(i)).data.data;console.log(c," Response Detailxxxx"),o.setValue("purpose_type_id",c.purpose_type_id),o.setValue("request_for",c.request_for.id),o.setValue("cost_center_id",c.cost_center_id),o.setValue("pajak_id",c.pajak_id),o.setValue("purchasing_group_id",c.purchasing_group_id),o.setValue("remark",c.remarks),o.setValue("total_destination",c.total_destination),o.setValue("destinations",c.destinations.map(C=>({destination:C.destination,business_trip_start_date:new Date(C.business_trip_start_date),business_trip_end_date:new Date(C.business_trip_end_date),detail_attedances:C.detail_attedances,allowances:C.allowances})))}catch{}}const[R,X]=S.useState([]),[L,z]=S.useState(n==="user"?d.toString():"");async function H(i){o.setValue("purpose_type_id",i||"");const s=n=="user"?d||"":L||"";console.log(s," ---- ");const c=me(i,s);try{const C=await _e.get(c);X(C.data.data)}catch{}}const U=i=>{o.setValue("total_destination",parseInt(i,10)),y(i),M()},{showToast:I}=ee(),W=async i=>{try{const s=new FormData;s.append("purpose_type_id",i.purpose_type_id??""),s.append("request_for",i.request_for??""),s.append("cost_center_id",i.cost_center_id??""),s.append("remark",i.remark??""),s.append("attachment",i.attachment??""),s.append("total_destination",`${i.total_destination}`),i.destinations.forEach((c,C)=>{const G={...c,business_trip_start_date:D(c.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:D(c.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:c.detail_attedances.map(E=>({...E,date:D(E.date).format("YYYY-MM-DD")})),allowances:c.allowances.map(E=>({...E,detail:E.detail.map(k=>({...k,date:(k==null?void 0:k.date)!=null?D(k.date).format("YYYY-MM-DD"):null}))}))};s.append(`destinations[${C}]`,JSON.stringify(G))}),console.log(s," test"),await re.Inertia.post(ge,s,{headers:{"Content-Type":"multipart/form-data"}}),I("succesfully created data","success")}catch(s){console.log(s)}};function M(){const i=[],s=parseInt(j);for(let c=0;c<s;c++)i.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});o.setValue("destinations",i)}const{fields:B,append:x,remove:h,update:J}=O({control:o.control,name:"destinations"});return S.useEffect(()=>{u&&m==Z.edit&&V()},[]),S.useEffect(()=>{m==Z.create&&M()},[j,R,u,m,n,d]),e.jsx(de,{className:"h-[600px] w-full ",children:e.jsx(se,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(W),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(_,{control:o.control,name:"request_for",render:({field:i})=>(n==="user"&&!i.value&&i.onChange(d.toString()),e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{onValueChange:s=>{z(s),i.onChange(s)},value:i.value,disabled:n==="user",children:[e.jsx(Y,{className:"w-[200px] py-2",children:e.jsx(F,{placeholder:"-- Select Business Purpose Type --"})}),e.jsx(q,{children:n==="admin"?a.map(s=>e.jsx($,{value:s.id.toString(),children:s.name},s.id)):a.filter(s=>s.id===d).map(s=>e.jsx($,{value:s.id.toString(),children:s.name},s.id))})]})}),e.jsx(b,{})]}))})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:o.control,name:"purpose_type_id",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{onValueChange:s=>H(s),value:i.value,children:[e.jsx(Y,{className:"w-[200px]",children:e.jsx(F,{placeholder:"-- Select Bussiness Purpose Type --"})}),e.jsx(q,{children:t.map(s=>e.jsx($,{value:s.id.toString(),children:s.name}))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:o.control,name:"cost_center_id",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{onValueChange:s=>i.onChange(s),value:i.value,children:[e.jsx(Y,{className:"w-[200px]",children:e.jsx(F,{placeholder:"-- Select Cost Center --"})}),e.jsx(q,{children:p.map(s=>e.jsx($,{value:s.id.toString(),children:s.cost_center}))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(_,{control:o.control,name:"remark",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(ce,{placeholder:"Insert remark",...i,rows:4,className:"w-[300px]"})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(_,{control:o.control,name:"attachment",render:({field:i})=>e.jsxs(g,{children:[e.jsx(ae,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(f,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",onChange:s=>{var C;const c=(C=s.target.files)==null?void 0:C[0];c?i.onChange(c):i.onChange(null)}})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:o.control,name:"total_destination",render:({field:i})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{value:i.value.toString(),onValueChange:U,children:[e.jsx(Y,{className:"w-[200px] py-2",children:e.jsx(F,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(q,{children:Array.from({length:5},(s,c)=>e.jsxs($,{value:(c+1).toString(),children:[" ",c+1," "]}))})]})}),e.jsx(b,{})]})})]})]})]}),e.jsx(he,{className:"my-4"}),e.jsx(Ce,{updateDestination:J,destinationField:B,listDestination:w,form:o,listAllowances:R,totalDestination:o.getValues("total_destination").toString(),pajak:l,purchasingGroup:v}),e.jsx(K,{type:"submit",children:"submit"})]})})})};function Ce({totalDestination:a,listAllowances:t,destinationField:l,form:p,updateDestination:v,listDestination:m=[],pajak:u,purchasingGroup:n}){return S.useState(),S.useState(),S.useState(0),e.jsxs(xe,{defaultValue:"destination1",className:"w-full",children:[e.jsx(pe,{className:"flex items-center justify-start space-x-4",children:l.map((d,w)=>e.jsxs(ue,{value:`destination${w+1}`,children:["Destination ",w+1]}))}),l.map((d,w)=>e.jsx(Se,{listAllowances:t,updateDestination:v,destination:d,form:p,index:w,listDestination:m,pajak:u,purchasingGroup:n}))]})}function Se({form:a,index:t,destination:l,updateDestination:p,listAllowances:v,listDestination:m,pajak:u,purchasingGroup:n}){const{fields:d,update:w,append:N,remove:j}=O({control:a.control,name:`destinations.${t}.detail_attedances`}),{fields:y,update:o,append:V,remove:R,replace:X}=O({control:a.control,name:`destinations.${t}.allowances`});function L(){let x=D(l.business_trip_start_date).startOf("day");const h=D(l.business_trip_end_date).startOf("day");for(j(),R();x.isBefore(h)||x.isSame(h);){const s={date:x.toDate(),shift_code:"SHIFTREGULAR",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00"};N(s),x=x.add(1,"days")}function J(s){let c=D(l.business_trip_start_date).startOf("day");const C=D(l.business_trip_end_date).startOf("day"),G=[];for(;c.isBefore(C)||c.isSame(C);)G.push({date:c.toDate(),request_price:s}),c=c.add(1,"days");return G}const i=v.map(s=>({name:s.name,code:s.code,default_price:parseInt(s.grade_price),type:s.type,subtotal:parseInt(s.grade_price),currency:s.currency_id,request_value:s.request_value,detail:s.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(s.grade_price)}]:J(s.grade_price)}));X(i)}const[z,H]=S.useState(!1),U=x=>{H(x)},I=P({control:a.control,name:`destinations.${t}.total_percent`}),[W,M]=S.useState(0),B=W;return S.useEffect(()=>{const h=parseFloat((I||"0").toString())/100*B;a.setValue(`destinations.${t}.total_cash_advance`,h.toFixed(0))},[I,B]),e.jsxs(je,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination ",l.destination]}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.destination`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{onValueChange:h=>{p(t,{...l,destination:h})},defaultValue:l.destination,children:[e.jsx(Y,{className:"w-[200px]",children:e.jsx(F,{placeholder:"Destination"})}),e.jsx(q,{children:m.map(h=>e.jsx($,{value:h.destination,className:"uppercase",children:h.destination}))})]})}),e.jsx(b,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:a.control,name:`destinations.${t}.pajak_id`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{onValueChange:h=>x.onChange(h),value:x.value,children:[e.jsx(Y,{className:"w-[200px]",children:e.jsx(F,{placeholder:"-- Select Pajak --"})}),e.jsx(q,{children:u.map(h=>e.jsx($,{value:h.id.toString(),children:h.mwszkz}))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:a.control,name:`destinations.${t}.purchasing_group_id`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{onValueChange:h=>x.onChange(h),value:x.value,children:[e.jsx(Y,{className:"w-[200px]",children:e.jsx(F,{placeholder:"-- Select Purchasing Group --"})}),e.jsx(q,{children:n.map(h=>e.jsx($,{value:h.id.toString(),children:h.purchasing_group}))})]})}),e.jsx(b,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center",children:[e.jsx(_,{control:a.control,name:`destinations.${t}.business_trip_start_date`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(Q,{initialDate:l.business_trip_start_date,onDateChange:h=>{p(t,{...l,business_trip_start_date:h})}})}),e.jsx(b,{})]})}),e.jsx("span",{children:"To"}),e.jsx(_,{control:a.control,name:`destinations.${t}.business_trip_end_date`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(Q,{initialDate:l.business_trip_end_date,onDateChange:h=>{console.log("end date",h),p(t,{...l,business_trip_end_date:h})}})}),e.jsx(b,{})]})}),e.jsx(K,{type:"button",onClick:()=>L(),children:"Get Detail"})]})]})]}),e.jsx($e,{detailAttedanceFields:d,form:a,updateAttedanceFields:w,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(Ae,{allowanceField:y,destinationIndex:t,form:a})]},t),e.jsx(De,{allowanceField:y,destinationIndex:t,form:a,setTotalAllowance:M}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(ye,{fieldName:`destinations.${t}.cash_advance`,isRequired:!1,disabled:!1,onChanges:x=>U(x.target.checked)})})]}),z&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(_,{control:a.control,name:`destinations.${t}.reference_number`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{value:x.value||"",onChange:h=>x.onChange(h.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(b,{})]})}),e.jsx(_,{control:a.control,name:`destinations.${t}.total_percent`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsxs(T,{value:x.value||void 0,onValueChange:h=>x.onChange(h),children:[e.jsx(Y,{className:"w-[50%] mb-2",children:e.jsx(F,{placeholder:"-- Select Total Percent --"})}),e.jsxs(q,{children:[e.jsx($,{value:"10",children:"10%"}),e.jsx($,{value:"25",children:"25%"}),e.jsx($,{value:"50",children:"50%"})]})]})}),e.jsx(b,{})]})}),e.jsx(_,{control:a.control,name:`destinations.${t}.total_cash_advance`,render:({field:x})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{value:x.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(b,{})]})})]})]})})]})]})}function De({allowanceField:a,destinationIndex:t,form:l,setTotalAllowance:p}){const[v,m]=S.useState(0);S.useEffect(()=>{const n=a.reduce((d,w,N)=>{const j=l.getValues(`destinations.${t}.allowances.${N}.detail`),y=u(w,j);return d+y},0);m(n),p(n)},[a,l.watch()]);const u=(n,d)=>{var w;return n.type==="total"?parseFloat(((w=d==null?void 0:d[0])==null?void 0:w.request_price)||0):d==null?void 0:d.reduce((N,j)=>N+parseFloat(j.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:a.map((n,d)=>e.jsx(Ne,{allowance:n,destinationIndex:t,form:l,allowanceIndex:d}))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{className:"font-bold",children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:e.jsx("i",{children:"IDR"})}),e.jsx("span",{children:e.jsx("i",{children:v})})]})]})})]})})}function Ne({allowance:a,destinationIndex:t,form:l,allowanceIndex:p}){const v=P({control:l.control,name:`destinations.${t}.allowances.${p}.detail.0.request_price`}),m=P({control:l.control,name:`destinations.${t}.allowances.${p}.detail`}),u=()=>{if(a.type==="total")return parseFloat(v||0)*1;{let n=0;return m==null||m.forEach(d=>{const w=parseFloat(d.request_price||0);n+=w}),n}};return e.jsxs("tr",{children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:u()})]})]},a.id)}function $e({form:a,destinationIndex:t,detailAttedanceFields:l,updateAttedanceFields:p}){const v=a.watch(`destinations.${t}.detail_attedances`);return S.useEffect(()=>{},[v]),S.useEffect(()=>{},[l]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{children:e.jsxs("table",{className:"detail-attedance text-xs",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:l.map((m,u)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[D(m.date).format("DD/MM/YYYY"),e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${u}.date`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{defaultValue:D(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[m.shift_code,e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${u}.shift_code`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{defaultValue:D(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[m.shift_start,e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${u}.shift_start`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{defaultValue:D(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsxs("td",{children:[m.shift_end,e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${u}.shift_end`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{defaultValue:D(n.value).format("YYYY-MM-DD"),onChange:n.onChange,type:"hidden"})}),e.jsx(b,{})]})})]}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${u}.start_time`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(b,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${u}.end_time`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{defaultValue:n.value,onChange:n.onChange})}),e.jsx(b,{})]})})})]},m.index))})]})})})]})}function Ae({form:a,destinationIndex:t,allowanceField:l}){return e.jsx("table",{className:"w-full allowance-table",children:l.map((p,v)=>e.jsx(Te,{form:a,allowance:p,destinationIndex:t,allowanceIndex:v}))})}function Te({form:a,allowance:t,destinationIndex:l,allowanceIndex:p}){const[v,m]=S.useState(!1),u=j=>{m(y=>!y)},n=P({control:a.control,name:`destinations.${l}.allowances.${p}.detail.0.request_price`}),d=P({control:a.control,name:`destinations.${l}.allowances.${p}.detail`}),w=()=>{if(t.type==="total")return parseFloat(n||0)*1;{let j=0;return d==null||d.forEach(y=>{const o=parseFloat(y.request_price||0);j+=o}),j}},N=j=>y=>{const o=parseFloat(y.target.value)||0;t.request_value==="unlimited"?j.onChange(y):t.request_value==="up to max value"?o<=t.subtotal?j.onChange(y):alert(`Value cannot exceed the subtotal of IDR ${t.subtotal}`):t.request_value==="fixed value"&&alert("This value is fixed and cannot be changed.")};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:a.control,name:`destinations.${l}.allowances.${p}.detail.0.request_price`,render:({field:j})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{value:j.value,onChange:N(j)})}),e.jsx(b,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",t.subtotal," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",w()]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>u(),children:e.jsxs(K,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),v&&e.jsx(e.Fragment,{children:t.detail.map((j,y)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:D(j.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(_,{control:a.control,name:`destinations.${l}.allowances.${p}.detail.${y}.request_price`,render:({field:o})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{value:o.value,onChange:N(o)})}),e.jsx(b,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},j.id))})]})}function jt({form:a,type:t,allowanceIndex:l,destinationIndex:p}){const{fields:v}=O({control:a.control,name:`destinations.${p}.allowances.${l}.detail`});return e.jsx(e.Fragment,{children:v.map((m,u)=>e.jsx(_,{control:a.control,name:`destinations.${p}.allowances.${u}.detail.${u}.request_price`,render:({field:n})=>e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(A,{value:n.value,onChange:n.onChange})}),e.jsx(b,{})]})}))})}export{jt as AllowanceInputForm,Te as AllowanceRowInput,Ce as BussinesTripDestination,Se as BussinessDestinationForm,ut as BussinessTripFormV1,Ae as DetailAllowance,$e as DetailAttedances,Ne as ResultPerItem,De as ResultTotalItem};
