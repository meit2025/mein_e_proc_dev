import{r as g,u as Te,j as e,b as he}from"./app-Bvy8FZoY.js";/* empty css              */import{d as Fe,F as x,a as j,b as f,c as _}from"./form-Ce6_p1yy.js";import{u as Ee,b as K,a as Re,c as Q}from"./index.esm-D5Oqewor.js";import{S as qe,a as Ve,b as Me,c as ke,d as Pe}from"./select-CnnLIc3A.js";import{S as me}from"./separator-BSVZm-_X.js";import{T as Be}from"./textarea-D2WUUSJ3.js";import{I as b}from"./input-CXtbbTJt.js";import{T as Ie,a as Oe,b as Le,c as Ge}from"./tabs-BvnGdeVs.js";import{z as i,t as Xe}from"./index-plKhnve_.js";import{S as Je}from"./scroll-area-oUbPNvKt.js";import{C as Ue,E as We,G as pe,b as ze}from"./api-DtjMnnyq.js";import{BusinessTripType as V}from"./models-C-2JjESB.js";import{a as ue}from"./axiosInstance-J1tay7Yr.js";import{h as S}from"./moment-C5S46NFB.js";import{F as He}from"./formSwitchCustom-7uxTLr9A.js";import{B as fe}from"./button-CUKtuCjc.js";import{d as xe}from"./index-Bzlpv31l.js";import{W as Ze}from"./WorkflowComponent-BpnJGpGJ.js";import{F as Ke}from"./formDropdown-BiHHzPt6.js";import{u as je}from"./getDropdown-C_GitiR5.js";import{f as G}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{B as Qe}from"./Button-vO6FTumG.js";import{C as et}from"./chevrons-up-down-U-fQWRB1.js";import"./app-DQK4SJPx.js";import"./index-K2QtvFFV.js";import"./utils-CtFKiFZB.js";import"./index-DtpTsobC.js";import"./index-DwallDMZ.js";import"./index-Bb4qSo10.js";import"./index-BauVLrWr.js";import"./index-BCN9KICt.js";import"./index-BdQq_4o_.js";import"./index-BsteX7cQ.js";import"./index-o1D7osJb.js";import"./Combination-9n_doTs6.js";import"./index-BIMjOBN3.js";import"./index-DIhswBDC.js";import"./index-DogJu496.js";import"./index-DnmzVtlP.js";import"./CustomStatus-BUONzO7V.js";import"./createLucideIcon-BsGGNKh-.js";import"./Switch-B7VhWnRj.js";import"./createSimplePaletteValueFilter-DaWySeWN.js";import"./DefaultPropsProvider-BF7MJ-E_.js";import"./SwitchBase-Gl6biN52.js";import"./FormHelperText-DotMoRr8.js";import"./useControlled-DPqrNLIk.js";import"./createSvgIcon-CuMB4uQB.js";import"./TextField-BdhEaAps.js";import"./useSlot-DT-hhi7d.js";const tt=1*1024*1024,st=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],ds=({type:a,id:s})=>{var oe;const m=i.object({request_no:i.string().nonempty("Request for required"),remark:i.string().nonempty("Remark is required"),attachment:i.array(i.instanceof(File).refine(r=>st.includes(r.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(r=>r.size<=tt,{message:"File size must be less than 1MB"})),total_destination:i.number().int("Total Destinantion Required"),cash_advance:i.boolean().nullable().optional(),reference_number:i.string().nullable().optional(),total_percent:i.number().nullable().optional(),total_cash_advance:i.string().nullable().optional(),destinations:i.array(i.object({restricted_area:i.boolean().optional(),destination:i.string().nonempty("Destinantion Required"),business_trip_start_date:i.date().optional(),business_trip_end_date:i.date().optional(),detail_attedances:i.array(i.object({date:i.string().optional(),shift_code:i.string().optional(),shift_start:i.string().optional(),shift_end:i.string().optional(),start_time:i.string().optional(),end_time:i.string().optional(),start_date:i.string().optional(),end_date:i.string().optional(),request_start_time:i.string().optional(),request_end_time:i.string().optional()})),allowances:i.array(i.object({name:i.string().optional(),code:i.string().optional(),default_price:i.string().optional(),type:i.string().optional(),currency:i.string().optional(),subtotal:i.number().optional(),detail:i.array(i.object({date:i.string().nullish(),request_price:i.number().optional()}))})),other:i.array(i.object({value:i.number().optional()}))}))}).superRefine(({cash_advance:r,total_percent:h,attachment:n},c)=>{a===V.create&&n&&n.length===0&&c.addIssue({path:["attachment"],code:i.ZodIssueCode.too_small,minimum:1,type:"array",inclusive:!0,message:"Attachment is required"})}),l=Ee({resolver:Xe(m),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),Y=(r,h)=>{var n;return r.type==="total"?parseFloat(((n=h==null?void 0:h[0])==null?void 0:n.request_price)||0):h==null?void 0:h.reduce((c,y)=>c+parseFloat(y.request_price||0),0)},p=()=>{const r=l.getValues("destinations");l.getValues("destinations.0.other");const h=r.reduce((c,y,E)=>{const D=(y.allowances||[]).reduce((w,T,I)=>{const P=l.getValues(`destinations.${E}.allowances.${I}.detail`),Z=Y(T,P);return w+Z},0);return c+D},0);let n=0;try{n=r.reduce((c,y,E)=>{const D=(y.other||[]).reduce((w,T,I)=>{const P=l.getValues(`destinations.${E}.other.${I}.value`);return w+(P===void 0?0:P)},0);return c+D},0)}catch(c){console.log(c),n=0}return h+n},[d,t]=g.useState(!1),{showToast:F}=Te(),[A,v]=g.useState(!1),u=async r=>{var h,n;try{v(!0);const c=l.getValues("destinations"),y=ne(c),E=(h=o==null?void 0:o.business_trip_destination)==null?void 0:h.some(w=>w.restricted_area===!0||w.restricted_area==="1"||w.restricted_area===1),B=p(),D=new FormData;D.append("is_restricted_area",E?"true":"false"),D.append("day",y.toString()),D.append("user_id",((n=o==null?void 0:o.request_for)==null?void 0:n.id.toString())??""),D.append("value",B.toString()),D.append("request_no",r.request_no??""),D.append("remark",r.remark??""),D.append("total_destination",`${r.total_destination}`),r.destinations.forEach((w,T)=>{D.append(`destinations[${T}]`,JSON.stringify(w))}),a===V.create?(r.attachment.forEach((w,T)=>{w&&D.append(`attachment[${T}]`,w)}),await xe.Inertia.post(Ue,D,{headers:{"Content-Type":"multipart/form-data"}}),F("succesfully created data","success")):(r.attachment.forEach((w,T)=>{w&&D.append(`attachment[${T}]`,w)}),ae.forEach((w,T)=>{w&&D.append(`file_existing[${T}]`,JSON.stringify(w))}),await xe.Inertia.post(`${We}/${s}`,D,{headers:{"Content-Type":"multipart/form-data"}}),F("succesfully updated data","success")),setTimeout(()=>{v(!1)},1e3)}catch(c){console.log(c)}},[o,N]=g.useState(null),[C,X]=g.useState([]),[M,R]=g.useState([]),[k,J]=g.useState(!1);async function U(r){l.setValue("request_no",r||"");const h=pe(r);try{const n=await ue.get(h),c=n.data.data;console.log(n.data.data,"response"),J(c.cash_advance==1),l.setValue("remark",c.remarks||""),l.setValue("total_destination",c.total_destination||1),l.setValue("cash_advance",c.cash_advance==1),l.setValue("reference_number",c.reference_number),l.setValue("total_percent",Number(c.total_percent)),l.setValue("request_no",r),l.setValue("total_cash_advance",(c==null?void 0:c.total_cash_advance)!==null?G(c.total_cash_advance,!1):"0"),N(n.data.data),a===V.create&&(R(c.destinations),$(c.destinations)),H(c.total_destination)}catch(n){console.log(n)}}const[ee,H]=g.useState(""),te=r=>{H(r)};function $(r){const h=r.map(n=>({destination:n.destination||"",pajak:n.pajak||"",purchasing_group:n.purchasing_group||"",business_trip_start_date:new Date(n.business_trip_start_date),business_trip_end_date:new Date(n.business_trip_end_date),allowances:n.allowances||[],detail_attedances:n.detail_attedances||[],total_allowance:n.total_allowance||0,other:n.other||[]}));l.setValue("destinations",h)}const{fields:se,append:ct,remove:dt,update:_e}=K({control:l.control,name:"destinations"});g.useEffect(()=>{},[o,ee]);const[ht,ge]=g.useState(0),[ve,ye]=g.useState(!1),[W,we]=g.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),ne=r=>{const h=[];r.forEach(c=>{c.detail_attedances.forEach(y=>{y.date&&h.push(y.date),y.end_date&&h.push(y.end_date)})});const n=h.map(c=>new Date(c)).sort((c,y)=>c.getTime()-y.getTime());if(n.length===0)return 0;{const c=n[0],y=n[n.length-1];return Math.floor((y.getTime()-c.getTime())/(1e3*60*60*24))+1}},be=async()=>{var r,h,n,c,y,E,B,D,w,T,I,P,Z,ie;try{const O=l.getValues("destinations"),Ce=ne(O);console.log(O,"day");const Se=(r=o==null?void 0:o.business_trip_destination)==null?void 0:r.some(z=>z.restricted_area===!0||z.restricted_area==="1"||z.restricted_area===1),ce=p();if(ce===0){F("Please fill the balance","error");return}const L=await ue.get("/check-approval",{params:{is_restricted_area:Se,day:Ce,value:ce,user_id:((h=o==null?void 0:o.request_for)==null?void 0:h.id)??"",type:"TRIP_DECLARATION"}});if(L.data.status_code===200){const z=(c=(n=L.data)==null?void 0:n.data)==null?void 0:c.approval.map(q=>(q==null?void 0:q.division_name)||null),$e=(E=(y=L.data)==null?void 0:y.data)==null?void 0:E.approval.map(q=>(q==null?void 0:q.name)||null),de=[];(D=(B=L.data)==null?void 0:B.data)!=null&&D.hr&&de.push((I=(T=(w=L.data)==null?void 0:w.data)==null?void 0:T.hr)==null?void 0:I.name);const Ye=(((P=L.data.data)==null?void 0:P.approval)??[]).map(q=>({status:"",name:q.name,dateApproved:""}));we({approvalRequest:z,approvalFrom:$e,acknowledgeFrom:de,approvalFromStatusRoute:Ye}),ye(!0)}}catch(O){F((ie=(Z=O==null?void 0:O.response)==null?void 0:Z.data)==null?void 0:ie.message,"error")}},{dataDropdown:Ae,getDropdown:re}=je();je(),g.useEffect(()=>{re("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:V.create===a?"true":"false"})},[l.watch("destinations")]);const[ae,le]=g.useState([]);async function De(){l.setValue("destinations",[]);const r=ze(s),n=(await he.get(r)).data.data;await U(n.parent_id.toString()),le(n.attachments);const c=pe(s),E=(await he.get(c)).data.data;R(E.destinations),$(E.destinations)}g.useEffect(()=>{s&&a===V.clone&&(re("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}),De())},[a]);const Ne=r=>{le(h=>h.filter(n=>n.id!==r))};return e.jsx(Je,{className:"h-[600px] w-full ",children:e.jsx(Fe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(u),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(Ke,{fieldLabel:"",options:Ae,fieldName:"request_no",isRequired:!0,disabled:V.create!==a,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:r=>{U(r)}})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:o.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:o.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(oe=o==null?void 0:o.cost_center)==null?void 0:oe.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(x,{control:l.control,name:"remark",render:({field:r})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(Be,{placeholder:"Insert remark",...r,rows:4,className:"w-[300px]"})}),e.jsx(_,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(x,{control:l.control,name:"attachment",render:({field:r})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:h=>{const n=h.target.files;if(n){const c=Array.from(n);r.onChange(c)}else r.onChange([])}})}),l.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(l.formState.errors.attachment)?l.formState.errors.attachment.map((h,n)=>e.jsx("span",{children:h.message},n)):l.formState.errors.attachment.message})]})})})]}),ae.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ae.map((r,h)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:r.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:r.file_name},h),e.jsx("button",{type:"button",onClick:()=>Ne(r.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(x,{control:l.control,name:"total_destination",render:({field:r})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsxs(qe,{value:ee,onValueChange:te,disabled:!0,children:[e.jsx(Ve,{className:"w-[200px] py-2",children:e.jsx(Me,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(ke,{children:Array.from({length:5},(h,n)=>e.jsxs(Pe,{value:(n+1).toString(),children:[" ",n+1," "]},n))})]})}),e.jsx(_,{})]})})]})]})]}),e.jsx(me,{className:"my-4"}),e.jsx(at,{updateDestination:_e,destinationField:se,form:l,listAllowances:C,totalDestination:l.getValues("total_destination").toString(),setTotalAllowance:ge,businessTripDetail:o,type:a,btEdit:V.edit,setIsCashAdvance:J,isCashAdvance:k,setOtherAllowance:t,otherAllowance:d}),e.jsx(me,{className:"my-4"}),e.jsx(Qe,{onClick:async()=>await be(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:ve&&e.jsx(Ze,{workflowApproval:{approvalRequest:W.approvalRequest,approvalFrom:W.approvalFrom,acknowledgeFrom:W.acknowledgeFrom},workflowApprovalStep:W.approvalFromStatusRoute,workflowApprovalDiagram:W.approvalFrom})}),e.jsx(fe,{type:"submit",loading:A,children:"submit"})]})})})};function at({totalDestination:a,listAllowances:s,form:m,destinationField:l,updateDestination:Y,setTotalAllowance:p,businessTripDetail:d,type:t,btEdit:F,setIsCashAdvance:A,isCashAdvance:v,setOtherAllowance:u,otherAllowance:o}){return e.jsxs(Ie,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Oe,{className:"flex items-center justify-start space-x-4",children:l.map((N,C)=>e.jsxs(Le,{value:`destination${C+1}`,children:["Destination ",C+1]}))}),l.map((N,C)=>e.jsx(nt,{listAllowances:s,updateDestination:Y,destination:N,form:m,index:C,setTotalAllowance:p,businessTripDetail:d,type:t,btEdit:V.edit,setIsCashAdvance:A,isCashAdvance:v,setOtherAllowance:u,otherAllowance:o},C))]})}function nt({form:a,index:s,destination:m,updateDestination:l,listAllowances:Y,setTotalAllowance:p,businessTripDetail:d,type:t,btEdit:F,setIsCashAdvance:A,isCashAdvance:v,setOtherAllowance:u,otherAllowance:o}){const{fields:N,update:C,append:X,remove:M}=K({control:a.control,name:`destinations[${s}].detail_attedances`}),{fields:R,update:k,append:J,remove:U,replace:ee}=K({control:a.control,name:`destinations[${s}].allowances`}),H=$=>{A($)};Re(),Q({control:a.control,name:"total_percent"});const te=d==null?void 0:d.total_cash_advance;return g.useEffect(()=>{},[te]),e.jsxs(Ge,{value:`destination${s+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:m.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:m==null?void 0:m.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:m==null?void 0:m.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:S(m.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:S(m.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(rt,{detailAttedanceFields:N,form:a,updateAttedanceFields:C,destinationIndex:s}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(lt,{allowanceField:R,destinationIndex:s,form:a,setOtherAllowance:u,otherAllowance:o})]},s),e.jsx(it,{allowanceField:R,destinationIndex:s,form:a,setTotalAllowance:p}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(He,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:$=>H($.target.checked)})})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(x,{control:a.control,name:"reference_number",render:({field:$})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{value:$.value||"",onChange:se=>$.onChange(se.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(_,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(x,{control:a.control,name:"total_percent",render:({field:$})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{...$,value:$.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(_,{})]})}),e.jsx(x,{control:a.control,name:"total_cash_advance",render:({field:$})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{value:$.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(_,{})]})})]})]})]})]})]})}function rt({form:a,destinationIndex:s,detailAttedanceFields:m,updateAttedanceFields:l}){const Y=a.watch(`destinations[${s}].detail_attedances`);return g.useEffect(()=>{},[Y]),g.useEffect(()=>{},[m]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Request: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"})]}),e.jsx("tbody",{children:Y.map((p,d)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[S(p.date).format("DD/MM/YYYY"),e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_code,e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_code`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_start,e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_start`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_end,e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_end`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_start_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_start_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_end_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.request_end_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(_,{})]})})]})]},p.index))})]})})}),e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Declaration: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:Y.map((p,d)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[S(p.date).format("DD/MM/YYYY"),e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_code,e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_code`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_start,e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_start`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_end,e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.shift_end`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.start_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.start_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(_,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.end_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:S(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(_,{})]})}),e.jsx(x,{control:a.control,name:`destinations.${s}.detail_attedances.${d}.end_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(_,{})]})})]})]},p.index))})]})})})]})}function lt({form:a,destinationIndex:s,allowanceField:m,setOtherAllowance:l,otherAllowance:Y}){const p=a.watch(`destinations[${s}].allowances`);return g.useEffect(()=>{},[p]),K({control:a.control,name:`destinations.${s}.other`}),Q({control:a.control,name:`destinations.${s}.other`}),e.jsx("table",{className:"w-full allowance-table",children:p.map((d,t)=>e.jsx(ot,{form:a,allowance:d,destinationIndex:s,allowanceIndex:t}))})}function ot({form:a,allowance:s,destinationIndex:m,allowanceIndex:l}){const[Y,p]=g.useState(!1);g.useState(0);const d=u=>{p(o=>!o)},t=Q({control:a.control,name:`destinations[${m}].allowances[${l}].detail[0].request_price`}),F=Q({control:a.control,name:`destinations[${m}].allowances[${l}].detail`}),A=()=>{if(s.type==="total")return parseFloat(t||0)*1;{let u=0;return F==null||F.forEach(o=>{const N=parseFloat(o.request_price||0);u+=N}),u}},v=(u,o)=>{const N=parseFloat(o),C=isNaN(N)?0:N,X=s.request_value;let M=!0;switch(X){case"unlimited":M=!0;break;case"fixed value":const R=s.default_price;C!==R&&(alert(`Please enter the fixed value of IDR ${R}`),M=!1);break;case"up to max value":const k=s.default_price;C>k&&(alert(`The value should not exceed IDR ${k}`),M=!1);break;default:M=!1}if(M){a.setValue(`destinations[${m}].allowances[${l}].detail[${u}].request_price`,C);const k=a.getValues(`destinations[${m}].allowances[${l}].detail`).reduce((J,U)=>J+(parseFloat(U.request_price)||0),0);a.setValue(`destinations[${m}].allowances[${l}].subtotal`,k)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:s.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:s.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{control:a.control,name:`destinations[${m}].allowances[${l}].detail[0].request_price`,render:({field:u})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{value:u.value,onChange:o=>v(0,o.target.value)})}),e.jsx(_,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",s.detail.length," Days * ",G(s.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",G(A(),!1)]})})}),s.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(fe,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},s.id),Y&&e.jsx(e.Fragment,{children:s.detail.map((u,o)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:S(u.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(x,{control:a.control,name:`destinations[${m}].allowances[${l}].detail[${o}].request_price`,render:({field:N})=>e.jsxs(j,{children:[e.jsx(f,{children:e.jsx(b,{value:N.value,onChange:C=>v(o,C.target.value)})}),e.jsx(_,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},u.id))})]})}function it({allowanceField:a,destinationIndex:s,form:m,setTotalAllowance:l}){const[Y,p]=g.useState(0),d=m.watch(`destinations.${s}.other`),t=m.watch(`destinations[${s}].allowances`);g.useEffect(()=>{const A=t.reduce((u,o,N)=>{const C=m.getValues(`destinations.${s}.allowances.${N}.detail`),X=F(o,C);return u+X},0),v=Array.isArray(d)?d.reduce((u,o)=>{const N=Number(o==null?void 0:o.value)||0;return u+N},0):0;p(A+v)},[t,m.watch()]);const F=(A,v)=>{var u;return A.type==="total"?parseFloat(((u=v==null?void 0:v[0])==null?void 0:u.request_price)||0):v==null?void 0:v.reduce((o,N)=>o+parseFloat(N.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsxs("tbody",{children:[t.map((A,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:A.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:G(A.subtotal)})]})]},A.id)),Array.isArray(d)&&d.length>0&&e.jsx(e.Fragment,{children:d.map((A,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:"Other Allowance"}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:A!=null&&A.value?G(A.value):"0"})]})]},v))})]}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:G(Y)})]})]})})]})})}export{ot as AllowanceRowInput,at as BussinesTripDestination,nt as BussinessDestinationForm,ds as BussinessTripFormV1,lt as DetailAllowance,rt as DetailAttedances,it as ResultTotalItem};
