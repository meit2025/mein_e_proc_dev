import{r as g,u as Ne,j as e,b as De}from"./app-DXvCWy_g.js";/* empty css              */import{d as Se,F as _,a as w,b,c as v}from"./form-CZvwhUmC.js";import{u as Ce,b as P,a as Te,c as U}from"./index.esm-BcPjsMaP.js";import{S as $e,a as Fe,b as Ee,c as Re,d as qe}from"./select-xlCEfrhf.js";import{S as ie}from"./separator-CaSgeOr6.js";import{T as ke}from"./textarea-D7OI5A8f.js";import{I as A}from"./input-Bn2u0rTA.js";import{T as Ye,a as Ve,b as Ie,c as Pe}from"./tabs-C4oCzKqu.js";import{z as l,t as Me}from"./index-DQmcIO17.js";import{S as Be}from"./scroll-area-vjtvFjYc.js";import{C as Oe,E as Le,G as Ge,b as Xe}from"./api-DtjMnnyq.js";import{BusinessTripType as J}from"./models-Du9GtcS9.js";import{a as oe}from"./axiosInstance-Bnz1542E.js";import{h as E}from"./moment-C5S46NFB.js";import{F as Je}from"./formSwitchCustom-DuHrjDAz.js";import{B as W}from"./button-UGZPga1B.js";import{d as ce}from"./index-DzpeNgPo.js";import{W as Ue}from"./WorkflowComponent-C8roOtLa.js";import{F as We}from"./formDropdown-DUIY3vG7.js";import{u as de}from"./getDropdown-syxiQ95A.js";import{f as z}from"./rupiahCurrencyFormat-CP-6egij.js";import{B as ze}from"./Button-CyY0x1JS.js";import{C as He}from"./chevrons-up-down-Bmuv8hJg.js";import"./app-DQK4SJPx.js";import"./index-p5kvgYEb.js";import"./utils-BznOihSZ.js";import"./index-BTMMRGyW.js";import"./index-HoxMBkts.js";import"./index-Bb4qSo10.js";import"./index-BW625G9T.js";import"./index-CD672HsC.js";import"./index-DI-3zzmH.js";import"./index-LKyRpN3V.js";import"./Combination-D_a243NT.js";import"./index-M0arRCSX.js";import"./index-CV19Upoy.js";import"./index-DYHjiu3y.js";import"./CustomStatus-BIOt3uqR.js";import"./createLucideIcon-D_Nl4BB1.js";import"./Switch-f4k6L12N.js";import"./createSimplePaletteValueFilter-B0E9KX_2.js";import"./DefaultPropsProvider-RTDV_DeN.js";import"./SwitchBase-DmyIkK_3.js";import"./FormHelperText-C78JNciO.js";import"./useControlled-DdgDYhZI.js";import"./createSvgIcon-DD_1bPr5.js";import"./TextField-fdpBW3ld.js";import"./useSlot-hLIcwbd0.js";const Ze=1*1024*1024,Ke=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],ss=({type:a,id:t})=>{var ne;const c=l.object({request_no:l.string().nonempty("Request for required"),remark:l.string().nonempty("Remark is required"),attachment:l.array(l.instanceof(File).refine(r=>Ke.includes(r.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(r=>r.size<=Ze,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:l.number().int("Total Destinantion Required"),cash_advance:l.boolean().nullable().optional(),reference_number:l.string().nullable().optional(),total_percent:l.string().nullable().optional(),total_cash_advance:l.string().nullable().optional(),destinations:l.array(l.object({destination:l.string().nonempty("Destinantion Required"),business_trip_start_date:l.date().optional(),business_trip_end_date:l.date().optional(),detail_attedances:l.array(l.object({date:l.string().optional(),shift_code:l.string().optional(),shift_start:l.string().optional(),shift_end:l.string().optional(),start_time:l.string().optional(),end_time:l.string().optional(),request_start_time:l.string().optional(),request_end_time:l.string().optional()})),allowances:l.array(l.object({name:l.string().optional(),code:l.string().optional(),default_price:l.string().optional(),type:l.string().optional(),currency:l.string().optional(),subtotal:l.number().optional(),detail:l.array(l.object({date:l.string().nullish(),request_price:l.number().optional()}))})),other:l.array(l.object({value:l.number().optional()}))}))}),n=Ce({resolver:Me(c),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),N=(r,p)=>{var s;return r.type==="total"?parseFloat(((s=p==null?void 0:p[0])==null?void 0:s.request_price)||0):p==null?void 0:p.reduce((i,y)=>i+parseFloat(y.request_price||0),0)},x=()=>n.getValues("destinations").reduce((s,i,y)=>{const M=(i.allowances||[]).reduce((B,O,L)=>{const G=n.getValues(`destinations.${y}.allowances.${L}.detail`),X=N(O,G);return B+X},0);return s+M},0),[d,o]=g.useState(!1),{showToast:D}=Ne(),T=async r=>{var p;try{if(a==J.create){const s=x(),i=new FormData;i.append("user_id",((p=u.request_for)==null?void 0:p.id.toString())??""),i.append("value",s.toString()),i.append("request_no",r.request_no??""),i.append("remark",r.remark??""),r.attachment.forEach((y,R)=>{y&&i.append(`attachment[${R}]`,y)}),i.append("total_destination",`${r.total_destination}`),r.destinations.forEach((y,R)=>{i.append(`destinations[${R}]`,JSON.stringify(y))}),await ce.Inertia.post(Oe,i,{headers:{"Content-Type":"multipart/form-data"}}),D("succesfully created data","success")}else{const s=new FormData;s.append("remark",r.remark??""),r.attachment.forEach((i,y)=>{i&&s.append(`attachment[${y}]`,i)}),ee.forEach((i,y)=>{i&&s.append(`file_existing[${y}]`,JSON.stringify(i))}),await ce.Inertia.post(`${Le}/${t}`,s,{headers:{"Content-Type":"multipart/form-data"}}),D("succesfully updated data","success")}}catch(s){console.log(s)}},[u,j]=g.useState([]),[h,m]=g.useState([]),[f,q]=g.useState([]),[C,$]=g.useState(!1);console.log(d);async function k(r){n.setValue("request_no",r||"");const p=Ge(r);try{const s=await oe.get(p),i=s.data.data;console.log(i,"businessTripData"),$(i.cash_advance==1),n.setValue("remark",i.remarks||""),n.setValue("total_destination",i.total_destination||1),n.setValue("cash_advance",i.cash_advance==1),n.setValue("reference_number",i.reference_number),n.setValue("total_percent",`${i.total_percent} %`),n.setValue("total_cash_advance",z(i.total_cash_advance,!1)),j(s.data.data),q(i.destinations),Z(i.total_destination),K(i.destinations)}catch(s){console.log(s)}}const[H,Z]=g.useState(""),te=r=>{Z(r)};function K(r){const p=r.map(s=>({destination:s.destination||"",pajak:s.pajak||"",purchasing_group:s.purchasing_group||"",business_trip_start_date:new Date(s.business_trip_start_date),business_trip_end_date:new Date(s.business_trip_end_date),allowances:s.allowances||[],detail_attedances:s.detail_attedances||[],total_allowance:s.total_allowance||0,other:s.other||[]}));n.setValue("destinations",p)}const{fields:Q,append:S,remove:se,update:pe}=P({control:n.control,name:"destinations"});g.useEffect(()=>{},[u,H]);const[nt,me]=g.useState(0),[he,xe]=g.useState(!1),[I,ue]=g.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),je=async()=>{var r,p,s,i,y,R,M,B,O,L,G,X,re;try{const Y=x();if(Y===0){D("Please fill the balance","error");return}const V=await oe.get("/check-approval",{params:{value:Y,user_id:((r=u.request_for)==null?void 0:r.id)??"",type:"TRIP_DECLARATION"}});if(V.data.status_code===200){const ve=(s=(p=V.data)==null?void 0:p.data)==null?void 0:s.approval.map(F=>(F==null?void 0:F.division_name)||null),ye=(y=(i=V.data)==null?void 0:i.data)==null?void 0:y.approval.map(F=>(F==null?void 0:F.name)||null),le=[];(M=(R=V.data)==null?void 0:R.data)!=null&&M.hr&&le.push((L=(O=(B=V.data)==null?void 0:B.data)==null?void 0:O.hr)==null?void 0:L.name);const Ae=(((G=V.data.data)==null?void 0:G.approval)??[]).map(F=>({status:"",name:F.name,dateApproved:""}));ue({approvalRequest:ve,approvalFrom:ye,acknowledgeFrom:le,approvalFromStatusRoute:Ae}),xe(!0)}}catch(Y){D((re=(X=Y==null?void 0:Y.response)==null?void 0:X.data)==null?void 0:re.message,"error")}},{dataDropdown:fe,getDropdown:ge}=de(),{dataDropdown:rt,getDropdown:_e}=de();g.useEffect(()=>{ge("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:"true"})},[n.watch("destinations")]);const[ee,ae]=g.useState([]);async function we(){n.setValue("destinations",[]);const r=Xe(t),s=(await De.get(r)).data.data;await k(s.parent_id.toString()),ae(s.attachments)}g.useEffect(()=>{t&&a==J.clone&&(we(),_e("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"}}))},[a]);const be=r=>{ae(p=>p.filter(s=>s.id!==r))};return e.jsx(Be,{className:"h-[600px] w-full ",children:e.jsx(Se,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(T),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(We,{fieldLabel:"",options:fe,fieldName:"request_no",isRequired:!0,disabled:!1,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:r=>{k(r)}})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:u.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:u.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(ne=u==null?void 0:u.cost_center)==null?void 0:ne.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:"remark",render:({field:r})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(ke,{placeholder:"Insert remark",...r,rows:4,className:"w-[300px]"})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(_,{control:n.control,name:"attachment",render:({field:r})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:p=>{const s=p.target.files;if(s){const i=Array.from(s);r.onChange(i)}else r.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((p,s)=>e.jsx("span",{children:p.message},s)):n.formState.errors.attachment.message})]})})})]}),ee.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ee.map((r,p)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:r.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:r.file_name},p),e.jsx("button",{type:"button",onClick:()=>be(r.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(_,{control:n.control,name:"total_destination",render:({field:r})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsxs($e,{value:H,onValueChange:te,disabled:!0,children:[e.jsx(Fe,{className:"w-[200px] py-2",children:e.jsx(Ee,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Re,{children:Array.from({length:5},(p,s)=>e.jsxs(qe,{value:(s+1).toString(),children:[" ",s+1," "]},s))})]})}),e.jsx(v,{})]})})]})]})]}),e.jsx(ie,{className:"my-4"}),e.jsx(Qe,{updateDestination:pe,destinationField:Q,form:n,listAllowances:h,totalDestination:n.getValues("total_destination").toString(),setTotalAllowance:me,businessTripDetail:u,type:a,btEdit:J.edit,setIsCashAdvance:$,isCashAdvance:C,setOtherAllowance:o,otherAllowance:d}),e.jsx(ie,{className:"my-4"}),e.jsx(ze,{onClick:async()=>await je(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:he&&e.jsx(Ue,{workflowApproval:{approvalRequest:I.approvalRequest,approvalFrom:I.approvalFrom,acknowledgeFrom:I.acknowledgeFrom},workflowApprovalStep:I.approvalFromStatusRoute,workflowApprovalDiagram:I.approvalFrom})}),e.jsx(W,{type:"submit",children:"submit"})]})})})};function Qe({totalDestination:a,listAllowances:t,form:c,destinationField:n,updateDestination:N,setTotalAllowance:x,businessTripDetail:d,type:o,btEdit:D,setIsCashAdvance:T,isCashAdvance:u,setOtherAllowance:j,otherAllowance:h}){return e.jsxs(Ye,{defaultValue:"destination1",className:"w-full",children:[e.jsx(Ve,{className:"flex items-center justify-start space-x-4",children:n.map((m,f)=>e.jsxs(Ie,{value:`destination${f+1}`,children:["Destination ",f+1]}))}),n.map((m,f)=>e.jsx(et,{listAllowances:t,updateDestination:N,destination:m,form:c,index:f,setTotalAllowance:x,businessTripDetail:d,type:o,btEdit:J.edit,setIsCashAdvance:T,isCashAdvance:u,setOtherAllowance:j,otherAllowance:h}))]})}function et({form:a,index:t,destination:c,updateDestination:n,listAllowances:N,setTotalAllowance:x,businessTripDetail:d,type:o,btEdit:D,setIsCashAdvance:T,isCashAdvance:u,setOtherAllowance:j,otherAllowance:h}){const{fields:m,update:f,append:q,remove:C}=P({control:a.control,name:`destinations[${t}].detail_attedances`}),{fields:$,update:k,append:H,remove:Z,replace:te}=P({control:a.control,name:`destinations[${t}].allowances`}),K=S=>{T(S)};Te(),U({control:a.control,name:"total_percent"});const Q=d.total_cash_advance;return g.useEffect(()=>{},[Q]),e.jsxs(Pe,{value:`destination${t+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:c.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:c==null?void 0:c.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:c==null?void 0:c.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:E(c.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:E(c.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(tt,{detailAttedanceFields:m,form:a,updateAttedanceFields:f,destinationIndex:t}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(st,{allowanceField:$,destinationIndex:t,form:a,setOtherAllowance:j,otherAllowance:h})]},t),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Je,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:S=>K(S.target.checked)})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(_,{control:a.control,name:"reference_number",render:({field:S})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{value:S.value||"",onChange:se=>S.onChange(se.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(_,{control:a.control,name:"total_percent",render:({field:S})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{...S,value:S.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(v,{})]})}),e.jsx(_,{control:a.control,name:"total_cash_advance",render:({field:S})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{value:S.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(v,{})]})})]})]})]})]})]})}function as({allowanceField:a,destinationIndex:t,form:c,setTotalAllowance:n}){const N=c.watch(`destinations[${t}].allowances`),x=c.watch(`destinations[${t}].total_allowance`);return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsx("tbody",{children:N.map((d,o)=>e.jsxs("tr",{children:[e.jsx("td",{children:d.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:d.subtotal})]})]},d.id))}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:x})]})]})})]})})}function tt({form:a,destinationIndex:t,detailAttedanceFields:c,updateAttedanceFields:n}){const N=a.watch(`destinations[${t}].detail_attedances`);return g.useEffect(()=>{},[N]),g.useEffect(()=>{},[c]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:N.map((x,d)=>e.jsxs("tr",{children:[e.jsxs("td",{children:[E(x.date).format("DD/MM/YYYY"),e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.date`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:E(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_code,e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.shift_code`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:E(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_start,e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.shift_start`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:E(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsxs("td",{children:[x.shift_end,e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.shift_end`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:E(o.value).format("YYYY-MM-DD"),onChange:o.onChange,type:"hidden"})}),e.jsx(v,{})]})})]}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.start_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(v,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.end_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(v,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.request_start_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(v,{})]})})}),e.jsx("td",{children:e.jsx(_,{control:a.control,name:`destinations.${t}.detail_attedances.${d}.request_end_time`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{defaultValue:o.value,onChange:o.onChange})}),e.jsx(v,{})]})})})]},x.index))})]})})})]})}function st({form:a,destinationIndex:t,allowanceField:c,setOtherAllowance:n,otherAllowance:N}){const x=a.watch(`destinations[${t}].allowances`);g.useEffect(()=>{},[x]);const{fields:d,append:o,remove:D}=P({control:a.control,name:`destinations.${t}.other`}),T=U({control:a.control,name:`destinations.${t}.other`}),u=()=>(T||[]).reduce((h,m)=>{const f=Number((m==null?void 0:m.value)||0);return h+f},0),j=()=>{o({value:0})};return e.jsxs("table",{className:"w-full allowance-table",children:[x.map((h,m)=>e.jsx(at,{form:a,allowance:h,destinationIndex:t,allowanceIndex:m})),d.length===0&&e.jsx("tr",{children:e.jsx("td",{children:e.jsx(W,{type:"button",className:"text-xl",onClick:j,children:"+"})})}),d.map((h,m)=>e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:"Other Allowance"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:a.control,name:`destinations.${t}.other[${m}].value`,render:({field:f})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{type:"number",min:"0",value:f.value??"",onChange:q=>{let C=q.target.value;if(C===""){f.onChange(void 0);return}const $=Math.max(0,Number(C));f.onChange($)}})}),e.jsx(v,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm",style:{padding:"2px 5px"},children:["= IDR ",z(u(),!1)]})})}),e.jsx("td",{children:e.jsx(W,{type:"button",className:"text-xs",onClick:()=>D(m),children:"X"})})]},m))]})}function at({form:a,allowance:t,destinationIndex:c,allowanceIndex:n}){const[N,x]=g.useState(!1);g.useState(0);const d=j=>{x(h=>!h)},o=U({control:a.control,name:`destinations[${c}].allowances[${n}].detail[0].request_price`}),D=U({control:a.control,name:`destinations[${c}].allowances[${n}].detail`}),T=()=>{if(t.type==="total")return parseFloat(o||0)*1;{let j=0;return D==null||D.forEach(h=>{const m=parseFloat(h.request_price||0);j+=m}),j}},u=(j,h)=>{const m=parseFloat(h),f=isNaN(m)?0:m,q=t.request_value;let C=!0;switch(q){case"unlimited":C=!0;break;case"fixed value":const $=t.subtotal;f!==$&&(alert(`Please enter the fixed value of IDR ${$}`),C=!1);break;case"up to max value":const k=t.subtotal;f>k&&(alert(`The value should not exceed IDR ${k}`),C=!1);break;default:C=!1}C&&a.setValue(`destinations[${c}].allowances[${n}].detail[${j}].request_price`,f)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:t.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:t.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{control:a.control,name:`destinations[${c}].allowances[${n}].detail[0].request_price`,render:({field:j})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{value:j.value,onChange:h=>u(0,h.target.value)})}),e.jsx(v,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",t.detail.length," Days * ",z(t.subtotal,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",z(T(),!1)]})})}),t.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>d(),children:e.jsxs(W,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},t.id),N&&e.jsx(e.Fragment,{children:t.detail.map((j,h)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:E(j.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(_,{control:a.control,name:`destinations[${c}].allowances[${n}].detail[${h}].request_price`,render:({field:m})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{value:m.value,onChange:f=>u(h,f.target.value)})}),e.jsx(v,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},j.id))})]})}function ns({form:a,type:t,allowanceIndex:c,destinationIndex:n}){const{fields:N}=P({control:a.control,name:`destinations.${n}.allowances.${c}.detail`});return e.jsx(e.Fragment,{children:N.map((x,d)=>e.jsx(_,{control:a.control,name:`destinations.${n}.allowances.${d}.detail.${d}.request_price`,render:({field:o})=>e.jsxs(w,{children:[e.jsx(b,{children:e.jsx(A,{value:o.value,onChange:o.onChange})}),e.jsx(v,{})]})}))})}export{ns as AllowanceInputForm,at as AllowanceRowInput,Qe as BussinesTripDestination,et as BussinessDestinationForm,ss as BussinessTripFormV1,st as DetailAllowance,tt as DetailAttedances,as as ResultTotalItem};
