import{r as c,u as Le,j as e,b as Ge}from"./app-DT9oxaOb.js";import{d as Oe,F as x,a as g,b as j,c as v,e as Xe}from"./form-hL4e1H9r.js";import{z as s,t as ze}from"./index-CSK2W2Ec.js";import{d as U}from"./index-COcYOZcc.js";import{B as Je}from"./button--eB67zHQ.js";import{T as We}from"./textarea-C1mnd4tm.js";import{u as He,b as ne,c as Ke}from"./index.esm-CamKYyGJ.js";import{S as Ze}from"./scroll-area-DF_l_iwJ.js";import{S as ee}from"./separator-BRylfeB_.js";/* empty css              */import{a as $}from"./axiosInstance-CCIKLaiQ.js";import{W as Qe}from"./WorkflowComponent-CO7SHwuf.js";import{F as Ue}from"./formSwitchCustom-C3yFOw-R.js";import{I as M}from"./input-BDqDAMkt.js";import{S as te,a as ae,b as se,c as re,d as k}from"./select-B4L0-kF0.js";import{C as et,E as tt,a as at}from"./api-CjLesBQC.js";import{G as st,a as rt}from"./api-BEQetkWJ.js";import{h as N}from"./moment-C5S46NFB.js";import{BusinessTripType as u}from"./models-BAdk5O-V.js";import{u as S}from"./getDropdown-DySdopra.js";import{F as B}from"./formDropdown-BAREkBwW.js";import{BussinesTripDestination as nt}from"./BussinesTripDestination-DhDWHSf0.js";import{B as ot}from"./Button-s4xr3tQ2.js";import"./index-sY56SCGx.js";import"./utils-DwndSUy6.js";import"./index-BCvOxj_J.js";import"./index-Bb4qSo10.js";import"./index-XH5AFRIt.js";import"./index-EvR_V4_C.js";import"./createSvgIcon-BMfph7ok.js";import"./DefaultPropsProvider-DmjKak_p.js";import"./createLucideIcon-BXQGbN7f.js";import"./Switch-DgNDVjgC.js";import"./createSimplePaletteValueFilter-BNo2HqrB.js";import"./SwitchBase-BpteUVqi.js";import"./FormHelperText-GBiFxlm-.js";import"./useControlled-drrZw8K3.js";import"./index-pfNXkOFO.js";import"./index-BjEbi6AW.js";import"./Combination-CLqhaVs0.js";import"./index-DQ6BtcNe.js";import"./index-Ce-bC7Hs.js";import"./index-9ljr2T9d.js";import"./CustomStatus-CBEeb0Kb.js";import"./TextField-CpS1-5zT.js";import"./useSlot-tQ4DkPgF.js";import"./tabs-BDSJ_BNk.js";import"./index-DP-wH3hV.js";import"./BussinessDestinationForm-Cx1HacX-.js";import"./CustomDatePicker-BS4Lepr4.js";import"./popover-n78cYVA-.js";import"./DetailAttedances-BC0gEm4-.js";import"./DetailAllowance-C3xLM4gA.js";import"./rupiahCurrencyFormat-CP-6egij.js";import"./chevrons-up-down-STjrn3aM.js";import"./ResultTotalItem-DyQtSD6v.js";s.object({remark:s.string().min(1).max(50),reimburse_cost:s.number()});const it=1*1024*1024,lt=["image/jpeg","image/png","application/pdf"],_a=({users:q,listPurposeType:oe,pajak:I,costcenter:R,purchasingGroup:V,type:p,id:w,isAdmin:h,idUser:f})=>{const ie=s.object({purpose_type_id:s.string().min(1,"Purpose type required"),request_for:s.string().min(1,"Request is required"),cost_center_id:s.string().min(1,"Cost Center is required"),remark:s.string().min(1,"Remark is required"),attachment:s.array(s.instanceof(File).refine(t=>lt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, or PDF"}).refine(t=>t.size<=it,{message:"File size must be less than 1MB"})),total_destination:s.number().min(1,"Total Destinantion Required"),cash_advance:s.boolean().nullable().optional(),reference_number:s.string().nullable().optional(),total_percent:s.string().nullable().optional(),total_cash_advance:s.string().nullable().optional(),destinations:s.array(s.object({destination:s.string().min(1,"Destinantion is Required"),pajak_id:s.string().min(1,"Pajak is required"),purchasing_group_id:s.string().min(1,"Purchasing Group is required"),business_trip_start_date:s.date().optional(),business_trip_end_date:s.date().optional(),detail_attedances:s.array(s.object({date:s.date().optional(),shift_code:s.string().optional(),shift_start:s.string().optional(),shift_end:s.string().optional(),start_time:s.string().optional(),end_time:s.string().optional()})),allowances:s.array(s.object({name:s.string().optional(),code:s.string().optional(),default_price:s.number().optional(),type:s.string().optional(),subtotal:s.number().optional(),currency:s.string().optional(),detail:s.array(s.object({date:s.date().nullish(),request_price:s.any().optional()}))}))}))}),[L,le]=c.useState("1"),r=He({resolver:ze(ie),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:"",total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",pajak_id:"",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[T,G]=c.useState([]);async function ce(){const t=at(w);r.setValue("destinations",[]);try{const a=await Ge.get(t),n=a.data.data;X("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.data.data.purpose_type.type}}),G(n.attachments),r.setValue("purpose_type_id",n.purpose_type_id.toString()),r.setValue("request_for",n.request_for.id.toString()),r.setValue("cost_center_id",n.cost_center_id.toString()),r.setValue("remark",n.remarks),r.setValue("total_destination",n.total_destination),r.setValue("cash_advance",n.cash_advance==1),r.setValue("reference_number",n.reference_number),r.setValue("total_percent",n.total_percent),r.setValue("total_cash_advance",n.total_cash_advance),console.log(n.destinations," data.destinations"),r.setValue("destinations",n.destinations.map(o=>({destination:o.destination,pajak_id:o.pajak_id,purchasing_group_id:o.purchasing_group_id,business_trip_start_date:new Date(o.business_trip_start_date),business_trip_end_date:new Date(o.business_trip_end_date),detail_attedances:o.detail_attedances.map(i=>({...i,date:new Date(i.date)})),allowances:o.allowances.map(i=>({...i,default_price:parseInt(i.default_price),subtotal:parseInt(i.subtotal),detail:i.detail.map(l=>({...l,date:(l==null?void 0:l.date)!=null?new Date(l.date):null}))}))})))}catch{}}const[O,de]=c.useState([]),[pe,me]=c.useState(""),{dataDropdown:ue,getDropdown:X}=S(),[_e,he]=c.useState(h==="0"?f==null?void 0:f.toString():"");async function fe(t){r.setValue("purpose_type_id",t||"");const a=h=="0"?f||"":_e||"",n=st(t,a),o=rt(t);try{const i=await $.get(n),l=await $.get(o),d=l.data.data.purpose.type;d=="international"&&z("1"),me(d),de(i.data.data),X("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:l.data.data.purpose.type}})}catch(i){console.log(i)}}const z=t=>{r.setValue("total_destination",parseInt(t,10)),le(t),J()},{showToast:F}=Le(),xe=async t=>{console.log(T," valuesss");try{const a=new FormData,n=Y();if(a.append("user_id",t.request_for??""),a.append("value",n.toString()),a.append("purpose_type_id",t.purpose_type_id??""),a.append("request_for",t.request_for??""),a.append("cost_center_id",t.cost_center_id??""),a.append("remark",t.remark??""),a.append("reference_number",`${t.reference_number}`),a.append("cash_advance",`${t.cash_advance}`),a.append("total_percent",`${t.total_percent}`),a.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((o,i)=>{o&&a.append(`attachment[${i}]`,o)}),a.append("total_destination",`${t.total_destination}`),t.destinations.forEach((o,i)=>{const l={...o,business_trip_start_date:N(o.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:N(o.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:o.detail_attedances.map(d=>({...d,date:N(d.date).format("YYYY-MM-DD")})),allowances:o.allowances.map(d=>({...d,detail:d.detail.map(m=>({...m,date:(m==null?void 0:m.date)!=null?N(m.date).format("YYYY-MM-DD"):null}))}))};a.append(`destinations[${i}]`,JSON.stringify(l))}),p==u.create)await U.Inertia.post(et,a,{headers:{"Content-Type":"multipart/form-data"}}),F("succesfully created data","success");else{const o=new FormData;o.append("remark",t.remark??""),t.attachment.forEach((i,l)=>{i&&o.append(`attachment[${l}]`,i)}),T.forEach((i,l)=>{i&&o.append(`file_existing[${l}]`,JSON.stringify(i))}),await U.Inertia.post(`${tt}/${w}`,o,{headers:{"Content-Type":"multipart/form-data"}}),F("succesfully updated data","success")}}catch(a){console.log(a)}};function J(){const t=[],a=parseInt(L);for(let n=0;n<a;n++)t.push({destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,pajak_id:"",purchasing_group_id:"",cash_advance:!1,total_percent:"",total_cash_advance:"0",allowances:[],detail_attedances:[]});r.setValue("destinations",t)}const{fields:ge,append:ct,remove:dt,update:je}=ne({control:r.control,name:"destinations"});c.useEffect(()=>{w&&p==u.edit&&ce()},[p]),c.useEffect(()=>{p==u.create&&J()},[L,O,h,f]);const[we,be]=c.useState(!1),[D,ye]=c.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),Se=(t,a)=>{var n;return t.type==="total"?parseFloat(((n=a==null?void 0:a[0])==null?void 0:n.request_price)||0):a==null?void 0:a.reduce((o,i)=>o+parseFloat(i.request_price||0),0)},Y=()=>r.getValues("destinations").reduce((n,o,i)=>{const d=(o.allowances||[]).reduce((m,C,E)=>{const A=r.getValues(`destinations.${i}.allowances.${E}.detail`),P=Se(C,A);return m+P},0);return n+d},0),W=async()=>{var t,a,n,o,i,l,d,m,C,E,A,P;try{const b=Y();if(b===0){F("Please fill the balance","error");return}const y=await $.get("/check-approval",{params:{value:b,user_id:r.getValues("request_for"),type:"TRIP"}});if(y.data.status_code===200){const $e=(a=(t=y.data)==null?void 0:t.data)==null?void 0:a.approval.map(_=>(_==null?void 0:_.division_name)||null),Be=(o=(n=y.data)==null?void 0:n.data)==null?void 0:o.approval.map(_=>(_==null?void 0:_.name)||null),Q=[];(l=(i=y.data)==null?void 0:i.data)!=null&&l.hr&&Q.push((C=(m=(d=y.data)==null?void 0:d.data)==null?void 0:m.hr)==null?void 0:C.name);const Me=(((E=y.data.data)==null?void 0:E.approval)??[]).map(_=>({status:"",name:_.name,dateApproved:""}));ye({approvalRequest:$e,approvalFrom:Be,acknowledgeFrom:Q,approvalFromStatusRoute:Me}),be(!0)}}catch(b){F((P=(A=b==null?void 0:b.response)==null?void 0:A.data)==null?void 0:P.message,"error")}};c.useEffect(()=>{Y()>0&&W()},[r.watch("destinations")]),c.useState([]);const ve=t=>{G(a=>a.filter(n=>n.id!==t))},[De,H]=c.useState(!1),Te=t=>{H(t)},K=Ke({control:r.control,name:"total_percent"}),[Fe,Ce]=c.useState(0),Z=Fe;c.useEffect(()=>{p==u.edit&&H(r.getValues("cash_advance")??!1);const a=parseFloat((K||"0").toString())/100*Z;r.setValue("total_cash_advance",a.toFixed(0))},[K,Z]);const{dataDropdown:Ee,getDropdown:Ae}=S(),{dataDropdown:Pe,getDropdown:ke}=S(),{dataDropdown:Ne,getDropdown:qe}=S(),{dataDropdown:Ie,getDropdown:Re}=S(),{dataDropdown:Ve,getDropdown:Ye}=S();return c.useEffect(()=>{Ae("",{name:"name",id:"id",tabel:"users",idType:"string"}),ke("",{name:"name",id:"id",tabel:"purpose_types",idType:"string"}),qe("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),Re("",{name:"mwszkz",id:"id",tabel:"pajaks",idType:"string"}),Ye("",{name:"purchasing_group",id:"id",tabel:"purchasing_groups",idType:"string"})},[]),c.useEffect(()=>{p!=u.edit&&h=="0"&&r.setValue("request_for",(f==null?void 0:f.toString())??"")},[]),e.jsx(Ze,{className:"h-[600px] w-full ",children:e.jsx(Oe,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(xe),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request For"}),e.jsx("td",{children:e.jsx(B,{fieldLabel:"",options:Ee,fieldName:"request_for",isRequired:!0,disabled:p==u.edit?!!r.watch("request_for"):h=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onChangeOutside:t=>{he(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussiness Trip Purpose Type"}),e.jsx("td",{children:e.jsx(B,{fieldLabel:"",options:Pe,fieldName:"purpose_type_id",isRequired:!0,disabled:p==u.edit?!!r.watch("purpose_type_id"):!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,a)=>{await fe(t)}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(B,{fieldLabel:"",options:Ne,fieldName:"cost_center_id",isRequired:!0,disabled:p==u.edit?!!r.watch("cost_center_id"):!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(x,{control:r.control,name:"remark",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(We,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(v,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Attachment"}),e.jsx("td",{children:e.jsx(x,{control:r.control,name:"attachment",render:({field:t})=>e.jsxs(g,{children:[e.jsx(Xe,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB"}),e.jsx(j,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,onChange:a=>{const n=a.target.files;if(n){const o=Array.from(n);t.onChange(o)}else t.onChange([])}})}),r.formState.errors.attachment&&Array.isArray(r.formState.errors.attachment)?r.formState.errors.attachment.map((a,n)=>e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:a.message},n)):null]})})})]}),T.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:T.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:t.file_name},a),e.jsx("button",{type:"button",onClick:()=>ve(t.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"doc,jpg,ods,png,txt,pdf"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(x,{control:r.control,name:"total_destination",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs(te,{value:t.value.toString(),onValueChange:z,disabled:p==u.edit?!!r.watch("total_destination"):pe=="international",children:[e.jsx(ae,{className:"w-[200px] py-2",children:e.jsx(se,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(re,{children:Array.from({length:5},(a,n)=>e.jsxs(k,{value:(n+1).toString(),children:[" ",n+1," "]},n))})]})}),e.jsx(v,{})]})})]})]})]}),e.jsx(ee,{className:"my-4"}),e.jsx(nt,{updateDestination:je,destinationField:ge,form:r,listAllowances:O,totalDestination:r.getValues("total_destination").toString(),pajak:I,purchasingGroup:V,setTotalAllowance:Ce,dataTax:Ie,dataPurchasingGroup:Ve,dataDestination:ue,type:p,btEdit:u.edit}),e.jsx(ee,{className:"my-4"}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(Ue,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Te(t.target.checked)})})]}),De&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(x,{control:r.control,name:"reference_number",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(M,{value:t.value||"",onChange:a=>t.onChange(a.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number"})}),e.jsx(v,{})]})}),e.jsx(x,{control:r.control,name:"total_percent",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:e.jsxs(te,{value:t.value||void 0,onValueChange:a=>t.onChange(a),children:[e.jsx(ae,{className:"w-[50%] mb-2",children:e.jsx(se,{placeholder:"-- Select Total Percent --"})}),e.jsxs(re,{children:[e.jsx(k,{value:"10",children:"10%"}),e.jsx(k,{value:"25",children:"25%"}),e.jsx(k,{value:"50",children:"50%"})]})]})}),e.jsx(v,{})]})}),e.jsx(x,{control:r.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(M,{value:t.value||"",readOnly:!0,className:"w-[50%]"})}),e.jsx(v,{})]})})]})]})})]}),e.jsx(ot,{onClick:async()=>await W(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:we&&e.jsx(Qe,{workflowApproval:{approvalRequest:D.approvalRequest,approvalFrom:D.approvalFrom,acknowledgeFrom:D.acknowledgeFrom},workflowApprovalStep:D.approvalFromStatusRoute,workflowApprovalDiagram:D.approvalFrom})}),e.jsx(Je,{type:"submit",children:"submit"})]})})})};function ha({form:q,type:oe,allowanceIndex:I,destinationIndex:R}){const{fields:V}=ne({control:q.control,name:`destinations.${R}.allowances.${I}.detail`});return e.jsx(e.Fragment,{children:V.map((p,w)=>e.jsx(x,{control:q.control,name:`destinations.${R}.allowances.${w}.detail.${w}.request_price`,render:({field:h})=>e.jsxs(g,{children:[e.jsx(j,{children:e.jsx(M,{value:h.value,onChange:h.onChange})}),e.jsx(v,{})]})}))})}export{ha as AllowanceInputForm,_a as BussinessTripFormV1};
