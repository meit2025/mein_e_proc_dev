import{j as e,r as F,u as rt,q as at}from"./app-CaU5BHLq.js";import{B as nt}from"./button-BsgJxWB0.js";import{h as $}from"./moment-C5S46NFB.js";import{z as u,t as ot}from"./index-D69hZN1N.js";import{f as H}from"./rupiahCurrencyFormat-CP-6egij.js";import{d as lt,F as D,a as N,b as C,c as S,f as it,e as ct}from"./form--W6sjzTf.js";import{u as mt,b as dt}from"./index.esm-BTz3RK1_.js";import{T as De}from"./textarea-BOwjh16d.js";/* empty css                  */import{S as pt}from"./scroll-area-BFfzJZKf.js";import{a as A}from"./axiosInstance-BOGfP1qU.js";import{S as Ne}from"./separator-D3xuhobV.js";import{T as ut,a as ht,b as ft,c as gt}from"./tabs-DiuNR2Tn.js";import{S as W,a as Z,b as J,c as K,d as X}from"./select-BPyS7YIR.js";import{F as ae}from"./formDropdown-syU2gQGh.js";import{C as Ce}from"./CustomDatePicker-CyFDtIjI.js";import{I as Se}from"./input-DNiMRtKT.js";import{ReimburseFormType as b}from"./listModel-TdtqvWRz.js";import{u as Q}from"./getDropdown-C_1oXgaQ.js";import{G as _t,a as Fe,b as jt}from"./api-DXF7erOJ.js";import{L as xt}from"./LoadingSpin-f-xPQ63G.js";import{W as bt}from"./WorkflowComponent-CurjK_zH.js";import{C as yt}from"./CustomStatus-D4NTmVzk.js";import{F as Ie}from"./FormHelperText-DVoX-5uD.js";import{B as wt}from"./Button-C94K6XPf.js";import"./app-DQK4SJPx.js";import"./index-COcTjbFu.js";import"./index-Bb4qSo10.js";import"./utils-gQbiy-bH.js";import"./createLucideIcon-Ph3KASTp.js";import"./index-erOylCr4.js";import"./index-BEBgdMcG.js";import"./index-yWUXuHul.js";import"./index-D89ftgD3.js";import"./index-BGgm14XW.js";import"./index-BdQq_4o_.js";import"./index-DwO51Zhk.js";import"./index-BbET0Z3x.js";import"./index-BKVNZwOw.js";import"./index-BnoQBmxY.js";import"./index-CREntH3s.js";import"./Combination-C9ej0uf1.js";import"./index-Du17KhK2.js";import"./TextField-Bj6kqZ-J.js";import"./createSvgIcon-UPnILT9v.js";import"./DefaultPropsProvider-Da4bJPyr.js";import"./useSlot-DHESPkfy.js";import"./createSimplePaletteValueFilter-DcYWumH0.js";import"./useControlled-tao6Id_w.js";function vt({isLoading:ne=!1,children:oe}){return e.jsx("div",{className:"",children:ne?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(xt,{})})}):oe})}const ys=({onSuccess:ne,currencies:oe,taxDefaultValue:he,uomDefaultValue:fe,categories:Dt,users:Nt,edit_url:Ee,update_url:qe,store_url:Te,type:_,currentUser:R})=>{const[Re,Ye]=F.useState("form1"),{showToast:Y}=rt();at().props;const{dataDropdown:ke,getDropdown:ge}=Q(_t),{dataDropdown:Me,getDropdown:Le}=Q(),{dataDropdown:$e,getDropdown:Ae}=Q(),{dataDropdown:Be,getDropdown:_e}=Q("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:Ve,getDropdown:je}=Q("api/master/cost-center/dropdown-list"),[G,xe]=F.useState([]),[Pe,le]=F.useState([]),[I,Ge]=F.useState(!1),[be,ze]=F.useState(!1),[Oe,U]=F.useState(!1),[j,B]=F.useState([]),[z,He]=F.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),We=1*1024*1024,Ze=["image/jpeg","image/png","application/pdf","image/heic","image/heif"],Je=u.object({formCount:u.string().min(1,"total form must be have value"),remark_group:u.string().min(1,"header remark is required"),cost_center:u.string().min(1,"cost center required"),requester:u.string().min(1,"requester required"),value:u.number().optional(),user_id:u.string().optional(),forms:u.array(u.object({reimburseId:u.string().optional(),for:u.string().optional(),group:u.string().optional(),reimburse_type:u.string().min(1,"reimburse type is required"),short_text:u.string().min(1,"remarks is required"),balance:u.string(),remaining_balance_when_request:u.number(),currency:u.string().min(1,"currency required"),tax_on_sales:u.string().min(1,"tax required"),purchase_requisition_unit_of_measure:u.string().min(1,"uom required"),purchasing_group:u.string().min(1,"Purchasing Group required"),type:u.any(),item_delivery_data:u.date(),claim_date:u.date(),attachment:u.array(u.instanceof(File).refine(s=>Ze.includes(s.type),{message:"File type must be JPG, JPEG, PNG, HEIC, or PDF"}).refine(s=>s.size<=We,{message:"File size must be less than 1MB"})).min(_===b.create?1:0,"Attachment is required")}))});F.useEffect(()=>{Ae("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}}),Le("",{name:"unit_of_measurement_text",id:"id",tabel:"uoms",where:{key:"iso_code",parameter:"PCE"}}),_e("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),je("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"}),ge("",{name:"name",id:"nip",tabel:"users"}),a.getValues("requester")!==""&&ee(0)},[]);const Ke={formCount:"1",remark_group:"",cost_center:"",requester:String(R==null?void 0:R.is_admin)==="1"?"":R==null?void 0:R.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:he,purchase_requisition_unit_of_measure:fe,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},a=mt({resolver:ot(Je),defaultValues:Ke}),{fields:ie,update:x}=dt({control:a.control,name:"forms"});async function Xe(){a.setValue("forms",[]),U(!0);try{const s=await A.get(Ee??""),t=s.data.data.group,n=s.data.data.forms;Ge(t.reimbursementStatus);const d=n.map(l=>({reimburseId:String(l.id),for:String(l.for),group:String(l.group),reimburse_type:l.reimburse_type.code,short_text:l.short_text,balance:_===b.edit?l.balance:"",currency:l.currency,tax_on_sales:String(l.tax_on_sales),purchase_requisition_unit_of_measure:String(l.purchase_requisition_unit_of_measure),purchasing_group:String(l.purchasing_group),type:l.type,item_delivery_data:new Date(l.item_delivery_data),claim_date:new Date(l.claim_date),attachment:[]}));a.setValue("formCount",n.length.toString()),a.setValue("remark_group",t.remark),a.setValue("cost_center",String(t.cost_center.id)),a.setValue("requester",t.requester);let p=0;for(const l of n)await ee(p,{reimburse_type:l.reimburse_type.code}),await ye(p,{type:l.type,reimburse_type:l.reimburse_type.code}),await ce(p,{reimburse_type:l.reimburse_type.code,for:l.reimburse_type.is_employee===1?null:l.for}),p++;a.setValue("forms",d),U(!1)}catch{U(!1)}}F.useEffect(()=>{(_===b.edit||_===b.clone)&&(U(!0),Xe())},[_]);const Qe=async s=>{s.length>0&&ge("",{name:"name",id:"nip",tabel:"users"})},ee=async(s,t=null)=>{const n=await A.get(Fe,{params:{user:a.getValues("requester"),hasValue:t!=null?t.reimburse_type:null},headers:{"Content-Type":"application/json"}});xe(d=>{const p=[...d];return p[s]=n.data.data,p})},Ue=async(s,t)=>{if(s&&s.length>0)try{const n=await A.get(Fe,{params:{search:s,user:a.getValues("requester")}});xe(d=>{const p=[...d];return p[t]=n.data.data,p})}catch(n){console.error("Error searching reimburse types:",n)}},ye=async(s,t)=>{const n=await A.get(jt,{params:{user:a.getValues("requester"),familyRelationship:t.type=="Family"?"0":"1",reimburseType:t.reimburse_type},headers:{"Content-Type":"application/json"}});le(d=>{const p=[...d];return p[s]=n.data.data,p})},et=s=>{for(let t=0;t<ie.length;t++)ee(t);if(s==null)for(let t=0;t<ie.length;t++)a.setValue(`forms.${t}.reimburse_type`,""),a.setValue(`forms.${t}.for`,"");B([]),le([])};function tt(s){const t=[...a.getValues("forms")];for(let n=0;n<parseInt(s);n++)if(n+1>t.length){ee(n);const d={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:he,purchase_requisition_unit_of_measure:fe,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};t.push(d)}a.setValue("forms",t)}const we=s=>{Ye(s)},st=async s=>{var n,d,p,l,h;if(j)for(let m=0;m<j.length;m++){if(s.forms.length==0||s.forms.length-1,((n=j[m])==null?void 0:n.type_limit)!=="Unlimited"&&parseInt((d=j[m])==null?void 0:d.limit)==0){Y("Claim Limit for form "+(m+1)+" is Empty, Please Contact the Admin","error");return}if(s.forms[m].balance==""||parseInt(s.forms[m].balance)==0){Y("Claim Balance for form "+(m+1)+" cannot be 0","error");return}if(parseInt(((p=j[m])==null?void 0:p.balance)??0)<parseInt(s.forms[m].balance??0)){Y("Please check your balance input for forms "+(m+1)+"  is not must be above "+((l=j[m])==null?void 0:l.balance),"error");return}s.forms=s.forms.map((v,E)=>{var q;return{...v,claim_date:$(v.claim_date).format("YYYY-MM-DD"),item_delivery_data:$(v.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:parseInt(((q=j[E])==null?void 0:q.balance)??0)}})}const t=s.forms.reduce((m,v)=>m+parseInt(v.balance)||0,0);s.value=t,s.user_id=(s==null?void 0:s.requester)||"0";try{let m;_===b.edit?m=await A.put(qe??"",s,{headers:{"Content-Type":"multipart/form-data"}}):m=await A.post(Te??"",s,{headers:{"Content-Type":"multipart/form-data"}}),Y((h=m==null?void 0:m.data)==null?void 0:h.data,"success"),ne()}catch{}};async function ce(s,t=null){var p,l;const n=a.getValues(`forms.${s}`),d={user:a.getValues("requester"),reimbuse_type:t!=null?t.reimburse_type:n.reimburse_type,for:t!=null?t.for:n.for};try{const h=await A.get("reimburse/data-limit-and-balance",{params:d});B(m=>{const E=a.getValues("forms").filter((y,k)=>k!==s&&y.reimburse_type===n.reimburse_type),q=E.reduce((y,k)=>y+parseInt(k.balance)||0,0),L=[...m];return L[s]={...h.data.data,balance:h.data.data.balance-q,limit:h.data.data.type_limit=="Unlimited"?h.data.data.type_limit:Math.max(0,h.data.data.limit-E.length)},L})}catch(h){Y((l=(p=h==null?void 0:h.response)==null?void 0:p.data)==null?void 0:l.message,"error")}}const ve=async()=>{var s,t,n,d,p,l,h,m,v,E,q,L;try{const y=a.getValues("forms"),k=y.map((w,T)=>({index:T,value:w.balance?parseInt(w.balance):0}));if(k.some(w=>w.value===0)){const w=k.findIndex(T=>T.value===0);Y(`Please fill the balance for form ${w+1}`,"error");return}const te=y.reduce((w,T)=>w+(parseInt(T.balance)||0),0),M=await A.get("/check-approval",{params:{value:te,requester:a.getValues("requester"),type:"REIM"}});if(M.data.status_code===200){const w=(t=(s=M.data)==null?void 0:s.data)==null?void 0:t.approval.map(i=>(i==null?void 0:i.division_name)||null),T=(d=(n=M.data)==null?void 0:n.data)==null?void 0:d.approval.map(i=>(i==null?void 0:i.name)||null),o=[];(l=(p=M.data)==null?void 0:p.data)!=null&&l.hr&&o.push((v=(m=(h=M.data)==null?void 0:h.data)==null?void 0:m.hr)==null?void 0:v.name);const r=(((E=M.data.data)==null?void 0:E.approval)??[]).map(i=>({status:"",name:i.name,dateApproved:""}));He({approvalRequest:w,approvalFrom:T,acknowledgeFrom:o,approvalFromStatusRoute:r}),ze(!0)}}catch(y){Y((L=(q=y==null?void 0:y.response)==null?void 0:q.data)==null?void 0:L.message,"error")}};return F.useEffect(()=>{a.getValues("forms").reduce((n,d)=>n+parseInt(d.balance)||0,0)>0&&be===!0&&ve()},[a.watch("forms"),a.watch("requester")]),e.jsx(pt,{className:"h-[600px] w-full",children:e.jsx(vt,{isLoading:Oe,children:e.jsx(lt,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(st),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:I&&e.jsx(yt,{name:I==null?void 0:I.name,className:I==null?void 0:I.classname,code:I==null?void 0:I.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:"remark_group",render:({field:s})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(De,{placeholder:"Insert remark",...s})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(ae,{fieldLabel:"",options:Ve,fieldName:"cost_center",disabled:_===b.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onChangeOutside:async(s,t)=>{s.length>0&&s!==(t==null?void 0:t.value)&&je(s,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:s})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(ae,{options:ke,fieldName:"requester",disabled:String(R==null?void 0:R.is_admin)==="0"||_===b.edit,placeholder:"Select Employee",onSearch:Qe,onChangeOutside:s=>et(s),classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:"formCount",render:({field:s})=>{var t;return e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(W,{disabled:_===b.edit,onValueChange:n=>{s.onChange(n),tt(n),we(`form${parseInt(n)}`);const d=a.getValues("forms");if(d.length>parseInt(n)){const p=d.slice(0,parseInt(n));a.setValue("forms",p),B(l=>{let h=[...l];return h=h.slice(0,parseInt(n)),h})}},value:(t=s.value)==null?void 0:t.toString(),children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"Select number of forms"})}),e.jsx(K,{children:Array.from({length:3},(n,d)=>d+1).map(n=>e.jsx(X,{value:n.toString(),children:n},n))})]})}),e.jsx(S,{})]})}})})]})]})}),e.jsx(Ne,{className:"my-4"}),e.jsxs(ut,{value:Re,onValueChange:we,className:"w-full",children:[e.jsxs(ht,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:a.watch("formCount")||1}).map((s,t)=>e.jsxs(ft,{value:`form${t+1}`,children:["Form ",t+1]},t))]}),ie.map((s,t)=>{var n,d,p,l,h,m,v,E,q,L,y,k,me,te,M,w,T;return e.jsxs(gt,{value:`form${t+1}`,children:[e.jsx(D,{control:a.control,name:`forms.${t}.reimburseId`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(Se,{className:"sr-only",value:s.reimburseId,onChange:o.onChange})}),e.jsx(S,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(ae,{options:G[t],fieldName:`forms.${t}.reimburse_type`,disabled:a.getValues("requester")==""||_===b.edit,placeholder:"Select Reimburse Type",onChangeOutside:(o,r)=>{const f=a.getValues("requester");if(o!==(r==null?void 0:r.value)&&f!==""&&Ue(o,t),r!=null&&r.value){let i=G[t].filter(g=>g.value==r.value)[0];x(t,{...s,reimburse_type:r==null?void 0:r.value,type:i.is_employee===1?"Employee":"Family"}),i.is_employee===1?ce(t,{reimburse_type:r==null?void 0:r.value,for:null}):(B(g=>{const c=[...g];return c[t]=[],c}),a.setValue(`forms.${t}.balance`,""),ye(t,{type:"Family",reimburse_type:r==null?void 0:r.value}))}else{B(g=>{const c=[...g];return c[t]=[],c}),x(t,{...s,balance:""}),a.setValue(`forms.${t}.for`,""),le(g=>{const c=[...g];return c[t]=[],c});const i=a.getValues("forms");i.forEach((g,c)=>{var O,de;if(c>t&&i[c].reimburse_type===s.reimburse_type){const se=((O=j[c])==null?void 0:O.balance)||0,pe=((de=j[c])==null?void 0:de.limit)||0;B(P=>{var re;const V=[...P];return V[c]={...V[c],balance:se+parseInt(s.balance||"0")},((re=j[c])==null?void 0:re.type_limit)!=="Unlimited"&&(V[c]={...V[c],limit:pe+1}),V}),a.setValue(`forms.${c}.balance`,"")}})}},classNames:"mt-2 w-full"}),((p=(d=(n=a.formState.errors)==null?void 0:n.forms)==null?void 0:d[t])==null?void 0:p.reimburse_type)&&e.jsx(Ie,{error:!0,children:(v=(m=(h=(l=a.formState.errors)==null?void 0:l.forms)==null?void 0:h[t])==null?void 0:m.reimburse_type)==null?void 0:v.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:`forms.${t}.for`,render:({field:o})=>{var r,f,i,g;return e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(W,{disabled:((i=(f=(r=G==null?void 0:G[t])==null?void 0:r.filter(c=>(c==null?void 0:c.value)==a.getValues(`forms.${t}.reimburse_type`)))==null?void 0:f[0])==null?void 0:i.is_employee)===1||_===b.edit,onValueChange:c=>{x(t,{...s,for:c}),ce(t,{reimburse_type:a.getValues(`forms.${t}.reimburse_type`),for:c})},defaultValue:s==null?void 0:s.for,value:s.for,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(g=Pe[t])==null?void 0:g.map(c=>e.jsx(X,{value:c.value.toString(),children:c.label},c.value))})]})}),e.jsx(S,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(ae,{fieldLabel:"",options:Be,fieldName:`forms.${t}.purchasing_group`,disabled:_===b.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onChangeOutside:async(o,r)=>{o.length>0&&o!==(r==null?void 0:r.value)&&await _e(o,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:o}),r!=null&&r.value&&x(t,{...s,purchasing_group:r==null?void 0:r.value})}}),((L=(q=(E=a.formState.errors)==null?void 0:E.forms)==null?void 0:q[t])==null?void 0:L.purchasing_group)&&e.jsx(Ie,{error:!0,children:(te=(me=(k=(y=a.formState.errors)==null?void 0:y.forms)==null?void 0:k[t])==null?void 0:me.purchasing_group)==null?void 0:te.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:`forms.${t}.tax_on_sales`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(W,{disabled:!0,onValueChange:r=>{x(t,{...s,tax_on_sales:r})},defaultValue:s.tax_on_sales,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:($e??[]).map((r,f)=>e.jsxs(X,{value:r.value.toString(),children:[r.description," - ",r.label]},r.value))})]})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:`forms.${t}.purchase_requisition_unit_of_measure`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(W,{disabled:!0,onValueChange:r=>{x(t,{...s,purchase_requisition_unit_of_measure:String(r)})},defaultValue:s.purchase_requisition_unit_of_measure,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:(Me??[]).map((r,f)=>e.jsx(X,{value:r.value.toString(),children:`${r.label} - ${r.iso_code}`},r.value))})]})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:`forms.${t}.short_text`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(De,{placeholder:"Insert remark",onChange:r=>{x(t,{...s,short_text:r.target.value})},defaultValue:s.short_text})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((M=j[t])==null?void 0:M.balance)&&H((w=j[t])==null?void 0:w.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(T=j[t])==null?void 0:T.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:`forms.${t}.item_delivery_data`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(Ce,{disabled:_===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:r=>{if($(r).format("YYYY-MM-DD")>=$(new Date).format("YYYY-MM-DD"))o.onChange(r),x(t,{...s,item_delivery_data:r});else{const i=$(o.value).format("YYYY-MM-DD");o.onChange(i),x(t,{...s,item_delivery_data:i}),Y("Receipt date cannot be less than today","error")}}})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(D,{control:a.control,name:`forms.${t}.claim_date`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(Ce,{disabled:_===b.edit,initialDate:o.value instanceof Date?o.value:new Date(o.value),minDate:new Date,onDateChange:r=>{if($(r).format("YYYY-MM-DD")>=$(new Date).format("YYYY-MM-DD"))o.onChange(r),x(t,{...s,claim_date:r});else{const i=$(o.value).format("YYYY-MM-DD");o.onChange(i),x(t,{...s,claim_date:i}),Y("Claim date cannot be less than today","error")}}})}),e.jsx(S,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"w-full grid grid-cols-7 gap-x-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(D,{control:a.control,name:`forms.${t}.currency`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(C,{children:e.jsxs(W,{disabled:_===b.edit,onValueChange:r=>{x(t,{...s,currency:r})},defaultValue:s.currency,children:[e.jsx(Z,{className:"w-[200px]",children:e.jsx(J,{placeholder:"-"})}),e.jsx(K,{children:oe.map(r=>e.jsxs(X,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(it,{className:"h-6"}),e.jsx(S,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(D,{control:a.control,name:`forms.${t}.balance`,render:({field:o})=>{var r;return e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(Se,{type:"text",placeholder:"0",onChange:f=>{var se;const i=f.target.value.replace(/[^0-9]/g,""),g=H(i,!1),c=parseInt(i)||0,O=((se=j[t])==null?void 0:se.balance)||0;if(c>O){f.target.value=H(i.slice(0,-1),!1);return}x(t,{...s,balance:i}),f.target.value=g,a.getValues("forms").forEach((pe,P)=>{if(P>t&&pe.reimburse_type===s.reimburse_type){const V=O-c;B(re=>{const ue=[...re];return ue[P]={...ue[P],balance:V},ue}),x(P,{...s,balance:""})}})},defaultValue:H(s.balance,!1),value:H(s.balance,!1),disabled:typeof j[t]>"u"||((r=j[t])==null?void 0:r.length)===0||_===b.edit})}),e.jsx(S,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(D,{control:a.control,name:`forms.${t}.attachment`,render:({field:o})=>e.jsxs(N,{children:[e.jsx(ct,{className:"text-xs text-gray-500 font-extralight mb-1",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(C,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:r=>{const f=r.target.files;if(f){const i=[...s.attachment],g=Array.from(f);i.push(...g),x(t,{...s,attachment:i})}}})}),e.jsx(S,{})]})}),e.jsx("div",{className:"mt-2",children:s.attachment&&s.attachment.length>0&&e.jsx("ul",{children:s.attachment.map((o,r)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsx("button",{type:"button",className:"text-red-500 ml-2",onClick:()=>{const f=s.attachment.filter((i,g)=>g!==r);x(t,{...s,attachment:f})},children:"Delete"})]},r))})})]})]})]})})})]},t)})]}),e.jsx(wt,{onClick:async()=>await ve(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:be&&e.jsx(bt,{workflowApproval:{approvalRequest:z.approvalRequest,approvalFrom:z.approvalFrom,acknowledgeFrom:z.acknowledgeFrom},workflowApprovalStep:z.approvalFromStatusRoute,workflowApprovalDiagram:z.approvalFrom})}),e.jsx(Ne,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(nt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{ys as ReimburseForm};
