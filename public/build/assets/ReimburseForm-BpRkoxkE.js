import{r as m,u as Z,q as ee,a as S,j as e}from"./app-DYXD3EX6.js";import{B as se}from"./button-DVK5eS8I.js";import{F as te,a as c,b as d,c as i,d as h}from"./form-GOUxazQD.js";import{u as re}from"./index.esm-CDnEN_go.js";import{T as $}from"./textarea-DThDYi76.js";/* empty css                  */import{S as ae}from"./scroll-area-D7o3zFP-.js";import{a as ne}from"./axiosInstance-DxCNASqb.js";import{S as F}from"./separator-47DIMeP-.js";import{T as le,a as oe,b as ce,c as de}from"./tabs-DtnjYL7o.js";import{S as u,a as p,b as f,c as g,d as y}from"./select-C3teCrVG.js";import{C as D}from"./CustomDatePicker-6kMhgyEa.js";import{I as R}from"./input-Cs8XgmnE.js";import"./app-wnGHkkFm.js";import"./index-DGSpRV6m.js";import"./index-DJ4vfpRt.js";import"./index-BHuNwEzv.js";import"./index-cT_ms_yg.js";import"./Combination-C-Xv4M6e.js";import"./react-icons.esm-B54UoypB.js";import"./index-BDwmgrWd.js";import"./createLucideIcon-DVkDQ0mH.js";const ke=({purchasing_groups:T,reimbursement:l,reimburses:q,currencies:k,types:A,periods:E,users:I,csrf_token:ie})=>{const[B,L]=m.useState("form1"),{showToast:_}=Z();ee().props;const[he,P]=m.useState(1);m.useState(q);const[b,G]=m.useState([]),[w,M]=m.useState([[]]),[z,H]=m.useState(),[J,K]=m.useState([]),[C,O]=m.useState([[]]),n=re({defaultValues:{formCount:"1",remark_group:"",requester:"",forms:Array.from({length:1}).map(()=>({id:"",type:"",reimburse_type:"",purchasing_group:"",short_text:"",period:"",balance:0,for:z,item_delivery_data:new Date,start_date:new Date,end_date:new Date,currency:"IDR",attachment:null}))}});m.useEffect(()=>{l&&(n.setValue("remark_group",l.remark),n.setValue("requester",l.users.nip),n.setValue("formCount",l.reimburses.length.toString()),n.setValue("forms",l.reimburses.map(a=>({id:a.id,reimburse_type:a.reimburse_type,short_text:a.short_text,balance:Number(a.balance),currency:a.currency,purchasing_group:a.purchasing_group,period:a.period,item_delivery_data:new Date(a.item_delivery_data),start_date:new Date(a.start_date),end_date:new Date(a.end_date),attachment:a.attachment||null}))),l.reimburses.forEach((a,s)=>{N(s,a.reimburse_type)}))},[l]);async function Q(a){try{const o=(await S.get(`/family/show/${a}`)).data;K(o),H(a),n.setValue("requester",a)}catch(s){const j=s.response.data;_(j.message,j.status)}}const U=a=>{P(a);const s=n.getValues("forms"),o=Array.from({length:a}).map((j,r)=>s[r]||{id:"",type:"",reimburse_type:"",short_text:"",period:"",balance:0,item_delivery_data:new Date,start_date:new Date,end_date:new Date,currency:"IDR"});n.setValue("forms",o),n.setValue("formCount",a.toString())},W=a=>{L(a)};async function N(a,s){try{const j=(await S.get(`/reimburse/type/${s}`)).data;M(r=>{const t=[...r];return t[a]=j.data,t}),O(r=>{const t=[...r];return t[a]=s==="Family",t}),n.setValue(`forms.${a}.type`,s)}catch(o){const r=o.response.data;_(r.message,r.status)}}async function X(a,s,o,j,r){const x=(await S.post("/reimburse/is_required",{user:s,is_employee:o,type:j,period:r})).data.data;console.log(x),G(v=>{const V=[...v];return V[a]={plafon:x==null?void 0:x.plafon,limit:x==null?void 0:x.limit},V}),n.setValue(`forms.${a}.for`,s)}const Y=async a=>{try{const s=await ne.post("/reimburse",a);_(s.message,"success")}catch(s){_(s.message,"error")}};return e.jsx(ae,{className:"h-[600px] w-full",children:e.jsx(te,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(Y),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Request No."}),e.jsx("td",{children:(l==null?void 0:l.request_number)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request Status"}),e.jsx("td",{children:(l==null?void 0:l.status)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:"remark_group",render:({field:a})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx($,{disabled:l!==null,placeholder:"Insert remark",...a})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:"requester",render:({field:a})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(u,{disabled:l!==null,onValueChange:s=>Q(s),value:a.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(f,{placeholder:"Requester"})}),e.jsx(g,{children:I.map(s=>e.jsxs(y,{value:s.nip,children:[s.name," [",s.nip,"]"]},s.nip))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:"formCount",render:({field:a})=>{var s;return e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(u,{disabled:l!==null,onValueChange:o=>U(o),value:(s=a.value)==null?void 0:s.toString(),children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(f,{placeholder:"Select number of forms"})}),e.jsx(g,{children:Array.from({length:20},(o,j)=>j+1).map(o=>e.jsx(y,{value:o.toString(),children:o},o))})]})}),e.jsx(h,{})]})}})})]})]})}),e.jsx(F,{className:"my-4"}),e.jsxs(le,{value:B,onValueChange:W,className:"w-full",children:[e.jsxs(oe,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:n.watch("formCount")||1}).map((a,s)=>e.jsxs(ce,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),Array.from({length:n.watch("formCount")||1}).map((a,s)=>{var o,j;return e.jsxs(de,{value:`form${s+1}`,children:[e.jsx(c,{control:n.control,name:`forms.${s}.id`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(R,{className:"sr-only",value:r.value,onChange:r.onChange})}),e.jsx(h,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:n.control,name:`forms.${s}.type`,render:({field:r})=>e.jsxs(u,{disabled:l!==null,onValueChange:t=>N(s,t),value:r.value,children:[e.jsx(p,{children:e.jsx(f,{placeholder:"Select type"})}),e.jsx(g,{children:A.map(t=>e.jsx(y,{value:t,children:t},t))})]})}),e.jsx(c,{control:n.control,name:`forms.${s}.reimburse_type`,render:({field:r})=>e.jsxs(u,{disabled:!w[s]||w[s].length===0,onValueChange:t=>n.setValue(`forms.${s}.reimburse_type`,t),value:r.value,children:[e.jsx(p,{children:e.jsx(f,{placeholder:"Select detail"})}),e.jsx(g,{children:w[s]&&w[s].map(t=>e.jsx(y,{value:t.code,children:t.name},t.code))})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:`forms.${s}.purchasing_group`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(u,{disabled:l!==null,onValueChange:t=>r.onChange(t),value:r.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(g,{children:T.map(t=>e.jsxs(y,{value:t.id.toString(),children:[t.purchasing_group_desc," - ",t.purchasing_group]},t.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:`forms.${s}.period`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(u,{disabled:l!==null,onValueChange:t=>r.onChange(t),value:r.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(g,{children:E.map(t=>e.jsxs(y,{value:t.code,children:[t.start," - ",t.end," (",t.code,")"]},t.code))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:`forms.${s}.for`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(u,{disabled:!C[s]||C[s].length===0,onValueChange:t=>X(s,t,!C[s],n.getValues(`forms.${s}.reimburse_type`),n.getValues(`forms.${s}.period`)),value:r.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(g,{children:J.map(t=>e.jsx(y,{value:t.id.toString(),children:t.name},t.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:`forms.${s}.short_text`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx($,{placeholder:"Insert remark",...r})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsx("td",{children:(o=b[s])==null?void 0:o.plafon})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Limit per claim"}),e.jsx("td",{children:(j=b[s])==null?void 0:j.limit})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:`forms.${s}.item_delivery_data`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(D,{disabled:l!==null,initialDate:r.value instanceof Date?r.value:new Date(r.value),onDateChange:t=>r.onChange(t)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(c,{control:n.control,name:`forms.${s}.start_date`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(D,{disabled:l!==null,initialDate:r.value instanceof Date?r.value:new Date(r.value),onDateChange:t=>r.onChange(t)})}),e.jsx(h,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(c,{control:n.control,name:`forms.${s}.end_date`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(D,{disabled:l!==null,initialDate:r.value instanceof Date?r.value:new Date(r.value),onDateChange:t=>r.onChange(t)})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:n.control,name:`forms.${s}.currency`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(u,{disabled:l!==null,onValueChange:t=>r.onChange(t),value:r.value,children:[e.jsx(p,{className:"w-[200px]",children:e.jsx(f,{placeholder:"-"})}),e.jsx(g,{children:k.map(t=>e.jsxs(y,{value:t.code,children:[t.name," (",t.code,")"]},t.code))})]})}),e.jsx(h,{})]})}),e.jsx(c,{control:n.control,name:`forms.${s}.balance`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(R,{disabled:l!==null,type:"number",placeholder:"0.0",...r,onChange:t=>r.onChange(Number(t.target.value)),value:r.value||0})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(c,{control:n.control,name:`forms.${s}.attachment`,render:({field:r})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:t=>{const x=t.target.files;if(x){const v=Array.from(x);r.onChange(v)}}})}),e.jsx(h,{})]})})})]})]})})})]},s)})]}),e.jsx(F,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(se,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{ke as ReimburseForm};
