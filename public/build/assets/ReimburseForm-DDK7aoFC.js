import{j as e,r as q,u as nt,q as it}from"./app-DT_WwNBc.js";import{B as lt}from"./button-DcYfZZSp.js";import{h as qe}from"./moment-C5S46NFB.js";import{z as p,t as ot}from"./index-DDcYmHoI.js";import{f as J}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{d as ct,F as T,a as A,b as E,c as k,I as Re,f as mt,e as ut}from"./form-D5qp3Juq.js";import{u as dt,b as pt}from"./index.esm-D9bZmIJf.js";import{T as Te}from"./textarea-Du7a9NcP.js";import{S as ht}from"./scroll-area-BDQmPct_.js";import{a as P}from"./axiosInstance-CGEyTaEe.js";import{S as Ae}from"./separator-CpOq3ygA.js";import{T as ft,a as gt,b as bt,c as _t}from"./tabs-C3qH8HVu.js";import{S as K,a as X,b as Q,c as U,d as ee}from"./select-Dm4fcRvW.js";import{F as de}from"./formDropdown-C1TZEeBB.js";import{C as Ee}from"./CustomDatePicker-v2R-xSuY.js";import{ReimburseFormType as x}from"./listModel-BxazjRcE.js";import{u as te}from"./getDropdown-C-Wlu7p2.js";import{G as jt,a as ke,b as xt}from"./api-BeRu2Z8X.js";import{L as yt}from"./LoadingSpin-CqCeBnsX.js";import{W as wt}from"./WorkflowComponent-vLIhqRUF.js";import{C as vt}from"./CustomStatus-Dtc4IakF.js";import{F as Le}from"./FormHelperText-Bn6GwnHb.js";import{B as Nt}from"./Button-Cj2bVVR8.js";import"./app-CfpADx9m.js";import"./index-BDGzNDWJ.js";import"./index-Bb4qSo10.js";import"./utils-Bz2PsrGk.js";import"./createLucideIcon-Q32zYPBd.js";import"./index-C0t-ebrR.js";import"./index-ttJJpqrh.js";import"./index-C2zfve3C.js";import"./index-DKWOI60d.js";import"./index-BXLBAjtO.js";import"./index-BdQq_4o_.js";import"./index-B8SSD9gK.js";import"./index-D7TKn3SX.js";import"./index-C6_LOZ4m.js";import"./index-vT5Wz2s4.js";import"./index-B11avPmX.js";import"./Combination-BoF-0U39.js";import"./index-CtDbeg-P.js";import"./TextField-DFT2tXCj.js";import"./createSvgIcon-BU2ITfiI.js";import"./DefaultPropsProvider-CTNyP9kF.js";import"./useSlot-49b1vwed.js";import"./createSimplePaletteValueFilter-DLct-fk7.js";import"./useControlled-DsHLdvA-.js";function St({isLoading:z=!1,children:pe}){return e.jsx("div",{className:"",children:z?e.jsx(e.Fragment,{children:e.jsx("div",{className:"h-64 w-full flex justify-center items-center",children:e.jsx(yt,{})})}):pe})}const xs=({onSuccess:z,currencies:pe,taxDefaultValue:xe,uomDefaultValue:ye,edit_url:Ve,update_url:Ie,store_url:$e,type:_,currentUser:V})=>{const[we,ve]=q.useState("form1"),{showToast:I}=nt();it().props;const{dataDropdown:se,getDropdown:ae}=te(jt);te();const{dataDropdown:Be,getDropdown:Me}=te(),{dataDropdown:re,getDropdown:ne}=te("api/master-pr/purchasing-group/dropdown-list"),{dataDropdown:ie,getDropdown:le}=te("api/master/cost-center/dropdown-list"),[M,he]=q.useState([]),[Pe,fe]=q.useState([]),[oe,Ye]=q.useState(null),[Ne,Ge]=q.useState(!1),[Oe,ce]=q.useState(!1),[v,Y]=q.useState([]),[Dt,G]=q.useState([]);q.useState([]);const ge=q.useRef([]),H=q.useRef([]),[W,ze]=q.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),He=1*1024*1024,We=["image/jpeg","image/png","image/svg+xml","application/pdf","image/heic","image/heif"],Ze=p.object({formCount:p.string().min(1,"total form must be have value"),remark_group:p.string().min(1,"header remark is required"),cost_center:p.string().min(1,"cost center required"),requester:p.string().min(1,"requester required"),value:p.number().optional(),user_id:p.string().optional(),forms:p.array(p.object({reimburseId:p.string().optional(),for:p.string().optional(),group:p.string().optional(),reimburse_type:p.string().min(1,"reimburse type is required"),short_text:p.string().min(1,"remarks is required"),balance:p.string(),remaining_balance_when_request:p.number(),currency:p.string().min(1,"currency required"),tax_on_sales:p.string().min(1,"tax required"),purchase_requisition_unit_of_measure:p.string().min(1,"uom required"),purchasing_group:p.string().min(1,"Purchasing Group required"),type:p.any(),item_delivery_data:p.date({required_error:"Receipt date is required"}),claim_date:p.date().min(new Date(new Date().setHours(0,0,0,0)),"Claim date must be today or greater"),attachment:p.array(p.instanceof(File).refine(t=>We.includes(t.type),{message:"File type must be JPG, JPEG, PNG, SVG, HEIC, or PDF"}).refine(t=>t.size<=He,{message:"File size must be less than 1MB"})),savedAttachment:p.array(p.any()).optional().nullable()}).refine(t=>{const s=_===x.clone,n=_===x.create,m=Array.isArray(t.savedAttachment)&&t.savedAttachment.length>0,l=Array.isArray(t.attachment)&&t.attachment.length>0;return!(n&&!l||s&&!m&&!l)},{message:"Attachment is required",path:["attachment"]}))});q.useEffect(()=>{(async()=>{var n,m;(_===x.edit||_===x.clone)&&(ce(!0),await Je()),Me("",{name:"mwszkz",id:"id",tabel:"pajaks",where:{key:"mwszkz",parameter:"V0"}});const s=Number(we.split("form")[1])-1;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:(n=r.getValues("forms")[s])!=null&&n.purchasing_group?"id":"",value:((m=r.getValues("forms")[s])==null?void 0:m.purchasing_group)??""}}),le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:r.getValues("cost_center")?"id":"",value:r.getValues("cost_center")??""}}),ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:r.getValues("requester")?"nip":"",value:r.getValues("requester")??""}}),r.getValues("requester")!==""&&_===x.create&&Z(0)})()},[_]);async function Je(){var t,s;r.setValue("forms",[]),ce(!0);try{const m=(await P.get(Ve??"")).data.data,l=m.forms??[],d=m.group;Ye(d.reimbursementStatus),G(l.map(o=>String(o.id)));const b=l.map((o,g)=>{const{id:j,for:h,group:R,reimburse_type:y,short_text:D,balance:$,currency:B,tax_on_sales:F,purchase_requisition_unit_of_measure:w,remaining_balance_when_request:C,purchasing_group:c,type:a,item_delivery_data:i,claim_date:u,reimburse_attachment:f}=o,N=l.slice(g).filter(L=>L.for===h&&L.reimburse_type.code===y.code);ge.current.push({id:String(j),reimburse_type:y.code,balance:N.reduce((L,me)=>L+Number(me.balance||0),0),limit:N.reduce(L=>L+1||0,0),for:String(h)});const O=H.current.findIndex(L=>L.reimburse_type===y.code&&L.for===String(h));return O!==-1?H.current[O].totalBalance=Number(H.current[O].totalBalance)+Number($||0):H.current.push({reimburse_type:y.code,totalBalance:Number($||0),for:String(h)}),{reimburseId:String(j),for:String(h),group:String(R),reimburse_type:y.code,short_text:D,balance:$,currency:B,tax_on_sales:String(F),purchase_requisition_unit_of_measure:String(w),remaining_balance_when_request:Number(C)||0,purchasing_group:String(c),type:a,item_delivery_data:new Date(i),claim_date:new Date(u),attachment:[],savedAttachment:f}});r.setValue("formCount",l.length.toString()),r.setValue("remark_group",d.remark),r.setValue("cost_center",String(d.cost_center.id)),r.setValue("requester",d.requester),r.setValue("forms",b);for(let o=0;o<l.length;o++){const g=l[o];await Z(o,{reimburse_type:g.reimburse_type.code}),await Se(o,{type:g.type,reimburse_type:g.reimburse_type.code}),await _e(o,{reimburse_type:g.reimburse_type.code,for:g.reimburse_type.is_employee===1?null:g.for},!0)}ce(!1)}catch(n){const m=n;ce(!1),I((s=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:s.message,"error")}}const Ke={formCount:"1",remark_group:"",cost_center:"",requester:String(V==null?void 0:V.is_admin)==="1"?"":V==null?void 0:V.nip,forms:[{reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:xe,purchase_requisition_unit_of_measure:ye,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]}]},r=dt({resolver:ot(Ze),defaultValues:Ke}),{fields:be,update:S}=pt({control:r.control,name:"forms"}),Z=async(t,s=null)=>{const n=r.getValues("requester");if(n===null||n===""){he(l=>{const d=[...l];return d[t]=[],d});return}const m=await P.get(ke,{params:{user:n,hasValue:s!=null?s.reimburse_type:null},headers:{"Content-Type":"application/json"}});he(l=>{const d=[...l];return d[t]=m.data.data,d})},Xe=async(t,s)=>{if(t&&t.length>0)try{const n=await P.get(ke,{params:{search:t,user:r.getValues("requester")}});he(m=>{const l=[...m];return l[s]=n.data.data,l})}catch(n){console.error("Error searching reimburse types:",n)}},Se=async(t,s)=>{const n=await P.get(xt,{params:{user:r.getValues("requester"),familyRelationship:s.type=="Family"?"0":"1",reimburseType:s.reimburse_type},headers:{"Content-Type":"application/json"}});fe(m=>{const l=[...m];return l[t]=n.data.data,l})},Qe=t=>{for(let s=0;s<be.length;s++)Z(s);if(t==null)for(let s=0;s<be.length;s++)r.setValue(`forms.${s}.reimburse_type`,""),r.setValue(`forms.${s}.for`,"");Y([]),fe([])},De=(t,s)=>{const n=r.getValues("forms");n.forEach((m,l)=>{var d,b;if(l>t&&n[l].reimburse_type===s.reimburse_type){const o=((d=v[l])==null?void 0:d.balance)||0,g=((b=v[l])==null?void 0:b.limit)||0;Y(j=>{var R;const h=[...j];return h[l]={...h[l],balance:o+Number(s.balance||"0")},((R=v[l])==null?void 0:R.type_limit)!=="Unlimited"&&(h[l]={...h[l],limit:g+1}),h}),r.setValue(`forms.${l}.balance`,"")}})};function Ue(t){const s=[...r.getValues("forms")];for(let n=0;n<Number(t);n++)if(n+1>s.length){Z(n);const m={reimburseId:"",for:"",group:"",reimburse_type:"",short_text:"",balance:"",remaining_balance_when_request:0,currency:"IDR",tax_on_sales:xe,purchase_requisition_unit_of_measure:ye,purchasing_group:"",type:"",item_delivery_data:new Date,claim_date:new Date,attachment:[]};s.push(m)}r.setValue("forms",s)}const et=t=>{ve(t)},tt=async t=>{var n,m,l,d,b;if(v)for(let o=0;o<v.length;o++){if(t.forms.length==0||t.forms.length-1,((n=v[o])==null?void 0:n.type_limit)!=="Unlimited"&&Number((m=v[o])==null?void 0:m.limit)==0){I("Claim Limit for form "+(o+1)+" is Empty, Please Contact the Admin","error");return}if(t.forms[o].balance==""||Number(t.forms[o].balance)==0){I("Claim Balance for form "+(o+1)+" cannot be 0","error");return}if(Number(((l=v[o])==null?void 0:l.balance)??0)<Number(t.forms[o].balance??0)){I("Please check your balance input for forms "+(o+1)+"  is not must be above "+((d=v[o])==null?void 0:d.balance),"error");return}t.forms=t.forms.map((g,j)=>{var h;return{...g,claim_date:qe(g.claim_date).format("YYYY-MM-DD"),item_delivery_data:qe(g.item_delivery_data).format("YYYY-MM-DD"),remaining_balance_when_request:Number(((h=v[j])==null?void 0:h.balance)??0)}})}const s=t.forms.reduce((o,g)=>o+Number(g.balance)||0,0);t.value=s,t.user_id=(t==null?void 0:t.requester)||"0";try{let o;_===x.edit||_===x.clone?o=await P.post(Ie??"",t,{headers:{"Content-Type":"multipart/form-data"}}):o=await P.post($e??"",t,{headers:{"Content-Type":"multipart/form-data"}}),I((b=o==null?void 0:o.data)==null?void 0:b.data,"success"),z==null||z()}catch{}};async function _e(t,s=null,n=!1){var b,o,g;const m=r.getValues(`forms.${t}`);let l=!m.for||m.for===""?r.getValues("requester")||"":m.for;const d={user:r.getValues("requester"),reimbuse_type:s!=null?s.reimburse_type:m.reimburse_type,for:s!=null?s.for:l};try{const j=await P.get("reimburse/data-limit-and-balance",{params:d}),h=r.getValues("forms");let R=0,y=0,D=j.data.data.balance,$=j.data.data.limit,B=(a=!1)=>h.filter((i,u)=>{let f=!i.for||i.for===""?r.getValues("requester")||"":i.for;return i.reimburse_type===m.reimburse_type&&f===l&&(_===x.clone&&n&&!a?!0:u!==t)}),F=B(!0).length,w=B().reduce((a,i)=>a+Number(i.balance||0),0);if(_===x.clone){let a=((b=H.current.find(i=>i.reimburse_type===m.reimburse_type&&i.for===l))==null?void 0:b.totalBalance)??0;if(D+=a,n){let i=ge.current.find(u=>m.reimburseId==u.id);i&&(R=Number(i.balance),y=F+Number(i.limit),G(u=>{const f=[...u];return f[t]=i.id,f}))}else{let i=ge.current.find(u=>u.reimburse_type===m.reimburse_type&&u.for===l);i!==void 0&&(y=Number(i.limit),G(u=>{const f=[...u];return f[t]=i.id,f}))}}let C=D-w+R,c=Math.max(0,$-F+y);Y(a=>{const i=[...a];return i[t]={...j.data.data,balance:C,limit:j.data.data.type_limit==="Unlimited"?j.data.data.type_limit:c},i})}catch(j){const h=j;I((g=(o=h==null?void 0:h.response)==null?void 0:o.data)==null?void 0:g.message,"error")}}const Fe=async()=>{var t,s,n,m,l,d,b,o,g,j,h,R;try{const y=r.getValues("forms"),D=y.map((w,C)=>({index:C,value:w.balance?Number(w.balance):0}));if(D.some(w=>w.value===0)){const w=D.findIndex(C=>C.value===0);I(`Please fill balance form ${w+1}`,"error");return}const B=y.reduce((w,C)=>w+(Number(C.balance)||0),0),F=await P.get("/check-approval",{params:{value:B,requester:r.getValues("requester"),type:"REIM"}});if(F.data.status_code===200){const w=(s=(t=F.data)==null?void 0:t.data)==null?void 0:s.approval.map(u=>(u==null?void 0:u.division_name)||null),C=(m=(n=F.data)==null?void 0:n.data)==null?void 0:m.approval.map(u=>(u==null?void 0:u.name)||null),c=[];(d=(l=F.data)==null?void 0:l.data)!=null&&d.hr&&c.push((g=(o=(b=F.data)==null?void 0:b.data)==null?void 0:o.hr)==null?void 0:g.name);const a=(((j=F.data.data)==null?void 0:j.approval)??[]).map(u=>({status:"",name:u.name,dateApproved:""}));ze({approvalRequest:w,approvalFrom:C,acknowledgeFrom:c,approvalFromStatusRoute:a}),Ge(!0)}}catch(y){const D=y;I((R=(h=D==null?void 0:D.response)==null?void 0:h.data)==null?void 0:R.message,"error")}};q.useEffect(()=>{r.getValues("forms").reduce((n,m)=>n+Number(m.balance)||0,0)>0&&Ne===!0&&Fe()},[r.watch("forms"),r.watch("requester")]);const st=t=>{const s=t;if(Object.keys(s).length>0){let n=`
        <h3 style="color: rgb(211, 47, 47);font-weight: bolder">Error</h3>
        <ul style="list-style-type: disc;margin-left: 1rem">
      `;Object.entries(s).forEach(([m,l])=>{m==="forms"?l.forEach((d,b)=>{n+=`</br><strong>Form ${b+1}:</strong></br>`,Object.values(d).forEach(o=>{n+=`<li>${o.message}</li>`})}):n+=`<li>${l.message}</li>`}),n+="</ul>",I(e.jsx("div",{dangerouslySetInnerHTML:{__html:n}}),"error")}};return e.jsx(ht,{className:"h-[600px] w-full",children:e.jsx(St,{isLoading:Oe,children:e.jsx(ct,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(tt,t=>{st(t)}),children:[e.jsx("table",{className:"mt-4 w-full text-xs font-thin reimburse-form-table",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Request Status"}),e.jsx("td",{children:oe&&e.jsx(vt,{name:oe.name,className:oe.classname,code:oe.code})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Header",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:"remark_group",render:({field:t})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Te,{placeholder:"Insert remark",...t})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{fieldLabel:"",options:ie,fieldName:"cost_center",disabled:_===x.edit,placeholder:"Cost Center",classNames:"mt-2 w-full",onSearch:async t=>{const s=ie==null?void 0:ie.some(n=>n.label===t);t.length>0&&!s?await le(t,{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",search:t}):t.length==0&&!s&&le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string"})},onFocus:()=>{const t=r.getValues("cost_center");le("",{name:"cost_center",id:"id",tabel:"master_cost_centers",idType:"string",hasValue:{key:t?"id":"",value:t??""}})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Employee",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(de,{options:se,fieldName:"requester",disabled:String(V==null?void 0:V.is_admin)==="0"||_===x.edit,placeholder:"Select Employee",onSearch:(t,s)=>{const n=se==null?void 0:se.some(m=>m.label===t);t.length>0&&!n?ae(t,{name:"name",id:"nip",tabel:"users",search:t}):t.length==0&&!n&&ae("",{name:"name",id:"nip",tabel:"users"})},onChangeOutside:t=>Qe(t),onFocus:()=>{const t=r.getValues("requester");ae("",{name:"name",id:"nip",tabel:"users",hasValue:{key:t?"nip":"",value:t??""}})},classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Number of Forms"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:"formCount",render:({field:t})=>{var s;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(K,{disabled:_===x.edit,onValueChange:n=>{t.onChange(n),Ue(n);const m=r.getValues("forms");let l=Number(n);if(m.length>l){const d=m.slice(0,l);r.setValue("forms",d),Y(b=>{let o=[...b];return o=o.slice(0,l),o}),ve(`form${Math.max(1,l)}`),G(b=>{const o=[...b];return o[l]="",o})}},value:(s=t.value)==null?void 0:s.toString(),children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"Select number of forms"})}),e.jsx(U,{children:Array.from({length:3},(n,m)=>m+1).map(n=>e.jsx(ee,{value:n.toString(),children:n},n))})]})}),e.jsx(k,{})]})}})})]})]})}),e.jsx(Ae,{className:"my-4"}),e.jsxs(ft,{value:we,onValueChange:et,className:"w-full",children:[e.jsxs(gt,{className:"flex justify-start items-center space-x-4",children:[" ",Array.from({length:Number(r.watch("formCount"))||1}).map((t,s)=>e.jsxs(bt,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),be.map((t,s)=>{var n,m,l,d,b,o,g,j,h,R,y,D,$,B,F,w,C;return e.jsxs(_t,{value:`form${s+1}`,children:[e.jsx(T,{control:r.control,name:`forms.${s}.reimburseId`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Re,{className:"sr-only",value:t.reimburseId,onChange:c.onChange})}),e.jsx(k,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Type of Reimbursement",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{options:M[s],fieldName:`forms.${s}.reimburse_type`,disabled:M[s]===void 0||M[s].length===0||_===x.edit,placeholder:"Select Reimburse Type",onSearch:async c=>{var i;((i=M[s])==null?void 0:i.some(u=>u.label===c))||await Xe(c,s)},onChangeOutside:async c=>{if(c){const a=M[s].filter(u=>u.value==c)[0];S(s,{...t,reimburse_type:c,type:a.is_employee===1?"Employee":"Family",balance:""}),a.is_employee===1?_e(s,{reimburse_type:c,for:null}):(Y(u=>{const f=[...u];return f[s]=[],f}),r.setValue(`forms.${s}.balance`,""),r.setValue(`forms.${s}.for`,""),Se(s,{type:"Family",reimburse_type:c}));const i=r.getValues(`forms.${s}.reimburse_type`);c!==i&&(G(u=>{const f=[...u];return f[s]="",f}),De(s,t))}else Y(a=>{const i=[...a];return i[s]=[],i}),S(s,{...t,reimburse_type:"",type:"",balance:""}),G(a=>{const i=[...a];return i[s]="",i}),r.setValue(`forms.${s}.for`,""),fe(a=>{const i=[...a];return i[s]=[],i}),De(s,t)},onFocus:()=>{Z(s)},classNames:"mt-2 w-full"}),((l=(m=(n=r.formState.errors)==null?void 0:n.forms)==null?void 0:m[s])==null?void 0:l.reimburse_type)&&e.jsx(Le,{error:!0,children:(g=(o=(b=(d=r.formState.errors)==null?void 0:d.forms)==null?void 0:b[s])==null?void 0:o.reimburse_type)==null?void 0:g.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Family"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.for`,render:({field:c})=>{var a,i,u,f;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(K,{disabled:((u=(i=(a=M==null?void 0:M[s])==null?void 0:a.filter(N=>(N==null?void 0:N.value)==r.getValues(`forms.${s}.reimburse_type`)))==null?void 0:i[0])==null?void 0:u.is_employee)===1||_===x.edit,onValueChange:N=>{S(s,{...t,for:N}),_e(s,{reimburse_type:r.getValues(`forms.${s}.reimburse_type`),for:N})},defaultValue:t==null?void 0:t.for,value:t.for,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(f=Pe[s])==null?void 0:f.map(N=>e.jsx(ee,{value:N.value.toString(),children:N.label},N.value))})]})}),e.jsx(k,{})]})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(de,{fieldLabel:"",options:re,fieldName:`forms.${s}.purchasing_group`,disabled:_===x.edit,placeholder:"Puchasing Group",classNames:"mt-2 w-full",onSearch:async c=>{const a=re==null?void 0:re.some(i=>i.label===c);return c.length>0&&!a?await ne(c,{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",search:c}):c.length==0&&!a&&await ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string"}),[]},onChangeOutside:c=>{c&&S(s,{...t,purchasing_group:c})},onFocus:()=>{var a;const c=(a=r.getValues("forms")[s])==null?void 0:a.purchasing_group;ne("",{name:"purchasing_group_desc",id:"id",tabel:"purchasing_groups",idType:"string",hasValue:{key:c?"id":"",value:c??""}})}}),((R=(h=(j=r.formState.errors)==null?void 0:j.forms)==null?void 0:h[s])==null?void 0:R.purchasing_group)&&e.jsx(Le,{error:!0,children:(B=($=(D=(y=r.formState.errors)==null?void 0:y.forms)==null?void 0:D[s])==null?void 0:$.purchasing_group)==null?void 0:B.message})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Tax"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.tax_on_sales`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(K,{disabled:!0,onValueChange:a=>{S(s,{...t,tax_on_sales:a})},defaultValue:t.tax_on_sales,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:(Be??[]).map((a,i)=>e.jsxs(ee,{value:a.value.toString(),children:[a.description," - ",a.label]},a.value))})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Uom"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.purchase_requisition_unit_of_measure`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(K,{disabled:!0,onValueChange:a=>{S(s,{...t,purchase_requisition_unit_of_measure:String(a)})},defaultValue:t.purchase_requisition_unit_of_measure,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:e.jsx(ee,{value:"2",children:"Piece - PC"},"2")})]})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["Remark Item",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.short_text`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Te,{placeholder:"Insert remark",onChange:a=>{S(s,{...t,short_text:a.target.value})},defaultValue:t.short_text})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Current Balance"}),e.jsx("td",{children:e.jsx("span",{className:"font-bold",children:((F=v[s])==null?void 0:F.balance)&&J((w=v[s])==null?void 0:w.balance)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Limit Claim"}),e.jsxs("td",{children:[e.jsx("span",{className:"font-bold",children:(C=v[s])==null?void 0:C.limit})," "]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Receipt Date"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.item_delivery_data`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Ee,{disabled:_===x.edit,initialDate:c.value instanceof Date?c.value:new Date(c.value),onDateChange:a=>{c.onChange(a),S(s,{...t,item_delivery_data:a})}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Claim Date"}),e.jsx("td",{children:e.jsx(T,{control:r.control,name:`forms.${s}.claim_date`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Ee,{disabled:_===x.edit,initialDate:c.value instanceof Date?c.value:new Date(c.value),disabledDays:[{before:new Date}],onDateChange:a=>{c.onChange(a),S(s,{...t,claim_date:a})}})}),e.jsx(k,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-1/4",children:"Reimburse Cost"}),e.jsxs("td",{className:"grid grid-cols-7 gap-x-4 w-full",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(T,{control:r.control,name:`forms.${s}.currency`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(E,{children:e.jsxs(K,{disabled:_===x.edit,onValueChange:a=>{S(s,{...t,currency:a})},defaultValue:t.currency,children:[e.jsx(X,{className:"w-[200px]",children:e.jsx(Q,{placeholder:"-"})}),e.jsx(U,{children:pe.map(a=>e.jsxs(ee,{value:a.code,children:[a.name," (",a.code,")"]},a.code))})]})}),e.jsx(mt,{className:"h-6"}),e.jsx(k,{})]})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(T,{control:r.control,name:`forms.${s}.balance`,render:({field:c})=>{var a;return e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(Re,{type:"text",placeholder:"0",onChange:i=>{var me;const u=i.target.value.replace(/[^0-9]/g,""),f=J(u,!1),N=Number(u)||0,O=((me=v[s])==null?void 0:me.balance)||0;if(N>O){i.target.value=J(u.slice(0,-1),!1);return}S(s,{...t,balance:u}),i.target.value=f,r.getValues("forms").forEach((Ce,ue)=>{if(ue>s&&Ce.reimburse_type===t.reimburse_type){const at=O-N;Y(rt=>{const je=[...rt];return je[ue]={...je[ue],balance:at},je}),S(ue,{...Ce,balance:""})}})},defaultValue:J(t.balance,!1),value:J(t.balance,!1),disabled:typeof v[s]>"u"||((a=v[s])==null?void 0:a.length)===0||_===x.edit})}),e.jsx(k,{})]})}})})]})]}),e.jsxs("tr",{children:[e.jsxs("td",{className:"w-1/4",children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[e.jsx(T,{control:r.control,name:`forms.${s}.attachment`,render:({field:c})=>e.jsxs(A,{children:[e.jsx(ut,{className:"mb-1 text-xs font-extralight text-gray-500",children:"Max File: 1000KB, Extension : jpg,jpeg,png,pdf,heic"}),e.jsx(E,{children:e.jsx("input",{className:"flex px-3 py-1 w-full h-9 text-xs bg-transparent rounded-md border shadow-sm transition-colors border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:"image/*,.pdf,.heic",onChange:a=>{const i=a.target.files;if(i){const u=[...t.attachment],f=Array.from(i);u.push(...f),S(s,{...t,attachment:u})}}})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"pb-3 mt-2",children:[t.attachment&&t.attachment.length>0&&e.jsx("ul",{children:t.attachment.map((c,a)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:c.name}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const i=t.attachment.filter((u,f)=>f!==a);S(s,{...t,attachment:i})},children:"Delete"})]},a))}),e.jsx("hr",{}),e.jsx("div",{className:"pb-3 mt-2",children:t.savedAttachment&&t.savedAttachment.length>0&&e.jsx("ul",{children:t.savedAttachment.map((c,a)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:c.url}),e.jsx("button",{type:"button",className:"ml-2 text-red-500",onClick:()=>{const i=t.savedAttachment.filter((u,f)=>f!==a);S(s,{...t,savedAttachment:i})},children:"Delete"})]},a))})})]})]})]})]})})})]},s)})]}),e.jsx(Nt,{onClick:async()=>await Fe(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Ne&&e.jsx(wt,{workflowApproval:{approvalRequest:W.approvalRequest,approvalFrom:W.approvalFrom,acknowledgeFrom:W.acknowledgeFrom},workflowApprovalStep:W.approvalFromStatusRoute,workflowApprovalDiagram:W.approvalFrom})}),e.jsx(Ae,{className:"my-4"}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(lt,{type:"submit",className:"w-32",children:"Submit"})})]})})})})};export{xs as ReimburseForm};
