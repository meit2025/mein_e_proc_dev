import{X as j,r as n,j as e}from"./app-CQ-RdD6K.js";import{D as E}from"./detailApproval-BzWe8iOV.js";import{F as M}from"./FormMapping-TjhI-G9I.js";import{F as k}from"./formTextArea-DfjQVLVe.js";import{L as q}from"./Loading-fsr20d-_.js";import{a as B}from"./axiosInstance-DBXdQYWT.js";import{h as D}from"./moment-C5S46NFB.js";import{u as I}from"./index.esm-CCpNitNU.js";import{B as u}from"./Button-DBQmFMAl.js";import{M as Y}from"./TextField-CvP7--Jg.js";import{B as N}from"./Box-BErno1kg.js";const O={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",pt:2,px:4,pb:3},Z=({id:d,children:b,type:p,status_id:r})=>{var h;const{props:P}=j(),{auth:t}=j().props,a=I({mode:"onChange",reValidateMode:"onChange"}),[y,m]=n.useState(!1),[C,f]=n.useState(!1),[V,v]=n.useState(!1),x=n.useCallback(async()=>{var i;m(!0);try{const l=(await B.get("/api/approval/route/getApproval?id="+d+"&type="+p)).data;a.reset(l.data.data);const w=(l.data??[]).map(o=>{var g;return((g=o.user.divisions)==null?void 0:g.name)||null}),A=(l.data??[]).map(o=>o.user.name),s=(l.data??[]).find(o=>o.is_status===!1);r!==4&&r!==2&&r!==6&&(s==null?void 0:s.user_id)===((i=t==null?void 0:t.user)==null?void 0:i.id)&&f(!0);const F=(l.data??[]).map(o=>({status:o.status,name:o.user.name,dateApproved:D(o.updated_at).format("YYYY-MM-DD"),note:o.message}));a.setValue("approvalFromStatusRoute",F),a.setValue("approvalRequest",w),a.setValue("approvalFrom",A),a.setValue("approvalId",s==null?void 0:s.id),a.setValue("function_name",p.toLowerCase()),a.setValue("type",p.toLowerCase()),a.setValue("id",d)}catch{m(!1)}finally{m(!1)}},[d,p,a,r,(h=t==null?void 0:t.user)==null?void 0:h.id]);n.useEffect(()=>{x()},[x,r]),n.useEffect(()=>{(r===4||r===6||r===2)&&f(!1)},[r]);const L=()=>{v(!1),a.setValue("note",""),a.setValue("id_approval",""),a.setValue("status","")},c=i=>{v(!0),a.setValue("status",i)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{isLoading:y}),e.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[C&&e.jsx("div",{className:"card-header",children:e.jsxs("div",{children:[e.jsx(u,{variant:"contained",onClick:()=>c("Approved"),color:"primary",type:"button",children:"APPROVE"}),e.jsx(u,{onClick:()=>c("Revise"),style:{marginLeft:"1rem"},variant:"contained",color:"warning",type:"button",children:"Revise"}),e.jsx(u,{onClick:()=>c("Rejected"),style:{marginLeft:"1rem"},variant:"contained",color:"error",type:"button",children:"REJECT"})]})}),b,e.jsx(E,{methods:a}),e.jsx(Y,{open:V,onClose:L,"aria-labelledby":"parent-modal-title","aria-describedby":"parent-modal-description",children:e.jsx(N,{sx:{...O,width:900},children:e.jsx(M,{isCustom:!0,formCustom:e.jsx(e.Fragment,{children:e.jsx(k,{fieldLabel:"note",fieldName:"note",isRequired:!0,requiredMessage:"",rows:20,style:{width:"100%"}})}),methods:a,url:"api/approval/approval_or_rejceted"})})})]})]})};export{Z as L};
