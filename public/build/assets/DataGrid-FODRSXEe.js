import{j as e,r,u as ke,q as be,a as S,b as X}from"./app-ln2fqx89.js";import{a as A}from"./axiosInstance-R41-rouA.js";import{D as Se,b as Ne,c as $e}from"./dialog-B_VhgsqL.js";import{B as O}from"./button-dz9CecE9.js";import{L as Me}from"./LoadingSpin-CfW3LbVl.js";import{D as Fe,a as De,b as Be,c as Ue,d as z,e as J}from"./dropdown-menu-DvvrVgN6.js";import{D as Ae}from"./index-hmkcH4D7.js";import{c as Z}from"./createLucideIcon-Dz91u1UG.js";import{B as U}from"./Box-Cj0gdrww.js";import{T as ze,a as K}from"./Tabs-BRqWkOtD.js";import{B as Q}from"./Button-BHxgiNy2.js";import{D as Oe,G as Te}from"./DataGrid-ulYqcTR2.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=Z("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Z("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Pe=({open:j,onOpenChange:T,onDelete:N,onClose:w,children:a,className:D,isLoading:c,title:x,description:l,labelConfirmButton:$="Delete"})=>e.jsx(Se,{open:j,onOpenChange:w,children:e.jsxs(Ne,{className:D||"md:max-w-[768px]",children:[l||"Are you sure delete this item?",e.jsxs($e,{children:[w?e.jsx(O,{variant:"outline",onClick:w,children:"Close"}):null,N?e.jsx(e.Fragment,{children:c?e.jsx(Me,{}):e.jsx(O,{type:"submit",onClick:N,children:$})}):null]})]})}),Y=j=>({id:`simple-tab-${j}`,"aria-controls":`simple-tabpanel-${j}`}),Ze=({columns:j,buttonCustome:T,onExport:N,onExportXls:w,url:a,labelFilter:D="Search",onEdit:c,onDelete:x,onDetail:l,onCreate:$,onClone:B,defaultSearch:I,actionType:ee,buttonActionCustome:L,deleteConfirmationText:se,titleConfirmationText:_e,isHistory:te=!1,isLoading:P=!1,role:s,tabelFooter:ae})=>{var H,V,W;const[ie,ne]=r.useState([]),[re,_]=r.useState(!1),[o,le]=r.useState({page:0,pageSize:10}),[y,oe]=r.useState([]),[v,ce]=r.useState({items:[]});r.useState(null);const[de,p]=r.useState(!1),[h,xe]=r.useState(0),[pe,he]=r.useState(0),[C,me]=r.useState(""),[R,fe]=r.useState(""),{showToast:k}=ke(),[u,b]=r.useState({isOpen:!1,labelConfirmButton:"Delete",message:"",onConfirm:async()=>{}}),{props:q}=be(),m=((H=q.auth)==null?void 0:H.permission)||[],M=r.useCallback(async(t,i,g,d,n,F)=>{_(!0);const ye=d.length>0?d[0].field:"id",ve=d.length>0?d[0].sort:"desc",Ce=n.items.map(f=>`${f.field}=${f.operator},${f.value}`).join("&");try{const f=`${I||"?"}page=${t+1}&per_page=${i}&search=${g}&sort_by=${ye}&sort_direction=${ve}&approval=${F}&${Ce}`;fe(f);const E=await A.get(`${a.url}${f}`);ne(E.data.data.data),he(E.data.data.total)}catch(f){console.error("Error fetching data:",f)}finally{_(!1)}},[a]);r.useEffect(()=>{M(o.page,o.pageSize,C,y,v,h)},[M,v,o,C,y]);const G=async t=>{var i,g,d;p(!0);try{const n=await A.delete(`${a.deleteUrl}/${t}`);k(((i=n==null?void 0:n.data)==null?void 0:i.message)||"Record deleted successfully","success"),p(!1),b({...u,isOpen:!1}),x&&await x(t),M(o.page,o.pageSize,C,y,v,0)}catch(n){if(p(!1),X.isAxiosError(n)){const F=((d=(g=n.response)==null?void 0:g.data)==null?void 0:d.message)||"Failed to delete record";k(F,"error")}else k("An unexpected error occurred","error");p(!1)}},ue=async t=>{var i,g,d;p(!0);try{const n=await A.post("api/approval/approval_or_rejceted",{id:t,type:a.cancelApproval,status:"Cancel",function_name:a.cancelApproval});k(((i=n==null?void 0:n.data)==null?void 0:i.message)||"cancel successfully","success"),p(!1),b({...u,isOpen:!1}),x&&await x(t),M(o.page,o.pageSize,C,y,v,0)}catch(n){if(p(!1),X.isAxiosError(n)){const F=((d=(g=n.response)==null?void 0:g.data)==null?void 0:d.message)||"Failed to cancel record";k(F,"error")}else k("An unexpected error occurred","error");p(!1)}},ge=c||x||l||a.detailUrl||a.editUrl||a.deleteUrl||L?[{field:"actions",headerName:"Actions",width:250,renderCell:t=>e.jsx(e.Fragment,{children:ee==="dropdown"?e.jsxs(Fe,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(O,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"..."}),e.jsx(Ae,{className:"h-4 w-4"})]})}),e.jsxs(Be,{align:"end",children:[e.jsx(Ue,{children:"Actions"}),(c||a.editUrl)&&h===0&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.update)??""))&&e.jsx(z,{onClick:()=>c&&c(t.row.id),children:e.jsxs("span",{className:"flex items-center text-sm space-x-2",children:[e.jsx("span",{children:"Edit"}),e.jsx(Ie,{size:14})]})})}),e.jsx(J,{}),(a.deleteUrl||x)&&h===0&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.delete)??""))&&e.jsx(z,{className:"bg-red-400 text-white hover:!bg-red-500 hover:!text-white transition-all duration-300",onClick:()=>b({isOpen:!0,labelConfirmButton:"Delete",message:se??"Are you sure you want to delete this record?",onConfirm:async()=>{G(t.row.id)}}),children:e.jsxs("span",{className:"flex items-center  text-sm space-x-2",children:[e.jsx("span",{children:"Delete"}),e.jsx(Le,{size:14})]})})}),e.jsx(J,{}),(l||a.detailUrl)&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.detail)??""))&&e.jsx(z,{onClick:()=>{l&&l(t.row.id),a.detailUrl&&(window.location.href=`${a.detailUrl}/${t.row.id}`)},children:"View details"})})]})]}):e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[(l||a.detailUrl)&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.detail)??""))&&e.jsx(S,{href:a.detailUrl===""?"#":`${a.detailUrl}/${t.row.id}`,onClick:i=>{l&&(i.preventDefault(),l&&l(t.row.id))},alt:"detail",children:e.jsx("i",{className:" ki-duotone ki-size text-info text-2xl"})})}),(B||a.clone)&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.create)??""))&&h===0&&e.jsx(S,{href:a.clone===""?"#":`${a.clone}/${t.row.id}`,onClick:i=>{B&&(i.preventDefault(),B&&B(t.row.id))},alt:"detail",children:e.jsx("i",{className:" ki-filled ki-copy text-warning text-2xl"})})}),(c||a.editUrl)&&h===0&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.update)??""))&&e.jsx(S,{href:a.editUrl===""?"#":`${a.editUrl}/${t.row.id}`,onClick:i=>{c&&(i.preventDefault(),c&&c(t.row.id))},alt:"edit",children:e.jsx("i",{className:" ki-duotone ki-notepad-edit text-success text-2xl"})})}),(a.deleteUrl||x)&&h===0&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.delete)??""))&&e.jsx(S,{href:"",onClick:i=>{i.preventDefault(),b({isOpen:!0,labelConfirmButton:"Delete",message:"Are you sure you want to delete this record?",onConfirm:async()=>{G(t.row.id)}})},alt:"delete",children:e.jsx("i",{className:" ki-duotone ki-trash-square text-danger text-2xl"})})}),a.cancelApproval&&t.row.status_id===1&&h===0?e.jsx(e.Fragment,{children:e.jsx(S,{href:"",onClick:i=>{i.preventDefault(),b({isOpen:!0,labelConfirmButton:"Cancel Approval",message:"Are you sure want to cancel this request?",onConfirm:async()=>{ue(t.row.id)}})},alt:"delete",children:e.jsx("i",{className:"ki-filled ki-cross-square text-danger text-2xl"})})}):e.jsx(e.Fragment,{}),L]})})}]:[],je=(t,i)=>{xe(i),M(o.page,o.pageSize,C,y,v,i)},we=t=>e.jsxs(e.Fragment,{children:[ae,e.jsx(Te,{...t})]});return e.jsx(U,{children:e.jsx(U,{sx:{height:"45rem",width:"100%",overflowX:"auto"},children:e.jsxs(U,{sx:{width:"100%"},children:[te&&((W=(V=q.auth)==null?void 0:V.user)==null?void 0:W.is_approval)&&e.jsx(U,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ze,{value:h,onChange:je,"aria-label":"dynamic tabs example",children:[e.jsx(K,{label:"List",...Y(0)},0),e.jsx(K,{label:"Approval",...Y(0)},1)]})}),e.jsx("div",{className:"lg:col-span-2 mt-2",children:e.jsx("div",{className:"grid",children:e.jsxs("div",{className:"card card-grid h-full min-w-full",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{className:"card-title",children:e.jsxs("div",{className:"input input-sm max-w-48",children:[e.jsx("i",{className:"ki-filled ki-magnifier"}),e.jsx("input",{placeholder:D,type:"text",value:C,onChange:t=>me(t.target.value),style:{width:"100%",maxWidth:"200px",marginBottom:"10p"}})]})}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"center",gap:"10px"},children:[($||a.addUrl)&&e.jsx(e.Fragment,{children:(!s||m.includes((s==null?void 0:s.create)??""))&&e.jsxs(S,{href:a.addUrl??"#",className:"btn btn-success",onClick:t=>{$&&(t.preventDefault(),$())},style:{marginRight:"10px",marginBottom:"10px"},children:[e.jsx("i",{className:"ki-filled ki-additem"}),"Add New"]})}),N&&e.jsx(Q,{className:"btn",variant:"contained",onClick:()=>N(R),color:"primary",startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:"Export TXT"}),w&&e.jsx(Q,{className:"btn",variant:"contained",onClick:()=>w(R),color:"primary",disabled:P,startIcon:e.jsx("i",{className:"ki-filled ki-folder-down"}),style:{marginBottom:"10px"},children:P?"Downloading...":"Export to Excel"}),T]})]}),e.jsxs("div",{className:"card-body",children:[e.jsx(Pe,{isLoading:de,description:u.message,open:u.isOpen,labelConfirmButton:u.labelConfirmButton,onClose:()=>{b({...u,isOpen:!1})},onDelete:async()=>u.onConfirm()}),e.jsx("div",{"data-datatable":"true","data-datatable-page-size":o.pageSize,children:e.jsx("div",{className:"scrollable-x-auto",children:e.jsx(Oe,{rows:ie,columns:[...j,...ge],loading:re,paginationMode:"server",rowCount:pe,paginationModel:o,onPaginationModelChange:le,pageSizeOptions:[10,20],sortingMode:"server",sortModel:y,onSortModelChange:t=>oe(t),filterMode:"server",filterModel:v,onFilterModelChange:t=>ce(t),slots:{footer:we}})})})]})]})})})]})})})};export{Pe as C,Ze as D};
