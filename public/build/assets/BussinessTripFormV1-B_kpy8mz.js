import{r as d,u as Qe,j as e,b as et}from"./app-C4u3Ury9.js";import{d as tt,F as S,a as T,b as D,c as E,e as at}from"./form-AlGFVZbj.js";import{z as s,t as st}from"./index-DLYhRHv8.js";import{d as ie}from"./index-ChILX1B-.js";import{B as rt}from"./button-CZp1Fhv0.js";import{T as nt}from"./textarea-DPcozGKR.js";import{u as ot,b as de,c as it}from"./index.esm-Cvp8ltxj.js";import{S as lt}from"./scroll-area-C9T3Ksr0.js";import{S as le}from"./separator-BAKYY0Ae.js";/* empty css              */import{a as C}from"./axiosInstance-CfLqZfQO.js";import{W as ct}from"./WorkflowComponent-BWHEgEyt.js";import{F as dt}from"./formSwitchCustom-7xp6cSVL.js";import{I as J}from"./input-EEpuLji8.js";import{S as pt,a as ut,b as mt,c as _t,d as ht}from"./select-DdblA8pg.js";import{a as ft,C as gt,b as xt,c as jt,d as bt}from"./api-C1Ya95ai.js";import{G as ce,a as wt}from"./api-BG2DVmVj.js";import{h as R}from"./moment-C5S46NFB.js";import{BusinessTripType as w}from"./models-ByF1-OGQ.js";import{u as y}from"./getDropdown-1-RDjiEJ.js";import{F as z}from"./formDropdown-DSd5Z2HD.js";import{f as yt}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{BussinesTripDestination as St}from"./BussinesTripDestination-BB4tH5tP.js";import{B as Tt}from"./Button-5eKBCfHV.js";import"./app-DQK4SJPx.js";import"./index-CCAsgjoT.js";import"./utils-Cii1IJo8.js";import"./index--wKzXHLl.js";import"./index-C4wK9VnJ.js";import"./index-Bb4qSo10.js";import"./createLucideIcon-rKB89Gyb.js";import"./index-Bao6NFfz.js";import"./index-hQxwtsSL.js";import"./index-BnN3m8Xy.js";import"./index-BdQq_4o_.js";import"./createSvgIcon-CCSeQ3Tj.js";import"./DefaultPropsProvider-CD5Qhxxm.js";import"./Switch-D49HDHFd.js";import"./createSimplePaletteValueFilter-Ctd3iPQm.js";import"./SwitchBase-B6ntGBqD.js";import"./FormHelperText-CoyF3cIz.js";import"./useControlled-3neFbyaU.js";import"./index-D3MVRmBT.js";import"./index-DAmaQ-oB.js";import"./Combination-pVLlb2u1.js";import"./index-CL8PvEFL.js";import"./index-DZltq38T.js";import"./CustomStatus-BEjDlinY.js";import"./TextField-CIyqLsON.js";import"./useSlot-CliWPknx.js";import"./tabs-BQ82Nyd5.js";import"./index-DmLOpN91.js";import"./BussinessDestinationForm-Ctvbm5t2.js";import"./CustomDatePicker-Csb_O7cr.js";import"./DetailAttedances-BkkE28qv.js";import"./DetailAllowance-EIwSlRyi.js";import"./chevrons-up-down-DR8coVFD.js";import"./ResultTotalItem-CsldC7Rc.js";import"./checkbox-DWbbnIy5.js";s.object({remark:s.string().min(1).max(50),reimburse_cost:s.number()});const Dt=1*1024*1024,vt=["heic","image/jpeg","image/jpg","image/png","image/heic","image/heif","application/pdf"],qa=({users:V,listPurposeType:pe,pajak:Y,costcenter:B,purchasingGroup:M,type:g,id:x,isAdmin:_,idUser:h})=>{const ue=s.object({purpose_type_id:s.string().min(1,"Purpose type required"),request_for:s.string().min(1,"Request is required"),cost_center_id:s.string().min(1,"Cost Center is required"),remark:s.string().min(1,"Remark is required"),attachment:s.array(s.instanceof(File).refine(t=>vt.includes(t.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(t=>t.size<=Dt,{message:"File size must be less than 1MB"})).min(1,"Attachment is required"),total_destination:s.number().min(1,"Total Destinantion Required"),cash_advance:s.boolean().nullable().optional(),total_percent:s.number().nullable().optional(),total_cash_advance:s.string().nullable().optional(),destinations:s.array(s.object({destination:s.string().min(1,"Destinantion is Required"),restricted_area:s.boolean().nullable().optional(),pajak_id:s.string().min(1,"Pajak is required"),purchasing_group_id:s.string().min(1,"Purchasing Group is required"),business_trip_start_date:s.date().optional(),business_trip_end_date:s.date().optional(),detail_attedances:s.array(s.object({date:s.date().optional(),shift_code:s.string().optional(),shift_start:s.string().optional(),shift_end:s.string().optional(),start_time:s.string().optional(),end_time:s.string().optional(),start_date:s.date().optional(),end_date:s.date().optional()})),allowances:s.array(s.object({name:s.string().optional(),code:s.string().optional(),default_price:s.number().optional(),type:s.string().optional(),subtotal:s.number().optional(),currency:s.string().optional(),detail:s.array(s.object({date:s.date().nullish(),request_price:s.any().optional()}))})).min(1,"Allowances tidak boleh kosong")}))}).superRefine(({cash_advance:t,total_percent:r},a)=>{if(t===!0)if(!r||r.toString().trim()==="")a.addIssue({code:s.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent is required"});else{const i=Number(r);(isNaN(i)||i<1||i>100)&&a.addIssue({code:s.ZodIssueCode.custom,path:["total_percent"],message:"Total Percent must be a number between 1 and 100"})}}),[v,W]=d.useState("1"),o=ot({resolver:st(ue),defaultValues:{purpose_type_id:"",request_for:"",cost_center_id:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,total_percent:0,total_cash_advance:"0",destinations:[{detail_attedances:[],allowances:[],destination:"",restricted_area:!1,pajak_id:"V0",purchasing_group_id:"",business_trip_start_date:new Date,business_trip_end_date:new Date}]}}),[$,Z]=d.useState([]),[me,_e]=d.useState(null),[H,K]=d.useState([]);async function he(){const t=bt(x);o.setValue("destinations",[]);try{const a=(await et.get(t)).data.data,i=ce(a.purpose_type_id,a.request_for.id),n=await C.get(i);K(n.data.data),U("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.purpose_type.type}}),_e(a.request_no),Z(a.attachments),o.setValue("purpose_type_id",a.purpose_type_id.toString()),o.setValue("request_for",a.request_for.id.toString()),o.setValue("cost_center_id",a.cost_center.cost_center.toString()),o.setValue("remark",a.remarks),o.setValue("total_destination",a.total_destination),o.setValue("cash_advance",a.cash_advance==1),o.setValue("total_percent",a.total_percent),o.setValue("total_cash_advance",a.total_cash_advance),o.setValue("destinations",a.destinations.map(l=>({destination:l.destination,restricted_area:l.restricted_area==1,pajak_id:l.pajak.mwszkz,purchasing_group_id:l.purchasing_group.purchasing_group,business_trip_start_date:new Date(l.business_trip_start_date),business_trip_end_date:new Date(l.business_trip_end_date),detail_attedances:l.detail_attedances.map(c=>({...c,date:new Date(c.date),start_date:new Date(c.start_date),end_date:new Date(c.end_date)})),allowances:l.allowances.map(c=>({...c,default_price:parseInt(c.default_price),subtotal:parseInt(c.subtotal),detail:c.detail.map(p=>({...p,date:(p==null?void 0:p.date)!=null?new Date(p.date):null}))}))})))}catch{}}const{dataDropdown:fe,getDropdown:U}=y(),[G,ge]=d.useState(_==="0"?h==null?void 0:h.toString():""),[xe,je]=d.useState([]);async function be(){const t=_=="0"?h||0:G||0,r=jt(t),a=await C.get(r);je(a.data.data)}async function we(t){o.setValue("purpose_type_id",t||"");const r=_=="0"?h||"":G||"",a=ce(t,r),i=wt(t);try{const n=await C.get(a),l=await C.get(i);K(n.data.data),U("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:l.data.data.purpose.type}})}catch(n){console.log(n)}}const[ye,L]=d.useState([]),Se=t=>{o.setValue("total_destination",parseInt(t,10)),W(t),ee(),L([])},[Te,O]=d.useState("destination1");d.useEffect(()=>{parseInt(v,10)<1?W("1"):O(`destination${v}`)},[v]);const{showToast:N}=Qe(),[De,Q]=d.useState(!1),ve=async t=>{var i;if(!await o.trigger()){const n=o.formState.errors;for(let l=0;l<te.length;l++)if((i=n==null?void 0:n.destinations)!=null&&i[l]){O(`destination${l+1}`);break}return}const a=ae();if(a===0){N("Please add at least one destination","error");return}try{Q(!0);const n=new FormData;n.append("user_id",t.request_for??""),n.append("value",a.toString()),n.append("purpose_type_id",t.purpose_type_id??""),n.append("request_for",t.request_for??""),n.append("cost_center_id",t.cost_center_id??""),n.append("remark",t.remark??""),n.append("cash_advance",`${t.cash_advance}`),n.append("total_percent",`${t.total_percent}`),n.append("total_cash_advance",`${t.total_cash_advance}`),t.attachment.forEach((l,c)=>{l&&n.append(`attachment[${c}]`,l)}),n.append("total_destination",`${t.total_destination}`),t.destinations.forEach((l,c)=>{const p={...l,business_trip_start_date:R(l.business_trip_start_date).format("YYYY-MM-DD"),business_trip_end_date:R(l.business_trip_end_date).format("YYYY-MM-DD"),detail_attedances:l.detail_attedances.map(u=>({...u,date:R(u.date).format("YYYY-MM-DD")})),allowances:l.allowances.map(u=>({...u,detail:u.detail.map(m=>({...m,date:(m==null?void 0:m.date)!=null?R(m.date).format("YYYY-MM-DD"):null}))}))};n.append(`destinations[${c}]`,JSON.stringify(p))}),g==w.create?(await ie.Inertia.post(gt,n,{headers:{"Content-Type":"multipart/form-data"}}),N("succesfully created data","success")):($.forEach((l,c)=>{l&&n.append(`file_existing[${c}]`,JSON.stringify(l))}),await ie.Inertia.post(`${xt}/${x}`,n,{headers:{"Content-Type":"multipart/form-data"}}),N("succesfully updated data","success")),setTimeout(()=>{Q(!1)},1e3)}catch(n){console.log(n)}};function ee(){const t=[],r=parseInt(v);for(let a=0;a<r;a++)t.push({destination:"",business_trip_start_date:"",business_trip_end_date:"",pajak_id:"V0",purchasing_group_id:"",restricted_area:!1,allowances:[],detail_attedances:[]});o.setValue("destinations",t)}const{fields:te,append:Nt,remove:Ft,update:Ne}=de({control:o.control,name:"destinations"}),[Fe,Ce]=d.useState(!1);d.useEffect(()=>{g==w.create&&ee(),be()},[v,H,_,h,G]);const[Ee,Pe]=d.useState(!1),[F,Ie]=d.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),ke=(t,r)=>{var a;return t.type==="total"?parseFloat(((a=r==null?void 0:r[0])==null?void 0:a.request_price)||0):r==null?void 0:r.reduce((i,n)=>i+parseFloat(n.request_price||0),0)},ae=()=>o.getValues("destinations").reduce((a,i,n)=>{const c=(i.allowances||[]).reduce((p,u,m)=>{const k=o.getValues(`destinations.${n}.allowances.${m}.detail`),A=ke(u,k);return p+A},0);return a+c},0),Ae=t=>{const r=[];t.forEach(i=>{i.detail_attedances.forEach(n=>{n.start_date&&r.push(n.start_date),n.end_date&&r.push(n.end_date)})});const a=r.map(i=>new Date(i)).sort((i,n)=>i.getTime()-n.getTime());if(a.length===0)return 0;{const i=a[0],n=a[a.length-1];return Math.floor((n.getTime()-i.getTime())/(1e3*60*60*24))+1}},qe=async()=>{var t,r,a,i,n,l,c,p,u,m,k,A;try{const j=ae(),q=o.getValues("destinations");if(j===0){N("Please fill the balance","error");return}const Ze=Ae(q),He=q==null?void 0:q.some(X=>X.restricted_area===!0),b=await C.get("/check-approval",{params:{is_restricted_area:He,day:Ze,value:j,user_id:o.getValues("request_for"),type:"TRIP"}});if(b.data.status_code===200){const X=(r=(t=b.data)==null?void 0:t.data)==null?void 0:r.approval.map(f=>(f==null?void 0:f.division_name)||null),Ke=(i=(a=b.data)==null?void 0:a.data)==null?void 0:i.approval.map(f=>(f==null?void 0:f.name)||null),oe=[];(l=(n=b.data)==null?void 0:n.data)!=null&&l.hr&&oe.push((u=(p=(c=b.data)==null?void 0:c.data)==null?void 0:p.hr)==null?void 0:u.name);const Ue=(((m=b.data.data)==null?void 0:m.approval)??[]).map(f=>({status:"",name:f.name,dateApproved:""}));Ie({approvalRequest:X,approvalFrom:Ke,acknowledgeFrom:oe,approvalFromStatusRoute:Ue}),Pe(!0)}}catch(j){N((A=(k=j==null?void 0:j.response)==null?void 0:k.data)==null?void 0:A.message,"error")}};d.useEffect(()=>{},[o.watch("destinations")]);const Re=t=>{Z(r=>r.filter(a=>a.id!==t))},[Ve,se]=d.useState(!1),Ye=t=>{se(t)},re=it({control:o.control,name:"total_percent"}),[Be,Me]=d.useState(0),ne=Be;d.useEffect(()=>{g==w.clone&&se(o.getValues("cash_advance")??!1);const r=parseFloat((re||"0").toString())/100*ne;o.setValue("total_cash_advance",yt(r.toFixed(0),!1))},[re,ne]);const{dataDropdown:P,getDropdown:I}=y(ft),{dataDropdown:$e,getDropdown:Ge}=y(),{dataDropdown:Le,getDropdown:Oe}=y(),{dataDropdown:Xe,getDropdown:ze}=y(),{dataDropdown:Je,getDropdown:We}=y();return d.useEffect(()=>{(async()=>{x&&g==w.clone&&(await he(),Ce(!0)),I("",{name:"name",id:"id",tabel:"users",hasValue:{key:o.getValues("request_for")?"id":"",value:o.getValues("request_for")??""},idType:"string"}),Ge("",{name:"name",id:"id",tabel:"purpose_types",idType:"string",softDelete:!0}),Oe("",{name:"desc",id:"cost_center",tabel:"master_cost_centers",idType:"string",isMapping:!0,hiddenZero:!0}),ze("",{name:"description",id:"mwszkz",tabel:"pajaks",idType:"string",isMapping:!0}),We("",{name:"purchasing_group_desc",id:"purchasing_group",tabel:"purchasing_groups",idType:"string",isMapping:!0})})()},[g]),d.useEffect(()=>{g!=w.clone&&_=="0"&&o.setValue("request_for",(h==null?void 0:h.toString())??"")},[]),e.jsx(lt,{className:"h-[600px] w-full ",children:e.jsx(tt,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(ve),children:[e.jsxs("table",{className:"mt-4 text-xs font-thin reimburse-form-table",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:"ODR-YYYY-MM-XXXXXXXX"})]}),Fe&&e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"From Request No."}),e.jsx("td",{className:"text-sm",children:me})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Request For ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(z,{fieldLabel:"",options:P,fieldName:"request_for",isRequired:!0,disabled:_=="0",placeholder:"Select Employee",classNames:"mt-2 w-full",onSearch:(t,r)=>{const a=P==null?void 0:P.some(i=>i.label===t);t.length>0&&!a?I(t,{name:"name",id:"id",tabel:"users",search:t,idType:"string"}):t.length==0&&!a&&I("",{name:"name",id:"id",tabel:"users",idType:"string"})},onChangeOutside:t=>{ge(t),t===null&&L([])},onFocus:()=>{let t=o.getValues("request_for");I("",{name:"name",id:"id",tabel:"users",hasValue:{key:t?"id":"",value:t??""},idType:"string"})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussiness Trip Purpose Type",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(z,{fieldLabel:"",options:$e,fieldName:"purpose_type_id",isRequired:!0,disabled:!1,placeholder:"Select Purpose Type",classNames:"mt-2 w-full",onChangeOutside:async(t,r)=>{await we(t)}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Cost Center",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(z,{fieldLabel:"",options:Le,fieldName:"cost_center_id",isRequired:!0,disabled:!1,placeholder:"Select Cost Center",classNames:"mt-2 w-full"})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Remark",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(S,{control:o.control,name:"remark",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(nt,{placeholder:"Insert remark",...t,rows:4,className:"w-[300px]"})}),e.jsx(E,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(S,{control:o.control,name:"attachment",render:({field:t})=>e.jsxs(T,{children:[e.jsx(at,{className:"mb-1 text-xs text-gray-500 font-extralight",children:"Max File: 1000KB"}),e.jsx(D,{children:e.jsx("input",{className:"flex w-full px-3 py-1 text-xs transition-colors bg-transparent border rounded-md shadow-sm h-9 border-input file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",multiple:!0,onChange:r=>{const a=r.target.files;if(a){const i=Array.from(a);t.onChange(i)}else t.onChange([])}})}),o.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(o.formState.errors.attachment)?o.formState.errors.attachment.map((r,a)=>e.jsx("span",{children:r.message},a)):o.formState.errors.attachment.message})]})})})]}),$.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:$.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:t.url,target:"_blank",className:"inline-block text-blue-500",rel:"noreferrer",children:t.file_name},r),e.jsx("button",{type:"button",onClick:()=>Re(t.id),className:"inline-block mt-2 ml-2 text-red-500 cursor-pointer",children:"Delete"})]},r))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-xs text-gray-500 font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Total Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{children:[" ",e.jsx(S,{control:o.control,name:"total_destination",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsxs(pt,{value:t.value.toString(),onValueChange:Se,disabled:!1,children:[e.jsx(ut,{className:"w-[200px] py-2",children:e.jsx(mt,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(_t,{children:Array.from({length:5},(r,a)=>e.jsxs(ht,{value:(a+1).toString(),children:[" ",a+1," "]},a))})]})}),e.jsx(E,{})]})})]})]})]}),e.jsx(le,{className:"my-4"}),e.jsx(St,{updateDestination:Ne,destinationField:te,form:o,listAllowances:H,totalDestination:o.getValues("total_destination").toString(),pajak:Y,purchasingGroup:M,setTotalAllowance:Me,dataTax:Xe,dataPurchasingGroup:Je,dataDestination:fe,type:g,btClone:w.clone,dateBusinessTripByUser:xe,setSelectedDates:L,selectedDates:ye,setActiveTab:O,activeTab:Te}),e.jsx(le,{className:"my-4"}),e.jsxs("table",{className:"w-full mt-10 text-sm",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(dt,{fieldName:"cash_advance",isRequired:!1,disabled:!1,onChanges:t=>Ye(t.target.checked)})})]}),Ve&&e.jsx(e.Fragment,{children:e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(S,{control:o.control,name:"total_percent",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(J,{type:"number",...t,value:t.value||"",className:"w-[50%]",onChange:r=>{const a=r.target.value;if(!/^\d*$/.test(a))return;const i=parseInt(a,10);i>=1&&i<=100?t.onChange(i):a===""&&t.onChange("")}})}),e.jsx(E,{})]})}),e.jsx(S,{control:o.control,name:"total_cash_advance",render:({field:t})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(J,{value:t.value||"",readOnly:!0,className:"w-[50%] mt-3"})}),e.jsx(E,{})]})})]})]})})]}),e.jsx(Tt,{onClick:async()=>await qe(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:Ee&&e.jsx(ct,{workflowApproval:{approvalRequest:F.approvalRequest,approvalFrom:F.approvalFrom,acknowledgeFrom:F.acknowledgeFrom},workflowApprovalStep:F.approvalFromStatusRoute,workflowApprovalDiagram:F.approvalFrom})}),e.jsx(rt,{type:"submit",loading:De,children:"submit"})]})})})};function Ra({form:V,type:pe,allowanceIndex:Y,destinationIndex:B}){const{fields:M}=de({control:V.control,name:`destinations.${B}.allowances.${Y}.detail`});return e.jsx(e.Fragment,{children:M.map((g,x)=>e.jsx(S,{control:V.control,name:`destinations.${B}.allowances.${x}.detail.${x}.request_price`,render:({field:_})=>e.jsxs(T,{children:[e.jsx(D,{children:e.jsx(J,{value:_.value,onChange:_.onChange})}),e.jsx(E,{})]})}))})}export{Ra as AllowanceInputForm,qa as BussinessTripFormV1};
