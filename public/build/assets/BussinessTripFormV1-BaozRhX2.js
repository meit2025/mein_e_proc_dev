import{r as v,u as Re,j as e,a as qe}from"./app-BTT2Hi9L.js";/* empty css              */import{BusinessTripType as O}from"./models-C_LmT9C3.js";import{b as Ve,G as Me,C as ke,E as Pe}from"./api-DtjMnnyq.js";import{u as Be,b as se,a as Oe,c as ae}from"./index.esm-VqG0F-oi.js";import{d as Ie,F as x,a as j,b as _,c as g,I as w}from"./form-Cn_O4pvV.js";import{S as Le,a as Ge,b as Xe,c as Je,d as Ue}from"./select-jNKCgknz.js";import{T as We,a as ze,b as He,c as Ze}from"./tabs-CUT8Wthm.js";import{W as Ke}from"./WorkflowComponent-DCbx-EhI.js";import{B as je}from"./button-D5po1-kR.js";import{F as Qe}from"./formDropdown-kJnykfD2.js";import{F as et}from"./formSwitchCustom-Dgjrl5HZ.js";import{d as de}from"./index-CurrXPq9.js";import{S as tt}from"./scroll-area-C1gDsoVJ.js";import{S as he}from"./separator-BHNZwX27.js";import{T as st}from"./textarea-CQ144C3r.js";import{a as pe}from"./axiosInstance-C2Sq3Z4B.js";import{f as W}from"./rupiahCurrencyFormat-D0mkqwcl.js";import{h as C}from"./moment-C5S46NFB.js";import{u as me}from"./getDropdown-BJ5vff0K.js";import{o as J,a as U,s as m,n as I,b as ue,d as xe,i as at,Z as rt,t as nt}from"./types-DC3rSv43.js";import{B as lt}from"./Button-B09GUSd8.js";import{C as ot}from"./chevrons-up-down-5sHU-W3l.js";import"./app-ffJwujpg.js";import"./CustomStatus-BEoHYLpX.js";import"./utils-mlA64J5d.js";import"./createLucideIcon-CJR_kDz_.js";import"./index-CaS1uhW2.js";import"./index-BfItECJS.js";import"./index-CuLH5o9g.js";import"./index-Cm_GmgHt.js";import"./index-BwwwKVVQ.js";import"./index-DhdkEhfp.js";import"./index-BdQq_4o_.js";import"./index-C_efu6Ma.js";import"./index-3ml3h7G5.js";import"./index-DmNFg_3N.js";import"./index-DMd1fZMP.js";import"./index-BOtIm3yP.js";import"./index-DvR0F_LQ.js";import"./index-BGXW6IWI.js";import"./createSvgIcon-DT99xyz5.js";import"./DefaultPropsProvider-Bfn9fTI0.js";import"./TextField-xi4mnOOA.js";import"./useSlot-BcAkMbIz.js";import"./createSimplePaletteValueFilter-BJ1N3K2S.js";import"./CircularProgress-DWcqI8xw.js";import"./FormHelperText-oSihsMoe.js";import"./mergeSlotProps-CQKNC0Hu.js";import"./Switch-0HLrKHo7.js";import"./SwitchBase-B-LdiOtE.js";const it=1*1024*1024,ct=["heic","image/heic","image/heif","image/jpeg","image/jpg","image/png","application/pdf"],xs=({type:r,id:a})=>{var le;const h=J({request_no:m().nonempty("Request for required"),remark:m().nonempty("Remark is required"),attachment:U(at(File).refine(l=>ct.includes(l.type),{message:"File type must be JPG, JPEG, PNG, HEIC or PDF"}).refine(l=>l.size<=it,{message:"File size must be less than 1MB"})),total_destination:I().int("Total Destinantion Required"),cash_advance:ue().nullable().optional(),reference_number:m().nullable().optional(),total_percent:I().nullable().optional(),total_cash_advance:m().nullable().optional(),destinations:U(J({restricted_area:ue().optional(),destination:m().nonempty("Destinantion Required"),business_trip_start_date:xe().optional(),business_trip_end_date:xe().optional(),pajak_id:m().optional(),purchasing_group_id:m().optional(),detail_attedances:U(J({date:m().optional(),shift_code:m().optional(),shift_start:m().optional(),shift_end:m().optional(),start_time:m().optional(),end_time:m().optional(),start_date:m().optional(),end_date:m().optional(),request_start_time:m().optional(),request_end_time:m().optional()})),allowances:U(J({id:I().optional(),data_type:m().optional(),name:m().optional(),code:m().optional(),default_price:m().optional(),type:m().optional(),currency:m().optional(),subtotal:I().optional(),detail:U(J({id:I().optional(),data_type:m().optional(),date:m().nullish(),request_price:I().optional()}))})),other:U(J({value:I().optional()}))}))}).superRefine(({cash_advance:l,total_percent:d,attachment:s},o)=>{r===O.create&&s&&s.length===0&&o.addIssue({path:["attachment"],code:rt.too_small,minimum:1,type:"array",inclusive:!0,message:"Attachment is required"})}),n=Be({resolver:nt(h),defaultValues:{request_no:"",remark:"",attachment:[],total_destination:1,cash_advance:!1,reference_number:"",total_percent:0,total_cash_advance:"0",destinations:[{restricted_area:!1,destination:"",business_trip_start_date:new Date,business_trip_end_date:new Date,detail_attedances:[],allowances:[],other:[{value:0}]}]}}),T=(l,d)=>{var s;return l.type==="total"?parseFloat(((s=d==null?void 0:d[0])==null?void 0:s.request_price)||0):d==null?void 0:d.reduce((o,A)=>o+parseFloat(A.request_price||0),0)},p=()=>{const l=n.getValues("destinations");n.getValues("destinations.0.other");const d=l.reduce((o,A,k)=>{const D=(A.allowances||[]).reduce((S,R,$)=>{const q=n.getValues(`destinations.${k}.allowances.${$}.detail`),te=T(R,q);return S+te},0);return o+D},0);let s=0;try{s=l.reduce((o,A,k)=>{const D=(A.other||[]).reduce((S,R,$)=>{const q=n.getValues(`destinations.${k}.other.${$}.value`);return S+(q===void 0?0:q)},0);return o+D},0)}catch(o){console.log(o),s=0}return d+s},[c,t]=v.useState(!1),{showToast:E}=Re(),[b,f]=v.useState(!1),Y=async l=>{var d,s;try{f(!0);const o=n.getValues("destinations"),A=re(o),k=(d=i==null?void 0:i.business_trip_destination)==null?void 0:d.some(S=>S.restricted_area===!0||S.restricted_area==="1"||S.restricted_area===1),L=p(),D=new FormData;if(D.append("is_restricted_area",k?"true":"false"),D.append("day",A.toString()),D.append("user_id",((s=i==null?void 0:i.request_for)==null?void 0:s.id.toString())??""),D.append("value",L.toString()),D.append("request_no",l.request_no??""),D.append("remark",l.remark??""),D.append("total_destination",`${l.total_destination}`),l.destinations.forEach((S,R)=>{console.log(S,"item"),D.append(`destinations[${R}]`,JSON.stringify(S))}),r===O.create)l.attachment.forEach((S,R)=>{S&&D.append(`attachment[${R}]`,S)}),await de.Inertia.post(ke,D,{headers:{"Content-Type":"multipart/form-data"}}),E("succesfully created data","success");else{l.attachment.forEach(($,q)=>{$&&D.append(`attachment[${q}]`,$)}),ee.forEach(($,q)=>{$&&D.append(`file_existing[${q}]`,JSON.stringify($))});const S=ee.some($=>$),R=l.attachment.some($=>$);if(!S&&!R){E("Please add at least one attachment","error"),f(!1);return}await de.Inertia.post(`${Pe}/${a}`,D,{headers:{"Content-Type":"multipart/form-data"}}),E("succesfully updated data","success")}setTimeout(()=>{f(!1)},1e3)}catch(o){console.log(o)}},[i,u]=v.useState(null),[y,F]=v.useState([]),[B,Z]=v.useState([]),[V,N]=v.useState(!1);async function M(l){const d=Me(l);try{const s=await pe.get(d),o=s.data.data;r===O.clone?(console.log(o.parent_id,"businessTripData"),n.setValue("request_no",o.parent_id.toString()||"")):n.setValue("request_no",l.toString()||""),N(o.cash_advance==1),n.setValue("remark",o.remarks||""),n.setValue("total_destination",o.total_destination||1),n.setValue("cash_advance",o.cash_advance==1),n.setValue("reference_number",o.reference_number),n.setValue("total_percent",Number(o.total_percent)),n.setValue("total_cash_advance",(o==null?void 0:o.total_cash_advance)!==null?W(o.total_cash_advance,!1):"0"),u(s.data.data),Z(o.destinations),fe(o.destinations),Q(o.total_destination),console.log(n.getValues())}catch(s){console.log(s)}}const[K,Q]=v.useState(""),_e=l=>{Q(l)};function fe(l){const d=l.map(s=>({destination:s.destination||"",pajak:s.pajak||"",purchasing_group:s.purchasing_group||"",business_trip_start_date:new Date(s.business_trip_start_date),business_trip_end_date:new Date(s.business_trip_end_date),allowances:s.allowances||[],detail_attedances:s.detail_attedances||[],total_allowance:s.total_allowance||0,other:s.other||[],pajak_id:s.pajak_id.toString(),purchasing_group_id:s.purchasing_group_id.toString(),restricted_area:s.restricted_area==1||s.restricted_area==!0||s.restricted_area=="1"||s.restricted_area=="true"}));n.setValue("destinations",d)}const{fields:ge,update:ye}=se({control:n.control,name:"destinations"});v.useEffect(()=>{},[i,K]);const[jt,ve]=v.useState(0),[we,be]=v.useState(!1),[z,Ae]=v.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[],approvalFromStatusRoute:[]}),re=l=>{const d=[];l.forEach(o=>{o.detail_attedances.forEach(A=>{A.date&&d.push(A.date),A.end_date&&d.push(A.end_date)})});const s=d.map(o=>new Date(o)).sort((o,A)=>o.getTime()-A.getTime());if(s.length===0)return 0;{const o=s[0],A=s[s.length-1];return Math.floor((A.getTime()-o.getTime())/(1e3*60*60*24))+1}},De=async()=>{var l,d,s,o,A,k,L,D,S,R,$,q,te,oe;try{const G=n.getValues("destinations"),Ye=re(G);console.log(G,"day");const Te=(l=i==null?void 0:i.business_trip_destination)==null?void 0:l.some(H=>H.restricted_area===!0||H.restricted_area==="1"||H.restricted_area===1),ie=p();if(ie===0){E("Please fill the balance","error");return}const X=await pe.get("/check-approval",{params:{is_restricted_area:Te,day:Ye,value:ie,user_id:((d=i==null?void 0:i.request_for)==null?void 0:d.id)??"",type:"TRIP_DECLARATION"}});if(X.data.status_code===200){const H=(o=(s=X.data)==null?void 0:s.data)==null?void 0:o.approval.map(P=>(P==null?void 0:P.division_name)||null),Fe=(k=(A=X.data)==null?void 0:A.data)==null?void 0:k.approval.map(P=>(P==null?void 0:P.name)||null),ce=[];(D=(L=X.data)==null?void 0:L.data)!=null&&D.hr&&ce.push(($=(R=(S=X.data)==null?void 0:S.data)==null?void 0:R.hr)==null?void 0:$.name);const Ee=(((q=X.data.data)==null?void 0:q.approval)??[]).map(P=>({status:"",name:P.name,dateApproved:""}));Ae({approvalRequest:H,approvalFrom:Fe,acknowledgeFrom:ce,approvalFromStatusRoute:Ee}),be(!0)}}catch(G){E((oe=(te=G==null?void 0:G.response)==null?void 0:te.data)==null?void 0:oe.message,"error")}},{dataDropdown:Ne,getDropdown:Se}=me();me(),v.useEffect(()=>{Se("",{name:"request_no",id:"id",tabel:"business_trip",idType:"string",where:{key:"type",parameter:"request"},declaration:O.create===r?"true":"false"})},[n.watch("destinations")]);const[ee,ne]=v.useState([]);async function Ce(){n.setValue("destinations",[]);const l=Ve(a),s=(await qe.get(l)).data.data;await M(s.id),ne(s.attachments)}v.useEffect(()=>{a&&r===O.clone&&Ce()},[r]);const $e=l=>{ne(d=>d.filter(s=>s.id!==l))};return e.jsx(tt,{className:"h-[600px] w-full ",children:e.jsx(Ie,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(Y),children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Declaration No."}),e.jsx("td",{children:"DCLR-YYYY-MM-XXXXXXX"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request No."}),e.jsx("td",{children:e.jsx(Qe,{fieldLabel:"",options:Ne,fieldName:"request_no",isRequired:!0,disabled:O.create!==r,placeholder:"Select Request No.",classNames:"mt-2 w-full",onChangeOutside:l=>{M(l)}})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purpose Type"}),e.jsx("td",{className:"text-sm",children:i.name_purpose})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request for"}),e.jsx("td",{className:"text-sm",children:i.name_request})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{className:"text-sm",children:(le=i==null?void 0:i.cost_center)==null?void 0:le.company_code})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(x,{control:n.control,name:"remark",render:({field:l})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(st,{placeholder:"Insert remark",...l,rows:4,className:"w-[300px]"})}),e.jsx(g,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["File Attachment",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(x,{control:n.control,name:"attachment",render:({field:l})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx("input",{className:"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-xs shadow-sm transition-colors file:border-0 file:bg-transparent file:text-xs file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",type:"file",multiple:!0,accept:".jpg,.jpeg,.png,.pdf,.heic,.heif",onChange:d=>{const s=d.target.files;if(s){const o=Array.from(s);l.onChange(o)}else l.onChange([])}})}),n.formState.errors.attachment&&e.jsx("p",{className:"text-[0.8rem] font-medium text-destructive",children:Array.isArray(n.formState.errors.attachment)?n.formState.errors.attachment.map((d,s)=>e.jsx("span",{children:d.message},s)):n.formState.errors.attachment.message})]})})})]}),ee.length>0&&e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsx("td",{className:"pb-3",children:ee.map((l,d)=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("a",{href:l.url,target:"_blank",className:"text-blue-500 inline-block",rel:"noreferrer",children:l.file_name},d),e.jsx("button",{type:"button",onClick:()=>$e(l.id),className:"text-red-500 mt-2 inline-block ml-2 cursor-pointer",children:"Delete"})]}))})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"File Extension"}),e.jsx("td",{className:"text-gray-500 text-xs font-extralight",children:"PDF, JPG, JPEG, PNG and HEIC Max 1mb"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Total Destination"}),e.jsxs("td",{children:[" ",e.jsx(x,{control:n.control,name:"total_destination",render:({field:l})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsxs(Le,{value:K,onValueChange:_e,disabled:!0,children:[e.jsx(Ge,{className:"w-[200px] py-2",children:e.jsx(Xe,{placeholder:"-- Select Bussiness Trip --"})}),e.jsx(Je,{children:Array.from({length:5},(d,s)=>e.jsxs(Ue,{value:(s+1).toString(),children:[" ",s+1," "]},s))})]})}),e.jsx(g,{})]})})]})]})]}),e.jsx(he,{className:"my-4"}),e.jsx(dt,{updateDestination:ye,destinationField:ge,form:n,listAllowances:y,totalDestination:n.getValues("total_destination").toString(),setTotalAllowance:ve,businessTripDetail:i,type:r,btEdit:O.edit,setIsCashAdvance:N,isCashAdvance:V,setOtherAllowance:t,otherAllowance:c}),e.jsx(he,{className:"my-4"}),e.jsx(lt,{onClick:async()=>await De(),variant:"contained",color:"primary",type:"button",children:"Check Approval"}),e.jsx("div",{className:"my-2",children:we&&e.jsx(Ke,{workflowApproval:{approvalRequest:z.approvalRequest,approvalFrom:z.approvalFrom,acknowledgeFrom:z.acknowledgeFrom},workflowApprovalStep:z.approvalFromStatusRoute,workflowApprovalDiagram:z.approvalFrom})}),e.jsx(je,{type:"submit",loading:b,children:"submit"})]})})})};function dt({totalDestination:r,listAllowances:a,form:h,destinationField:n,updateDestination:T,setTotalAllowance:p,businessTripDetail:c,type:t,btEdit:E,setIsCashAdvance:b,isCashAdvance:f,setOtherAllowance:Y,otherAllowance:i}){return e.jsxs(We,{defaultValue:"destination1",className:"w-full",children:[e.jsx(ze,{className:"flex items-center justify-start space-x-4",children:n.map((u,y)=>e.jsxs(He,{value:`destination${y+1}`,children:["Destination ",y+1]}))}),n.map((u,y)=>e.jsx(ht,{listAllowances:a,updateDestination:T,destination:u,form:h,index:y,setTotalAllowance:p,businessTripDetail:c,type:t,btEdit:O.edit,setIsCashAdvance:b,isCashAdvance:f,setOtherAllowance:Y,otherAllowance:i},y))]})}function ht({form:r,index:a,destination:h,updateDestination:n,listAllowances:T,setTotalAllowance:p,businessTripDetail:c,type:t,btEdit:E,setIsCashAdvance:b,isCashAdvance:f,setOtherAllowance:Y,otherAllowance:i}){const{fields:u,update:y}=se({control:r.control,name:`destinations[${a}].detail_attedances`}),{fields:F}=se({control:r.control,name:`destinations[${a}].allowances`}),B=N=>{b(N)},{setValue:Z}=Oe();ae({control:r.control,name:"total_percent"});const V=c==null?void 0:c.total_cash_advance;return v.useEffect(()=>{},[V]),e.jsxs(Ze,{value:`destination${a+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Destination"}),e.jsx("td",{children:h.destination})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Restricted Area"}),e.jsx("td",{children:h.restricted_area==!0||h.restricted_area==1?"Yes":"No"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Pajak"}),e.jsx("td",{className:"text-sm",children:h==null?void 0:h.pajak})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{className:"text-sm",children:h==null?void 0:h.purchasing_group})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Bussines Trip Date"}),e.jsxs("td",{className:"flex space-x-2 items-center gap-3",children:[e.jsx("span",{children:C(h.business_trip_start_date).format("DD/MM/YYYY")}),e.jsx("span",{children:"To"}),e.jsx("span",{children:C(h.business_trip_end_date).format("DD/MM/YYYY")})]})]})]}),e.jsx(pt,{detailAttedanceFields:u,form:r,updateAttedanceFields:y,destinationIndex:a}),e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(mt,{allowanceField:F,destinationIndex:a,form:r,setOtherAllowance:Y,otherAllowance:i})]},a),e.jsx(xt,{allowanceField:F,destinationIndex:a,form:r,setTotalAllowance:p}),e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Cash Advance"}),e.jsx("td",{className:"w-[50%] pb-0",children:e.jsx(et,{fieldName:"cash_advance",isRequired:!1,disabled:!0,onChanges:N=>B(N.target.checked)})})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Reference Number"}),e.jsx("td",{className:"w-[50%]",style:{paddingBottom:0},children:e.jsx(x,{control:r.control,name:"reference_number",render:({field:N})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{value:N.value||"",onChange:M=>N.onChange(M.target.value),className:"w-[50%] mb-2",placeholder:"Reference Number",disabled:!0})}),e.jsx(g,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"w-[50%]",children:"Total Percent"}),e.jsxs("td",{className:"w-[50%]",children:[e.jsx(x,{control:r.control,name:"total_percent",render:({field:N})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{...N,value:N.value||"",readOnly:!0,className:"w-[50%]",min:"1",max:"100"})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:"total_cash_advance",render:({field:N})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{value:N.value||"",readOnly:!0,className:"w-[50%] mt-2"})}),e.jsx(g,{})]})})]})]})]})]})]})}function pt({form:r,destinationIndex:a,detailAttedanceFields:h,updateAttedanceFields:n}){const T=r.watch(`destinations[${a}].detail_attedances`);return v.useEffect(()=>{},[T]),v.useEffect(()=>{},[h]),e.jsxs("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:[e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Request: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Request Start Time"}),e.jsx("th",{children:"Request End Time"})]}),e.jsx("tbody",{children:T.map((p,c)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[C(p.date).format("DD/MM/YYYY"),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_code,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.shift_code`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_start,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.shift_start`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_end,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.shift_end`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.request_start_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.request_start_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.request_end_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",readOnly:!0,style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.request_end_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:t.value,onChange:t.onChange,readOnly:!0})}),e.jsx(g,{})]})})]})]},p.index))})]})})}),e.jsx("tr",{children:e.jsx("td",{colSpan:2,children:e.jsx("div",{className:"mb-4 text-sm",children:"Detail Attedance Business Trip Declaration: "})})}),e.jsx("tr",{children:e.jsx("td",{className:"overflow-x",children:e.jsxs("table",{className:"detail-attedance text-xs table-auto overflow-scroll w-full",children:[e.jsxs("thead",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Shift code"}),e.jsx("th",{children:"Shift Start"}),e.jsx("th",{children:"Shift End"}),e.jsx("th",{children:"Start Time"}),e.jsx("th",{children:"End Time"})]}),e.jsx("tbody",{children:T.map((p,c)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{verticalAlign:"middle"},children:[C(p.date).format("DD/MM/YYYY"),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_code,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.shift_code`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_start,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.shift_start`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[p.shift_end,e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.shift_end`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"hidden"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.start_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.start_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(g,{})]})})]}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.end_date`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:C(t.value).format("YYYY-MM-DD"),onChange:t.onChange,type:"date",style:{marginBottom:"5px"}})}),e.jsx(g,{})]})}),e.jsx(x,{control:r.control,name:`destinations.${a}.detail_attedances.${c}.end_time`,render:({field:t})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{defaultValue:t.value,onChange:t.onChange,type:"time"})}),e.jsx(g,{})]})})]})]},p.index))})]})})})]})}function mt({form:r,destinationIndex:a,allowanceField:h,setOtherAllowance:n,otherAllowance:T}){const p=r.watch(`destinations[${a}].allowances`);return v.useEffect(()=>{},[p]),se({control:r.control,name:`destinations.${a}.other`}),ae({control:r.control,name:`destinations.${a}.other`}),e.jsx("table",{className:"w-full allowance-table",children:p.map((c,t)=>e.jsx(ut,{form:r,allowance:c,destinationIndex:a,allowanceIndex:t},t))})}function ut({form:r,allowance:a,destinationIndex:h,allowanceIndex:n}){const[T,p]=v.useState(!1),[c,t]=v.useState(0),E=u=>{p(y=>!y)},b=ae({control:r.control,name:`destinations[${h}].allowances[${n}].detail[0].request_price`}),f=ae({control:r.control,name:`destinations[${h}].allowances[${n}].detail`}),Y=()=>{if(a.type==="total")return parseFloat(b||0)*1;{let u=0;return f==null||f.forEach(y=>{const F=parseFloat(y.request_price||0);u+=F}),u}},i=(u,y)=>{const F=parseFloat(y),B=isNaN(F)?0:F,Z=a.request_value;let V=!0;switch(Z){case"unlimited":V=!0;break;case"fixed value":const N=a.default_price;B!==N&&(alert(`Please enter the fixed value of IDR ${N}`),V=!1);break;case"up to max value":const M=a.default_price;B>M&&(alert(`The value should not exceed IDR ${M}`),V=!1);break;default:V=!1}if(V){r.setValue(`destinations[${h}].allowances[${n}].detail[${u}].request_price`,B);const M=r.getValues(`destinations[${h}].allowances[${n}].detail`).reduce((K,Q)=>K+(parseFloat(Q.request_price)||0),0);r.setValue(`destinations[${h}].allowances[${n}].subtotal`,M)}};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{width:220,style:{verticalAlign:"middle"},className:"text-sm",children:a.name}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:a.type=="total"?e.jsx("span",{className:"text-sm",children:"IDR"}):e.jsx("span",{})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:a.type=="total"?e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{control:r.control,name:`destinations[${h}].allowances[${n}].detail[0].request_price`,render:({field:u})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{value:u.value,onChange:y=>i(0,y.target.value)})}),e.jsx(g,{})]})}),e.jsx("span",{className:"text-sm",children:"* 100%"})]}):e.jsxs("span",{className:"text-sm",children:[" ",a.detail.length," Days * ",W(a.default_price,!1)," * 100%"]})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:"text-sm total",style:{padding:"2px 5px"},children:["= IDR ",W(Y(),!1)]})})}),a.type=="total"?e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}):e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},onClick:()=>E(),children:e.jsxs(je,{variant:"ghost",type:"button",size:"sm",className:"w-9 p-0",children:[e.jsx(ot,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]},a.id),T&&e.jsx(e.Fragment,{children:a.detail.map((u,y)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"text-end",style:{verticalAlign:"middle"},children:[e.jsx("span",{className:"text-sm",children:C(u.date).format("DD/MM/YYYY")})," "]}),e.jsx("td",{style:{padding:"8px 2px",verticalAlign:"middle"},children:":"}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("span",{className:"text-sm",children:"IDR"})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"},children:e.jsx("div",{className:"flex mt-1 text-sm justify-between items-center",children:e.jsx(x,{control:r.control,name:`destinations[${h}].allowances[${n}].detail[${y}].request_price`,render:({field:F})=>e.jsxs(j,{children:[e.jsx(_,{children:e.jsx(w,{value:F.value,onChange:B=>i(y,B.target.value)})}),e.jsx(g,{})]})})})}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}}),e.jsx("td",{style:{verticalAlign:"middle",padding:"2px 5px"}})]},u.id))})]})}function xt({allowanceField:r,destinationIndex:a,form:h,setTotalAllowance:n}){const[T,p]=v.useState(0),c=h.watch(`destinations.${a}.other`),t=h.watch(`destinations[${a}].allowances`);v.useEffect(()=>{const b=t.reduce((Y,i,u)=>{const y=h.getValues(`destinations.${a}.allowances.${u}.detail`),F=E(i,y);return Y+F},0),f=Array.isArray(c)?c.reduce((Y,i)=>{const u=Number(i==null?void 0:i.value)||0;return Y+u},0):0;p(b+f)},[t,h.watch()]);const E=(b,f)=>{var Y;return b.type==="total"?parseFloat(((Y=f==null?void 0:f[0])==null?void 0:Y.request_price)||0):f==null?void 0:f.reduce((i,u)=>i+parseFloat(u.request_price||0),0)};return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"w-full text-sm mt-10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-[50%]",children:"Item"}),e.jsx("th",{className:"w-[50%]",children:"Sub Total"})]})}),e.jsxs("tbody",{children:[t.map((b,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:b.name}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:W(b.subtotal)})]})]},b.id)),Array.isArray(c)&&c.length>0&&e.jsx(e.Fragment,{children:c.map((b,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:"Other Allowance"}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:b!=null&&b.value?W(b.value):"0"})]})]},f))})]}),e.jsx("tfoot",{className:"mt-4",children:e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("i",{children:"Total Allowance"})}),e.jsxs("td",{className:"flex justify-between pr-4",children:[e.jsx("span",{children:"IDR"}),e.jsx("span",{children:W(T)})]})]})})]})})}export{ut as AllowanceRowInput,dt as BussinesTripDestination,ht as BussinessDestinationForm,xs as BussinessTripFormV1,mt as DetailAllowance,pt as DetailAttedances,xt as ResultTotalItem};
