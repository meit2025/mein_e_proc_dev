import{r as p,u as D,j as e}from"./app-CCDmF8JI.js";import{a as P}from"./axiosInstance-Dtc0ahWe.js";import{L as T}from"./Loading-Djbzjt_R.js";import{W as L}from"./WorkflowComponent-CzzoF0ii.js";import{F as x}from"./formDropdown-BivT9GeB.js";import{u as V}from"./getDropdown-C4zemp13.js";import{a as q}from"./index.esm-BGYZ15jd.js";import{B as E}from"./Button-Ba7Y50K3.js";import"./app-HlhieNAw.js";import"./createSimplePaletteValueFilter-C0rP-KuP.js";import"./DefaultPropsProvider-7-Upppsi.js";import"./createLucideIcon-BYN8O0z9.js";import"./TextField-DvR2ErB1.js";import"./useSlot-ClH3lA2U.js";import"./FormHelperText-87pAN2h-.js";const ra=({isDisabled:I})=>{const{getValues:d,watch:u,setValue:B}=q(),[b,o]=p.useState(!1),[k,m]=p.useState(!1),[t,A]=p.useState({approvalRequest:[],approvalFrom:[],acknowledgeFrom:[]}),{dataDropdown:F,getDropdown:j}=V(),{showToast:r}=D(),N=u("document_type"),R=u("metode_approval"),S=async()=>{var c,v,_,f,h,g;try{const a=d(),w=d("vendors").filter(s=>(s.winner||!1)===!0),C=((w.length>0?w[0]:null).units||[]).reduce((s,n)=>s+n.total_amount,0);if(a.document_type===null||a.document_type===void 0){o(!1),r("Please input Document Type","error");return}if(a.purchasing_groups===null||a.purchasing_groups===void 0){o(!1),r("Please input purchasing group","error");return}if(a.total_all_amount===null||a.total_all_amount===void 0){o(!1),r("Please input Item","error");return}if(a.user_id===null||a.user_id===void 0){o(!1),r("Please input Item","error");return}if(a.document_type==="ZENT"){if(a.metode_approval===null||a.metode_approval===void 0){o(!1),r("Please select metode approval","error");return}if(a.metode_approval==="chooses_approval"&&(a.chooses_approval_id===null||a.chooses_approval_id===void 0)){o(!1),r("Please select chooses approval","error");return}}const l=await P.get("/check-approval",{params:{document_type_id:a.document_type,purchasing_group_id:a.purchasing_groups,value:C,user_id:a.user_id,type:"PR",metode_approval:a.metode_approval,chooses_approval_id:a.chooses_approval_id}});if(l.data.status_code===200){const s=(v=(c=l.data)==null?void 0:c.data)==null?void 0:v.approval_route.map(i=>{var y;return((y=i.user.divisions)==null?void 0:y.name)||null}),n=(f=(_=l.data)==null?void 0:_.data)==null?void 0:f.approval_route.map(i=>i.user.name);A({approvalRequest:s,approvalFrom:n,acknowledgeFrom:[]}),m(!0)}o(!1)}catch(a){o(!1),m(!1),r((g=(h=a==null?void 0:a.response)==null?void 0:h.data)==null?void 0:g.message,"error")}};return p.useEffect(()=>{j("",{name:"name",id:"id",tabel:"approval_tracking_number_chooses"})},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"card card-grid h-full min-w-full p-4",children:[e.jsx(T,{isLoading:b}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"flex justify-start mt-4 mb-2",children:e.jsx(E,{onClick:async()=>await S(),variant:"contained",color:"primary",type:"button",children:"Check Approval"})}),N==="ZENT"&&e.jsxs(e.Fragment,{children:[e.jsx(x,{options:[{label:"Approval",value:"approval"},{label:"Chooses Approval Tracking Number",value:"chooses_approval"},{label:"Automatic Approval Tracking Number",value:"automatic_approval_by_purchasing_group"}],fieldLabel:"Metode Approval",fieldName:"metode_approval",disabled:!1,style:{width:"58.5rem"},placeholder:"Metode Approval",classNames:"mt-2"}),R==="chooses_approval"&&e.jsx(x,{options:F,fieldLabel:"Select Chooses approval",fieldName:"chooses_approval_id",isRequired:!0,disabled:!1,style:{width:"58.5rem"},placeholder:"Select Chooses approval",classNames:"mt-2"})]}),k&&e.jsx(L,{workflowApproval:{approvalRequest:t.approvalRequest,approvalFrom:t.approvalFrom,acknowledgeFrom:t.acknowledgeFrom},workflowApprovalStep:t.approvalFrom,workflowApprovalDiagram:t.approvalFrom})]})]})})};export{ra as default};
