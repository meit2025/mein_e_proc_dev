import{r as _,u as Z,q as ee,b as S,j as e}from"./app-BnmUwhWw.js";import{B as se}from"./button-DNUxuwVj.js";import{F as re,a as c,b as d,c as i,d as h}from"./form-BoRG5OxW.js";import{u as te}from"./index.esm-DO0QSKbU.js";import{T as $}from"./textarea-Bvm58tOb.js";/* empty css                  */import{S as ae}from"./scroll-area-Dc4My1dF.js";import{a as le}from"./axiosInstance-Cxz19zcI.js";import{S as F}from"./separator-BvFL-baG.js";import{T as ne,a as oe,b as ce,c as de}from"./tabs-7PD1moLr.js";import{S as m,a as u,b as p,c as g,d as f}from"./select-Ytu7zxOF.js";import{C as D}from"./CustomDatePicker-D9TCp8xP.js";import{I as R}from"./input-BkyJkoVe.js";import"./app-wnGHkkFm.js";import"./index-nbLYfKn7.js";import"./index-Ds1syxLm.js";import"./index-D73CNb11.js";import"./index-BicAGZ7X.js";import"./Combination-mc6H3MvX.js";import"./react-icons.esm-CZWVYFOU.js";import"./index-DNSzpshw.js";import"./createLucideIcon-eTOMDpSW.js";const Ae=({purchasing_groups:T,reimbursement:n,reimburses:ie,currencies:q,categories:k,periods:A,users:E,taxes:I,cost_center:B})=>{const[L,P]=_.useState("form1"),{showToast:y}=Z();ee().props;const[he,z]=_.useState(1),[N,G]=_.useState([]),[w,M]=_.useState([[]]),[xe,H]=_.useState(),[J,K]=_.useState([]),[C,O]=_.useState([[]]),l=te({defaultValues:{formCount:"1",remark_group:"",cost_center:"",requester:"",forms:Array.from({length:1}).map(()=>({id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:0,currency:"IDR",tax_on_sales:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date}))}}),Q=a=>{z(a);const s=l.getValues("forms"),o=Array.from({length:a}).map((x,t)=>s[t]||{id:"",for:"",group:"",reimburse_type:"",short_text:"",balance:0,currency:"IDR",tax_on_sales:"",purchasing_group:"",period:"",type:"",item_delivery_data:new Date,start_date:new Date,end_date:new Date});l.setValue("forms",o),l.setValue("formCount",a.toString())};_.useEffect(()=>{n&&(l.setValue("remark_group",n.remark),l.setValue("cost_center",n.cost_center),l.setValue("requester",n.users.nip),l.setValue("formCount",n.reimburses.length.toString()),l.setValue("forms",n.reimburses.map(a=>({id:a.id,for:a.for,group:a.group,reimburse_type:a.reimburse_type,short_text:a.short_text,balance:Number(a.balance),currency:a.currency,tax_on_sales:a.tax_on_sales,purchasing_group:a.purchasing_group,period:a.period,type:a.type,item_delivery_data:new Date(a.item_delivery_data),start_date:new Date(a.start_date),end_date:new Date(a.end_date)}))),n.reimburses.forEach((a,s)=>{V(s,a.reimburse_type)}))},[n]);const U=async a=>{try{const o=(await S.get(`/family/show/${a}`)).data;K(o),H(a),l.setValue("requester",a)}catch(s){const x=s.response.data;y(x.message,x.status)}},W=a=>{P(a)},V=async(a,s)=>{try{const x=(await S.get(`/reimburse/type/${s}`)).data;M(t=>{const r=[...t];return r[a]=x.data,r}),O(t=>{const r=[...t];return r[a]=s==="Family",r}),l.setValue(`forms.${a}.type`,s)}catch(o){const t=o.response.data;y(t.message,t.status)}},X=async(a,s,o,x,t)=>{const j=(await S.post("/reimburse/is_required",{user:s,is_employee:o,type:x,period:t})).data.data;console.log(j),G(v=>{const b=[...v];return b[a]={plafon:j==null?void 0:j.plafon,limit:j==null?void 0:j.limit},b}),l.setValue(`forms.${a}.for`,s)},Y=async a=>{try{const s=await le.post("/reimburse",a);y(s.message,"success")}catch(s){y(s.message,"error")}};return e.jsx(ae,{className:"h-[600px] w-full",children:e.jsx(re,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(Y),children:[e.jsx("table",{className:"text-xs mt-4 reimburse-form-table font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Request No."}),e.jsx("td",{children:(n==null?void 0:n.request_number)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Request Status"}),e.jsx("td",{children:(n==null?void 0:n.status)??"-"})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:"remark_group",render:({field:a})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx($,{disabled:n!==null,placeholder:"Insert remark",...a})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Cost Center"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:"cost_center",render:({field:a})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:s=>a.onChange(s),value:a.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"-"})}),e.jsx(g,{children:B.map(s=>e.jsx(f,{value:s.id.toString(),children:s.cost_center},s.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Employee"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:"requester",render:({field:a})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:s=>U(s),value:a.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"Requester"})}),e.jsx(g,{children:E.map(s=>e.jsxs(f,{value:s.nip,children:[s.name," [",s.nip,"]"]},s.nip))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Number of Forms"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:"formCount",render:({field:a})=>{var s;return e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:o=>Q(o),value:(s=a.value)==null?void 0:s.toString(),children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"Select number of forms"})}),e.jsx(g,{children:Array.from({length:20},(o,x)=>x+1).map(o=>e.jsx(f,{value:o.toString(),children:o},o))})]})}),e.jsx(h,{})]})}})})]})]})}),e.jsx(F,{className:"my-4"}),e.jsxs(ne,{value:L,onValueChange:W,className:"w-full",children:[e.jsxs(oe,{className:"flex items-center justify-start space-x-4",children:[" ",Array.from({length:l.watch("formCount")||1}).map((a,s)=>e.jsxs(ce,{value:`form${s+1}`,children:["Form ",s+1]},s))]}),Array.from({length:l.watch("formCount")||1}).map((a,s)=>{var o,x;return e.jsxs(de,{value:`form${s+1}`,children:[e.jsx(c,{control:l.control,name:`forms.${s}.id`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(R,{className:"sr-only",value:t.value,onChange:t.onChange})}),e.jsx(h,{})]})}),e.jsx("div",{children:e.jsx("table",{className:"text-xs mt-4 reimburse-form-detail font-thin",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Type of Reimbursement"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:l.control,name:`forms.${s}.type`,render:({field:t})=>e.jsxs(m,{disabled:n!==null,onValueChange:r=>V(s,r),value:t.value,children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select type"})}),e.jsx(g,{children:k.map(r=>e.jsx(f,{value:r,children:r},r))})]})}),e.jsx(c,{control:l.control,name:`forms.${s}.reimburse_type`,render:({field:t})=>e.jsxs(m,{disabled:!w[s]||w[s].length===0,onValueChange:r=>l.setValue(`forms.${s}.reimburse_type`,r),value:t.value,children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select detail"})}),e.jsx(g,{children:w[s]&&w[s].map(r=>e.jsx(f,{value:r.code,children:r.name},r.code))})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Purchasing Group"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.purchasing_group`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"-"})}),e.jsx(g,{children:T.map(r=>e.jsxs(f,{value:r.id.toString(),children:[r.purchasing_group_desc," - ",r.purchasing_group]},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Period Date"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.period`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"-"})}),e.jsx(g,{children:A.map(r=>e.jsxs(f,{value:r.code,children:[r.start," - ",r.end," (",r.code,")"]},r.code))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.for`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:!C[s]||C[s].length===0,onValueChange:r=>X(s,r,!C[s],l.getValues(`forms.${s}.reimburse_type`),l.getValues(`forms.${s}.period`)),value:t.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"-"})}),e.jsx(g,{children:J.map(r=>e.jsx(f,{value:r.id.toString(),children:r.name},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Tax"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.tax_on_sales`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"-"})}),e.jsx(g,{children:I.map(r=>e.jsx(f,{value:r.id.toString(),children:r.mwszkz},r.id))})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Remark"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.short_text`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx($,{placeholder:"Insert remark",...t})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Balance"}),e.jsx("td",{children:(o=N[s])==null?void 0:o.plafon})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Limit per claim"}),e.jsx("td",{children:(x=N[s])==null?void 0:x.limit})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Receipt Date"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.item_delivery_data`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(D,{disabled:n!==null,initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Claim date"}),e.jsxs("td",{className:"flex items-center",children:[e.jsx("span",{className:"mx-2",children:"Start Date"}),e.jsx(c,{control:l.control,name:`forms.${s}.start_date`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(D,{disabled:n!==null,initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(h,{})]})}),e.jsx("span",{className:"mx-2",children:"End Date"}),e.jsx(c,{control:l.control,name:`forms.${s}.end_date`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(D,{disabled:n!==null,initialDate:t.value instanceof Date?t.value:new Date(t.value),onDateChange:r=>t.onChange(r)})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Reimburse Cost"}),e.jsxs("td",{className:"flex items-center space-x-3",children:[e.jsx(c,{control:l.control,name:`forms.${s}.currency`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsxs(m,{disabled:n!==null,onValueChange:r=>t.onChange(r),value:t.value,children:[e.jsx(u,{className:"w-[200px]",children:e.jsx(p,{placeholder:"-"})}),e.jsx(g,{children:q.map(r=>e.jsxs(f,{value:r.code,children:[r.name," (",r.code,")"]},r.code))})]})}),e.jsx(h,{})]})}),e.jsx(c,{control:l.control,name:`forms.${s}.balance`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx(R,{disabled:n!==null,type:"number",placeholder:"0.0",...t,onChange:r=>t.onChange(Number(r.target.value)),value:t.value||0})}),e.jsx(h,{})]})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Attachments"}),e.jsx("td",{children:e.jsx(c,{control:l.control,name:`forms.${s}.attachment`,render:({field:t})=>e.jsxs(d,{children:[e.jsx(i,{children:e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:r=>{const j=r.target.files;if(j){const v=Array.from(j);t.onChange(v)}}})}),e.jsx(h,{})]})})})]})]})})})]},s)})]}),e.jsx(F,{className:"my-4"}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(se,{type:"submit",className:"w-32",children:"Save"})})]})})})};export{Ae as ReimburseForm};
