import{r as R,u as K,j as e}from"./app-COJ7NqvI.js";import{d as Q,F as m,a as n,b as o,c as h,e as T}from"./form-5BFTr8UC.js";import{B as X}from"./button-CrJwXWf_.js";import{o as M,a as Z,s as u,n as v,c as ee,b as ae,t as re}from"./types-Bu-IK2ku.js";import{u as le,b as te}from"./index.esm-fhDVJvEV.js";import{S as se}from"./scroll-area-Dr5tzQJq.js";import{S as D,a as P,b as A,c as B,d as x}from"./select-BPjlxWV0.js";import{I as g}from"./input-xPNppgkS.js";import{a as S}from"./axiosInstance-B-5dpWIr.js";import{F as y}from"./utils-3PeL5dVk.js";import{M as ie}from"./MultiSelect-Djha8kk9.js";import{R as ne,a as L}from"./radio-group-DCCdYULY.js";import{L as oe}from"./Loading-DxCzrtML.js";import{F as V}from"./formDropdown-DD-iyLp9.js";import{u as k}from"./getDropdown-DK5ykjlZ.js";import{f as w}from"./rupiahCurrencyFormat-D0mkqwcl.js";const j="/api/master/reimburse-type",Ie=`${j}/`,de=`${j}/create`,Ne=d=>`${j}/edit/${d}`,Fe=d=>`${j}/update/${d}`,Re=`${j}/delete`;function me({onSuccess:d,type:E=y.create,listGrades:U,editURL:Y,updateURL:$,id:ce}){const G=M({code:u(),name:u().min(1,"Name is required"),is_employee:ae(),family_status:u().optional(),interval_claim_period:v().nullable(),limit:ee(),material_group:v().refine(a=>a>0,{message:"Material Group must be chosen"}),material_number:v().refine(a=>a>0,{message:"Material Number must be chosen"}),grade_option:u().min(1,"Grade must be selected"),grade_all_price:u().optional(),grades:Z(M({grade:u(),id:v(),plafon:u().min(1,"Balance required")}))}),[O,C]=R.useState(!1),{dataDropdown:p,getDropdown:_}=k("api/master-pr/material-group/dropdown-list"),{dataDropdown:f,getDropdown:b}=k("api/master/master-material/get-dropdown-master-material-number"),I=365,q=[{label:"1 Year",value:I*1},{label:"2 Year",value:I*2}],H={code:"",name:"",material_group:null,material_number:null,family_status:"",interval_claim_period:null,is_employee:!0,grade_option:"all",grade_all_price:"",grades:[],limit:null},l=le({resolver:re(G),defaultValues:H});async function z(){try{const r=(await S.get(Y||"")).data.data;l.reset({code:r.code,name:r.name,limit:r.limit,is_employee:r.is_employee,family_status:r.family_status,interval_claim_period:r.interval_claim_period?parseInt(r.interval_claim_period):null,material_group:parseInt(r.material_group.id),material_number:parseInt(r.material_number),grade_option:r.grade_option,grade_all_price:r.grade_all_price,grades:r.grades}),F(r.material_group.material_group||"")}catch{}}const{fields:W}=te({control:l.control,name:"grades"}),{showToast:N}=K(),J=async a=>{var r,t,i;C(!0);try{let s;E===y.edit?s=await S.put($??"",a):s=await S.post(de??"",a),d&&d(!0),N((r=s==null?void 0:s.data)==null?void 0:r.message,"success")}catch(s){d&&d(!1);const c=((i=(t=s.response)==null?void 0:t.data)==null?void 0:i.message)??s.message;N(c,"error")}C(!1)},F=async a=>{a.length>0&&b(a,{name:"material_number",id:"id",tabel:"master_materials",where:{key:"material_group",parameter:a},hasValue:{key:l.getValues("material_number")?"id":"",value:l.getValues("material_number")??""}})};return R.useEffect(()=>{(async()=>{E===y.edit&&await z(),_("",{name:"material_group",id:"id",tabel:"material_groups",hasValue:{key:l.getValues("material_group")?"id":"",value:l.getValues("material_group")??""}})})()},[]),e.jsxs(se,{className:"h-[600px] w-full",children:[e.jsx(oe,{isLoading:O}),e.jsx(Q,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(J),children:[e.jsxs("table",{className:"text-xs mt-4 table font-thin",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("td",{children:e.jsx(m,{control:l.control,name:"code",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(g,{type:"text",placeholder:"Insert code",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value),disabled:E===y.edit})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Name"}),e.jsx("td",{children:e.jsx(m,{control:l.control,name:"name",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(g,{type:"text",...a,value:a.value||"",onChange:r=>a.onChange(r.target.value)})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"For"}),e.jsx("td",{children:e.jsx(m,{control:l.control,name:"is_employee",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:e.jsxs(D,{onValueChange:r=>a.onChange(r==="true"),value:a.value?"true":"false",children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(A,{placeholder:"-"})}),e.jsxs(B,{children:[e.jsx(x,{value:"true",children:"Employee"},"is_employee"),e.jsx(x,{value:"false",children:"Family"},"is_employee")]})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Family Status"}),e.jsx("td",{children:e.jsx(m,{control:l.control,name:"family_status",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:e.jsxs(D,{onValueChange:r=>a.onChange(r),value:a.value,disabled:l.getValues("is_employee")===!0,children:[e.jsx(P,{className:"w-[200px]",children:e.jsx(A,{placeholder:"Select Family"})}),e.jsxs(B,{children:[e.jsx(x,{value:"husband",children:"Husband"}),e.jsx(x,{value:"wife",children:"Wife"}),e.jsx(x,{value:"child",children:"Child"})]})]})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Limit Request",e.jsx("p",{className:"text-xs italic text-slate-400",children:"( Clear the form input to set an unlimited limit for the request reimbursement )"})]}),e.jsx("td",{children:e.jsx(m,{control:l.control,name:"limit",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(g,{type:"text",onChange:r=>a.onChange(parseInt(r.target.value.replace(/[^0-9]/g,""))||""),value:a.value??""})}),e.jsx(h,{})]})})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"block",width:200,children:"Balance"}),e.jsxs("td",{children:[e.jsx(m,{control:l.control,name:"grade_option",render:({field:a})=>e.jsx(n,{children:e.jsx(o,{children:e.jsxs(ne,{value:a.value,onValueChange:a.onChange,className:"flex flex space-x-1 mb-3",children:[e.jsxs(n,{className:"flex text-xs items-center space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(L,{value:"all"})}),e.jsx(T,{className:"text-xs",children:"All"})]}),e.jsxs(n,{className:"flex items-center space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(L,{value:"grade"})}),e.jsx(T,{className:"text-xs",children:"Grade"})]})]})})})}),l.getValues("grade_option")==="all"?e.jsx("div",{children:e.jsx(m,{control:l.control,name:"grade_all_price",render:({field:a})=>e.jsx(n,{children:e.jsx(o,{children:e.jsx(g,{type:"text",onChange:r=>{const t=r.target.value.replace(/[^0-9]/g,""),i=w(t,!1);a.onChange(t),r.target.value=i},value:w(String(a.value),!1)||0})})})})}):e.jsx("div",{children:e.jsx(ie,{label:"grade",id:"id",options:U||[],value:l.getValues("grades").map(a=>a.id),isHidden:"hidden",onSelect:a=>{l.setValue("grades",a.map((r,t)=>{var i,s;return{id:r.id,grade:r.grade,plafon:((s=(i=l.getValues("grades"))==null?void 0:i[t])==null?void 0:s.plafon)||"0"}}))}})}),l.getValues("grade_option")==="grade"?e.jsx("div",{className:"mt-4",children:e.jsx("table",{children:W.map((a,r)=>e.jsxs("tr",{children:[e.jsxs("td",{children:["Balance Grade ",a.grade]}),e.jsx("td",{children:":"}),e.jsx("td",{children:e.jsx("div",{children:e.jsx(m,{control:l.control,name:`grades.${r}.plafon`,render:({field:t})=>e.jsxs(n,{children:[e.jsx(o,{children:e.jsx(g,{type:"text",placeholder:"0",onChange:i=>{const s=i.target.value.replace(/[^0-9]/g,""),c=w(s,!1);t.onChange(s),i.target.value=c},value:w(t.value,!1)})}),e.jsx(h,{})]})})})})]},a))})}):null]})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Interval Claim Period"}),e.jsx("td",{children:e.jsx(V,{options:q,fieldName:"interval_claim_period",placeholder:"Select Interval",classNames:"mt-2 w-full",fieldLabel:""})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Group"}),e.jsx("td",{children:e.jsx(V,{fieldLabel:"",options:p,fieldName:"material_group",isRequired:!0,disabled:!1,placeholder:"Material Group",classNames:"mt-2 w-full",onSearch:a=>{const r=p==null?void 0:p.some(t=>t.label===a);a.length>0&&!r?_("",{name:"material_group",id:"id",tabel:"material_groups",search:a}):a.length==0&&!r&&_("",{name:"material_group",id:"id",tabel:"material_groups"})},onChangeOutside:async(a,r)=>{await F(r==null?void 0:r.label.split(" - ")[1])},onFocus:async()=>{let a=l.getValues("material_group");await _("",{name:"material_group",id:"id",tabel:"material_groups",hasValue:{key:a?"id":"",value:a??""}})}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200,children:"Material Number"}),e.jsx("td",{children:e.jsx(V,{fieldLabel:"",options:f,fieldName:"material_number",isRequired:!0,disabled:!1,placeholder:"Material Number",classNames:"mt-2 w-full",onSearch:a=>{var s;const r=l.getValues("material_group"),t=(s=p.find(c=>c.value===r))==null?void 0:s.label,i=f==null?void 0:f.some(c=>c.label===a);a.length>0&&!i?b("",{name:"material_number",id:"id",tabel:"master_materials",where:{key:"material_group",parameter:t==null?void 0:t.split(" - ")[1]},search:a}):a.length==0&&!i&&b("",{name:"material_number",id:"id",tabel:"master_materials",where:{key:"material_group",parameter:t==null?void 0:t.split(" - ")[1]}})},onFocus:()=>{var i;const a=l.getValues("material_group"),r=(i=p.find(s=>s.value===a))==null?void 0:i.label;let t=l.getValues("material_number");b("",{name:"material_number",id:"id",tabel:"master_materials",where:{key:"material_group",parameter:r==null?void 0:r.split(" - ")[1]},hasValue:{key:t?"id":"",value:t??""}})}})})]})]}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(X,{type:"submit",children:"Save"})})]})})]})}const Te=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"}));export{Re as D,Ne as E,Ie as L,me as R,Fe as U,Te as f};
