import{u as X,r as Z,j as e}from"./app-XKnYn2VD.js";import{F as x,a as w,b as g,c as y}from"./form-49BbB1G_.js";import{B as ee}from"./button-J1C9WaiC.js";import{b as $}from"./index.esm-CNlm9SGe.js";/* empty css              */import{c as te}from"./tabs-CL4IULL_.js";import{C as q}from"./CustomDatePicker-pguDHUYT.js";import{h as u}from"./moment-C5S46NFB.js";import{F as A}from"./formDropdown-C7PE_YJ0.js";import{DetailAttedances as se}from"./DetailAttedances-DUmCc8yG.js";import{DetailAllowance as re}from"./DetailAllowance-AcI5JQou.js";import{ResultTotalItem as ae}from"./ResultTotalItem-LZ7VCgAk.js";import{C as le}from"./checkbox-DI0qOJ3t.js";import{u as oe}from"./getDropdown-BdfDPkET.js";import"./app-DQK4SJPx.js";import"./index-BoTSG41L.js";import"./utils-CJiH3LLn.js";import"./index-DHpjkJzF.js";import"./index-B6C2ATfF.js";import"./index-Bb4qSo10.js";import"./createLucideIcon-DsUJ9VhZ.js";import"./index-BvQ1Ufrw.js";import"./index-D_3DyjUg.js";import"./index-f1-NqBFt.js";import"./index-DZ1hfClm.js";import"./index-4aeJmtE7.js";import"./index-BCJSPaHq.js";import"./index-Btx_234K.js";import"./Combination-BrlylfCI.js";import"./TextField-CpbwzdIe.js";import"./createSvgIcon-Cw9I4Il8.js";import"./DefaultPropsProvider-B-rIy-89.js";import"./useSlot-3eBtPhqJ.js";import"./createSimplePaletteValueFilter-BbPMKl5t.js";import"./useControlled-C4e1T68a.js";import"./FormHelperText-DGDi7qaM.js";import"./input-BSvNoWzb.js";import"./select-VeKI-JE6.js";import"./index-BdQq_4o_.js";import"./index-aT947Ps9.js";import"./rupiahCurrencyFormat-D0mkqwcl.js";import"./chevrons-up-down-B4Ve8gkY.js";import"./axiosInstance-B3ganowK.js";import"./index-alTZxAjS.js";function tt({key:B,form:d,index:r,destination:a,updateDestination:n,listAllowances:T,setTotalAllowance:G,pajak:ie,purchasingGroup:ne,dataTax:L,dataPurchasingGroup:P,dataDestination:p,type:v,btClone:k,setSelectedDates:h,selectedDates:C,dateBusinessTripByUser:f}){const{fields:M,update:V,append:H,remove:Y}=$({control:d.control,name:`destinations.${r}.detail_attedances`}),{fields:F,update:de,append:ce,remove:z,replace:J}=$({control:d.control,name:`destinations.${r}.allowances`}),{showToast:N}=X(),{dataDropdown:S,getDropdown:j}=oe();function K(){let t=u(a.business_trip_start_date).startOf("day"),s=u(a.business_trip_end_date).startOf("day");if(Y(),z(),t.isAfter(s)){N("Start date must be before end date","error");return}let i=!1;for(let o in f){let c=u(f[o].from).startOf("day"),m=u(f[o].to).startOf("day");if(t.isBetween(c,m,null,"[)")||s.isBetween(c,m,null,"(]")||t.isBefore(c)&&s.isAfter(m)){i=!0;break}}if(i){N("Your Selected Range is Unavailable. Please Select Other Days","error");return}for(;t.isBefore(s)||t.isSame(s);){const o={date:t.toDate(),shift_code:"REGULERSHIFT",shift_start:"08:00",shift_end:"17:00",end_time:"17:00",start_time:"08:00",start_date:t.toDate(),end_date:t.toDate()};H(o),t=t.add(1,"days")}function l(o){let c=u(a.business_trip_start_date).startOf("day"),m=u(a.business_trip_end_date).startOf("day"),I=[];for(;c.isBefore(m)||c.isSame(m);)I.push({date:c.toDate(),request_price:o}),c=c.add(1,"days");return I}const W=T.map(o=>({name:o.name,code:o.code,default_price:parseInt(o.grade_price),type:o.type,subtotal:parseInt(o.grade_price),currency:o.currency_id,request_value:o.request_value,detail:o.type.toLowerCase()=="total"?[{date:null,request_price:parseInt(o.grade_price)}]:l(o.grade_price)}));J(W)}const R=(t,s)=>{n(s,{...a,business_trip_start_date:t}),h(i=>{const l=[...i];return l[s]={...l[s],from:t},l})},O=(t,s)=>{n(s,{...a,business_trip_end_date:t}),h(i=>{const l=[...i];return l[s]={...l[s],to:t},l})},[D,_]=Z.useState(),b={};D&&(b.selected=D);const E=(t,s)=>{s==="start"&&(n(t,{...a,business_trip_start_date:null}),h(i=>{const l=[...i];return l[t]={...l[t],from:void 0},l})),s==="end"&&(n(t,{...a,business_trip_end_date:null}),h(i=>{const l=[...i];return l[t]={...l[t],to:void 0},l})),_(void 0)};let Q=e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>E(r,"start"),children:"Reset"})}),U=e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>E(r,"end"),children:"Reset"})});return e.jsxs(te,{value:`destination${r+1}`,children:[e.jsxs("div",{children:[e.jsxs("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:[e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Destination",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(A,{fieldLabel:"",options:p,fieldName:`destinations.${r}.destination`,isRequired:!0,disabled:!1,placeholder:"Select Destination",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,destination:t})},onSearch:async t=>{const s=p==null?void 0:p.some(i=>i.label===t);t.length>0&&!s?await j(t,{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type},search:t}):t.length==0&&!s&&await j("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type}}),p=S},onFocus:async()=>{let t=d.getValues("cost_center");await j("",{name:"destination",id:"destination",tabel:"destinations",where:{key:"type",parameter:a.type},hasValue:{key:t?"id":"",value:t??""}}),p=S}})})]}),e.jsxs("tr",{children:[e.jsx("td",{width:200}),e.jsxs("td",{className:"flex gap-2",children:[e.jsx(x,{control:d.control,name:`destinations.${r}.restricted_area`,render:({field:t})=>e.jsxs(w,{children:[e.jsx(g,{children:e.jsx(le,{checked:a.restricted_area,onCheckedChange:s=>{n(r,{...a,restricted_area:s})}})}),e.jsx(y,{})]})}),"Restricted Area"]})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Tax",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(A,{fieldLabel:"",options:L,fieldName:`destinations.${r}.pajak_id`,isRequired:!0,disabled:!1,placeholder:"Select Tax",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,pajak_id:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Purchasing Group",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("td",{children:e.jsx(A,{fieldLabel:"",options:P,fieldName:`destinations.${r}.purchasing_group_id`,isRequired:!0,disabled:!1,placeholder:"Select Purchasing Group",classNames:"mt-2 w-full",onChangeOutside:t=>{n(r,{...a,purchasing_group_id:t})}})})]}),e.jsxs("tr",{children:[e.jsxs("td",{width:200,children:["Bussines Trip Date",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("td",{className:"flex items-center space-x-2",children:[e.jsx(x,{control:d.control,name:`destinations.${r}.business_trip_start_date`,render:({field:t})=>e.jsxs(w,{children:[e.jsx(g,{children:e.jsx(q,{initialDate:a.business_trip_start_date,modifiers:b,onDayClick:(s,i)=>{i.selected?(R(void 0,r),_(void 0),n(r,{...a,business_trip_start_date:void 0,business_trip_end_date:void 0})):(R(s,r),_(s),n(r,{...a,business_trip_start_date:s,business_trip_end_date:s}))},disabledDays:C,footer:Q})}),e.jsx(y,{})]})}),e.jsx("span",{children:"To"}),e.jsx(x,{control:d.control,name:`destinations.${r}.business_trip_end_date`,render:({field:t})=>e.jsxs(w,{children:[e.jsx(g,{children:e.jsx(q,{initialDate:a.business_trip_end_date,modifiers:b,onDayClick:(s,i)=>{i.selected?(O(void 0,r),_(void 0),n(r,{...a,business_trip_end_date:void 0})):(O(s,r),_(s),n(r,{...a,business_trip_end_date:s}))},disabled:!1,disabledDays:C,footer:U})}),e.jsx(y,{})]})}),e.jsx(ee,{type:"button",onClick:()=>K(),children:"Get Detail"})]})]})]}),e.jsx(se,{detailAttedanceFields:M,form:d,updateAttedanceFields:V,destinationIndex:r,type:v,btClone:k}),e.jsx("table",{className:"mt-4 text-xs font-thin reimburse-form-detail",children:e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm",children:"Detail Bussines Trip Allowance:"}),e.jsx("td",{})]})}),e.jsx(re,{allowanceField:F,destinationIndex:r,form:d,type:v,btClone:k})]},r),e.jsx(ae,{allowanceField:F,destinationIndex:r,form:d,setTotalAllowance:G})]},B)}export{tt as BussinessDestinationForm};
